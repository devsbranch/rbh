{"version":3,"file":"list.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/model/indicator.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/filter_list.js","../../../apps/frappe/frappe/public/js/frappe/ui/filters/field_select.js","../../../apps/frappe/frappe/public/js/frappe/ui/tags.js","../../../apps/frappe/frappe/public/js/frappe/ui/tag_editor.js","../../../apps/frappe/frappe/public/js/frappe/ui/like.js","../../../apps/frappe/frappe/public/js/frappe/list/base_list.js","../../../apps/frappe/frappe/public/js/frappe/list/bulk_operations.js","../../../apps/frappe/frappe/public/js/frappe/list/list_settings.js","../../../apps/frappe/frappe/public/js/frappe/list/list_view.js","../../../apps/frappe/frappe/public/js/frappe/list/list_factory.js","../../../apps/frappe/frappe/public/js/frappe/list/list_filter.js","../../../apps/frappe/frappe/public/js/frappe/views/file/file_view.js","../../../apps/frappe/frappe/public/js/frappe/views/interaction.js","../../../apps/frappe/frappe/public/js/frappe/list/list_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/list/list_sidebar_group_by.js","../../../apps/frappe/frappe/public/js/frappe/views/gantt/gantt_view.js","../../../apps/frappe/frappe/public/js/frappe/views/calendar/calendar.js","../../../apps/frappe/frappe/public/js/frappe/views/dashboard/dashboard_view.js","../../../apps/frappe/frappe/public/js/frappe/views/image/image_view.js","../../../apps/frappe/frappe/public/js/frappe/views/kanban/kanban_view.js","../../../apps/frappe/frappe/public/js/frappe/views/inbox/inbox_view.js","../../../apps/frappe/frappe/public/js/frappe/views/treeview.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n\nfrappe.has_indicator = function(doctype) {\n\t// returns true if indicator is present\n\tif(frappe.model.is_submittable(doctype)) {\n\t\treturn true;\n\t} else if((frappe.listview_settings[doctype] || {}).get_indicator\n\t\t|| frappe.workflow.get_state_fieldname(doctype)) {\n\t\treturn true;\n\t} else if(frappe.meta.has_field(doctype, 'enabled')\n\t\t|| frappe.meta.has_field(doctype, 'disabled')) {\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfrappe.get_indicator = function(doc, doctype) {\n\tif(doc.__unsaved) {\n\t\treturn [__(\"Not Saved\"), \"orange\"];\n\t}\n\n\tif(!doctype) doctype = doc.doctype;\n\n\tvar workflow = frappe.workflow.workflows[doctype];\n\tvar without_workflow = workflow ? workflow['override_status'] : true;\n\n\tvar settings = frappe.listview_settings[doctype] || {};\n\n\tvar is_submittable = frappe.model.is_submittable(doctype),\n\t\tworkflow_fieldname = frappe.workflow.get_state_fieldname(doctype);\n\n\t// workflow\n\tif(workflow_fieldname && !without_workflow) {\n\t\tvar value = doc[workflow_fieldname];\n\t\tif(value) {\n\t\t\tvar colour = \"\";\n\n\t\t\tif(locals[\"Workflow State\"][value] && locals[\"Workflow State\"][value].style) {\n\t\t\t\tvar colour = {\n\t\t\t\t\t\"Success\": \"green\",\n\t\t\t\t\t\"Warning\": \"orange\",\n\t\t\t\t\t\"Danger\": \"red\",\n\t\t\t\t\t\"Primary\": \"blue\",\n\t\t\t\t\t\"Inverse\": \"black\",\n\t\t\t\t\t\"Info\": \"light-blue\",\n\t\t\t\t}[locals[\"Workflow State\"][value].style];\n\t\t\t}\n\t\t\tif(!colour) colour = \"darkgrey\";\n\n\t\t\treturn [__(value), colour, workflow_fieldname + ',=,' + value];\n\t\t}\n\t}\n\n\t// draft if document is submittable\n\tif(is_submittable && doc.docstatus==0 && !settings.has_indicator_for_draft) {\n\t\treturn [__(\"Draft\"), \"red\", \"docstatus,=,0\"];\n\t}\n\n\t// cancelled\n\tif(is_submittable && doc.docstatus==2 && !settings.has_indicator_for_cancelled) {\n\t\treturn [__(\"Cancelled\"), \"red\", \"docstatus,=,2\"];\n\t}\n\n\tif(settings.get_indicator) {\n\t\tvar indicator = settings.get_indicator(doc);\n\t\tif(indicator) return indicator;\n\t}\n\n\t// if submittable\n\tif(is_submittable && doc.docstatus==1) {\n\t\treturn [__(\"Submitted\"), \"blue\", \"docstatus,=,1\"];\n\t}\n\n\t// based on status\n\tif(doc.status) {\n\t\treturn [__(doc.status), frappe.utils.guess_colour(doc.status)];\n\t}\n\n\t// based on enabled\n\tif(frappe.meta.has_field(doctype, 'enabled')) {\n\t\tif(doc.enabled) {\n\t\t\treturn [__('Enabled'), 'blue', 'enabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Disabled'), 'grey', 'enabled,=,0'];\n\t\t}\n\t}\n\n\t// based on disabled\n\tif(frappe.meta.has_field(doctype, 'disabled')) {\n\t\tif(doc.disabled) {\n\t\t\treturn [__('Disabled'), 'grey', 'disabled,=,1'];\n\t\t} else {\n\t\t\treturn [__('Enabled'), 'blue', 'disabled,=,0'];\n\t\t}\n\t}\n}\n","frappe.ui.Filter = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tif (this.value === null || this.value === undefined) {\n\t\t\tthis.value = '';\n\t\t}\n\n\t\tthis.utils = frappe.ui.filter_utils;\n\t\tthis.set_conditions();\n\t\tthis.set_conditions_from_config();\n\t\tthis.make();\n\t}\n\n\tset_conditions() {\n\t\tthis.conditions = [\n\t\t\t['=', __('Equals')],\n\t\t\t['!=', __('Not Equals')],\n\t\t\t['like', __('Like')],\n\t\t\t['not like', __('Not Like')],\n\t\t\t['in', __('In')],\n\t\t\t['not in', __('Not In')],\n\t\t\t['is', __('Is')],\n\t\t\t['>', '>'],\n\t\t\t['<', '<'],\n\t\t\t['>=', '>='],\n\t\t\t['<=', '<='],\n\t\t\t['Between', __('Between')],\n\t\t\t['Timespan', __('Timespan')],\n\t\t];\n\n\t\tthis.nested_set_conditions = [\n\t\t\t['descendants of', __('Descendants Of')],\n\t\t\t['not descendants of', __('Not Descendants Of')],\n\t\t\t['ancestors of', __('Ancestors Of')],\n\t\t\t['not ancestors of', __('Not Ancestors Of')],\n\t\t];\n\n\t\tthis.conditions.push(...this.nested_set_conditions);\n\n\t\tthis.invalid_condition_map = {\n\t\t\tDate: ['like', 'not like'],\n\t\t\tDatetime: ['like', 'not like'],\n\t\t\tData: ['Between', 'Timespan'],\n\t\t\tSelect: ['like', 'not like', 'Between', 'Timespan'],\n\t\t\tLink: ['Between', 'Timespan', '>', '<', '>=', '<='],\n\t\t\tCurrency: ['Between', 'Timespan'],\n\t\t\tColor: ['Between', 'Timespan'],\n\t\t\tCheck: this.conditions.map((c) => c[0]).filter((c) => c !== '='),\n\t\t};\n\t}\n\n\tset_conditions_from_config() {\n\t\tif (frappe.boot.additional_filters_config) {\n\t\t\tthis.filters_config = frappe.boot.additional_filters_config;\n\t\t\tfor (let key of Object.keys(this.filters_config)) {\n\t\t\t\tconst filter = this.filters_config[key];\n\t\t\t\tthis.conditions.push([key, __(`{0}`, [filter.label])]);\n\t\t\t\tfor (let fieldtype of Object.keys(this.invalid_condition_map)) {\n\t\t\t\t\tif (!filter.valid_for_fieldtypes.includes(fieldtype)) {\n\t\t\t\t\t\tthis.invalid_condition_map[fieldtype].push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tmake() {\n\t\tthis.filter_edit_area = $(\n\t\t\tfrappe.render_template('edit_filter', {\n\t\t\t\tconditions: this.conditions,\n\t\t\t})\n\t\t).appendTo(this.parent.find('.filter-edit-area'));\n\n\t\tthis.make_select();\n\t\tthis.set_events();\n\t\tthis.setup();\n\t}\n\n\tmake_select() {\n\t\tthis.fieldselect = new frappe.ui.FieldSelect({\n\t\t\tparent: this.filter_edit_area.find('.fieldname-select-area'),\n\t\t\tdoctype: this.parent_doctype,\n\t\t\tfilter_fields: this.filter_fields,\n\t\t\tselect: (doctype, fieldname) => {\n\t\t\t\tthis.set_field(doctype, fieldname);\n\t\t\t},\n\t\t});\n\n\t\tif (this.fieldname) {\n\t\t\tthis.fieldselect.set_value(this.doctype, this.fieldname);\n\t\t}\n\t}\n\n\tset_events() {\n\t\tthis.filter_edit_area.find('a.remove-filter').on('click', () => {\n\t\t\tthis.remove();\n\t\t});\n\n\t\tthis.filter_edit_area.find('.set-filter-and-run').on('click', () => {\n\t\t\tthis.filter_edit_area.removeClass('new-filter');\n\t\t\tthis.on_change();\n\t\t\tthis.update_filter_tag();\n\t\t});\n\n\t\tthis.filter_edit_area.find('.condition').change(() => {\n\t\t\tif (!this.field) return;\n\n\t\t\tlet condition = this.get_condition();\n\t\t\tlet fieldtype = null;\n\n\t\t\tif (['in', 'like', 'not in', 'not like'].includes(condition)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tthis.add_condition_help(condition);\n\t\t\t} else {\n\t\t\t\tthis.filter_edit_area.find('.filter-description').empty();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t['Select', 'MultiSelect'].includes(this.field.df.fieldtype) &&\n\t\t\t\t['in', 'not in'].includes(condition)\n\t\t\t) {\n\t\t\t\tfieldtype = 'MultiSelect';\n\t\t\t}\n\n\t\t\tthis.set_field(\n\t\t\t\tthis.field.df.parent,\n\t\t\t\tthis.field.df.fieldname,\n\t\t\t\tfieldtype,\n\t\t\t\tcondition\n\t\t\t);\n\t\t});\n\t}\n\n\tsetup() {\n\t\tconst fieldname = this.fieldname || 'name';\n\t\t// set the field\n\t\treturn this.set_values(this.doctype, fieldname, this.condition, this.value);\n\t}\n\n\tsetup_state(is_new) {\n\t\tlet promise = Promise.resolve();\n\t\tif (is_new) {\n\t\t\tthis.filter_edit_area.addClass('new-filter');\n\t\t} else {\n\t\t\tpromise = this.update_filter_tag();\n\t\t}\n\n\t\tif (this.hidden) {\n\t\t\tpromise.then(() => this.$filter_tag.hide());\n\t\t}\n\t}\n\n\tfreeze() {\n\t\tthis.update_filter_tag();\n\t}\n\n\tupdate_filter_tag() {\n\t\tif (this._filter_value_set) {\n\t\t\treturn this._filter_value_set.then(() => {\n\t\t\t\t!this.$filter_tag ? this.make_tag() : this.set_filter_button_text();\n\t\t\t\tthis.filter_edit_area.hide();\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\n\tremove() {\n\t\tthis.filter_edit_area.remove();\n\t\tthis.$filter_tag && this.$filter_tag.remove();\n\t\tthis.field = null;\n\t\tthis.on_change(true);\n\t}\n\n\tset_values(doctype, fieldname, condition, value) {\n\t\t// presents given (could be via tags!)\n\t\tif (this.set_field(doctype, fieldname) === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.field.df.original_type === 'Check') {\n\t\t\tvalue = value == 1 ? 'Yes' : 'No';\n\t\t}\n\t\tif (condition) this.set_condition(condition, true);\n\n\t\t// set value can be asynchronous, so update_filter_tag should happen after field is set\n\t\tthis._filter_value_set = Promise.resolve();\n\n\t\tif (['in', 'not in'].includes(condition) && Array.isArray(value)) {\n\t\t\tvalue = value.join(',');\n\t\t}\n\n\t\tif (Array.isArray(value)) {\n\t\t\tthis._filter_value_set = this.field.set_value(value);\n\t\t} else if (value !== undefined || value !== null) {\n\t\t\tthis._filter_value_set = this.field.set_value((value + '').trim());\n\t\t}\n\t\treturn this._filter_value_set;\n\t}\n\n\tset_field(doctype, fieldname, fieldtype, condition) {\n\t\t// set in fieldname (again)\n\t\tlet cur = {};\n\t\tif (this.field) for (let k in this.field.df) cur[k] = this.field.df[k];\n\n\t\tlet original_docfield = (this.fieldselect.fields_by_name[doctype] || {})[\n\t\t\tfieldname\n\t\t];\n\n\t\tif (!original_docfield) {\n\t\t\tconsole.warn(`Field ${fieldname} is not selectable.`);\n\t\t\tthis.remove();\n\t\t\treturn false;\n\t\t}\n\n\t\tlet df = copy_dict(original_docfield);\n\n\t\t// filter field shouldn't be read only or hidden\n\t\tdf.read_only = 0;\n\t\tdf.hidden = 0;\n\t\tdf.is_filter = true;\n\n\t\tlet c = condition ? condition : this.utils.get_default_condition(df);\n\t\tthis.set_condition(c);\n\n\t\tthis.utils.set_fieldtype(df, fieldtype, this.get_condition());\n\n\t\t// called when condition is changed,\n\t\t// don't change if all is well\n\t\tif (\n\t\t\tthis.field &&\n\t\t\tcur.fieldname == fieldname &&\n\t\t\tdf.fieldtype == cur.fieldtype &&\n\t\t\tdf.parent == cur.parent &&\n\t\t\tdf.options == cur.options\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// clear field area and make field\n\t\tthis.fieldselect.selected_doctype = doctype;\n\t\tthis.fieldselect.selected_fieldname = fieldname;\n\n\t\tif (\n\t\t\tthis.filters_config &&\n\t\t\tthis.filters_config[condition] &&\n\t\t\tthis.filters_config[condition].valid_for_fieldtypes.includes(df.fieldtype)\n\t\t) {\n\t\t\tlet args = {};\n\t\t\tif (this.filters_config[condition].depends_on) {\n\t\t\t\tconst field_name = this.filters_config[condition].depends_on;\n\t\t\t\tconst filter_value = this.filter_list.get_filter_value(fieldname);\n\t\t\t\targs[field_name] = filter_value;\n\t\t\t}\n\t\t\tfrappe\n\t\t\t\t.xcall(this.filters_config[condition].get_field, args)\n\t\t\t\t.then(field => {\n\t\t\t\t\tdf.fieldtype = field.fieldtype;\n\t\t\t\t\tdf.options = field.options;\n\t\t\t\t\tdf.fieldname = fieldname;\n\t\t\t\t\tthis.make_field(df, cur.fieldtype);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.make_field(df, cur.fieldtype);\n\t\t}\n\t}\n\n\tmake_field(df, old_fieldtype) {\n\t\tlet old_text = this.field ? this.field.get_value() : null;\n\t\tthis.hide_invalid_conditions(df.fieldtype, df.original_type);\n\t\tthis.toggle_nested_set_conditions(df);\n\t\tlet field_area = this.filter_edit_area.find('.filter-field').empty().get(0);\n\t\tlet f = frappe.ui.form.make_control({\n\t\t\tdf: df,\n\t\t\tparent: field_area,\n\t\t\tonly_input: true,\n\t\t});\n\t\tf.refresh();\n\n\t\tthis.field = f;\n\t\tif (old_text && f.fieldtype === old_fieldtype) {\n\t\t\tthis.field.set_value(old_text);\n\t\t}\n\n\t\t// run on enter\n\t\t$(this.field.wrapper)\n\t\t\t.find(':input')\n\t\t\t.keydown(e => {\n\t\t\t\tif (e.which == 13 && this.field.df.fieldtype !== 'MultiSelect') {\n\t\t\t\t\tthis.on_change();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tget_value() {\n\t\treturn [\n\t\t\tthis.fieldselect.selected_doctype,\n\t\t\tthis.field.df.fieldname,\n\t\t\tthis.get_condition(),\n\t\t\tthis.get_selected_value(),\n\t\t\tthis.hidden,\n\t\t];\n\t}\n\tget_selected_value() {\n\t\treturn this.utils.get_selected_value(this.field, this.get_condition());\n\t}\n\n\tget_condition() {\n\t\treturn this.filter_edit_area.find('.condition').val();\n\t}\n\n\tset_condition(condition, trigger_change = false) {\n\t\tlet $condition_field = this.filter_edit_area.find('.condition');\n\t\t$condition_field.val(condition);\n\t\tif (trigger_change) $condition_field.change();\n\t}\n\n\tmake_tag() {\n\t\tif (!this.field) return;\n\t\tthis.$filter_tag = this.get_filter_tag_element().insertAfter(\n\t\t\tthis.parent.find('.active-tag-filters .clear-filters')\n\t\t);\n\t\tthis.set_filter_button_text();\n\t\tthis.bind_tag();\n\t}\n\n\tbind_tag() {\n\t\tthis.$filter_tag.find('.remove-filter').on('click', this.remove.bind(this));\n\n\t\tlet filter_button = this.$filter_tag.find('.toggle-filter');\n\t\tfilter_button.on('click', () => {\n\t\t\tfilter_button\n\t\t\t\t.closest('.tag-filters-area')\n\t\t\t\t.find('.filter-edit-area')\n\t\t\t\t.show();\n\t\t\tthis.filter_edit_area.toggle();\n\t\t});\n\t}\n\n\tset_filter_button_text() {\n\t\tthis.$filter_tag.find('.toggle-filter').html(this.get_filter_button_text());\n\t}\n\n\tget_filter_button_text() {\n\t\tlet value = this.utils.get_formatted_value(\n\t\t\tthis.field,\n\t\t\tthis.get_selected_value()\n\t\t);\n\t\treturn `${__(this.field.df.label)} ${__(this.get_condition())} ${__(\n\t\t\tvalue\n\t\t)}`;\n\t}\n\n\tget_filter_tag_element() {\n\t\treturn $(`<div class=\"filter-tag btn-group\">\n\t\t\t<button class=\"btn btn-default btn-xs toggle-filter\"\n\t\t\t\ttitle=\"${__('Edit Filter')}\">\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-default btn-xs remove-filter\"\n\t\t\t\ttitle=\"${__('Remove Filter')}\">\n\t\t\t\t<i class=\"fa fa-remove text-muted\"></i>\n\t\t\t</button>\n\t\t</div>`);\n\t}\n\n\tadd_condition_help(condition) {\n\t\tconst description = ['in', 'not in'].includes(condition)\n\t\t\t? __('values separated by commas')\n\t\t\t: __('use % as wildcard');\n\n\t\tthis.filter_edit_area.find('.filter-description').html(description);\n\t}\n\n\thide_invalid_conditions(fieldtype, original_type) {\n\t\tlet invalid_conditions =\n\t\t\tthis.invalid_condition_map[original_type] ||\n\t\t\tthis.invalid_condition_map[fieldtype] ||\n\t\t\t[];\n\n\t\tfor (let condition of this.conditions) {\n\t\t\tthis.filter_edit_area\n\t\t\t\t.find(`.condition option[value=\"${condition[0]}\"]`)\n\t\t\t\t.toggle(!invalid_conditions.includes(condition[0]));\n\t\t}\n\t}\n\n\ttoggle_nested_set_conditions(df) {\n\t\tlet show_condition =\n\t\t\tdf.fieldtype === 'Link' &&\n\t\t\tfrappe.boot.nested_set_doctypes.includes(df.options);\n\t\tthis.nested_set_conditions.forEach((condition) => {\n\t\t\tthis.filter_edit_area\n\t\t\t\t.find(`.condition option[value=\"${condition[0]}\"]`)\n\t\t\t\t.toggle(show_condition);\n\t\t});\n\t}\n};\n\nfrappe.ui.filter_utils = {\n\tget_formatted_value(field, value) {\n\t\tif (field.df.fieldname === 'docstatus') {\n\t\t\tvalue = { 0: 'Draft', 1: 'Submitted', 2: 'Cancelled' }[value] || value;\n\t\t} else if (field.df.original_type === 'Check') {\n\t\t\tvalue = { 0: 'No', 1: 'Yes' }[cint(value)];\n\t\t}\n\t\treturn frappe.format(value, field.df, { only_value: 1 });\n\t},\n\n\tget_selected_value(field, condition) {\n\t\tlet val = field.get_value();\n\n\t\tif (typeof val === 'string') {\n\t\t\tval = strip(val);\n\t\t}\n\n\t\tif (condition == 'is' && !val) {\n\t\t\tval = field.df.options[0].value;\n\t\t}\n\n\t\tif (field.df.original_type == 'Check') {\n\t\t\tval = val == 'Yes' ? 1 : 0;\n\t\t}\n\n\t\tif (condition.indexOf('like', 'not like') !== -1) {\n\t\t\t// automatically append wildcards\n\t\t\tif (val && !(val.startsWith('%') || val.endsWith('%'))) {\n\t\t\t\tval = '%' + val + '%';\n\t\t\t}\n\t\t} else if (in_list(['in', 'not in'], condition)) {\n\t\t\tif (val) {\n\t\t\t\tval = val.split(',').map((v) => strip(v));\n\t\t\t}\n\t\t}\n\t\tif (val === '%') {\n\t\t\tval = '';\n\t\t}\n\n\t\treturn val;\n\t},\n\n\tget_default_condition(df) {\n\t\tif (df.fieldtype == 'Data') {\n\t\t\treturn 'like';\n\t\t} else if (df.fieldtype == 'Date' || df.fieldtype == 'Datetime') {\n\t\t\treturn 'Between';\n\t\t} else {\n\t\t\treturn '=';\n\t\t}\n\t},\n\n\tset_fieldtype(df, fieldtype, condition) {\n\t\t// reset\n\t\tif (df.original_type) df.fieldtype = df.original_type;\n\t\telse df.original_type = df.fieldtype;\n\n\t\tdf.description = '';\n\t\tdf.reqd = 0;\n\t\tdf.ignore_link_validation = true;\n\n\t\t// given\n\t\tif (fieldtype) {\n\t\t\tdf.fieldtype = fieldtype;\n\t\t\treturn;\n\t\t}\n\n\t\t// scrub\n\t\tif (df.fieldname == 'docstatus') {\n\t\t\tdf.fieldtype = 'Select',\n\t\t\tdf.options = [\n\t\t\t\t{ value: 0, label: __('Draft') },\n\t\t\t\t{ value: 1, label: __('Submitted') },\n\t\t\t\t{ value: 2, label: __('Cancelled') },\n\t\t\t];\n\t\t} else if (df.fieldtype == 'Check') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = 'No\\nYes';\n\t\t} else if (\n\t\t\t[\n\t\t\t\t'Text',\n\t\t\t\t'Small Text',\n\t\t\t\t'Text Editor',\n\t\t\t\t'Code',\n\t\t\t\t'Tag',\n\t\t\t\t'Comments',\n\t\t\t\t'Dynamic Link',\n\t\t\t\t'Read Only',\n\t\t\t\t'Assign',\n\t\t\t].indexOf(df.fieldtype) != -1\n\t\t) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if (\n\t\t\tdf.fieldtype == 'Link' &&\n\t\t\t[\n\t\t\t\t'=',\n\t\t\t\t'!=',\n\t\t\t\t'descendants of',\n\t\t\t\t'ancestors of',\n\t\t\t\t'not descendants of',\n\t\t\t\t'not ancestors of',\n\t\t\t].indexOf(condition) == -1\n\t\t) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif (\n\t\t\tdf.fieldtype === 'Data' &&\n\t\t\t(df.options || '').toLowerCase() === 'email'\n\t\t) {\n\t\t\tdf.options = null;\n\t\t}\n\t\tif (\n\t\t\tcondition == 'Between' &&\n\t\t\t(df.fieldtype == 'Date' || df.fieldtype == 'Datetime')\n\t\t) {\n\t\t\tdf.fieldtype = 'DateRange';\n\t\t}\n\t\tif (\n\t\t\tcondition == 'Timespan' &&\n\t\t\t['Date', 'Datetime', 'DateRange', 'Select'].includes(df.fieldtype)\n\t\t) {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = this.get_timespan_options(['Last', 'Today', 'This', 'Next']);\n\t\t}\n\t\tif (condition === 'is') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [\n\t\t\t\t{ label: __('Set'), value: 'set' },\n\t\t\t\t{ label: __('Not Set'), value: 'not set' },\n\t\t\t];\n\t\t}\n\t\treturn;\n\t},\n\n\tget_timespan_options(periods) {\n\t\tconst period_map = {\n\t\t\tLast: ['Week', 'Month', 'Quarter', '6 months', 'Year'],\n\t\t\tToday: null,\n\t\t\tThis: ['Week', 'Month', 'Quarter', 'Year'],\n\t\t\tNext: ['Week', 'Month', 'Quarter', '6 months', 'Year'],\n\t\t};\n\t\tlet options = [];\n\t\tperiods.forEach((period) => {\n\t\t\tif (period_map[period]) {\n\t\t\t\tperiod_map[period].forEach((p) => {\n\t\t\t\t\toptions.push({\n\t\t\t\t\t\tlabel: __(`{0} {1}`, [period, p]),\n\t\t\t\t\t\tvalue: `${period.toLowerCase()} ${p.toLowerCase()}`,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\toptions.push({\n\t\t\t\t\tlabel: __(`{0}`, [period]),\n\t\t\t\t\tvalue: `${period.toLowerCase()}`,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn options;\n\t},\n};\n","frappe.ui.FilterGroup = class {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.wrapper = this.parent;\n\t\tthis.filters = [];\n\t\tthis.make();\n\t\twindow.fltr = this;\n\t}\n\n\tmake() {\n\t\tthis.wrapper.append(this.get_container_template());\n\t\tthis.set_events();\n\t}\n\n\ttoggle_clear_filter() {\n\t\tlet clear_filter_button = this.wrapper.find('.clear-filters');\n\n\t\tif (this.filters.length == 0) {\n\t\t\tclear_filter_button.hide();\n\t\t} else {\n\t\t\tclear_filter_button.show();\n\t\t}\n\t}\n\tset_events() {\n\t\tthis.wrapper.find('.add-filter').on('click', () => {\n\t\t\tthis.add_filter(this.doctype, 'name')\n\t\t\t\t.then(this.toggle_clear_filter());\n\n\t\t});\n\t\tthis.wrapper.find('.clear-filters').on('click', () => {\n\t\t\tthis.clear_filters();\n\t\t});\n\t}\n\n\tadd_filters(filters) {\n\t\tlet promises = [];\n\n\t\tfor (const filter of filters) {\n\t\t\tpromises.push(() => this.add_filter(...filter));\n\t\t}\n\n\t\tpromises.push(() => this.toggle_clear_filter());\n\n\t\treturn frappe.run_serially(promises);\n\t}\n\n\tadd_filter(doctype, fieldname, condition, value, hidden) {\n\t\tif (!fieldname) return Promise.resolve();\n\t\t// adds a new filter, returns true if filter has been added\n\n\t\t// {}: Add in page filter by fieldname if exists ('=' => 'like')\n\n\t\tif(!this.validate_args(doctype, fieldname)) return false;\n\t\tconst is_new_filter = arguments.length < 2;\n\t\tif (is_new_filter && this.wrapper.find(\".new-filter:visible\").length) {\n\t\t\t// only allow 1 new filter at a time!\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\tlet args = [doctype, fieldname, condition, value, hidden];\n\t\t\tconst promise = this.push_new_filter(args, is_new_filter);\n\t\t\treturn (promise && promise.then) ? promise : Promise.resolve();\n\t\t}\n\t}\n\n\tvalidate_args(doctype, fieldname) {\n\n\t\tif(doctype && fieldname\n\t\t\t&& !frappe.meta.has_field(doctype, fieldname)\n\t\t\t&& !frappe.model.std_fields_list.includes(fieldname)) {\n\n\t\t\tfrappe.throw(__(`Invalid filter: \"${[fieldname.bold()]}\"`));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpush_new_filter(args, is_new_filter=false) {\n\t\t// args: [doctype, fieldname, condition, value]\n\t\tif(this.filter_exists(args)) return;\n\n\t\t// {}: Clear page filter fieldname field\n\n\t\tlet filter = this._push_new_filter(...args);\n\n\t\tif (filter && filter.value) {\n\t\t\tfilter.setup_state(is_new_filter);\n\t\t\treturn filter._filter_value_set; // internal promise\n\t\t}\n\t}\n\n\t_push_new_filter(doctype, fieldname, condition, value, hidden = false) {\n\t\tlet args = {\n\t\t\tparent: this.wrapper,\n\t\t\tparent_doctype: this.doctype,\n\t\t\tdoctype: doctype,\n\t\t\tfieldname: fieldname,\n\t\t\tcondition: condition,\n\t\t\tvalue: value,\n\t\t\thidden: hidden,\n\t\t\ton_change: (update) => {\n\t\t\t\tif(update) this.update_filters();\n\t\t\t\tthis.on_change();\n\t\t\t},\n\t\t\tfilter_items: (doctype, fieldname) => {\n\t\t\t\treturn !this.filter_exists([doctype, fieldname]);\n\t\t\t},\n\t\t\tfilter_list: this.base_list || this,\n\t\t};\n\t\tlet filter = new frappe.ui.Filter(args);\n\t\tthis.filters.push(filter);\n\t\treturn filter;\n\t}\n\n\tget_filter_value(fieldname) {\n\t\tlet filter_obj = this.filters.find(f => f.fieldname == fieldname) || {};\n\t\treturn filter_obj.value;\n\t}\n\n\tfilter_exists(filter_value) {\n\t\t// filter_value of form: [doctype, fieldname, condition, value]\n\t\tlet exists = false;\n\t\tthis.filters.filter(f => f.field).map(f => {\n\t\t\tlet f_value = f.get_value();\n\t\t\tif (filter_value.length === 2) {\n\t\t\t\texists = filter_value[0] === f_value[0] && filter_value[1] === f_value[1];\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet value = filter_value[3];\n\t\t\tlet equal = frappe.utils.arrays_equal;\n\n\t\t\tif(equal(f_value.slice(0, 4), filter_value.slice(0, 4)) || (Array.isArray(value) && equal(value, f_value[3]))) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t});\n\t\treturn exists;\n\t}\n\n\tget_filters() {\n\t\treturn this.filters.filter(f => f.field).map(f => {\n\t\t\treturn f.get_value();\n\t\t});\n\t\t// {}: this.list.update_standard_filters(values);\n\t}\n\n\tupdate_filters() {\n\t\tthis.filters = this.filters.filter(f => f.field); // remove hidden filters\n\t\tthis.toggle_clear_filter();\n\t}\n\n\tclear_filters() {\n\t\tthis.filters.map(f => f.remove(true));\n\t\t// {}: Clear page filters, .date-range-picker (called list run())\n\t\tthis.filters = [];\n\t}\n\n\tget_filter(fieldname) {\n\t\treturn this.filters.filter(f => {\n\t\t\treturn (f.field && f.field.df.fieldname==fieldname);\n\t\t})[0];\n\t}\n\n\tget_container_template() {\n\t\treturn $(`<div class=\"tag-filters-area\">\n\t\t\t<div class=\"active-tag-filters\">\n\t\t\t\t<button class=\"btn btn-default btn-xs filter-button text-muted add-filter\">\n\t\t\t\t\t${__(\"Add Filter\")}\n\t\t\t\t</button><button class=\"btn btn-default btn-xs filter-button text-muted clear-filters\" style=\"display: none;\">\n\t\t\t\t\t${__(\"Clear Filters\")}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"filter-edit-area\"></div>`);\n\t}\n\n\tget_filters_as_object() {\n\t\tlet filters = this.get_filters().reduce((acc, filter) => {\n\t\t\treturn Object.assign(acc, {\n\t\t\t\t[filter[1]]: [filter[2], filter[3]]\n\t\t\t});\n\t\t}, {});\n\t\treturn filters;\n\t}\n\n\tadd_filters_to_filter_group(filters) {\n\n\t\tfilters.forEach(filter => {\n\t\t\tthis.add_filter(filter[0], filter[1], filter[2], filter[3]);\n\t\t});\n\t}\n};\n","// <select> widget with all fields of a doctype as options\nfrappe.ui.FieldSelect = Class.extend({\n\t// opts parent, doctype, filter_fields, with_blank, select\n\tinit(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.fields_by_name = {};\n\t\tthis.options = [];\n\t\tthis.$input = $('<input class=\"form-control\">')\n\t\t\t.appendTo(this.parent)\n\t\t\t.on(\"click\", function () { $(this).select(); });\n\t\tthis.select_input = this.$input.get(0);\n\t\tthis.awesomplete = new Awesomplete(this.select_input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: me.options,\n\t\t\titem(item) {\n\t\t\t\treturn $(repl('<li class=\"filter-field-select\"><p>%(label)s</p></li>', item))\n\t\t\t\t\t.data(\"item.autocomplete\", item)\n\t\t\t\t\t.get(0);\n\t\t\t}\n\t\t});\n\t\tthis.$input.on(\"awesomplete-select\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.selected_doctype = item.doctype;\n\t\t\tme.selected_fieldname = item.fieldname;\n\t\t\tif(me.select) me.select(item.doctype, item.fieldname);\n\t\t});\n\t\tthis.$input.on(\"awesomplete-selectcomplete\", function(e) {\n\t\t\tvar o = e.originalEvent;\n\t\t\tvar value = o.text.value;\n\t\t\tvar item = me.awesomplete.get_item(value);\n\t\t\tme.$input.val(item.label);\n\t\t});\n\n\t\tif(this.filter_fields) {\n\t\t\tfor(var i in this.filter_fields)\n\t\t\t\tthis.add_field_option(this.filter_fields[i]);\n\t\t} else {\n\t\t\tthis.build_options();\n\t\t}\n\t\tthis.set_value(this.doctype, \"name\");\n\t},\n\tget_value() {\n\t\treturn this.selected_doctype ? this.selected_doctype + \".\" + this.selected_fieldname : null;\n\t},\n\tval(value) {\n\t\tif(value===undefined) {\n\t\t\treturn this.get_value();\n\t\t} else {\n\t\t\tthis.set_value(value);\n\t\t}\n\t},\n\tclear() {\n\t\tthis.selected_doctype = null;\n\t\tthis.selected_fieldname = null;\n\t\tthis.$input.val(\"\");\n\t},\n\tset_value(doctype, fieldname) {\n\t\tvar me = this;\n\t\tthis.clear();\n\t\tif(!doctype) return;\n\n\t\t// old style\n\t\tif(doctype.indexOf(\".\")!==-1) {\n\t\t\tvar parts = doctype.split(\".\");\n\t\t\tdoctype = parts[0];\n\t\t\tfieldname = parts[1];\n\t\t}\n\n\t\t$.each(this.options, function(i, v) {\n\t\t\tif(v.doctype===doctype && v.fieldname===fieldname) {\n\t\t\t\tme.selected_doctype = doctype;\n\t\t\t\tme.selected_fieldname = fieldname;\n\t\t\t\tme.$input.val(v.label);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tbuild_options() {\n\t\tvar me = this;\n\t\tme.table_fields = [];\n\t\tvar std_filters = $.map(frappe.model.std_fields, function(d) {\n\t\t\tvar opts = {parent: me.doctype};\n\t\t\tif(d.fieldname==\"name\") opts.options = me.doctype;\n\t\t\treturn $.extend(copy_dict(d), opts);\n\t\t});\n\n\t\t// add parenttype column\n\t\tvar doctype_obj = locals['DocType'][me.doctype];\n\t\tif(doctype_obj && cint(doctype_obj.istable)) {\n\t\t\tstd_filters = std_filters.concat([{\n\t\t\t\tfieldname: 'parent',\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: 'Parent',\n\t\t\t\tparent: me.doctype,\n\t\t\t}]);\n\t\t}\n\n\t\t// blank\n\t\tif(this.with_blank) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel:\"\",\n\t\t\t\tvalue:\"\",\n\t\t\t});\n\t\t}\n\n\t\t// main table\n\t\tvar main_table_fields = std_filters.concat(frappe.meta.docfield_list[me.doctype]);\n\t\t$.each(frappe.utils.sort(main_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\"))\n\t\t\t\tme.add_field_option(df);\n\t\t});\n\n\t\t// child tables\n\t\t$.each(me.table_fields, function(i, table_df) {\n\t\t\tif(table_df.options) {\n\t\t\t\tlet child_table_fields = [].concat(frappe.meta.docfield_list[table_df.options]);\n\n\t\t\t\tif (table_df.fieldtype === \"Table MultiSelect\") {\n\t\t\t\t\tconst link_field = frappe.meta.get_docfields(table_df.options)\n\t\t\t\t\t\t.find(df => df.fieldtype === 'Link');\n\t\t\t\t\tchild_table_fields = link_field ? [link_field] : [];\n\t\t\t\t}\n\n\t\t\t\t$.each(frappe.utils.sort(child_table_fields, \"label\", \"string\"), function(i, df) {\n\t\t\t\t\t// show fields where user has read access and if report hide flag is not set\n\t\t\t\t\tif(frappe.perm.has_perm(me.doctype, df.permlevel, \"read\"))\n\t\t\t\t\t\tme.add_field_option(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_field_option(df) {\n\t\tlet me = this;\n\n\t\tif (df.fieldname == 'docstatus' && !frappe.model.is_submittable(me.doctype))\n\t\t\treturn;\n\n\t\tif (frappe.model.table_fields.includes(df.fieldtype)) {\n\t\t\tme.table_fields.push(df);\n\t\t\treturn;\n\t\t}\n\n\t\tlet label = null;\n\t\tlet table = null;\n\n\t\tif(me.doctype && df.parent==me.doctype) {\n\t\t\tlabel = __(df.label);\n\t\t\ttable = me.doctype;\n\t\t} else {\n\t\t\tlabel = __(df.label) + ' (' + __(df.parent) + ')';\n\t\t\ttable = df.parent;\n\t\t}\n\n\t\tif(frappe.model.no_value_type.indexOf(df.fieldtype) == -1 &&\n\t\t\t!(me.fields_by_name[df.parent] && me.fields_by_name[df.parent][df.fieldname])) {\n\t\t\tthis.options.push({\n\t\t\t\tlabel: label,\n\t\t\t\tvalue: table + \".\" + df.fieldname,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tdoctype: df.parent\n\t\t\t});\n\t\t\tif(!me.fields_by_name[df.parent]) me.fields_by_name[df.parent] = {};\n\t\t\tme.fields_by_name[df.parent][df.fieldname] = df;\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.Tags = class {\n\tconstructor({\n\t\tparent, placeholder, tagsList,\n\t\tonTagAdd,\n\t\tonTagRemove,\n\t\tonTagClick,\n\t\tonChange\n\t}) {\n\t\tthis.tagsList = tagsList || [];\n\t\tthis.onTagAdd = onTagAdd;\n\t\tthis.onTagRemove = onTagRemove;\n\t\tthis.onTagClick = onTagClick;\n\t\tthis.onChange = onChange;\n\n\t\tthis.setup(parent, placeholder);\n\t}\n\n\tsetup(parent, placeholder) {\n\t\tthis.$wrapper = $(`<div class=\"tags-wrapper\"></div>`).appendTo(parent);\n\t\tthis.$ul = $(`<ul class=\"tags-list\"></ul>`).appendTo(this.$wrapper);\n\t\tthis.$input = $(`<input class=\"tags-input\"></input>`);\n\n\t\tthis.$inputWrapper = this.getListElement(this.$input);\n\t\tthis.$placeholder = this.getListElement($(`<span class=\"tags-placeholder text-muted\">${placeholder}</span>`));\n\t\tthis.$inputWrapper.appendTo(this.$ul);\n\t\tthis.$placeholder.appendTo(this.$ul);\n\n\t\tthis.deactivate();\n\t\tthis.bind();\n\t\tthis.boot();\n\t}\n\n\tbind() {\n\t\tconst me = this;\n\t\tconst select_tag = function() {\n\t\t\tconst tagValue = frappe.utils.xss_sanitise(me.$input.val());\n\t\t\tme.addTag(tagValue);\n\t\t\tme.$input.val('');\n\t\t}\n\n\t\tthis.$input.keypress((e) => {\n\t\t\tif (e.which == 13 || e.keyCode == 13) select_tag();\n\t\t});\n\t\tthis.$input.focusout(select_tag);\n\n\t\tthis.$input.on('blur', () => {\n\t\t\tthis.deactivate();\n\t\t});\n\n\t\tthis.$placeholder.on('click', () => {\n\t\t\tthis.activate();\n\t\t\tthis.$input.focus(); // focus only when clicked\n\t\t});\n\t}\n\n\tboot() {\n\t\tthis.addTags(this.tagsList);\n\t}\n\n\tactivate() {\n\t\tthis.$placeholder.hide();\n\t\tthis.$inputWrapper.show();\n\t}\n\n\tdeactivate() {\n\t\tthis.$inputWrapper.hide();\n\t\tthis.$placeholder.show();\n\t}\n\n\taddTag(label) {\n\t\tif(label && label!== '' && !this.tagsList.includes(label)) {\n\t\t\tlet $tag = this.getTag(label);\n\t\t\tthis.getListElement($tag).insertBefore(this.$inputWrapper);\n\t\t\tthis.tagsList.push(label);\n\t\t\tthis.onTagAdd && this.onTagAdd(label);\n\t\t}\n\t}\n\n\tremoveTag(label) {\n\t\tlabel = frappe.utils.xss_sanitise(label);\n\t\tif(this.tagsList.includes(label)) {\n\t\t\tthis.tagsList.splice(this.tagsList.indexOf(label), 1);\n\t\t\tthis.onTagRemove && this.onTagRemove(label);\n\t\t}\n\t}\n\n\taddTags(labels) {\n\t\tlabels.map(this.addTag.bind(this));\n\t}\n\n\tclearTags() {\n\t\tthis.$ul.find('.frappe-tag').remove();\n\t\tthis.tagsList = [];\n\t}\n\n\tgetListElement($element, className) {\n\t\tlet $li = $(`<li class=\"tags-list-item ${className}\"></li>`);\n\t\t$element.appendTo($li);\n\t\treturn $li;\n\t}\n\n\tgetTag(label) {\n\t\tlet $tag = $(`<div class=\"frappe-tag btn-group\" data-tag-label=\"${label}\">\n\t\t\t<button class=\"btn btn-default btn-xs toggle-tag\"\n\t\t\t\ttitle=\"${ __(\"toggle Tag\") }\"\n\t\t\t\tdata-tag-label=\"${label}\">#${label}\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-default btn-xs remove-tag\"\n\t\t\t\ttitle=\"${ __(\"Remove Tag\") }\"\n\t\t\t\tdata-tag-label=\"${label}\">\n\t\t\t\t<i class=\"fa fa-remove text-muted\"></i>\n\t\t\t</button></div>`);\n\n\t\tlet $searchTag = $tag.find(\".toggle-tag\");\n\t\tlet $removeTag = $tag.find(\".remove-tag\");\n\n\t\t$searchTag.on(\"click\", () => {\n\t\t\tfrappe.searchdialog.search.init_search(\"#\".concat($searchTag.attr('data-tag-label')), \"tags\");\n\t\t});\n\n\t\t$removeTag.on(\"click\", () => {\n\t\t\tthis.removeTag($removeTag.attr('data-tag-label'));\n\t\t\t$removeTag.closest('.tags-list-item').remove();\n\t\t});\n\n\t\tif(this.onTagClick) {\n\t\t\tlet $toggle_tag = $tag.find(\".toggle-tag\");\n\t\t\t$toggle_tag.on(\"click\", () => {\n\t\t\t\tthis.onTagClick($toggle_tag.attr('data-tag-label'));\n\t\t\t});\n\t\t}\n\n\t\treturn $tag;\n\t}\n}\n","frappe.ui.TagEditor = Class.extend({\n\tinit: function(opts) {\n\t\t/* docs:\n\t\tArguments\n\n\t\t- parent\n\t\t- user_tags\n\t\t- doctype\n\t\t- docname\n\t\t*/\n\t\t$.extend(this, opts);\n\n\t\tthis.setup_tags();\n\n\t\tif (!this.user_tags) {\n\t\t\tthis.user_tags = \"\";\n\t\t}\n\t\tthis.initialized = true;\n\t\tthis.refresh(this.user_tags);\n\t},\n\tsetup_tags: function() {\n\t\tvar me = this;\n\n\t\t// hidden form, does not have parent\n\t\tif (!this.parent) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"tag-line\" style=\"position: relative\">').appendTo(this.parent);\n\t\tif(!this.wrapper.length) return;\n\n\t\tthis.tags = new frappe.ui.Tags({\n\t\t\tparent: this.wrapper,\n\t\t\tplaceholder: __(\"Add a tag ...\"),\n\t\t\tonTagAdd: (tag) => {\n\t\t\t\tif(me.initialized && !me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.add_tag\",\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags ? me.user_tags.split(\",\") : [];\n\t\t\t\t\t\t\tuser_tags.push(tag)\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t\tfrappe.tags.utils.fetch_tags();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonTagRemove: (tag) => {\n\t\t\t\tif(!me.refreshing) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.remove_tag\",\n\t\t\t\t\t\targs: me.get_args(tag),\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tvar user_tags = me.user_tags.split(\",\");\n\t\t\t\t\t\t\tuser_tags.splice(user_tags.indexOf(tag), 1);\n\t\t\t\t\t\t\tme.user_tags = user_tags.join(\",\");\n\t\t\t\t\t\t\tme.on_change && me.on_change(me.user_tags);\n\t\t\t\t\t\t\tfrappe.tags.utils.fetch_tags();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.setup_awesomplete();\n\t\tthis.setup_complete = true;\n\t},\n\tsetup_awesomplete: function() {\n\t\tvar me = this;\n\t\tvar $input = this.wrapper.find(\"input.tags-input\");\n\t\tvar input = $input.get(0);\n\t\tthis.awesomplete = new Awesomplete(input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tlist: []\n\t\t});\n\t\t$input.on(\"awesomplete-open\", function(e){\n\t\t\t$input.attr('state', 'open');\n\t\t});\n\t\t$input.on(\"awesomplete-close\", function(e){\n\t\t\t$input.attr('state', 'closed');\n\t\t});\n\t\t$input.on(\"input\", function(e) {\n\t\t\tvar value = e.target.value;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.doctype.tag.tag.get_tags\",\n\t\t\t\targs:{\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\ttxt: value.toLowerCase(),\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.awesomplete.list = r.message;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t$input.on(\"focus\", function(e) {\n\t\t\tif($input.attr('state') != 'open') {\n\t\t\t\t$input.trigger(\"input\");\n\t\t\t}\n\t\t});\n\t},\n\tget_args: function(tag) {\n\t\treturn {\n\t\t\ttag: tag,\n\t\t\tdt: this.frm.doctype,\n\t\t\tdn: this.frm.docname,\n\t\t}\n\t},\n\trefresh: function(user_tags) {\n\t\tvar me = this;\n\t\tif (!this.initialized || !this.setup_complete || this.refreshing) return;\n\n\t\tme.refreshing = true;\n\t\ttry {\n\t\t\tme.tags.clearTags();\n\t\t\tif(user_tags) {\n\t\t\t\tme.user_tags = user_tags;\n\t\t\t\tme.tags.addTags(user_tags.split(','));\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tme.refreshing = false;\n\t\t\t// wtf bug\n\t\t\tsetTimeout( function() { me.refresh(); }, 100);\n\t\t}\n\t\tme.refreshing = false;\n\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.is_liked = function(doc) {\n\tvar liked = frappe.ui.get_liked_by(doc);\n\treturn liked.indexOf(frappe.session.user)===-1 ? false : true;\n}\n\nfrappe.ui.get_liked_by = function(doc) {\n\tvar liked = doc._liked_by;\n\tif(liked) {\n\t\tliked = JSON.parse(liked);\n\t}\n\n\treturn liked || [];\n}\n\nfrappe.ui.toggle_like = function($btn, doctype, name, callback) {\n\tvar add = $btn.hasClass(\"not-liked\") ? \"Yes\" : \"No\";\n\t// disable click\n\t$btn.css('pointer-events', 'none');\n\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.like.toggle_like\",\n\t\tquiet: true,\n\t\targs: {\n\t\t\tdoctype: doctype,\n\t\t\tname: name,\n\t\t\tadd: add,\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// renable click\n\t\t\t$btn.css('pointer-events', 'auto');\n\n\t\t\tif(!r.exc) {\n\t\t\t\t// update in all local-buttons\n\t\t\t\tvar action_buttons = $('.like-action[data-name=\"'+ name.replace(/\"/g, '\\\"')\n\t\t\t\t\t+'\"][data-doctype=\"'+ doctype.replace(/\"/g, '\\\"')+'\"]');\n\n\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\taction_buttons.removeClass(\"not-liked text-extra-muted\");\n\t\t\t\t} else {\n\t\t\t\t\taction_buttons.addClass(\"not-liked text-extra-muted\");\n\t\t\t\t}\n\n\t\t\t\t// update in locals (form)\n\t\t\t\tvar doc = locals[doctype] && locals[doctype][name];\n\t\t\t\tif(doc) {\n\t\t\t\t\tvar liked_by = JSON.parse(doc._liked_by || \"[]\"),\n\t\t\t\t\t\tidx = liked_by.indexOf(frappe.session.user);\n\t\t\t\t\tif(add===\"Yes\") {\n\t\t\t\t\t\tif(idx===-1)\n\t\t\t\t\t\t\tliked_by.push(frappe.session.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(idx!==-1) {\n\t\t\t\t\t\t\tliked_by = liked_by.slice(0,idx).concat(liked_by.slice(idx+1))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdoc._liked_by = JSON.stringify(liked_by);\n\t\t\t\t}\n\n\t\t\t\tif(callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nfrappe.ui.click_toggle_like = function() {\n\tvar $btn = $(this);\n\tvar $count = $btn.siblings(\".likes-count\");\n\tvar not_liked = $btn.hasClass(\"not-liked\");\n\tvar doctype = $btn.attr(\"data-doctype\");\n\tvar name = $btn.attr(\"data-name\");\n\n\tfrappe.ui.toggle_like($btn, doctype, name, function() {\n\t\tif (not_liked) {\n\t\t\t$count.text(cint($count.text()) + 1);\n\t\t} else {\n\t\t\t$count.text(cint($count.text()) - 1);\n\t\t}\n\t});\n\n\treturn false;\n}\n\nfrappe.ui.setup_like_popover = ($parent, selector, check_not_liked=true) => {\n\tif (frappe.dom.is_touchscreen()) {\n\t\treturn;\n\t}\n\n\t$parent.on('mouseover', selector, function() {\n\t\tconst target_element = $(this);\n\t\ttarget_element.popover({\n\t\t\tanimation: true,\n\t\t\tplacement: 'right',\n\t\t\ttrigger: 'manual',\n\t\t\ttemplate:`<div class=\"liked-by-popover popover\">\n\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t<div class=\"popover-content\"></div>\n\t\t\t</div>`,\n\t\t\tcontent: () => {\n\t\t\t\tlet liked_by = target_element.attr('data-liked-by');\n\t\t\t\tliked_by = liked_by ? decodeURI(liked_by) : '[]';\n\t\t\t\tliked_by = JSON.parse(liked_by);\n\n\t\t\t\tconst user = frappe.session.user;\n\t\t\t\t// hack\n\t\t\t\tif (check_not_liked) {\n\t\t\t\t\tif (target_element.find(\".not-liked\").length) {\n\t\t\t\t\t\tif (liked_by.indexOf(user)!==-1) {\n\t\t\t\t\t\t\tliked_by.splice(liked_by.indexOf(user), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (liked_by.indexOf(user)===-1) {\n\t\t\t\t\t\t\tliked_by.push(user);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!liked_by.length) {\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\n\t\t\t\tlet liked_by_list = $(`<ul class=\"list-unstyled\"></ul>`);\n\n\t\t\t\t// to show social profile of the user\n\t\t\t\tlet link_base = '#social/profile/';\n\n\t\t\t\tliked_by.forEach(user => {\n\t\t\t\t\t// append user list item\n\t\t\t\t\tliked_by_list.append(`\n\t\t\t\t\t\t<li data-user=${user}>${frappe.avatar(user)}\n\t\t\t\t\t\t\t<span>${frappe.user.full_name(user)}</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t`);\n\t\t\t\t});\n\n\t\t\t\tliked_by_list.children('li').click(ev => {\n\t\t\t\t\tlet user = ev.currentTarget.dataset.user;\n\t\t\t\t\ttarget_element.popover('hide');\n\t\t\t\t\tfrappe.set_route(link_base + user);\n\t\t\t\t});\n\n\t\t\t\treturn liked_by_list;\n\t\t\t},\n\t\t\thtml: true,\n\t\t\tcontainer: 'body'\n\t\t});\n\n\t\ttarget_element.popover('show');\n\n\t\t$(\".popover\").on(\"mouseleave\", () => {\n\t\t\ttarget_element.popover('hide');\n\t\t});\n\n\t\ttarget_element.on('mouseout', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!$('.popover:hover').length) {\n\t\t\t\t\ttarget_element.popover('hide');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t});\n\t});\n\n};\n","frappe.provide('frappe.views');\n\nfrappe.views.BaseList = class BaseList {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t}\n\n\tshow() {\n\t\tfrappe.run_serially([\n\t\t\t() => this.init(),\n\t\t\t() => this.before_refresh(),\n\t\t\t() => this.refresh()\n\t\t]);\n\t}\n\n\tinit() {\n\n\t\tif (this.init_promise) return this.init_promise;\n\n\t\tlet tasks = [\n\t\t\tthis.setup_defaults,\n\t\t\tthis.set_stats,\n\t\t\tthis.setup_fields,\n\t\t\t// make view\n\t\t\tthis.setup_page,\n\t\t\tthis.setup_side_bar,\n\t\t\tthis.setup_main_section,\n\t\t\tthis.setup_view,\n\t\t].map(fn => fn.bind(this));\n\n\t\tthis.init_promise = frappe.run_serially(tasks);\n\t\treturn this.init_promise;\n\t}\n\n\tsetup_defaults() {\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.page_title = this.page_title || __(this.doctype);\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tthis.settings = frappe.listview_settings[this.doctype] || {};\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\n\n\t\tthis.start = 0;\n\t\tthis.page_length = 20;\n\t\tthis.data = [];\n\t\tthis.method = 'frappe.desk.reportview.get';\n\n\t\tthis.can_create = frappe.model.can_create(this.doctype);\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\n\t\tthis.fields = [];\n\t\tthis.filters = [];\n\t\tthis.sort_by = 'modified';\n\t\tthis.sort_order = 'desc';\n\n\t\t// Setup buttons\n\t\tthis.primary_action = null;\n\t\tthis.secondary_action = {\n\t\t\tlabel: __('Refresh'),\n\t\t\taction: () => this.refresh()\n\t\t};\n\n\t\tthis.menu_items = [{\n\t\t\tlabel: __('Refresh'),\n\t\t\taction: () => this.refresh(),\n\t\t\tclass: 'visible-xs'\n\t\t}];\n\t}\n\n\tsetup_fields() {\n\t\tthis.set_fields();\n\t\tthis.build_fields();\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.meta.title_field\n\t\t);\n\n\t\tfields.forEach(f => this._add_field(f));\n\t}\n\n\tget_fields_in_list_view() {\n\t\treturn this.meta.fields.filter(df => {\n\t\t\treturn frappe.model.is_value_type(df.fieldtype) && (\n\t\t\t\tdf.in_list_view\n\t\t\t\t&& frappe.perm.has_perm(this.doctype, df.permlevel, 'read')\n\t\t\t) || (\n\t\t\t\tdf.fieldtype === 'Currency'\n\t\t\t\t&& df.options\n\t\t\t\t&& !df.options.includes(':')\n\t\t\t) || (\n\t\t\t\tdf.fieldname === 'status'\n\t\t\t);\n\t\t});\n\t}\n\n\tbuild_fields() {\n\t\t// fill in missing doctype\n\t\tthis.fields = this.fields.map(f => {\n\t\t\tif (typeof f === 'string') {\n\t\t\t\tf = [f, this.doctype];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t\t// remove null or undefined values\n\t\tthis.fields = this.fields.filter(Boolean);\n\t\t//de-duplicate\n\t\tthis.fields = this.fields.uniqBy(f => f[0] + f[1]);\n\t}\n\n\t_add_field(fieldname, doctype) {\n\t\tif (!fieldname) return;\n\n\t\tif (!doctype) doctype = this.doctype;\n\n\t\tif (typeof fieldname === 'object') {\n\t\t\t// df is passed\n\t\t\tconst df = fieldname;\n\t\t\tfieldname = df.fieldname;\n\t\t\tdoctype = df.parent;\n\t\t}\n\n\t\tif (!this.fields) this.fields = [];\n\n\t\tconst is_valid_field = frappe.model.std_fields_list.includes(fieldname)\n\t\t\t|| frappe.meta.has_field(doctype, fieldname)\n\t\t\t|| fieldname === '_seen';\n\n\t\tif (!is_valid_field) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fields.push([fieldname, doctype]);\n\t}\n\n\tset_stats() {\n\t\tthis.stats = ['_user_tags'];\n\t\t// add workflow field (as priority)\n\t\tthis.workflow_state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\t\tif (this.workflow_state_fieldname) {\n\t\t\tif (!frappe.workflow.workflows[this.doctype]['override_status']) {\n\t\t\t\tthis._add_field(this.workflow_state_fieldname);\n\t\t\t}\n\t\t\tthis.stats.push(this.workflow_state_fieldname);\n\t\t}\n\t}\n\n\tsetup_page() {\n\t\tthis.page = this.parent.page;\n\t\tthis.$page = $(this.parent);\n\t\tthis.page.page_form.removeClass('row').addClass('flex');\n\t\tthis.setup_page_head();\n\t}\n\n\tsetup_page_head() {\n\t\tthis.set_title();\n\t\tthis.set_menu_items();\n\t\tthis.set_breadcrumbs();\n\t}\n\n\tset_title() {\n\t\tthis.page.set_title(this.page_title);\n\t}\n\n\tset_menu_items() {\n\t\tconst $secondary_action = this.page.set_secondary_action(\n\t\t\tthis.secondary_action.label,\n\t\t\tthis.secondary_action.action,\n\t\t\tthis.secondary_action.icon\n\t\t);\n\t\tif (!this.secondary_action.icon) {\n\t\t\t$secondary_action.addClass('hidden-xs');\n\t\t} else {\n\t\t\t$secondary_action.addClass('visible-xs');\n\t\t}\n\n\t\tthis.menu_items.map(item => {\n\t\t\tif (item.condition && item.condition() === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst $item = this.page.add_menu_item(item.label, item.action, item.standard, item.shortcut);\n\t\t\tif (item.class) {\n\t\t\t\t$item && $item.addClass(item.class);\n\t\t\t}\n\t\t});\n\t}\n\n\tset_breadcrumbs() {\n\t\tfrappe.breadcrumbs.add(this.meta.module, this.doctype);\n\t}\n\n\tsetup_side_bar() {\n\t\tthis.list_sidebar = new frappe.views.ListSidebar({\n\t\t\tdoctype: this.doctype,\n\t\t\tstats: this.stats,\n\t\t\tparent: this.$page.find('.layout-side-section'),\n\t\t\t// set_filter: this.set_filter.bind(this),\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t});\n\t}\n\n\ttoggle_side_bar() {\n\t\tlet show_sidebar = JSON.parse(localStorage.show_sidebar || 'true');\n\t\tshow_sidebar = !show_sidebar;\n\t\tlocalStorage.show_sidebar = show_sidebar;\n\t\tthis.show_or_hide_sidebar();\n\t\t$(document.body).trigger('toggleListSidebar');\n\t}\n\n\tshow_or_hide_sidebar() {\n\t\tlet show_sidebar = JSON.parse(localStorage.show_sidebar || 'true');\n\t\t$(document.body).toggleClass('no-list-sidebar', !show_sidebar);\n\t}\n\n\tsetup_main_section() {\n\t\treturn frappe.run_serially([\n\t\t\tthis.setup_list_wrapper,\n\t\t\tthis.show_or_hide_sidebar,\n\t\t\tthis.setup_filter_area,\n\t\t\tthis.setup_sort_selector,\n\t\t\tthis.setup_result_area,\n\t\t\tthis.setup_no_result_area,\n\t\t\tthis.setup_freeze_area,\n\t\t\tthis.setup_paging_area\n\t\t].map(fn => fn.bind(this)));\n\t}\n\n\tsetup_list_wrapper() {\n\t\tthis.$frappe_list = $('<div class=\"frappe-list\">').appendTo(this.page.main);\n\t}\n\n\tsetup_filter_area() {\n\t\tthis.filter_area = new FilterArea(this);\n\n\t\tif (this.filters && this.filters.length > 0) {\n\t\t\treturn this.filter_area.set(this.filters);\n\t\t}\n\t}\n\n\tsetup_sort_selector() {\n\t\tthis.sort_selector = new frappe.ui.SortSelector({\n\t\t\tparent: this.filter_area.$filter_list_wrapper,\n\t\t\tdoctype: this.doctype,\n\t\t\targs: {\n\t\t\t\tsort_by: this.sort_by,\n\t\t\t\tsort_order: this.sort_order\n\t\t\t},\n\t\t\tonchange: this.on_sort_change.bind(this)\n\t\t});\n\t}\n\n\ton_sort_change() {\n\t\tthis.refresh();\n\t}\n\n\tsetup_result_area() {\n\t\tthis.$result = $(`<div class=\"result\">`);\n\t\tthis.$frappe_list.append(this.$result);\n\t}\n\n\tsetup_no_result_area() {\n\t\tthis.$no_result = $(`\n\t\t\t<div class=\"no-result text-muted flex justify-center align-center\">\n\t\t\t\t${this.get_no_result_message()}\n\t\t\t</div>\n\t\t`).hide();\n\t\tthis.$frappe_list.append(this.$no_result);\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze = $('<div class=\"freeze\"></div>').hide();\n\t\tthis.$frappe_list.append(this.$freeze);\n\t}\n\n\tget_no_result_message() {\n\t\treturn __('Nothing to show');\n\t}\n\n\tsetup_paging_area() {\n\t\tconst paging_values = [20, 100, 500];\n\t\tthis.$paging_area = $(\n\t\t\t`<div class=\"list-paging-area level\">\n\t\t\t\t<div class=\"level-left\">\n\t\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t\t${paging_values.map(value => `\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-default btn-sm btn-paging\"\n\t\t\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t\t\t${value}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t`).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t<button class=\"btn btn-default btn-more btn-sm\">\n\t\t\t\t\t\t${__(\"More\")}...\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t).hide();\n\t\tthis.$frappe_list.append(this.$paging_area);\n\n\t\t// set default paging btn active\n\t\tthis.$paging_area\n\t\t\t.find(`.btn-paging[data-value=\"${this.page_length}\"]`)\n\t\t\t.addClass('btn-info');\n\n\t\tthis.$paging_area.on('click', '.btn-paging, .btn-more', e => {\n\t\t\tconst $this = $(e.currentTarget);\n\n\t\t\tif ($this.is('.btn-paging')) {\n\t\t\t\t// set active button\n\t\t\t\tthis.$paging_area.find('.btn-paging').removeClass('btn-info');\n\t\t\t\t$this.addClass('btn-info');\n\n\t\t\t\tthis.start = 0;\n\t\t\t\tthis.page_length = $this.data().value;\n\t\t\t\tthis.refresh();\n\t\t\t} else if ($this.is('.btn-more')) {\n\t\t\t\tthis.start = this.start + this.page_length;\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\tget_fields() {\n\t\t// convert [fieldname, Doctype] => tabDoctype.fieldname\n\t\treturn this.fields.map(f => frappe.model.get_full_column_name(f[0], f[1]));\n\t}\n\n\tsetup_view() {\n\t\t// for child classes\n\t}\n\n\tget_filters_for_args() {\n\t\t// filters might have a fifth param called hidden,\n\t\t// we don't want to pass that server side\n\t\treturn this.filter_area\n\t\t\t? this.filter_area.get().map(filter => filter.slice(0, 4))\n\t\t\t: [];\n\t}\n\n\tget_filter_value(fieldname) {\n\t\treturn this.get_filters_for_args().filter(f => f[1] == fieldname)[0] &&\n\t\t\tthis.get_filters_for_args().filter(f => f[1] == fieldname)[0][3];\n\t}\n\n\tget_args() {\n\t\treturn {\n\t\t\tdoctype: this.doctype,\n\t\t\tfields: this.get_fields(),\n\t\t\tfilters: this.get_filters_for_args(),\n\t\t\torder_by: this.sort_selector.get_sql_string(),\n\t\t\tstart: this.start,\n\t\t\tpage_length: this.page_length,\n\t\t\tview: this.view\n\t\t};\n\t}\n\n\tget_call_args() {\n\t\tconst args = this.get_args();\n\t\treturn {\n\t\t\tmethod: this.method,\n\t\t\targs: args,\n\t\t\tfreeze: this.freeze_on_refresh || false,\n\t\t\tfreeze_message: this.freeze_message || (__('Loading') + '...')\n\t\t};\n\t}\n\n\tbefore_refresh() {\n\t\t// modify args here just before making the request\n\t\t// see list_view.js\n\t}\n\n\trefresh() {\n\t\tthis.freeze(true);\n\t\t// fetch data from server\n\t\treturn frappe.call(this.get_call_args()).then(r => {\n\t\t\t// render\n\t\t\tthis.prepare_data(r);\n\t\t\tthis.toggle_result_area();\n\t\t\tthis.before_render();\n\t\t\tthis.render();\n\t\t\tthis.after_render();\n\t\t\tthis.freeze(false);\n\t\t\tif (this.settings.refresh) {\n\t\t\t\tthis.settings.refresh(this);\n\t\t\t}\n\t\t});\n\t}\n\n\tprepare_data(r) {\n\t\tlet data = r.message || {};\n\t\tdata = !Array.isArray(data) ? frappe.utils.dict(data.keys, data.values) : data;\n\n\t\tif (this.start === 0) {\n\t\t\tthis.data = data;\n\t\t} else {\n\t\t\tthis.data = this.data.concat(data);\n\t\t}\n\n\t\tthis.data = this.data.uniqBy(d => d.name);\n\t}\n\n\tfreeze() {\n\t\t// show a freeze message while data is loading\n\t}\n\n\tbefore_render() {\n\n\t}\n\n\tafter_render() {\n\n\t}\n\n\trender() {\n\t\t// for child classes\n\t}\n\n\ton_filter_change() {\n\t\t// fired when filters are added or removed\n\t}\n\n\ttoggle_result_area() {\n\t\tthis.$result.toggle(this.data.length > 0);\n\t\tthis.$paging_area.toggle(this.data.length > 0);\n\t\tthis.$no_result.toggle(this.data.length == 0);\n\n\t\tconst show_more = (this.start + this.page_length) <= this.data.length;\n\t\tthis.$paging_area.find('.btn-more')\n\t\t\t.toggle(show_more);\n\t}\n\n\tcall_for_selected_items(method, args = {}) {\n\t\targs.names = this.get_checked_items(true);\n\n\t\tfrappe.call({\n\t\t\tmethod: method,\n\t\t\targs: args,\n\t\t\tfreeze: true,\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\nclass FilterArea {\n\tconstructor(list_view) {\n\t\tthis.list_view = list_view;\n\t\tthis.standard_filters_wrapper = this.list_view.page.page_form;\n\t\tthis.$filter_list_wrapper = $('<div class=\"filter-list\">').appendTo(this.list_view.$frappe_list);\n\t\tthis.trigger_refresh = true;\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tthis.make_standard_filters();\n\t\tthis.make_filter_list();\n\t}\n\n\tget() {\n\t\tlet filters = this.filter_list.get_filters();\n\t\tlet standard_filters = this.get_standard_filters();\n\n\t\treturn filters\n\t\t\t.concat(standard_filters)\n\t\t\t.uniqBy(JSON.stringify);\n\t}\n\n\tset(filters) {\n\t\t// use to method to set filters without triggering refresh\n\t\tthis.trigger_refresh = false;\n\t\treturn this.add(filters, false)\n\t\t\t.then(() => {\n\t\t\t\tthis.trigger_refresh = true;\n\t\t\t});\n\t}\n\n\tadd(filters, refresh = true) {\n\t\tif (!filters || Array.isArray(filters) && filters.length === 0)\n\t\t\treturn Promise.resolve();\n\n\t\tif (typeof filters[0] === 'string') {\n\t\t\t// passed in the format of doctype, field, condition, value\n\t\t\tconst filter = Array.from(arguments);\n\t\t\tfilters = [filter];\n\t\t}\n\n\t\tfilters = filters.filter(f => {\n\t\t\treturn !this.exists(f);\n\t\t});\n\n\t\tconst { non_standard_filters, promise } = this.set_standard_filter(filters);\n\n\t\treturn promise\n\t\t\t.then(() => {\n\t\t\t\treturn non_standard_filters.length > 0 &&\n\t\t\t\t\tthis.filter_list.add_filters(non_standard_filters);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\trefresh && this.list_view.refresh();\n\t\t\t});\n\t}\n\n\trefresh_list_view() {\n\t\tif (this.trigger_refresh) {\n\t\t\tthis.list_view.start = 0;\n\t\t\tthis.list_view.refresh();\n\t\t\tthis.list_view.on_filter_change();\n\t\t}\n\t}\n\n\texists(f) {\n\t\tlet exists = false;\n\t\t// check in standard filters\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tif (f[2] === '=' && f[1] in fields_dict) {\n\t\t\tconst value = fields_dict[f[1]].get_value();\n\t\t\tif (value) {\n\t\t\t\texists = true;\n\t\t\t}\n\t\t}\n\n\t\t// check in filter area\n\t\tif (!exists) {\n\t\t\texists = this.filter_list.filter_exists(f);\n\t\t}\n\n\t\treturn exists;\n\t}\n\n\tset_standard_filter(filters) {\n\t\tif (filters.length === 0) {\n\t\t\treturn {\n\t\t\t\tnon_standard_filters: [],\n\t\t\t\tpromise: Promise.resolve()\n\t\t\t};\n\t\t}\n\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tlet out = filters.reduce((out, filter) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tconst [dt, fieldname, condition, value] = filter;\n\t\t\tout.promise = out.promise || Promise.resolve();\n\t\t\tout.non_standard_filters = out.non_standard_filters || [];\n\n\t\t\tif (fields_dict[fieldname] && (condition === '=' || condition === \"like\")) {\n\t\t\t\t// standard filter\n\t\t\t\tout.promise = out.promise.then(\n\t\t\t\t\t() => fields_dict[fieldname].set_value(value)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// filter out non standard filters\n\t\t\t\tout.non_standard_filters.push(filter);\n\t\t\t}\n\t\t\treturn out;\n\t\t}, {});\n\n\t\treturn out;\n\t}\n\n\tremove(fieldname) {\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\n\t\tif (fieldname in fields_dict) {\n\t\t\treturn fields_dict[fieldname].set_value('');\n\t\t}\n\n\t\tlet filter = this.filter_list.get_filter(fieldname);\n\t\tif (filter) filter.remove();\n\t\treturn Promise.resolve();\n\t}\n\n\tclear(refresh = true) {\n\t\tif (!refresh) {\n\t\t\tthis.trigger_refresh = false;\n\t\t}\n\n\t\tthis.filter_list.clear_filters();\n\n\t\tconst promises = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tconst field = this.list_view.page.fields_dict[key];\n\t\t\tpromises.push(() => field.set_value(''));\n\t\t}\n\t\treturn frappe.run_serially(promises)\n\t\t\t.then(() => {\n\t\t\t\tthis.trigger_refresh = true;\n\t\t\t});\n\t}\n\n\tmake_standard_filters() {\n\t\tlet fields = [\n\t\t\t{\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: 'Name',\n\t\t\t\tcondition: 'like',\n\t\t\t\tfieldname: 'name',\n\t\t\t\tonchange: () => this.refresh_list_view()\n\t\t\t}\n\t\t];\n\n\t\tif(this.list_view.custom_filter_configs) {\n\t\t\tthis.list_view.custom_filter_configs.forEach(config => {\n\t\t\t\tconfig.onchange = () => this.refresh_list_view();\n\t\t\t});\n\n\t\t\tfields = fields.concat(this.list_view.custom_filter_configs);\n\t\t}\n\n\t\tconst doctype_fields = this.list_view.meta.fields;\n\t\tconst title_field = this.list_view.meta.title_field;\n\n\t\tfields = fields.concat(doctype_fields.filter(\n\t\t\tdf => (df.fieldname === title_field) || (df.in_standard_filter && frappe.model.is_value_type(df.fieldtype))\n\t\t).map(df => {\n\t\t\tlet options = df.options;\n\t\t\tlet condition = '=';\n\t\t\tlet fieldtype = df.fieldtype;\n\t\t\tif (['Text', 'Small Text', 'Text Editor', 'HTML Editor', 'Data', 'Code', 'Read Only'].includes(fieldtype)) {\n\t\t\t\tfieldtype = 'Data';\n\t\t\t\tcondition = 'like';\n\t\t\t}\n\t\t\tif (df.fieldtype == \"Select\" && df.options) {\n\t\t\t\toptions = df.options.split(\"\\n\");\n\t\t\t\tif (options.length > 0 && options[0] != \"\") {\n\t\t\t\t\toptions.unshift(\"\");\n\t\t\t\t\toptions = options.join(\"\\n\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet default_value = (fieldtype === 'Link') ? frappe.defaults.get_user_default(options) : null;\n\t\t\tif (['__default', '__global'].includes(default_value)) {\n\t\t\t\tdefault_value = null;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tfieldtype: fieldtype,\n\t\t\t\tlabel: __(df.label),\n\t\t\t\toptions: options,\n\t\t\t\tfieldname: df.fieldname,\n\t\t\t\tcondition: condition,\n\t\t\t\tdefault: default_value,\n\t\t\t\tonchange: () => this.refresh_list_view(),\n\t\t\t\tignore_link_validation: fieldtype === 'Dynamic Link',\n\t\t\t\tis_filter: 1,\n\t\t\t};\n\t\t}));\n\n\t\tfields.map(df => this.list_view.page.add_field(df));\n\t}\n\n\tget_standard_filters() {\n\t\tconst filters = [];\n\t\tconst fields_dict = this.list_view.page.fields_dict;\n\t\tfor (let key in fields_dict) {\n\t\t\tlet field = fields_dict[key];\n\t\t\tlet value = field.get_value();\n\t\t\tif (value) {\n\t\t\t\tif (field.df.condition === 'like' && !value.includes('%')) {\n\t\t\t\t\tvalue = '%' + value + '%';\n\t\t\t\t}\n\t\t\t\tfilters.push([\n\t\t\t\t\tthis.list_view.doctype,\n\t\t\t\t\tfield.df.fieldname,\n\t\t\t\t\tfield.df.condition || '=',\n\t\t\t\t\tvalue\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tmake_filter_list() {\n\t\tthis.filter_list = new frappe.ui.FilterGroup({\n\t\t\tbase_list: this.list_view,\n\t\t\tparent: this.$filter_list_wrapper,\n\t\t\tdoctype: this.list_view.doctype,\n\t\t\tdefault_filters: [],\n\t\t\ton_change: () => this.refresh_list_view()\n\t\t});\n\t}\n\n\tis_being_edited() {\n\t\t// returns true if user is currently editing filters\n\t\treturn this.filter_list &&\n\t\t\tthis.filter_list.wrapper.find('.filter-box:visible').length > 0;\n\t}\n}\n\n// utility function to validate view modes\nfrappe.views.view_modes = ['List', 'Gantt', 'Kanban', 'Calendar', 'Image', 'Inbox', 'Report', 'Dashboard'];\nfrappe.views.is_valid = view_mode => frappe.views.view_modes.includes(view_mode);\n","export default class BulkOperations {\n\tconstructor({ doctype }) {\n\t\tif (!doctype) frappe.throw(__('Doctype required'));\n\t\tthis.doctype = doctype;\n\t}\n\n\tprint(docs) {\n\t\tconst print_settings = frappe.model.get_doc(':Print Settings', 'Print Settings');\n\t\tconst allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tconst is_submittable = frappe.model.is_submittable(this.doctype);\n\t\tconst allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\tconst valid_docs = docs.filter(doc => {\n\t\t\treturn !is_submittable || doc.docstatus === 1 ||\n\t\t\t\t(allow_print_for_cancelled && doc.docstatus == 2) ||\n\t\t\t\t(allow_print_for_draft && doc.docstatus == 0) ||\n\t\t\t\tfrappe.user.has_role('Administrator');\n\t\t}).map(doc => doc.name);\n\n\t\tconst invalid_docs = docs.filter(doc => !valid_docs.includes(doc.name));\n\n\t\tif (invalid_docs.length > 0) {\n\t\t\tfrappe.msgprint(__('You selected Draft or Cancelled documents'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (valid_docs.length > 0) {\n\t\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Print Documents'),\n\t\t\t\tfields: [{\n\t\t\t\t\t'fieldtype': 'Check',\n\t\t\t\t\t'label': __('With Letterhead'),\n\t\t\t\t\t'fieldname': 'with_letterhead'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'label': __('Print Format'),\n\t\t\t\t\t'fieldname': 'print_sel',\n\t\t\t\t\toptions: frappe.meta.get_print_formats(this.doctype)\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tdialog.set_primary_action(__('Print'), args => {\n\t\t\t\tif (!args) return;\n\t\t\t\tconst default_print_format = frappe.get_meta(this.doctype).default_print_format;\n\t\t\t\tconst with_letterhead = args.with_letterhead ? 1 : 0;\n\t\t\t\tconst print_format = args.print_sel ? args.print_sel : default_print_format;\n\t\t\t\tconst json_string = JSON.stringify(valid_docs);\n\n\t\t\t\tconst w = window.open('/api/method/frappe.utils.print_format.download_multi_pdf?' +\n\t\t\t\t\t'doctype=' + encodeURIComponent(this.doctype) +\n\t\t\t\t\t'&name=' + encodeURIComponent(json_string) +\n\t\t\t\t\t'&format=' + encodeURIComponent(print_format) +\n\t\t\t\t\t'&no_letterhead=' + (with_letterhead ? '0' : '1'));\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__('Please enable pop-ups'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select atleast 1 record for printing'));\n\t\t}\n\t}\n\n\tdelete(docnames, done = null) {\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.reportview.delete_items',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\titems: docnames,\n\t\t\t\t\tdoctype: this.doctype\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot delete {0}', [failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound('delete');\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tassign(docnames, done) {\n\t\tif (docnames.length > 0) {\n\t\t\tconst assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: this,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add_multiple',\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tdocname: docnames,\n\t\t\t\tbulk_assign: true,\n\t\t\t\tre_assign: true,\n\t\t\t\tcallback: done\n\t\t\t});\n\t\t\tassign_to.dialog.clear();\n\t\t\tassign_to.dialog.show();\n\t\t} else {\n\t\t\tfrappe.msgprint(__('Select records for assignment'));\n\t\t}\n\t}\n\n\tapply_assignment_rule(docnames, done) {\n\t\tif (docnames.length > 0) {\n\t\t\tfrappe.call('frappe.automation.doctype.assignment_rule.assignment_rule.bulk_apply', {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tdocnames: docnames\n\t\t\t}).then(() => done());\n\t\t}\n\t}\n\n\tsubmit_or_cancel(docnames, action='submit', done=null) {\n\t\taction = action.toLowerCase();\n\t\tfrappe\n\t\t\t.call({\n\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\taction: action,\n\t\t\t\t\tdocnames: docnames\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((r) => {\n\t\t\t\tlet failed = r.message;\n\t\t\t\tif (!failed) failed = [];\n\n\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\tfrappe.throw(__('Cannot {0} {1}', [action, failed.map(f => f.bold()).join(', ')]));\n\t\t\t\t}\n\t\t\t\tif (failed.length < docnames.length) {\n\t\t\t\t\tfrappe.utils.play_sound(action);\n\t\t\t\t\tif (done) done();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tedit(docnames, field_mappings, done) {\n\t\tlet field_options = Object.keys(field_mappings).sort();\n\t\tconst status_regex = /status/i;\n\n\t\tconst default_field = field_options.find(value => status_regex.test(value));\n\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Edit'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Select',\n\t\t\t\t\t'options': field_options,\n\t\t\t\t\t'default': default_field,\n\t\t\t\t\t'label': __('Field'),\n\t\t\t\t\t'fieldname': 'field',\n\t\t\t\t\t'reqd': 1,\n\t\t\t\t\t'onchange': () => {\n\t\t\t\t\t\tset_value_field(dialog);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t\t'label': __('Value'),\n\t\t\t\t\t'fieldname': 'value',\n\t\t\t\t\t'reqd': 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: ({ value }) => {\n\t\t\t\tconst fieldname = field_mappings[dialog.get_value('field')].fieldname;\n\t\t\t\tdialog.disable_primary_action();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\tdocnames: docnames,\n\t\t\t\t\t\taction: 'update',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t[fieldname]: value\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(r => {\n\t\t\t\t\tlet failed = r.message || [];\n\n\t\t\t\t\tif (failed.length && !r._server_messages) {\n\t\t\t\t\t\tdialog.enable_primary_action();\n\t\t\t\t\t\tfrappe.throw(__('Cannot update {0}', [failed.map(f => f.bold ? f.bold() : f).join(', ')]));\n\t\t\t\t\t}\n\t\t\t\t\tdone();\n\t\t\t\t\tdialog.hide();\n\t\t\t\t\tfrappe.show_alert(__('Updated successfully'));\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Update')\n\t\t});\n\n\t\tif (default_field) set_value_field(dialog); // to set `Value` df based on default `Field`\n\n\t\tfunction set_value_field(dialogObj) {\n\t\t\tconst new_df = Object.assign({},\n\t\t\t\tfield_mappings[dialogObj.get_value('field')]);\n\t\t\t/* if the field label has status in it and\n\t\t\tif it has select fieldtype with no default value then\n\t\t\tset a default value from the available option. */\n\t\t\tif(new_df.label.match(status_regex) &&\n\t\t\t\tnew_df.fieldtype === 'Select' && !new_df.default) {\n\t\t\t\tlet options = [];\n\t\t\t\tif(typeof new_df.options===\"string\") {\n\t\t\t\t\toptions = new_df.options.split(\"\\n\");\n\t\t\t\t}\n\t\t\t\t//set second option as default if first option is an empty string\n\t\t\t\tnew_df.default = options[0] || options[1];\n\t\t\t}\n\t\t\tnew_df.label = __('Value');\n\t\t\tnew_df.reqd = 1;\n\t\t\tdelete new_df.depends_on;\n\t\t\tdialogObj.replace_field('value', new_df);\n\t\t}\n\n\t\tdialog.refresh();\n\t\tdialog.show();\n\t}\n}\n","export default class ListSettings {\n\tconstructor({ listview, doctype, meta, settings }) {\n\t\tif (!doctype) {\n\t\t\tfrappe.throw(__('Doctype required'));\n\t\t}\n\n\t\tthis.listview = listview;\n\t\tthis.doctype = doctype;\n\t\tthis.meta = meta;\n\t\tthis.settings = settings;\n\t\tthis.dialog = null;\n\t\tthis.fields = this.settings && this.settings.fields ? JSON.parse(this.settings.fields) : [];\n\t\tthis.subject_field = null;\n\n\t\tfrappe.model.with_doctype(\"List View Settings\", () => {\n\t\t\tthis.make();\n\t\t\tthis.get_listview_fields(meta);\n\t\t\tthis.setup_fields();\n\t\t\tthis.setup_remove_fields();\n\t\t\tthis.add_new_fields();\n\t\t\tthis.show_dialog();\n\t\t});\n\t}\n\n\tmake() {\n\t\tlet me = this;\n\n\t\tlet list_view_settings = frappe.get_meta(\"List View Settings\");\n\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"{0} Settings\", [__(me.doctype)]),\n\t\t\tfields: list_view_settings.fields\n\t\t});\n\t\tme.dialog.set_values(me.settings);\n\t\tme.dialog.set_primary_action(__('Save'), () => {\n\t\t\tlet values = me.dialog.get_values();\n\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Saving\"),\n\t\t\t\tindicator: \"green\"\n\t\t\t});\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.doctype.list_view_settings.list_view_settings.save_listview_settings\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\tlistview_settings: values,\n\t\t\t\t\tremoved_listview_fields: me.removed_fields || []\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tme.listview.refresh_columns(r.message.meta, r.message.listview_settings);\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tme.dialog.fields_dict[\"total_fields\"].df.onchange = () => me.refresh();\n\t}\n\n\trefresh() {\n\t\tlet me = this;\n\n\t\tme.setup_fields();\n\t\tme.add_new_fields();\n\t\tme.setup_remove_fields();\n\t}\n\n\tshow_dialog() {\n\t\tlet me = this;\n\n\t\tif (!this.settings.fields) {\n\t\t\tme.update_fields();\n\t\t}\n\n\t\tif (!me.dialog.get_value(\"total_fields\")) {\n\t\t\tlet field_count = me.fields.length;\n\n\t\t\tif (field_count < 4) {\n\t\t\t\tfield_count = 4;\n\t\t\t} else if (field_count > 10) {\n\t\t\t\tfield_count = 4;\n\t\t\t}\n\n\t\t\tme.dialog.set_value(\"total_fields\", field_count);\n\t\t}\n\n\t\tme.dialog.show();\n\t}\n\n\tsetup_fields() {\n\t\tfunction is_status_field(field) {\n\t\t\treturn field.fieldname === \"status_field\";\n\t\t}\n\n\t\tlet me = this;\n\n\t\tlet fields_html = me.dialog.get_field(\"fields_html\");\n\t\tlet wrapper = fields_html.$wrapper[0];\n\t\tlet fields = ``;\n\t\tlet total_fields = me.dialog.get_values().total_fields || me.settings.total_fields;\n\n\t\tfor (let idx in me.fields) {\n\t\t\tif (idx == parseInt(total_fields)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet is_sortable = (idx == 0) ? `` : `sortable`;\n\t\t\tlet show_sortable_handle = (idx == 0) ? `hide` : ``;\n\t\t\tlet can_remove = (idx == 0 || is_status_field(me.fields[idx])) ? `hide` : ``;\n\n\t\t\tfields += `\n\t\t\t\t<div class=\"control-input flex align-center form-control fields_order ${is_sortable}\"\n\t\t\t\t\tstyle=\"display: block; margin-bottom: 5px;\" data-fieldname=\"${me.fields[idx].fieldname}\"\n\t\t\t\t\tdata-label=\"${me.fields[idx].label}\" data-type=\"${me.fields[idx].type}\">\n\n\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t<div class=\"col-md-1\">\n\t\t\t\t\t\t\t<i class=\"fa fa-bars text-muted sortable-handle ${show_sortable_handle}\" aria-hidden=\"true\"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"col-md-10\" style=\"padding-left:0px;\">\n\t\t\t\t\t\t\t${me.fields[idx].label}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"col-md-1 ${can_remove}\">\n\t\t\t\t\t\t\t<a class=\"text-muted remove-field\" data-fieldname=\"${me.fields[idx].fieldname}\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-trash-o\" aria-hidden=\"true\"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t\t}\n\n\t\tfields_html.html(`\n\t\t\t<div class=\"form-group\">\n\t\t\t\t<div class=\"clearfix\">\n\t\t\t\t\t<label class=\"control-label\" style=\"padding-right: 0px;\">Fields</label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"control-input-wrapper\">\n\t\t\t\t${fields}\n\t\t\t\t</div>\n\t\t\t\t<p class=\"help-box small text-muted hidden-xs\">\n\t\t\t\t\t<a class=\"add-new-fields text-muted\">\n\t\t\t\t\t\t+ Add / Remove Fields\n\t\t\t\t\t</a>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t`);\n\n\t\tnew Sortable(wrapper.getElementsByClassName(\"control-input-wrapper\")[0], {\n\t\t\thandle: '.sortable-handle',\n\t\t\tdraggable: '.sortable',\n\t\t\tonUpdate: () => {\n\t\t\t\tme.update_fields();\n\t\t\t\tme.refresh();\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_new_fields() {\n\t\tlet me = this;\n\n\t\tlet fields_html = me.dialog.get_field(\"fields_html\");\n\t\tlet add_new_fields = fields_html.$wrapper[0].getElementsByClassName(\"add-new-fields\")[0];\n\t\tadd_new_fields.onclick = () => me.column_selector();\n\t}\n\n\tsetup_remove_fields() {\n\t\tlet me = this;\n\n\t\tlet fields_html = me.dialog.get_field(\"fields_html\");\n\t\tlet remove_fields = fields_html.$wrapper[0].getElementsByClassName(\"remove-field\");\n\n\t\tfor (let idx = 0; idx < remove_fields.length; idx++) {\n\t\t\tremove_fields.item(idx).onclick = () => me.remove_fields(remove_fields.item(idx).getAttribute(\"data-fieldname\"));\n\t\t}\n\t}\n\n\tremove_fields(fieldname) {\n\t\tlet me = this;\n\t\tlet existing_fields = me.fields.map(f => f.fieldname);\n\n\t\tfor (let idx in me.fields) {\n\t\t\tlet field = me.fields[idx];\n\n\t\t\tif (field.fieldname == fieldname) {\n\t\t\t\tme.fields.splice(idx, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tme.set_removed_fields(me.get_removed_listview_fields(me.fields.map(f => f.fieldname), existing_fields));\n\t\tme.refresh();\n\t\tme.update_fields();\n\t}\n\n\tupdate_fields() {\n\t\tlet me = this;\n\n\t\tlet fields_html = me.dialog.get_field(\"fields_html\");\n\t\tlet wrapper = fields_html.$wrapper[0];\n\n\t\tlet fields_order = wrapper.getElementsByClassName(\"fields_order\");\n\t\tme.fields = [];\n\n\t\tfor (let idx = 0; idx < fields_order.length; idx++) {\n\t\t\tme.fields.push({\n\t\t\t\tfieldname: fields_order.item(idx).getAttribute(\"data-fieldname\"),\n\t\t\t\tlabel: fields_order.item(idx).getAttribute(\"data-label\")\n\t\t\t});\n\t\t}\n\n\t\tme.dialog.set_value(\"fields\", JSON.stringify(me.fields));\n\t\tme.dialog.get_value(\"fields\");\n\t}\n\n\tcolumn_selector() {\n\t\tlet me = this;\n\n\t\tlet d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"{0} Fields\", [__(me.doctype)]),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Reset Fields\"),\n\t\t\t\t\tfieldtype: \"Button\",\n\t\t\t\t\tfieldname: \"reset_fields\",\n\t\t\t\t\tclick: () => me.reset_listview_fields(d)\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"Select Fields\"),\n\t\t\t\t\tfieldtype: \"MultiCheck\",\n\t\t\t\t\tfieldname: \"fields\",\n\t\t\t\t\toptions: me.get_doctype_fields(me.meta, me.fields.map(f => f.fieldname)),\n\t\t\t\t\tcolumns: 2\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\td.set_primary_action(__('Save'), () => {\n\t\t\tlet values = d.get_values().fields;\n\n\t\t\tme.set_removed_fields(me.get_removed_listview_fields(values, me.fields.map(f => f.fieldname)));\n\n\t\t\tme.fields = [];\n\t\t\tme.set_subject_field(me.meta);\n\t\t\tme.set_status_field();\n\n\t\t\tfor (let idx in values) {\n\t\t\t\tlet value = values[idx];\n\n\t\t\t\tif (me.fields.length === parseInt(me.dialog.get_values().total_fields)) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (value != me.subject_field.fieldname) {\n\t\t\t\t\tlet field = frappe.meta.get_docfield(me.doctype, value);\n\t\t\t\t\tif (field) {\n\t\t\t\t\t\tme.fields.push({\n\t\t\t\t\t\t\tlabel: field.label,\n\t\t\t\t\t\t\tfieldname: field.fieldname\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tme.refresh();\n\t\t\tme.dialog.set_value(\"fields\", JSON.stringify(me.fields));\n\t\t\td.hide();\n\t\t});\n\t\td.show();\n\t}\n\n\treset_listview_fields(dialog) {\n\t\tlet me = this;\n\n\t\tfrappe.xcall(\"frappe.desk.doctype.list_view_settings.list_view_settings.get_default_listview_fields\", {\n\t\t\tdoctype: me.doctype\n\t\t}).then((fields) => {\n\t\t\tlet field = dialog.get_field(\"fields\");\n\t\t\tfield.df.options = me.get_doctype_fields(me.meta, fields);\n\t\t\tdialog.refresh();\n\t\t});\n\n\t}\n\n\tget_listview_fields(meta) {\n\t\tlet me = this;\n\n\t\tif (!me.settings.fields) {\n\t\t\tme.set_list_view_fields(meta);\n\t\t} else {\n\t\t\tme.fields = JSON.parse(this.settings.fields);\n\t\t}\n\n\t\tme.fields.uniqBy(f => f.fieldname);\n\t}\n\n\tset_list_view_fields(meta) {\n\t\tlet me = this;\n\n\t\tme.set_subject_field(meta);\n\t\tme.set_status_field();\n\n\t\tmeta.fields.forEach(field => {\n\t\t\tif (field.in_list_view && !in_list(frappe.model.no_value_type, field.fieldtype) &&\n\t\t\t\tme.subject_field.fieldname != field.fieldname) {\n\n\t\t\t\tme.fields.push({\n\t\t\t\t\tlabel: field.label,\n\t\t\t\t\tfieldname: field.fieldname\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tset_subject_field(meta) {\n\t\tlet me = this;\n\n\t\tme.subject_field = {\n\t\t\tlabel: \"Name\",\n\t\t\tfieldname: \"name\"\n\t\t};\n\n\t\tif (meta.title_field) {\n\t\t\tlet field = frappe.meta.get_docfield(me.doctype, meta.title_field.trim());\n\n\t\t\tme.subject_field = {\n\t\t\t\tlabel: field.label,\n\t\t\t\tfieldname: field.fieldname\n\t\t\t};\n\t\t}\n\n\t\tme.fields.push(me.subject_field);\n\t}\n\n\tset_status_field() {\n\t\tlet me = this;\n\n\t\tif (frappe.has_indicator(me.doctype)) {\n\t\t\tme.fields.push({\n\t\t\t\ttype: \"Status\",\n\t\t\t\tlabel: \"Status\",\n\t\t\t\tfieldname: \"status_field\"\n\t\t\t});\n\t\t}\n\t}\n\n\tget_doctype_fields(meta, fields) {\n\t\tlet multiselect_fields = [];\n\n\t\tmeta.fields.forEach(field => {\n\t\t\tif (!in_list(frappe.model.no_value_type, field.fieldtype)) {\n\t\t\t\tmultiselect_fields.push({\n\t\t\t\t\tlabel: field.label,\n\t\t\t\t\tvalue: field.fieldname,\n\t\t\t\t\tchecked: in_list(fields, field.fieldname)\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn multiselect_fields;\n\t}\n\n\tget_removed_listview_fields(new_fields, existing_fields) {\n\t\tlet me = this;\n\t\tlet removed_fields = [];\n\n\t\tif (frappe.has_indicator(me.doctype)) {\n\t\t\tnew_fields.push(\"status_field\");\n\t\t}\n\n\t\texisting_fields.forEach(column => {\n\t\t\tif (!in_list(new_fields, column)) {\n\t\t\t\tremoved_fields.push(column);\n\t\t\t}\n\t\t});\n\n\t\treturn removed_fields;\n\t}\n\n\tset_removed_fields(fields) {\n\t\tlet me = this;\n\n\t\tif (me.removed_fields) {\n\t\t\tme.removed_fields.concat(fields);\n\t\t} else {\n\t\t\tme.removed_fields = fields;\n\t\t}\n\t}\n}\n","import BulkOperations from \"./bulk_operations\";\nimport ListSettings from \"./list_settings\";\n\nfrappe.provide('frappe.views');\n\nfrappe.views.ListView = class ListView extends frappe.views.BaseList {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tconst doctype = route[1];\n\n\t\tif (route.length === 2) {\n\t\t\t// List/{doctype} => List/{doctype}/{last_view} or List\n\t\t\tconst user_settings = frappe.get_user_settings(doctype);\n\t\t\tconst last_view = user_settings.last_view;\n\t\t\tfrappe.set_route('List', doctype, frappe.views.is_valid(last_view) ? last_view : 'List');\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tconstructor(opts) {\n\t\tsuper(opts);\n\t\tthis.show();\n\t}\n\n\thas_permissions() {\n\t\tconst can_read = frappe.perm.has_perm(this.doctype, 0, 'read');\n\t\treturn can_read;\n\t}\n\n\tshow() {\n\t\tthis.parent.disable_scroll_to_top = true;\n\n\t\tif (!this.has_permissions()) {\n\t\t\tfrappe.set_route('');\n\t\t\tfrappe.msgprint(__(`Not permitted to view ${this.doctype}`));\n\t\t\treturn;\n\t\t}\n\n\t\tsuper.show();\n\t}\n\n\tget view_name() {\n\t\treturn 'List';\n\t}\n\n\tget view_user_settings() {\n\t\treturn this.user_settings[this.view_name] || {};\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\n\t\tthis.view = 'List';\n\t\t// initialize with saved order by\n\t\tthis.sort_by = this.view_user_settings.sort_by || 'modified';\n\t\tthis.sort_order = this.view_user_settings.sort_order || 'desc';\n\n\t\t// set filters from user_settings or list_settings\n\t\tif (this.view_user_settings.filters && this.view_user_settings.filters.length) {\n\t\t\t// Priority 1: user_settings\n\t\t\tconst saved_filters = this.view_user_settings.filters;\n\t\t\tthis.filters = this.validate_filters(saved_filters);\n\t\t} else {\n\t\t\t// Priority 2: filters in listview_settings\n\t\t\tthis.filters = (this.settings.filters || []).map(f => {\n\t\t\t\tif (f.length === 3) {\n\t\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t});\n\t\t}\n\n\t\t// build menu items\n\t\tthis.menu_items = this.menu_items.concat(this.get_menu_items());\n\n\t\tif (this.view_user_settings.filters && this.view_user_settings.filters.length) {\n\t\t\t// Priority 1: saved filters\n\t\t\tconst saved_filters = this.view_user_settings.filters;\n\t\t\tthis.filters = this.validate_filters(saved_filters);\n\t\t} else {\n\t\t\t// Priority 2: filters in listview_settings\n\t\t\tthis.filters = (this.settings.filters || []).map(f => {\n\t\t\t\tif (f.length === 3) {\n\t\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t});\n\t\t}\n\n\t\tthis.patch_refresh_and_load_lib();\n\t\treturn this.get_list_view_settings();\n\t}\n\n\tget_list_view_settings() {\n\t\treturn frappe.call(\"frappe.desk.listview.get_list_settings\", {doctype: this.doctype})\n\t\t\t.then(doc => this.list_view_settings = doc.message || {});\n\t}\n\n\ton_sort_change(sort_by, sort_order) {\n\t\tthis.sort_by = sort_by;\n\t\tthis.sort_order = sort_order;\n\t\tsuper.on_sort_change();\n\t}\n\n\tvalidate_filters(filters) {\n\t\tconst valid_fields = this.meta.fields.map(df => df.fieldname);\n\t\treturn filters\n\t\t\t.filter(f => valid_fields.includes(f[1]))\n\t\t\t.uniqBy(f => f[1]);\n\t}\n\n\tsetup_page() {\n\t\tthis.parent.list_view = this;\n\t\tsuper.setup_page();\n\t}\n\n\tsetup_page_head() {\n\t\tsuper.setup_page_head();\n\t\tthis.set_primary_action();\n\t\tthis.set_actions_menu_items();\n\t}\n\n\tset_actions_menu_items() {\n\t\tthis.actions_menu_items = this.get_actions_menu_items();\n\t\tthis.workflow_action_menu_items = this.get_workflow_action_menu_items();\n\t\tthis.workflow_action_items = {};\n\n\t\tconst actions = this.actions_menu_items.concat(this.workflow_action_menu_items);\n\t\tactions.map(item => {\n\t\t\tconst $item = this.page.add_actions_menu_item(item.label, item.action, item.standard);\n\t\t\tif (item.class) {\n\t\t\t\t$item.addClass(item.class);\n\t\t\t}\n\t\t\tif (item.is_workflow_action && $item) {\n\t\t\t\t// can be used to dynamically show or hide action\n\t\t\t\tthis.workflow_action_items[item.name] = $item;\n\t\t\t}\n\t\t});\n\t}\n\n\tshow_restricted_list_indicator_if_applicable() {\n\t\tconst match_rules_list = frappe.perm.get_match_rules(this.doctype);\n\t\tif (match_rules_list.length) {\n\t\t\tthis.restricted_list = $(`<button class=\"restricted-button\">${__('Restricted')}</button>`)\n\t\t\t\t.prepend('<span class=\"octicon octicon-lock\"></span>')\n\t\t\t\t.click(() => this.show_restrictions(match_rules_list))\n\t\t\t\t.appendTo(this.page.page_form);\n\t\t}\n\t}\n\n\tshow_restrictions(match_rules_list=[]) {\n\t\tfrappe.msgprint(frappe.render_template('list_view_permission_restrictions', {\n\t\t\tcondition_list: match_rules_list\n\t\t}), __('Restrictions'));\n\t}\n\n\tset_fields() {\n\t\tlet fields = [].concat(\n\t\t\tfrappe.model.std_fields_list,\n\t\t\tthis.get_fields_in_list_view(),\n\t\t\t[this.meta.title_field, this.meta.image_field],\n\t\t\t(this.settings.add_fields || []),\n\t\t\tthis.meta.track_seen ? '_seen' : null,\n\t\t\tthis.sort_by,\n\t\t\t'enabled',\n\t\t\t'disabled',\n\t\t\t'color'\n\t\t);\n\n\t\tfields.forEach(f => this._add_field(f));\n\n\t\tthis.fields.forEach(f => {\n\t\t\tconst df = frappe.meta.get_docfield(f[1], f[0]);\n\t\t\tif (df && df.fieldtype === 'Currency' && df.options && !df.options.includes(':')) {\n\t\t\t\tthis._add_field(df.options);\n\t\t\t}\n\t\t});\n\t}\n\n\tpatch_refresh_and_load_lib() {\n\t\t// throttle refresh for 1s\n\t\tthis.refresh = this.refresh.bind(this);\n\t\tthis.refresh = frappe.utils.throttle(this.refresh, 1000);\n\t\tthis.load_lib = new Promise(resolve => {\n\t\t\tif (this.required_libs) {\n\t\t\t\tfrappe.require(this.required_libs, resolve);\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t\t// call refresh every 5 minutes\n\t\tconst interval = 5 * 60 * 1000;\n\t\tsetInterval(() => {\n\t\t\t// don't call if route is different\n\t\t\tif (frappe.get_route_str() === this.page_name) {\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t}, interval);\n\t}\n\n\tset_primary_action() {\n\t\tif (this.can_create) {\n\t\t\tthis.page.set_primary_action(__('New'), () => {\n\t\t\t\tif (this.settings.primary_action) {\n\t\t\t\t\tthis.settings.primary_action();\n\t\t\t\t} else {\n\t\t\t\t\tthis.make_new_doc();\n\t\t\t\t}\n\t\t\t}, 'octicon octicon-plus');\n\t\t} else {\n\t\t\tthis.page.clear_primary_action();\n\t\t}\n\t}\n\n\tmake_new_doc() {\n\t\tconst doctype = this.doctype;\n\t\tconst options = {};\n\t\tthis.filter_area.get().forEach(f => {\n\t\t\tif (f[2] === \"=\" && frappe.model.is_non_std_field(f[1])) {\n\t\t\t\toptions[f[1]] = f[3];\n\t\t\t}\n\t\t});\n\t\tfrappe.new_doc(doctype, options);\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t\tthis.render_header();\n\t\tthis.render_skeleton();\n\t\tthis.setup_events();\n\t\tthis.settings.onload && this.settings.onload(this);\n\t\tthis.show_restricted_list_indicator_if_applicable();\n\n\t}\n\n\trefresh_columns(meta, list_view_settings) {\n\t\tthis.meta = meta;\n\t\tthis.list_view_settings = list_view_settings;\n\n\t\tthis.setup_columns();\n\t\tthis.refresh(true);\n\t}\n\n\trefresh(refresh_header=false) {\n\t\tsuper.refresh().then(() => {\n\t\t\tthis.render_header(refresh_header);\n\t\t});\n\t}\n\n\tsetup_freeze_area() {\n\t\tthis.$freeze =\n\t\t\t$(`<div class=\"freeze flex justify-center align-center text-muted\">${__('Loading')}...</div>`)\n\t\t\t\t.hide();\n\t\tthis.$result.append(this.$freeze);\n\t}\n\n\tsetup_columns() {\n\t\t// setup columns for list view\n\t\tthis.columns = [];\n\n\t\tconst get_df = frappe.meta.get_docfield.bind(null, this.doctype);\n\n\t\t// 1st column: title_field or name\n\t\tif (this.meta.title_field) {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Subject',\n\t\t\t\tdf: get_df(this.meta.title_field)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Subject',\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Name'),\n\t\t\t\t\tfieldname: 'name'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// 2nd column: Status indicator\n\t\tif (frappe.has_indicator(this.doctype)) {\n\t\t\t// indicator\n\t\t\tthis.columns.push({\n\t\t\t\ttype: 'Status'\n\t\t\t});\n\t\t}\n\n\t\tconst fields_in_list_view = this.get_fields_in_list_view();\n\t\t// Add rest from in_list_view docfields\n\t\tthis.columns = this.columns.concat(\n\t\t\tfields_in_list_view\n\t\t\t\t.filter(df => {\n\t\t\t\t\tif (frappe.has_indicator(this.doctype) && df.fieldname === 'status') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (!df.in_list_view) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn df.fieldname !== this.meta.title_field;\n\t\t\t\t})\n\t\t\t\t.map(df => ({\n\t\t\t\t\ttype: 'Field',\n\t\t\t\t\tdf\n\t\t\t\t}))\n\t\t);\n\n\t\tif (this.list_view_settings.fields) {\n\t\t\tthis.columns = this.reorder_listview_fields();\n\t\t}\n\n\t\t// limit max to 8 columns if no total_fields is set in List View Settings\n\t\t// Screen with low density no of columns 4\n\t\t// Screen with medium density no of columns 6\n\t\t// Screen with high density no of columns 8\n\t\tlet total_fields = 6;\n\n\t\tif (window.innerWidth <= 1366) {\n\t\t\ttotal_fields = 4;\n\t\t} else if (window.innerWidth >= 1920) {\n\t\t\ttotal_fields = 8;\n\t\t}\n\n\t\tthis.columns = this.columns.slice(0, this.list_view_settings.total_fields || total_fields);\n\t}\n\n\treorder_listview_fields() {\n\t\tlet fields_order = [];\n\t\tlet fields = JSON.parse(this.list_view_settings.fields);\n\n\t\t//title_field is fixed\n\t\tfields_order.push(this.columns[0]);\n\t\tthis.columns.splice(0, 1);\n\n\t\tfor (let fld in fields) {\n\t\t\tfor (let col in this.columns) {\n\t\t\t\tlet field = fields[fld];\n\t\t\t\tlet column = this.columns[col];\n\n\t\t\t\tif (column.type == \"Status\" && field.fieldname == \"status_field\") {\n\t\t\t\t\tfields_order.push(column);\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (column.type == \"Field\" && field.fieldname === column.df.fieldname) {\n\t\t\t\t\tfields_order.push(column);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn fields_order;\n\t}\n\n\tget_documentation_link() {\n\t\tif (this.meta.documentation) {\n\t\t\treturn `<a href=\"${this.meta.documentation}\" target=\"blank\" class=\"meta-description small text-muted\">Need Help?</a>`;\n\t\t}\n\t\treturn '';\n\t}\n\n\tget_no_result_message() {\n\t\tlet help_link = this.get_documentation_link();\n\t\tlet filters = this.filter_area.get();\n\t\tlet no_result_message = filters.length ? __('No {0} found', [__(this.doctype)]) : __('You haven\\'t created a {0} yet', [__(this.doctype)]);\n\t\tlet new_button_label = filters.length ? __('Create a new {0}', [__(this.doctype)]) : __('Create your first {0}', [__(this.doctype)]);\n\t\tlet empty_state_image = this.settings.empty_state_image || '/assets/frappe/images/ui-states/empty.png';\n\n\t\tconst new_button = this.can_create ?\n\t\t\t`<p><button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t${new_button_label}\n\t\t\t</button></p>` : '';\n\n\t\treturn `<div class=\"msg-box no-border\">\n\t\t\t<div>\n\t\t\t\t<img src=\"${empty_state_image}\" alt=\"Generic Empty State\" class=\"null-state\">\n\t\t\t</div>\n\t\t\t<p>${no_result_message}</p>\n\t\t\t${new_button}\n\t\t\t${help_link}\n\t\t</div>`;\n\t}\n\n\tfreeze() {\n\t\tif (this.list_view_settings && !this.list_view_settings.disable_count) {\n\t\t\tthis.$result.find('.list-count').html(`<span>${__('Refreshing')}...</span>`);\n\t\t}\n\t}\n\n\tget_args() {\n\t\tconst args = super.get_args();\n\n\t\treturn Object.assign(args, {\n\t\t\twith_comment_count: true\n\t\t});\n\t}\n\n\tbefore_refresh() {\n\t\tif (frappe.route_options) {\n\t\t\tthis.filters = this.parse_filters_from_route_options();\n\t\t\tfrappe.route_options = null;\n\n\t\t\tif (this.filters.length > 0) {\n\t\t\t\treturn this.filter_area.clear(false)\n\t\t\t\t\t.then(() => this.filter_area.set(this.filters));\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tparse_filters_from_settings() {\n\t\treturn (this.settings.filters || []).map(f => {\n\t\t\tif (f.length === 3) {\n\t\t\t\tf = [this.doctype, f[0], f[1], f[2]];\n\t\t\t}\n\t\t\treturn f;\n\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_actions_menu_button(\n\t\t\tthis.$result.find('.list-row-check:checked').length > 0\n\t\t);\n\t}\n\n\ttoggle_actions_menu_button(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.page.show_actions_menu();\n\t\t\tthis.page.clear_primary_action();\n\t\t\tthis.toggle_workflow_actions();\n\t\t} else {\n\t\t\tthis.page.hide_actions_menu();\n\t\t\tthis.set_primary_action();\n\t\t}\n\t}\n\n\trender_header(refresh_header=false) {\n\t\tif (refresh_header) {\n\t\t\tthis.$result.find('.list-row-head').remove();\n\t\t}\n\n\t\tif (this.$result.find('.list-row-head').length === 0) {\n\t\t\t// append header once\n\t\t\tthis.$result.prepend(this.get_header_html());\n\t\t}\n\t}\n\n\trender_skeleton() {\n\t\tconst $row = this.get_list_row_html_skeleton('<div><input type=\"checkbox\" /></div>');\n\t\tthis.$result.append($row);\n\t}\n\n\tbefore_render() {\n\t\tthis.settings.before_render && this.settings.before_render();\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', this.view_name);\n\t\tthis.save_view_user_settings({\n\t\t\tfilters: this.filter_area.get(),\n\t\t\tsort_by: this.sort_selector.sort_by,\n\t\t\tsort_order: this.sort_selector.sort_order\n\t\t});\n\t}\n\n\tafter_render() {\n\t\tthis.$no_result.html(`\n\t\t\t<div class=\"no-result text-muted flex justify-center align-center\">\n\t\t\t\t${this.get_no_result_message()}\n\t\t\t</div>\n\t\t`);\n\t\tthis.setup_new_doc_event();\n\t\tthis.list_sidebar.reload_stats();\n\t}\n\n\trender() {\n\t\tthis.render_list();\n\t\tthis.on_row_checked();\n\t\tthis.render_count();\n\t\tthis.render_tags();\n\t}\n\n\trender_list() {\n\t\t// clear rows\n\t\tthis.$result.find('.list-row-container').remove();\n\t\tif (this.data.length > 0) {\n\t\t\t// append rows\n\t\t\tthis.$result.append(\n\t\t\t\tthis.data.map((doc, i) => {\n\t\t\t\t\tdoc._idx = i;\n\t\t\t\t\treturn this.get_list_row_html(doc);\n\t\t\t\t}).join('')\n\t\t\t);\n\t\t}\n\t}\n\n\trender_count() {\n\t\tif (!this.list_view_settings.disable_count) {\n\t\t\tthis.get_count_str().then(str => {\n\t\t\t\tthis.$result.find('.list-count').html(`<span>${str}</span>`);\n\t\t\t});\n\t\t}\n\t}\n\n\trender_tags() {\n\t\tconst $list_rows = this.$result.find('.list-row-container');\n\n\t\tthis.data.forEach((d, i) => {\n\t\t\tlet tag_html = $(`<div class='tag-row'>\n\t\t\t\t<div class='list-tag hidden-xs'></div>\n\t\t\t</div>`).appendTo($list_rows.get(i));\n\n\t\t\t// add tags\n\t\t\tlet tag_editor = new frappe.ui.TagEditor({\n\t\t\t\tparent: tag_html.find('.list-tag'),\n\t\t\t\tfrm: {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\tdocname: d.name\n\t\t\t\t},\n\t\t\t\tlist_sidebar: this.list_sidebar,\n\t\t\t\tuser_tags: d._user_tags,\n\t\t\t\ton_change: (user_tags) => {\n\t\t\t\t\td._user_tags = user_tags;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttag_editor.wrapper.on('click', '.tagit-label', (e) => {\n\t\t\t\tconst $this = $(e.currentTarget);\n\t\t\t\tthis.filter_area.add(this.doctype, '_user_tags', '=', $this.text());\n\t\t\t});\n\t\t});\n\t}\n\n\tget_header_html() {\n\t\tif (!this.columns) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst subject_field = this.columns[0].df;\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t<i class=\"octicon octicon-heart text-extra-muted\" title=\"${__(\"Likes\")}\"></i>\n\t\t\t</span>\n\t\t\t<span class=\"level-item\">${__(subject_field.label)}</span>\n\t\t`;\n\t\tconst $columns = this.columns.map(col => {\n\t\t\tlet classes = [\n\t\t\t\t'list-row-col ellipsis',\n\t\t\t\tcol.type == 'Subject' ? 'list-subject level' : 'hidden-xs',\n\t\t\t\tfrappe.model.is_numeric_field(col.df) ? 'text-right' : ''\n\t\t\t].join(' ');\n\n\t\t\treturn `\n\t\t\t\t<div class=\"${classes}\">\n\t\t\t\t\t${col.type === 'Subject' ? subject_html : `\n\t\t\t\t\t<span>${__(col.df && col.df.label || col.type)}</span>`}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn this.get_header_html_skeleton($columns, '<span class=\"list-count\"></span>');\n\t}\n\n\tget_header_html_skeleton(left = '', right = '') {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div class=\"level-left list-header-subject\">\n\t\t\t\t\t${left}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-left checkbox-actions\">\n\t\t\t\t\t<div class=\"level list-subject\">\n\t\t\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t\t\t\t<span class=\"level-item list-header-meta\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"level-right\">\n\t\t\t\t\t${right}\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tget_left_html(doc) {\n\t\treturn this.columns.map(col => this.get_column_html(col, doc)).join('');\n\t}\n\n\tget_right_html(doc) {\n\t\treturn this.get_meta_html(doc);\n\t}\n\n\tget_list_row_html(doc) {\n\t\treturn this.get_list_row_html_skeleton(this.get_left_html(doc),\n\t\t\tthis.get_right_html(doc));\n\t}\n\n\tget_list_row_html_skeleton(left = '', right = '') {\n\t\treturn `\n\t\t\t<div class=\"list-row-container\" tabindex=\"1\">\n\t\t\t\t<div class=\"level list-row small\">\n\t\t\t\t\t<div class=\"level-left ellipsis\">\n\t\t\t\t\t\t${left}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"level-right text-muted ellipsis\">\n\t\t\t\t\t\t${right}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_column_html(col, doc) {\n\t\tif (col.type === 'Status') {\n\t\t\treturn `\n\t\t\t\t<div class=\"list-row-col hidden-xs ellipsis\">\n\t\t\t\t\t${this.get_indicator_html(doc)}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst df = col.df || {};\n\t\tconst label = df.label;\n\t\tconst fieldname = df.fieldname;\n\t\tconst value = doc[fieldname] || '';\n\n\t\tconst format = () => {\n\t\t\tif (df.fieldtype === 'Code') {\n\t\t\t\treturn value;\n\t\t\t} else if (df.fieldtype === 'Percent') {\n\t\t\t\treturn `<div class=\"progress level\" style=\"margin: 0px;\">\n\t\t\t\t\t\t<div class=\"progress-bar progress-bar-success\" role=\"progressbar\"\n\t\t\t\t\t\t\taria-valuenow=\"${value}\"\n\t\t\t\t\t\t\taria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: ${Math.round(value)}%;\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn frappe.format(value, df, null, doc);\n\t\t\t}\n\t\t};\n\n\t\tconst field_html = () => {\n\t\t\tlet html;\n\t\t\tlet _value;\n\t\t\t// listview_setting formatter\n\t\t\tif (this.settings.formatters && this.settings.formatters[fieldname]) {\n\t\t\t\t_value = this.settings.formatters[fieldname](value, df, doc);\n\t\t\t} else {\n\t\t\t\tlet strip_html_required = df.fieldtype == 'Text Editor'\n\t\t\t\t\t|| (df.fetch_from && ['Text', 'Small Text'].includes(df.fieldtype));\n\t\t\t\tif (strip_html_required) {\n\t\t\t\t\t_value = strip_html(value);\n\t\t\t\t} else {\n\t\t\t\t\t_value = typeof value === 'string' ? frappe.utils.escape_html(value) : value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (df.fieldtype === 'Image') {\n\t\t\t\thtml = df.options ?\n\t\t\t\t\t`<img src=\"${doc[df.options]}\" style=\"max-height: 30px; max-width: 100%;\">` :\n\t\t\t\t\t`<div class=\"missing-image small\">\n\t\t\t\t\t\t<span class=\"octicon octicon-circle-slash\"></span>\n\t\t\t\t\t</div>`;\n\t\t\t} else if (df.fieldtype === 'Select') {\n\t\t\t\thtml = `<span class=\"filterable indicator ${frappe.utils.guess_colour(_value)} ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${__(_value)}\n\t\t\t\t</span>`;\n\t\t\t} else if (df.fieldtype === 'Link') {\n\t\t\t\thtml = `<a class=\"filterable text-muted ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${_value}\n\t\t\t\t</a>`;\n\t\t\t} else if (['Text Editor', 'Text', 'Small Text', 'HTML Editor'].includes(df.fieldtype)) {\n\t\t\t\thtml = `<span class=\"text-muted ellipsis\">\n\t\t\t\t\t${_value}\n\t\t\t\t</span>`;\n\t\t\t} else {\n\t\t\t\thtml = `<a class=\"filterable text-muted ellipsis\"\n\t\t\t\t\tdata-filter=\"${fieldname},=,${value}\">\n\t\t\t\t\t${format()}\n\t\t\t\t</a>`;\n\t\t\t}\n\n\t\t\treturn `<span class=\"ellipsis\"\n\t\t\t\ttitle=\"${__(label)}: ${escape(_value)}\">\n\t\t\t\t${html}\n\t\t\t</span>`;\n\t\t};\n\n\t\tconst class_map = {\n\t\t\tSubject: 'list-subject level',\n\t\t\tField: 'hidden-xs'\n\t\t};\n\t\tconst css_class = [\n\t\t\t'list-row-col ellipsis',\n\t\t\tclass_map[col.type],\n\t\t\tfrappe.model.is_numeric_field(df) ? 'text-right' : ''\n\t\t].join(' ');\n\n\t\tconst html_map = {\n\t\t\tSubject: this.get_subject_html(doc),\n\t\t\tField: field_html()\n\t\t};\n\t\tconst column_html = html_map[col.type];\n\n\t\treturn `\n\t\t\t<div class=\"${css_class}\">\n\t\t\t\t${column_html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_meta_html(doc) {\n\t\tlet html = '';\n\t\tif (!this.settings.hide_name_column && doc[this.meta.title_field || ''] !== doc.name) {\n\t\t\thtml += `\n\t\t\t\t<div class=\"level-item hidden-xs hidden-sm ellipsis\">\n\t\t\t\t\t<a class=\"text-muted ellipsis\" href=\"${this.get_form_link(doc)}\">\n\t\t\t\t\t\t${doc.name}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.settings.button && this.settings.button.show(doc)) {\n\t\t\thtml += `\n\t\t\t\t<div class=\"level-item hidden-xs\">\n\t\t\t\t\t<button class=\"btn btn-action btn-default btn-xs\"\n\t\t\t\t\t\tdata-name=\"${doc.name}\" data-idx=\"${doc._idx}\"\n\t\t\t\t\t\ttitle=\"${this.settings.button.get_description(doc)}\">\n\t\t\t\t\t\t${this.settings.button.get_label(doc)}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst modified = comment_when(doc.modified, true);\n\n\t\tconst last_assignee = JSON.parse(doc._assign || '[]').slice(-1)[0];\n\t\tconst assigned_to = last_assignee ?\n\t\t\t`<span class=\"filterable\"\n\t\t\t\tdata-filter=\"_assign,like,%${last_assignee}%\">\n\t\t\t\t${frappe.avatar(last_assignee)}\n\t\t\t</span>` :\n\t\t\t`<span class=\"avatar avatar-small avatar-empty\"></span>`;\n\n\t\tconst comment_count =\n\t\t\t`<span class=\"${!doc._comment_count ? 'text-extra-muted' : ''} comment-count\">\n\t\t\t\t<i class=\"octicon octicon-comment-discussion\"></i>\n\t\t\t\t${doc._comment_count > 99 ? \"99+\" : doc._comment_count}\n\t\t\t</span>`;\n\n\t\thtml += `\n\t\t\t<div class=\"level-item hidden-xs list-row-activity\">\n\t\t\t\t${modified}\n\t\t\t\t${assigned_to}\n\t\t\t\t${comment_count}\n\t\t\t</div>\n\t\t\t<div class=\"level-item visible-xs text-right\">\n\t\t\t\t${this.get_indicator_dot(doc)}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn html;\n\t}\n\n\tget_count_str() {\n\t\tlet current_count = this.data.length;\n\t\tlet count_without_children = this.data.uniqBy(d => d.name).length;\n\n\t\treturn frappe.db.count(this.doctype, {\n\t\t\tfilters: this.get_filters_for_args()\n\t\t}).then(total_count => {\n\t\t\tthis.total_count = total_count || current_count;\n\t\t\tlet str = __('{0} of {1}', [current_count, this.total_count]);\n\t\t\tif (count_without_children !== current_count) {\n\t\t\t\tstr = __('{0} of {1} ({2} rows with children)', [count_without_children, this.total_count, current_count]);\n\t\t\t}\n\t\t\treturn str;\n\t\t});\n\t}\n\n\tget_form_link(doc) {\n\t\tif (this.settings.get_form_link) {\n\t\t\treturn this.settings.get_form_link(doc);\n\t\t}\n\n\t\tconst docname = doc.name.match(/[%'\"]/)\n\t\t\t? encodeURIComponent(doc.name)\n\t\t\t: doc.name;\n\n\t\treturn '#Form/' + this.doctype + '/' + docname;\n\t}\n\n\tget_seen_class(doc) {\n\t\treturn JSON.parse(doc._seen || '[]').includes(frappe.session.user)\n\t\t\t? ''\n\t\t\t: 'bold';\n\t}\n\n\tget_subject_html(doc) {\n\t\tlet user = frappe.session.user;\n\t\tlet subject_field = this.columns[0].df;\n\t\tlet value = doc[subject_field.fieldname] || doc.name;\n\t\tlet subject = strip_html(value.toString());\n\t\tlet escaped_subject = frappe.utils.escape_html(subject);\n\n\t\tconst liked_by = JSON.parse(doc._liked_by || '[]');\n\t\tlet heart_class = liked_by.includes(user) ?\n\t\t\t'liked-by' : 'text-extra-muted not-liked';\n\n\t\tconst seen = this.get_seen_class(doc);\n\n\t\tlet subject_html = `\n\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${escape(doc.name)}\">\n\t\t\t<span class=\"level-item\" style=\"margin-bottom: 1px;\">\n\t\t\t\t<i class=\"octicon octicon-heart like-action ${heart_class}\"\n\t\t\t\t\tdata-name=\"${doc.name}\" data-doctype=\"${this.doctype}\"\n\t\t\t\t\tdata-liked-by=\"${encodeURI(doc._liked_by) || '[]'}\"\n\t\t\t\t>\n\t\t\t\t</i>\n\t\t\t\t<span class=\"likes-count\">\n\t\t\t\t\t${ liked_by.length > 99 ? __(\"99\") + '+' : __(liked_by.length || '')}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span class=\"level-item ${seen} ellipsis\" title=\"${escaped_subject}\">\n\t\t\t\t<a class=\"ellipsis\" href=\"${this.get_form_link(doc)}\" title=\"${escaped_subject}\" data-doctype=\"${this.doctype}\" data-name=\"${doc.name}\">\n\t\t\t\t${subject}\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t`;\n\n\t\treturn subject_html;\n\t}\n\n\tget_indicator_html(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (indicator) {\n\t\t\treturn `<span class=\"indicator ${indicator[1]} filterable\"\n\t\t\t\tdata-filter='${indicator[2]}'>\n\t\t\t\t${__(indicator[0])}\n\t\t\t<span>`;\n\t\t}\n\t\treturn '';\n\t}\n\n\tget_indicator_dot(doc) {\n\t\tconst indicator = frappe.get_indicator(doc, this.doctype);\n\t\tif (!indicator) return '';\n\t\treturn `<span class='indicator ${indicator[1]}' title='${__(indicator[0])}'></span>`;\n\t}\n\n\tsetup_events() {\n\t\tthis.setup_filterable();\n\t\tthis.setup_list_click();\n\t\tthis.setup_tag_event();\n\t\tthis.setup_new_doc_event();\n\t\tthis.setup_check_events();\n\t\tthis.setup_like();\n\t\tthis.setup_realtime_updates();\n\t\tthis.setup_action_handler();\n\t\tthis.setup_keyboard_navigation();\n\t}\n\n\tsetup_keyboard_navigation() {\n\t\tlet focus_first_row = () => {\n\t\t\tthis.$result.find('.list-row-container:first').focus();\n\t\t};\n\t\tlet focus_next = () => {\n\t\t\t$(document.activeElement).next().focus();\n\t\t};\n\t\tlet focus_prev = () => {\n\t\t\t$(document.activeElement).prev().focus();\n\t\t};\n\t\tlet list_row_focused = () => {\n\t\t\treturn $(document.activeElement).is('.list-row-container');\n\t\t};\n\t\tlet check_row = ($row) => {\n\t\t\tlet $input = $row.find('input[type=checkbox]');\n\t\t\t$input.click();\n\t\t};\n\t\tlet get_list_row_if_focused = () =>\n\t\t\tlist_row_focused() ? $(document.activeElement) : null;\n\n\t\tlet is_current_page = () => this.page.wrapper.is(':visible');\n\t\tlet is_input_focused = () => $(document.activeElement).is('input');\n\n\t\tlet handle_navigation = (direction) => {\n\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\n\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\tif ($list_row) {\n\t\t\t\tdirection === 'down' ? focus_next() : focus_prev();\n\t\t\t} else {\n\t\t\t\tfocus_first_row();\n\t\t\t}\n\t\t};\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'down',\n\t\t\taction: () => handle_navigation('down'),\n\t\t\tdescription: __('Navigate list down'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'up',\n\t\t\taction: () => handle_navigation('up'),\n\t\t\tdescription: __('Navigate list up'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'shift+down',\n\t\t\taction: () => {\n\t\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tcheck_row($list_row);\n\t\t\t\tfocus_next();\n\t\t\t},\n\t\t\tdescription: __('Select multiple list items'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'shift+up',\n\t\t\taction: () => {\n\t\t\t\tif (!is_current_page() || is_input_focused()) return false;\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tcheck_row($list_row);\n\t\t\t\tfocus_prev();\n\t\t\t},\n\t\t\tdescription: __('Select multiple list items'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'enter',\n\t\t\taction: () => {\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tif ($list_row) {\n\t\t\t\t\t$list_row.find('a[data-name]')[0].click();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tdescription: __('Open list item'),\n\t\t\tpage: this.page\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'space',\n\t\t\taction: () => {\n\t\t\t\tlet $list_row = get_list_row_if_focused();\n\t\t\t\tif ($list_row) {\n\t\t\t\t\tcheck_row($list_row);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tdescription: __('Select list item'),\n\t\t\tpage: this.page\n\t\t});\n\t}\n\n\tsetup_filterable() {\n\t\t// filterable events\n\t\tthis.$result.on('click', '.filterable', e => {\n\t\t\tif (e.metaKey || e.ctrlKey) return;\n\t\t\te.stopPropagation();\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\tconst filters = $this.attr('data-filter').split('|');\n\n\t\t\tconst filters_to_apply = filters.map(f => {\n\t\t\t\tf = f.split(',');\n\t\t\t\tif (f[2] === 'Today') {\n\t\t\t\t\tf[2] = frappe.datetime.get_today();\n\t\t\t\t} else if (f[2] == 'User') {\n\t\t\t\t\tf[2] = frappe.session.user;\n\t\t\t\t}\n\t\t\t\treturn [this.doctype, f[0], f[1], f.slice(2).join(',')];\n\t\t\t});\n\t\t\tthis.filter_area.add(filters_to_apply);\n\t\t});\n\t}\n\n\tsetup_list_click() {\n\t\tthis.$result.on('click', '.list-row, .image-view-header', (e) => {\n\t\t\tconst $target = $(e.target);\n\t\t\t// tick checkbox if Ctrl/Meta key is pressed\n\t\t\tif (e.ctrlKey || e.metaKey && !$target.is('a')) {\n\t\t\t\tconst $list_row = $(e.currentTarget);\n\t\t\t\tconst $check = $list_row.find('.list-row-checkbox');\n\t\t\t\t$check.prop('checked', !$check.prop('checked'));\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.on_row_checked();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// don't open form when checkbox, like, filterable are clicked\n\t\t\tif ($target.hasClass('filterable') ||\n\t\t\t\t$target.hasClass('octicon-heart') ||\n\t\t\t\t$target.is(':checkbox') ||\n\t\t\t\t$target.is('a')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// open form\n\t\t\tconst $row = $(e.currentTarget);\n\t\t\tconst link = $row.find('.list-subject a').get(0);\n\t\t\tif (link) {\n\t\t\t\twindow.location.href = link.href;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_action_handler() {\n\t\tthis.$result.on('click', '.btn-action', (e) => {\n\t\t\tconst $button = $(e.currentTarget);\n\t\t\tconst doc = this.data[$button.attr('data-idx')];\n\t\t\tthis.settings.button.action(doc);\n\t\t\te.stopPropagation();\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tsetup_check_events() {\n\t\tthis.$result.on('change', 'input[type=checkbox]', e => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\tif ($target.is('.list-header-subject .list-check-all')) {\n\t\t\t\tconst $check = this.$result.find('.checkbox-actions .list-check-all');\n\t\t\t\t$check.prop('checked', $target.prop('checked'));\n\t\t\t\t$check.trigger('change');\n\t\t\t} else if ($target.is('.checkbox-actions .list-check-all')) {\n\t\t\t\tconst $check = this.$result.find('.list-header-subject .list-check-all');\n\t\t\t\t$check.prop('checked', $target.prop('checked'));\n\n\t\t\t\tthis.$result.find('.list-row-checkbox')\n\t\t\t\t\t.prop('checked', $target.prop('checked'));\n\t\t\t}\n\n\t\t\tthis.on_row_checked();\n\t\t});\n\n\t\tthis.$result.on('click', '.list-row-checkbox', e => {\n\t\t\tconst $target = $(e.currentTarget);\n\n\t\t\t// shift select checkboxes\n\t\t\tif (e.shiftKey && this.$checkbox_cursor && !$target.is(this.$checkbox_cursor)) {\n\t\t\t\tconst name_1 = this.$checkbox_cursor.data().name;\n\t\t\t\tconst name_2 = $target.data().name;\n\t\t\t\tconst index_1 = this.data.findIndex(d => d.name === name_1);\n\t\t\t\tconst index_2 = this.data.findIndex(d => d.name === name_2);\n\t\t\t\tlet [min_index, max_index] = [index_1, index_2];\n\n\t\t\t\tif (min_index > max_index) {\n\t\t\t\t\t[min_index, max_index] = [max_index, min_index];\n\t\t\t\t}\n\n\t\t\t\tlet docnames = this.data.slice(min_index + 1, max_index).map(d => d.name);\n\t\t\t\tconst selector = docnames.map(name => `.list-row-checkbox[data-name=\"${name}\"]`).join(',');\n\t\t\t\tthis.$result.find(selector).prop('checked', true);\n\t\t\t}\n\n\t\t\tthis.$checkbox_cursor = $target;\n\t\t});\n\t}\n\n\tsetup_like() {\n\t\tthis.$result.on('click', '.like-action', frappe.ui.click_toggle_like);\n\t\tthis.$result.on('click', '.list-liked-by-me', e => {\n\t\t\tconst $this = $(e.currentTarget);\n\t\t\t$this.toggleClass('active');\n\n\t\t\tif ($this.hasClass('active')) {\n\t\t\t\tthis.filter_area.add(this.doctype, '_liked_by', 'like', '%' + frappe.session.user + '%');\n\t\t\t} else {\n\t\t\t\tthis.filter_area.remove('_liked_by');\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.setup_like_popover(this.$result, '.liked-by');\n\t}\n\n\tsetup_new_doc_event() {\n\t\tthis.$no_result.find('.btn-new-doc').click(() => {\n\t\t\tif (this.settings.primary_action) {\n\t\t\t\tthis.settings.primary_action();\n\t\t\t} else {\n\t\t\t\tthis.make_new_doc();\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_tag_event() {\n\t\tthis.list_sidebar.parent.on('click', '.list-tag-preview', () => {\n\t\t\tthis.toggle_tags();\n\t\t});\n\t}\n\n\tsetup_realtime_updates() {\n\t\tif (this.list_view_settings && this.list_view_settings.disable_auto_refresh) {\n\t\t\treturn;\n\t\t}\n\t\tfrappe.realtime.on('list_update', data => {\n\t\t\tif (this.filter_area.is_being_edited()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { doctype, name } = data;\n\t\t\tif (doctype !== this.doctype) return;\n\n\t\t\t// filters to get only the doc with this name\n\t\t\tconst call_args = this.get_call_args();\n\t\t\tcall_args.args.filters.push([this.doctype, 'name', '=', name]);\n\t\t\tcall_args.args.start = 0;\n\n\t\t\tfrappe.call(call_args)\n\t\t\t\t.then(({ message }) => {\n\t\t\t\t\tif (!message) return;\n\t\t\t\t\tconst data = frappe.utils.dict(message.keys, message.values);\n\t\t\t\t\tif (!(data && data.length)) {\n\t\t\t\t\t\t// this doc was changed and should not be visible\n\t\t\t\t\t\t// in the listview according to filters applied\n\t\t\t\t\t\t// let's remove it manually\n\t\t\t\t\t\tthis.data = this.data.filter(d => d.name !== name);\n\t\t\t\t\t\tthis.render_list();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst datum = data[0];\n\t\t\t\t\tconst index = this.data.findIndex(d => d.name === datum.name);\n\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\t// append new data\n\t\t\t\t\t\tthis.data.push(datum);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// update this data in place\n\t\t\t\t\t\tthis.data[index] = datum;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.data.sort((a, b) => {\n\t\t\t\t\t\tconst a_value = a[this.sort_by] || '';\n\t\t\t\t\t\tconst b_value = b[this.sort_by] || '';\n\n\t\t\t\t\t\tlet return_value = 0;\n\t\t\t\t\t\tif (a_value > b_value) {\n\t\t\t\t\t\t\treturn_value = 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (b_value > a_value) {\n\t\t\t\t\t\t\treturn_value = -1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.sort_order === 'desc') {\n\t\t\t\t\t\t\treturn_value = -return_value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn return_value;\n\t\t\t\t\t});\n\t\t\t\t\tthis.toggle_result_area();\n\t\t\t\t\tthis.render_list();\n\t\t\t\t\tif (this.$checks && this.$checks.length) {\n\t\t\t\t\t\tthis.set_rows_as_checked();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\tset_rows_as_checked() {\n\t\t$.each(this.$checks, (i, el) => {\n\t\t\tlet docname = $(el).attr('data-name');\n\t\t\tthis.$result.find(`.list-row-checkbox[data-name='${docname}']`).prop('checked', true);\n\t\t});\n\t\tthis.on_row_checked();\n\t}\n\n\ton_row_checked() {\n\t\tthis.$list_head_subject = this.$list_head_subject || this.$result.find('header .list-header-subject');\n\t\tthis.$checkbox_actions = this.$checkbox_actions || this.$result.find('header .checkbox-actions');\n\n\t\tthis.$checks = this.$result.find('.list-row-checkbox:checked');\n\n\t\tthis.$list_head_subject.toggle(this.$checks.length === 0);\n\t\tthis.$checkbox_actions.toggle(this.$checks.length > 0);\n\n\t\tif (this.$checks.length === 0) {\n\t\t\tthis.$list_head_subject.find('.list-check-all').prop('checked', false);\n\t\t} else {\n\t\t\tthis.$checkbox_actions.find('.list-header-meta').html(\n\t\t\t\t__('{0} items selected', [this.$checks.length])\n\t\t\t);\n\t\t\tthis.$checkbox_actions.show();\n\t\t\tthis.$list_head_subject.hide();\n\t\t}\n\t\tthis.toggle_actions_menu_button(this.$checks.length > 0);\n\t}\n\n\ttoggle_tags() {\n\t\tthis.$result.toggleClass('tags-shown');\n\t}\n\n\tget_checked_items(only_docnames) {\n\t\tconst docnames = Array.from(this.$checks || [])\n\t\t\t.map(check => cstr(unescape($(check).data().name)));\n\n\t\tif (only_docnames) return docnames;\n\n\t\treturn this.data.filter(d => docnames.includes(d.name));\n\t}\n\n\tsave_view_user_settings(obj) {\n\t\treturn frappe.model.user_settings.save(this.doctype, this.view_name, obj);\n\t}\n\n\ton_update() {\n\n\t}\n\n\tget_share_url() {\n\t\tconst query_params = this.get_filters_for_args().map(filter => {\n\t\t\tfilter[3] = encodeURIComponent(filter[3]);\n\t\t\tif (filter[2] === '=') {\n\t\t\t\treturn `${filter[1]}=${filter[3]}`;\n\t\t\t}\n\t\t\treturn [filter[1], '=', JSON.stringify([filter[2], filter[3]])].join('');\n\t\t}).join('&');\n\n\t\tlet full_url = window.location.href;\n\t\tif (query_params) {\n\t\t\tfull_url += '?' + query_params;\n\t\t}\n\t\treturn full_url;\n\t}\n\n\tshare_url() {\n\t\tconst d = new frappe.ui.Dialog({\n\t\t\ttitle: __('Share URL'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Code',\n\t\t\t\t\tfieldname: 'url',\n\t\t\t\t\tlabel: 'URL',\n\t\t\t\t\tdefault: this.get_share_url(),\n\t\t\t\t\tread_only: 1\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\td.show();\n\t}\n\n\tget_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst items = [];\n\n\t\tif (frappe.model.can_import(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Import'),\n\t\t\t\taction: () => frappe.set_route('List', 'Data Import', {\n\t\t\t\t\treference_doctype: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.model.can_set_user_permissions(doctype)) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('User Permissions'),\n\t\t\t\taction: () => frappe.set_route('List', 'User Permission', {\n\t\t\t\t\tallow: doctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.user_roles.includes('System Manager')) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Role Permissions Manager'),\n\t\t\t\taction: () => frappe.set_route('permission-manager', {\n\t\t\t\t\tdoctype\n\t\t\t\t}),\n\t\t\t\tstandard: true\n\t\t\t});\n\n\t\t\titems.push({\n\t\t\t\tlabel: __('Customize'),\n\t\t\t\taction: () => {\n\t\t\t\t\tif (!this.meta) return;\n\t\t\t\t\tif (this.meta.custom) {\n\t\t\t\t\t\tfrappe.set_route('Form', 'DocType', doctype);\n\t\t\t\t\t} else if (!this.meta.custom) {\n\t\t\t\t\t\tfrappe.set_route('Form', 'Customize Form', {\n\t\t\t\t\t\t\tdoc_type: doctype\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t\tshortcut: 'Ctrl+J',\n\t\t\t});\n\t\t}\n\n\t\titems.push({\n\t\t\tlabel: __('Toggle Sidebar'),\n\t\t\taction: () => this.toggle_side_bar(),\n\t\t\tstandard: true,\n\t\t\tshortcut: 'Ctrl+K',\n\t\t});\n\n\t\titems.push({\n\t\t\tlabel: __('Share URL'),\n\t\t\taction: () => this.share_url(),\n\t\t\tstandard: true,\n\t\t\tshortcut: 'Ctrl+L',\n\t\t});\n\n\t\tif (frappe.user.has_role('System Manager') && frappe.boot.developer_mode === 1) {\n\t\t\t// edit doctype\n\t\t\titems.push({\n\t\t\t\tlabel: __('Edit DocType'),\n\t\t\t\taction: () => frappe.set_route('Form', 'DocType', doctype),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\n\t\tif (frappe.user.has_role('System Manager')) {\n\t\t\titems.push({\n\t\t\t\tlabel: __('Settings'),\n\t\t\t\taction: () => this.show_list_settings(),\n\t\t\t\tstandard: true\n\t\t\t});\n\t\t}\n\t\treturn items;\n\t}\n\n\tshow_list_settings() {\n\t\tfrappe.model.with_doctype(this.doctype, () => {\n\t\t\tnew ListSettings({\n\t\t\t\tlistview: this,\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tsettings: this.list_view_settings,\n\t\t\t\tmeta: frappe.get_meta(this.doctype)\n\t\t\t});\n\t\t});\n\t}\n\n\tget_workflow_action_menu_items() {\n\t\tconst workflow_actions = [];\n\t\tif (frappe.model.has_workflow(this.doctype)) {\n\t\t\tconst actions = frappe.workflow.get_all_transition_actions(this.doctype);\n\t\t\tactions.forEach(action => {\n\t\t\t\tworkflow_actions.push({\n\t\t\t\t\tlabel: __(action),\n\t\t\t\t\tname: action,\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tfrappe.xcall('frappe.model.workflow.bulk_workflow_approval', {\n\t\t\t\t\t\t\tdocnames: this.get_checked_items(true),\n\t\t\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\t\t\taction: action\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tis_workflow_action: true\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn workflow_actions;\n\t}\n\n\ttoggle_workflow_actions() {\n\t\tif (!frappe.model.has_workflow(this.doctype)) return;\n\t\tconst checked_items = this.get_checked_items();\n\t\tfrappe.xcall('frappe.model.workflow.get_common_transition_actions', {\n\t\t\tdocs: checked_items,\n\t\t\tdoctype: this.doctype\n\t\t}).then(actions => {\n\t\t\tObject.keys(this.workflow_action_items).forEach((key) => {\n\t\t\t\tthis.workflow_action_items[key].toggle(actions.includes(key));\n\t\t\t});\n\t\t});\n\t}\n\n\tget_actions_menu_items() {\n\t\tconst doctype = this.doctype;\n\t\tconst actions_menu_items = [];\n\t\tconst bulk_operations = new BulkOperations({ doctype: this.doctype });\n\n\t\tconst is_field_editable = (field_doc) => {\n\t\t\treturn field_doc.fieldname && frappe.model.is_value_type(field_doc)\n\t\t\t\t&& field_doc.fieldtype !== 'Read Only' && !field_doc.hidden && !field_doc.read_only;\n\t\t};\n\n\t\tconst has_editable_fields = (doctype) => {\n\t\t\treturn frappe.meta.get_docfields(doctype).some(field_doc => is_field_editable(field_doc));\n\t\t};\n\n\t\tconst has_submit_permission = (doctype) => {\n\t\t\treturn frappe.perm.has_perm(doctype, 0, 'submit');\n\t\t};\n\n\t\t// utility\n\t\tconst bulk_assignment = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Assign To'),\n\t\t\t\taction: () => bulk_operations.assign(this.get_checked_items(true), this.refresh),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_assignment_rule = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Apply Assignment Rule'),\n\t\t\t\taction: () => bulk_operations.apply_assignment_rule(this.get_checked_items(true), this.refresh),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_printing = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: () => bulk_operations.print(this.get_checked_items()),\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_delete = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Delete'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true).map(docname => docname.toString());\n\t\t\t\t\tfrappe.confirm(__('Delete {0} items permanently?', [docnames.length]),\n\t\t\t\t\t\t() => bulk_operations.delete(docnames, this.refresh));\n\t\t\t\t},\n\t\t\t\tstandard: true,\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_cancel = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Cancel'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(__('Cancel {0} documents?', [docnames.length]),\n\t\t\t\t\t\t\t() => bulk_operations.submit_or_cancel(docnames, 'cancel', this.refresh));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_submit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Submit'),\n\t\t\t\taction: () => {\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\t\t\t\t\tif (docnames.length > 0) {\n\t\t\t\t\t\tfrappe.confirm(__('Submit {0} documents?', [docnames.length]),\n\t\t\t\t\t\t\t() => bulk_operations.submit_or_cancel(docnames, 'submit', this.refresh));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\tconst bulk_edit = () => {\n\t\t\treturn {\n\t\t\t\tlabel: __('Edit'),\n\t\t\t\taction: () => {\n\t\t\t\t\tlet field_mappings = {};\n\n\t\t\t\t\tfrappe.meta.get_docfields(doctype).forEach(field_doc => {\n\t\t\t\t\t\tif (is_field_editable(field_doc)) {\n\t\t\t\t\t\t\tfield_mappings[field_doc.label] = Object.assign({}, field_doc);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tconst docnames = this.get_checked_items(true);\n\n\t\t\t\t\tbulk_operations.edit(docnames, field_mappings, this.refresh);\n\t\t\t\t},\n\t\t\t\tstandard: true\n\t\t\t};\n\t\t};\n\n\t\t// bulk edit\n\t\tif (has_editable_fields(doctype)) {\n\t\t\tactions_menu_items.push(bulk_edit());\n\t\t}\n\n\t\t// bulk assignment\n\t\tactions_menu_items.push(bulk_assignment());\n\n\t\tactions_menu_items.push(bulk_assignment_rule());\n\n\t\t// bulk printing\n\t\tif (frappe.model.can_print(doctype)) {\n\t\t\tactions_menu_items.push(bulk_printing());\n\t\t}\n\n\t\t// bulk submit\n\t\tif (frappe.model.is_submittable(doctype) && has_submit_permission(doctype) && !(frappe.model.has_workflow(doctype))) {\n\t\t\tactions_menu_items.push(bulk_submit());\n\t\t}\n\n\t\t// bulk cancel\n\t\tif (frappe.model.can_cancel(doctype) && !(frappe.model.has_workflow(doctype))) {\n\t\t\tactions_menu_items.push(bulk_cancel());\n\t\t}\n\n\t\t// bulk delete\n\t\tif (frappe.model.can_delete(doctype)) {\n\t\t\tactions_menu_items.push(bulk_delete());\n\t\t}\n\n\t\treturn actions_menu_items;\n\t}\n\n\tparse_filters_from_route_options() {\n\t\tconst filters = [];\n\n\t\tfor (let field in frappe.route_options) {\n\n\t\t\tlet doctype = null;\n\t\t\tlet value = frappe.route_options[field];\n\n\t\t\tlet value_array;\n\t\t\tif ($.isArray(value) && value[0].startsWith('[') && value[0].endsWith(']')) {\n\t\t\t\tvalue_array = [];\n\t\t\t\tfor(var i=0; i<value.length; i++) {\n\t\t\t\t\tvalue_array.push(JSON.parse(value[i]));\n\t\t\t\t}\n\t\t\t} else if (typeof value === 'string' && value.startsWith('[') && value.endsWith(']')) {\n\t\t\t\tvalue = JSON.parse(value);\n\t\t\t}\n\n\t\t\t// if `Child DocType.fieldname`\n\t\t\tif (field.includes('.')) {\n\t\t\t\tdoctype = field.split('.')[0];\n\t\t\t\tfield = field.split('.')[1];\n\t\t\t}\n\n\t\t\t// find the table in which the key exists\n\t\t\t// for example the filter could be {\"item_code\": \"X\"}\n\t\t\t// where item_code is in the child table.\n\n\t\t\t// we can search all tables for mapping the doctype\n\t\t\tif (!doctype) {\n\t\t\t\tdoctype = frappe.meta.get_doctype_for_field(this.doctype, field);\n\t\t\t}\n\n\t\t\tif (doctype) {\n\t\t\t\tif (value_array) {\n\t\t\t\t\tfor(var j=0; j<value_array.length; j++){\n\t\t\t\t\t\tif ($.isArray(value_array[j])) {\n\t\t\t\t\t\t\tfilters.push([doctype, field, value_array[j][0], value_array[j][1]]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfilters.push([doctype, field, \"=\", value_array[j]]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if ($.isArray(value)) {\n\t\t\t\t\tfilters.push([doctype, field, value[0], value[1]]);\n\t\t\t\t} else {\n\t\t\t\t\tfilters.push([doctype, field, \"=\", value]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tstatic trigger_list_update(data) {\n\t\tconst doctype = data.doctype;\n\t\tif (!doctype) return;\n\t\tfrappe.provide('frappe.views.trees');\n\n\t\t// refresh tree view\n\t\tif (frappe.views.trees[doctype]) {\n\t\t\tfrappe.views.trees[doctype].tree.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\t// refresh list view\n\t\tconst page_name = frappe.get_route_str();\n\t\tconst list_view = frappe.views.list_view[page_name];\n\t\tlist_view && list_view.on_update(data);\n\t}\n};\n\n$(document).on('save', (event, doc) => {\n\tfrappe.views.ListView.trigger_list_update(doc);\n});\n\nfrappe.get_list_view = (doctype) => {\n\tlet route = `List/${doctype}/List`;\n\treturn frappe.views.list_view[route];\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.list_view');\n\nwindow.cur_list = null;\nfrappe.views.ListFactory = class ListFactory extends frappe.views.Factory {\n\tmake (route) {\n\t\tvar me = this;\n\t\tvar doctype = route[1];\n\n\t\tfrappe.model.with_doctype(doctype, function () {\n\t\t\tif (locals['DocType'][doctype].issingle) {\n\t\t\t\tfrappe.set_re_route('Form', doctype);\n\t\t\t} else {\n\t\t\t\t// List / Gantt / Kanban / etc\n\t\t\t\t// File is a special view\n\t\t\t\tconst view_name = doctype !== 'File' ? route[2] : 'File';\n\t\t\t\tlet view_class = frappe.views[view_name + 'View'];\n\t\t\t\tif (!view_class) view_class = frappe.views.ListView;\n\n\t\t\t\tif (view_class && view_class.load_last_view && view_class.load_last_view()) {\n\t\t\t\t\t// view can have custom routing logic\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.provide('frappe.views.list_view.' + doctype);\n\t\t\t\tconst page_name = frappe.get_route_str();\n\n\t\t\t\tif (!frappe.views.list_view[page_name]) {\n\t\t\t\t\tfrappe.views.list_view[page_name] = new view_class({\n\t\t\t\t\t\tdoctype: doctype,\n\t\t\t\t\t\tparent: me.make_page(true, page_name)\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.container.change_to(page_name);\n\t\t\t\t}\n\t\t\t\tme.set_cur_list();\n\t\t\t}\n\t\t});\n\t}\n\n\tshow() {\n\t\tif(this.re_route_to_view()) {\n\t\t\treturn;\n\t\t}\n\t\tthis.set_module_breadcrumb();\n\t\tsuper.show();\n\t\tthis.set_cur_list();\n\t\tcur_list && cur_list.show();\n\t}\n\n\tre_route_to_view() {\n\t\tvar route = frappe.get_route();\n\t\tvar doctype = route[1];\n\t\tvar last_route = frappe.route_history.slice(-2)[0];\n\t\tif (route[0] === 'List' && route.length === 2 && frappe.views.list_view[doctype]) {\n\t\t\tif(last_route && last_route[0]==='List' && last_route[1]===doctype) {\n\t\t\t\t// last route same as this route, so going back.\n\t\t\t\t// this happens because #List/Item will redirect to #List/Item/List\n\t\t\t\t// while coming from back button, the last 2 routes will be same, so\n\t\t\t\t// we know user is coming in the reverse direction (via back button)\n\n\t\t\t\t// example:\n\t\t\t\t// Step 1: #List/Item redirects to #List/Item/List\n\t\t\t\t// Step 2: User hits \"back\" comes back to #List/Item\n\t\t\t\t// Step 3: Now we cannot send the user back to #List/Item/List so go back one more step\n\t\t\t\twindow.history.go(-1);\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tset_module_breadcrumb() {\n\t\tif (frappe.route_history.length > 1) {\n\t\t\tvar prev_route = frappe.route_history[frappe.route_history.length - 2];\n\t\t\tif (prev_route[0] === 'modules') {\n\t\t\t\tvar doctype = frappe.get_route()[1],\n\t\t\t\t\tmodule = prev_route[1];\n\t\t\t\tif (frappe.module_links[module] && frappe.module_links[module].includes(doctype)) {\n\t\t\t\t\t// save the last page from the breadcrumb was accessed\n\t\t\t\t\tfrappe.breadcrumbs.set_doctype_module(doctype, module);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tset_cur_list() {\n\t\tvar route = frappe.get_route();\n\t\tvar page_name = frappe.get_route_str();\n\t\tcur_list = frappe.views.list_view[page_name];\n\t\tif (cur_list && cur_list.doctype !== route[1]) {\n\t\t\t// changing...\n\t\t\twindow.cur_list = null;\n\t\t}\n\t}\n}\n","frappe.provide('frappe.ui');\n\nexport default class ListFilter {\n\tconstructor({ wrapper, doctype }) {\n\t\tObject.assign(this, arguments[0]);\n\t\tthis.can_add_global = frappe.user.has_role(['System Manager', 'Administrator']);\n\t\tthis.filters = [];\n\t\tthis.make();\n\t\tthis.bind();\n\t\tthis.refresh();\n\t}\n\n\tmake() {\n\t\t// init dom\n\t\tthis.wrapper.html('<li class=\"input-area\"></li>');\n\t\tthis.$input_area = this.wrapper.find('.input-area');\n\t\tthis.$list_filters = this.wrapper.find('.list-filters');\n\n\t\tthis.filter_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tlabel: __('Save Filter').toUpperCase(),\n\t\t\t\tplaceholder: __('Filter Name'),\n\t\t\t\tinput_class: 'input-xs'\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1,\n\t\t});\n\n\t\t$(this.filter_input.label_area).css('font-size', 10);\n\n\t\tthis.is_global_input = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Check',\n\t\t\t\tlabel: __('Is Global')\n\t\t\t},\n\t\t\tparent: this.$input_area,\n\t\t\trender_input: 1\n\t\t});\n\n\t}\n\n\tbind() {\n\t\tthis.bind_save_filter();\n\t\tthis.bind_click_filter();\n\t\tthis.bind_remove_filter();\n\t}\n\n\trefresh() {\n\t\tthis.get_list_filters()\n\t\t\t.then(() => {\n\t\t\t\tconst html = this.filters.map(filter => this.filter_template(filter));\n\t\t\t\tthis.wrapper.find('.list-link').remove();\n\t\t\t\tthis.wrapper.append(html);\n\t\t\t});\n\t\tthis.is_global_input.toggle(false);\n\t\tthis.filter_input.set_description('');\n\t}\n\n\tfilter_template(filter) {\n\t\treturn `<li class=\"list-link\" data-name=\"${filter.name}\">\n\t\t\t<a style=\"max-width: 90%;\">${filter.filter_name}</a>\n\t\t\t<a class=\"text-muted pull-right\"><span class=\"remove octicon octicon-x\"></span></a>\n\t\t</li>`;\n\t}\n\n\tbind_click_filter() {\n\t\tthis.wrapper.on('click', '.list-link', e => {\n\t\t\tconst name = $(e.currentTarget).attr('data-name');\n\t\t\tthis.list_view.filter_area.clear()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.list_view.filter_area.add(this.get_filters_values(name));\n\t\t\t\t});\n\t\t});\n\t}\n\n\tbind_remove_filter() {\n\t\tthis.wrapper.on('click', '.list-link .remove', e => {\n\t\t\tconst $li = $(e.currentTarget).closest('.list-link')\n\t\t\tconst name = $li.attr('data-name');\n\t\t\t$li.remove();\n\t\t\tthis.remove_filter(name)\n\t\t\t\t.then(() => this.refresh());\n\t\t});\n\t}\n\n\tbind_save_filter() {\n\t\tthis.filter_input.$input.keydown(frappe.utils.debounce(e => {\n\t\t\tconst value = this.filter_input.get_value();\n\t\t\tconst has_value = Boolean(value);\n\n\t\t\tif (e.which === frappe.ui.keyCode['ENTER']) {\n\t\t\t\tif (!has_value || this.filter_name_exists(value)) return;\n\n\t\t\t\tthis.filter_input.set_value('');\n\t\t\t\tthis.save_filter(value)\n\t\t\t\t\t.then(() => this.refresh());\n\t\t\t} else {\n\t\t\t\tlet help_text = __('Press Enter to save');\n\n\t\t\t\tif (this.filter_name_exists(value)) {\n\t\t\t\t\thelp_text = __('Duplicate Filter Name');\n\t\t\t\t}\n\n\t\t\t\tthis.filter_input.set_description(has_value ? help_text : '');\n\n\t\t\t\tif (this.can_add_global) {\n\t\t\t\t\tthis.is_global_input.toggle(has_value);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 300));\n\t}\n\n\tsave_filter(filter_name) {\n\t\treturn frappe.db.insert({\n\t\t\tdoctype: 'List Filter',\n\t\t\treference_doctype: this.list_view.doctype,\n\t\t\tfilter_name,\n\t\t\tfor_user: this.is_global_input.get_value() ? '' : frappe.session.user,\n\t\t\tfilters: JSON.stringify(this.get_current_filters())\n\t\t});\n\t}\n\n\tremove_filter(name) {\n\t\tif (!name) return;\n\t\treturn frappe.db.delete_doc('List Filter', name);\n\t}\n\n\tget_filters_values(name) {\n\t\tconst filter = this.filters.find(filter => filter.name === name);\n\t\treturn  JSON.parse(filter.filters || '[]');\n\t}\n\n\tget_current_filters() {\n\t\treturn this.list_view.filter_area.get();\n\t}\n\n\tfilter_name_exists(filter_name) {\n\t\treturn (this.filters || []).find(f => f.filter_name === filter_name);\n\t}\n\n\tget_list_filters() {\n\t\treturn frappe.db.get_list('List Filter', {\n\t\t\tfields: ['name', 'filter_name', 'for_user', 'filters'],\n\t\t\tfilters: { reference_doctype: this.list_view.doctype },\n\t\t\tor_filters: [['for_user', '=', frappe.session.user], ['for_user', '=', '']]\n\t\t}).then((filters) => {\n\t\t\tthis.filters = filters || [];\n\t\t});\n\t}\n}\n","frappe.provide('frappe.views');\n\nfrappe.views.FileView = class FileView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 2) {\n\t\t\tconst view_user_settings = frappe.get_user_settings('File', 'File');\n\t\t\tfrappe.set_route('List', 'File', view_user_settings.last_folder || frappe.boot.home_folder);\n\t\t\treturn true;\n\t\t}\n\t\treturn redirect_to_home_if_invalid_route();\n\t}\n\n\tget view_name() {\n\t\treturn 'File';\n\t}\n\n\tshow() {\n\t\tif (!redirect_to_home_if_invalid_route()) {\n\t\t\tsuper.show();\n\t\t}\n\t}\n\n\tsetup_view() {\n\t\tthis.render_header();\n\t\tthis.setup_events();\n\t}\n\n\tset_breadcrumbs() {\n\t\tconst route = frappe.get_route();\n\t\troute.splice(-1);\n\t\tconst last_folder = route[route.length - 1];\n\t\tif (last_folder === 'File') return;\n\n\t\tfrappe.breadcrumbs.add({\n\t\t\ttype: 'Custom',\n\t\t\tlabel: __('Home'),\n\t\t\troute: '#List/File/Home'\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = __('File Manager');\n\n\t\t\t\tconst route = frappe.get_route();\n\t\t\t\tthis.current_folder = route.slice(2).join('/');\n\t\t\t\tthis.filters = [['File', 'folder', '=', this.current_folder, true]];\n\t\t\t\tthis.order_by = this.view_user_settings.order_by || 'file_name asc';\n\n\t\t\t\tthis.menu_items = this.menu_items.concat(this.file_menu_items());\n\t\t\t});\n\t}\n\n\tfile_menu_items() {\n\t\tconst items = [\n\t\t\t{\n\t\t\t\tlabel: __('Home'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.set_route('List', 'File', 'Home');\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Cut'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.file_manager.cut(this.get_checked_items(), this.current_folder);\n\t\t\t\t},\n\t\t\t\tclass: 'cut-menu-button hide'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Paste'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.file_manager.paste(this.current_folder);\n\t\t\t\t},\n\t\t\t\tclass: 'paste-menu-button hide'\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('New Folder'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.prompt(__('Name'), (values) => {\n\t\t\t\t\t\tif((values.value.indexOf(\"/\") > -1)) {\n\t\t\t\t\t\t\tfrappe.throw(__(\"Folder name should not include '/' (slash)\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst data =  {\n\t\t\t\t\t\t\tfile_name: values.value,\n\t\t\t\t\t\t\tfolder: this.current_folder\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"frappe.core.doctype.file.file.create_new_folder\",\n\t\t\t\t\t\t\targs: data\n\t\t\t\t\t\t});\n\t\t\t\t\t}, __('Enter folder name'), __('Create'));\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Toggle Grid View'),\n\t\t\t\taction: () => {\n\t\t\t\t\tfrappe.views.FileView.grid_view = !frappe.views.FileView.grid_view;\n\t\t\t\t\tthis.refresh();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Import Zip'),\n\t\t\t\taction: () => {\n\t\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\t\tfolder: this.current_folder,\n\t\t\t\t\t\trestrictions: {\n\t\t\t\t\t\t\tallowed_file_types: ['.zip']\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton_success: file => {\n\t\t\t\t\t\t\tfrappe.show_alert(__('Unzipping files...'));\n\t\t\t\t\t\t\tfrappe.call('frappe.core.doctype.file.file.unzip_file', { name: file.name })\n\t\t\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\t\t\tfrappe.show_alert(__('Unzipped {0} files', [r.message]));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\treturn items;\n\t}\n\n\tset_fields() {\n\t\tthis.fields = this.meta.fields\n\t\t\t.filter(df => frappe.model.is_value_type(df.fieldtype) && !df.hidden)\n\t\t\t.map(df => df.fieldname)\n\t\t\t.concat(['name', 'modified', 'creation']);\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\n\t\tthis.data = this.data.map(d => this.prepare_datum(d));\n\n\t\t// Bring folders to the top\n\t\tconst { sort_by } = this.sort_selector;\n\t\tif (sort_by === 'file_name') {\n\t\t\tthis.data.sort((a, b) => {\n\t\t\t\tif (a.is_folder && !b.is_folder) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (!a.is_folder &&b.is_folder) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\t\t}\n\t}\n\n\tprepare_datum(d) {\n\t\tlet icon_class = '';\n\t\tif (d.is_folder) {\n\t\t\ticon_class = \"octicon octicon-file-directory\";\n\t\t} else if (frappe.utils.is_image_file(d.file_name)) {\n\t\t\ticon_class = \"octicon octicon-file-media\";\n\t\t} else {\n\t\t\ticon_class = 'octicon octicon-file-text';\n\t\t}\n\n\t\tlet title = d.file_name || d.file_url;\n\t\ttitle = title.slice(0, 60);\n\t\td._title = title;\n\t\td.icon_class = icon_class;\n\n\t\td.subject_html = `\n\t\t\t<i class=\"${icon_class} text-muted\" style=\"width: 16px;\"></i>\n\t\t\t<span>${title}</span>\n\t\t\t${d.is_private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : ''}\n\t\t`;\n\t\treturn d;\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tfrappe.model.user_settings.save('File', 'grid_view', frappe.views.FileView.grid_view);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_folder: this.current_folder,\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.$result.removeClass('file-grid');\n\t\tif (frappe.views.FileView.grid_view) {\n\t\t\tthis.render_grid_view();\n\t\t} else {\n\t\t\tsuper.render();\n\t\t}\n\t}\n\n\trender_grid_view() {\n\t\tlet html = '';\n\n\t\thtml = this.data.map(d => {\n\t\t\treturn `\n\t\t\t\t<a href=\"${this.get_route_url(d)}\">\n\t\t\t\t\t<div class=\"file-wrapper padding flex small\">\n\t\t\t\t\t\t<div class=\"file-icon text-muted\">\n\t\t\t\t\t\t\t<span class=\"${d.icon_class} mega-octicon\"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"file-title ellipsis\">${d._title}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t`;\n\t\t}).join('');\n\t\tthis.$result.addClass('file-grid');\n\t\tthis.$result.html(html);\n\t}\n\n\tget_breadcrumbs_html() {\n\t\tconst route = frappe.get_route();\n\t\tconst folders = route.slice(2);\n\n\t\treturn folders\n\t\t\t.map((folder, i) => {\n\t\t\t\tif (i === folders.length - 1) {\n\t\t\t\t\treturn `<span>${folder}</span>`;\n\t\t\t\t}\n\t\t\t\tconst route = folders.reduce((acc, curr, j) => {\n\t\t\t\t\tif (j <= i) {\n\t\t\t\t\t\tacc += '/' + curr;\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, '#List/File');\n\n\t\t\t\treturn `<a href=\"${route}\">${folder}</a>`;\n\t\t\t})\n\t\t\t// only show last 3 breadcrumbs\n\t\t\t.slice(-3)\n\t\t\t.join('&nbsp;/&nbsp;');\n\t}\n\n\tget_header_html() {\n\t\tconst breadcrumbs_html = this.get_breadcrumbs_html();\n\n\t\tlet subject_html = `\n\t\t\t<div class=\"list-row-col list-subject level\">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"${__(\"Select All\")}\">\n\t\t\t\t<span class=\"level-item\">${breadcrumbs_html}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t<span>${__('Size')}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs\">\n\t\t\t\t<span>${__('Created')}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.get_header_html_skeleton(subject_html, '<span class=\"list-count\"></span>');\n\t}\n\n\tget_route_url(file) {\n\t\treturn file.is_folder ? '#List/File/' + file.name : this.get_form_link(file);\n\t}\n\n\tget_left_html(file) {\n\t\tfile = this.prepare_datum(file);\n\t\tconst file_size = file.file_size ? frappe.form.formatters.FileSize(file.file_size) : '';\n\t\tconst route_url = this.get_route_url(file);\n\n\t\tlet created_on;\n\t\tconst [date] = file.creation.split(' ');\n\t\tif (date === frappe.datetime.now_date()) {\n\t\t\tcreated_on = comment_when(file.creation);\n\t\t} else {\n\t\t\tcreated_on = frappe.datetime.str_to_user(date);\n\t\t}\n\n\t\treturn `\n\t\t\t<div class=\"list-row-col ellipsis list-subject level\">\n\t\t\t\t<input class=\"level-item list-row-checkbox hidden-xs\" type=\"checkbox\" data-name=\"${file.name}\">\n\t\t\t\t<span class=\"level-item  ellipsis\" title=\"${file.file_name}\">\n\t\t\t\t\t<a class=\"ellipsis\" href=\"${route_url}\" title=\"${file.file_name}\">\n\t\t\t\t\t\t${file.subject_html}\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${file_size}</span>\n\t\t\t</div>\n\t\t\t<div class=\"list-row-col ellipsis hidden-xs text-muted\">\n\t\t\t\t<span>${created_on}</span>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_right_html(file) {\n\t\treturn `\n\t\t\t<div class=\"level-item list-row-activity\">\n\t\t\t\t${comment_when(file.modified)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tsetup_events() {\n\t\tsuper.setup_events();\n\t\tthis.setup_drag_drop();\n\t}\n\n\tsetup_drag_drop() {\n\t\tthis.$result.on('dragenter dragover', false)\n\t\t\t.on('drop', e => {\n\t\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\n\t\t\t\tnew frappe.ui.FileUploader({\n\t\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\t\tfolder: this.current_folder\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\ttoggle_result_area() {\n\t\tsuper.toggle_result_area();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ton_row_checked() {\n\t\tsuper.on_row_checked();\n\t\tthis.toggle_cut_paste_buttons();\n\t}\n\n\ttoggle_cut_paste_buttons() {\n\t\t// paste btn\n\t\tconst $paste_btn = this.page.menu_btn_group.find('.paste-menu-button');\n\t\tconst hide = !frappe.file_manager.can_paste ||\n\t\t\tfrappe.file_manager.old_folder === this.current_folder;\n\n\t\tif (hide) {\n\t\t\t$paste_btn.addClass('hide');\n\t\t} else {\n\t\t\t$paste_btn.removeClass('hide');\n\t\t}\n\n\t\t// cut btn\n\t\tconst $cut_btn = this.page.menu_btn_group.find('.cut-menu-button');\n\t\tif (this.$checks && this.$checks.length > 0) {\n\t\t\t$cut_btn.removeClass('hide');\n\t\t} else {\n\t\t\t$cut_btn.addClass('hide');\n\t\t}\n\t}\n};\n\nfrappe.views.FileView.grid_view = frappe.get_user_settings('File').grid_view || false;\n\nfunction redirect_to_home_if_invalid_route() {\n\tconst route = frappe.get_route();\n\tif (route[2] === 'List') {\n\t\t// if the user somehow redirects to List/File/List\n\t\t// redirect back to Home\n\t\tfrappe.set_route('List', 'File', 'Home');\n\t\treturn true;\n\t}\n\treturn false;\n}\n","// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nfrappe.provide('frappe.views');\nfrappe.provide(\"frappe.interaction_settings\");\n\nfrappe.views.InteractionComposer = class InteractionComposer {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tlet me = this;\n\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: (me.title || me.subject || __(\"New Activity\")),\n\t\t\tno_submit_on_enter: true,\n\t\t\tfields: me.get_fields(),\n\t\t\tprimary_action_label: __('Create'),\n\t\t\tprimary_action: function() {\n\t\t\t\tme.create_action();\n\t\t\t}\n\t\t});\n\n\t\t$(document).on(\"upload_complete\", function(event, attachment) {\n\t\t\tif(me.dialog.display) {\n\t\t\t\tlet wrapper = $(me.dialog.fields_dict.select_attachments.wrapper);\n\n\t\t\t\t// find already checked items\n\t\t\t\tlet checked_items = wrapper.find('[data-file-name]:checked').map(function() {\n\t\t\t\t\treturn $(this).attr(\"data-file-name\");\n\t\t\t\t});\n\n\t\t\t\t// reset attachment list\n\t\t\t\tme.render_attach();\n\n\t\t\t\t// check latest added\n\t\t\t\tchecked_items.push(attachment.name);\n\n\t\t\t\t$.each(checked_items, function(i, filename) {\n\t\t\t\t\twrapper.find('[data-file-name=\"'+ filename +'\"]').prop(\"checked\", true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tme.prepare();\n\t\tme.dialog.show();\n\t}\n\n\tget_fields() {\n\t\tlet me = this;\n\t\tlet interaction_docs = Object.keys(get_doc_mappings());\n\n\t\tlet fields = [\n\t\t\t{label:__(\"Reference\"), fieldtype:\"Select\",\n\t\t\t\tfieldname:\"interaction_type\", options: interaction_docs,\n\t\t\t\treqd: 1,\n\t\t\t\tonchange: () => {\n\t\t\t\t\tlet values = me.get_values();\n\t\t\t\t\tme.get_fields().forEach(field => {\n\t\t\t\t\t\tif (field.fieldname != \"interaction_type\") {\n\t\t\t\t\t\t\tme.dialog.set_df_property(field.fieldname, \"reqd\", 0);\n\t\t\t\t\t\t\tme.dialog.set_df_property(field.fieldname, \"hidden\", 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.set_reqd_hidden_fields(values);\n\t\t\t\t\tme.get_event_categories();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{label:__(\"Category\"), fieldtype:\"Select\",\n\t\t\t\tfieldname:\"category\", options: \"\", hidden: 1},\n\t\t\t{label:__(\"Public\"), fieldtype:\"Check\",\n\t\t\t\tfieldname:\"public\", default: \"1\"},\n\t\t\t{fieldtype: \"Column Break\"},\n\t\t\t{label:__(\"Date\"), fieldtype:\"Datetime\",\n\t\t\t\tfieldname:\"due_date\"},\n\t\t\t{label:__(\"Assigned To\"), fieldtype:\"Link\",\n\t\t\t\tfieldname:\"assigned_to\", options:\"User\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Summary\"), fieldtype:\"Data\",\n\t\t\t\tfieldname:\"summary\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{fieldtype:\"Text Editor\", fieldname:\"description\"},\n\t\t\t{fieldtype: \"Section Break\"},\n\t\t\t{label:__(\"Select Attachments\"), fieldtype:\"HTML\",\n\t\t\t\tfieldname:\"select_attachments\"}\n\t\t];\n\n\t\treturn fields;\n\n\t}\n\n\tget_event_categories() {\n\t\tlet me = this;\n\t\tfrappe.model.with_doctype('Event', () => {\n\t\t\tlet categories = frappe.meta.get_docfield(\"Event\", \"event_category\").options.split(\"\\n\");\n\t\t\tme.dialog.get_input(\"category\").empty().add_options(categories);\n\t\t});\n\t}\n\n\tprepare() {\n\t\tthis.setup_attach();\n\t}\n\n\tset_reqd_hidden_fields(values) {\n\t\tlet me = this;\n\t\tif (values&&\"interaction_type\" in values) {\n\t\t\tlet doc_mapping = get_doc_mappings();\n\t\t\tdoc_mapping[values.interaction_type][\"reqd_fields\"].forEach(value => {\n\t\t\t\tme.dialog.set_df_property(value, 'reqd', 1);\n\t\t\t});\n\n\t\t\tdoc_mapping[values.interaction_type][\"hidden_fields\"].forEach(value => {\n\t\t\t\tme.dialog.set_df_property(value, 'hidden', 1);\n\t\t\t});\n\t\t}\n\t}\n\n\tsetup_attach() {\n\t\tvar fields = this.dialog.fields_dict;\n\t\tvar attach = $(fields.select_attachments.wrapper);\n\n\t\tif (!this.attachments) {\n\t\t\tthis.attachments = [];\n\t\t}\n\n\t\tlet args = {\n\t\t\tfolder: 'Home/Attachments',\n\t\t\ton_success: attachment => this.attachments.push(attachment)\n\t\t};\n\n\t\tif (this.frm) {\n\t\t\targs = {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tdocname: this.frm.docname,\n\t\t\t\tfolder: 'Home/Attachments',\n\t\t\t\ton_success: attachment => {\n\t\t\t\t\tthis.frm.attachments.attachment_uploaded(attachment);\n\t\t\t\t\tthis.render_attach();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t$(\"<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>\"\n\t\t\t+__(\"Select Attachments\")+\"</h6><div class='attach-list'></div>\\\n\t\t\t<p class='add-more-attachments'>\\\n\t\t\t<a class='text-muted small'><i class='octicon octicon-plus' style='font-size: 12px'></i> \"\n\t\t\t+__(\"Add Attachment\")+\"</a></p>\").appendTo(attach.empty());\n\t\tattach\n\t\t\t.find(\".add-more-attachments a\")\n\t\t\t.on('click',() => new frappe.ui.FileUploader(args));\n\t\tthis.render_attach();\n\t}\n\n\trender_attach(){\n\t\tlet fields = this.dialog.fields_dict;\n\t\tlet attach = $(fields.select_attachments.wrapper).find(\".attach-list\").empty();\n\n\t\tlet files = [];\n\t\tif (this.attachments && this.attachments.length) {\n\t\t\tfiles = files.concat(this.attachments);\n\t\t}\n\t\tif (cur_frm) {\n\t\t\tfiles = files.concat(cur_frm.get_files());\n\t\t}\n\n\t\tif(files.length) {\n\t\t\t$.each(files, function(i, f) {\n\t\t\t\tif (!f.file_name) return;\n\t\t\t\tf.file_url = frappe.urllib.get_full_url(f.file_url);\n\n\t\t\t\t$(repl('<p class=\"checkbox\">'\n\t\t\t\t\t+\t'<label><span><input type=\"checkbox\" data-file-name=\"%(name)s\"></input></span>'\n\t\t\t\t\t+\t\t'<span class=\"small\">%(file_name)s</span>'\n\t\t\t\t\t+\t' <a href=\"%(file_url)s\" target=\"_blank\" class=\"text-muted small\">'\n\t\t\t\t\t+\t\t'<i class=\"fa fa-share\" style=\"vertical-align: middle; margin-left: 3px;\"></i>'\n\t\t\t\t\t+ '</label></p>', f))\n\t\t\t\t\t.appendTo(attach);\n\t\t\t});\n\t\t}\n\t}\n\n\tcreate_action() {\n\t\tlet me = this;\n\t\tlet btn = me.dialog.get_primary_btn();\n\n\t\tlet form_values = this.get_values();\n\t\tif(!form_values) return;\n\n\t\tlet selected_attachments =\n\t\t\t$.map($(me.dialog.wrapper).find(\"[data-file-name]:checked\"), function(element){\n\t\t\t\treturn $(element).attr(\"data-file-name\");\n\t\t\t});\n\n\t\tme.create_interaction(btn, form_values, selected_attachments);\n\t}\n\n\tget_values() {\n\t\tlet me = this;\n\t\tlet values = this.dialog.get_values(true);\n\t\tif (values) {\n\t\t\tvalues[\"reference_doctype\"] = me.frm.doc.doctype;\n\t\t\tvalues[\"reference_document\"] = me.frm.doc.name;\n\t\t}\n\n\t\treturn values;\n\t}\n\n\tcreate_interaction(btn, form_values, selected_attachments) {\n\t\tlet me = this;\n\t\tme.dialog.hide();\n\n\t\tlet field_map = get_doc_mappings();\n\t\tlet interaction_values = {};\n\t\tObject.keys(form_values).forEach(value => {\n\t\t\tinteraction_values[field_map[form_values.interaction_type][\"field_map\"][value]] = form_values[value];\n\t\t});\n\n\t\tif (\"event_type\" in interaction_values){\n\t\t\tinteraction_values[\"event_type\"] = (form_values.public == 1) ? \"Public\" : \"Private\";\n\t\t}\n\t\tif (interaction_values[\"doctype\"] == \"Event\") {\n\t\t\tinteraction_values[\"event_participants\"] = [{\"reference_doctype\": form_values.reference_doctype,\n\t\t\t\t\"reference_docname\": form_values.reference_document}];\n\t\t}\n\t\tif (!(\"owner\" in interaction_values)){\n\t\t\tinteraction_values[\"owner\"] = frappe.session.user;\n\t\t}\n\t\treturn frappe.call({\n\t\t\tmethod:\"frappe.client.insert\",\n\t\t\targs: { doc: interaction_values},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"{0} created successfully\", [form_values.interaction_type]),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t});\n\t\t\t\t\tif (\"assigned_to\" in form_values) {\n\t\t\t\t\t\tme.assign_document(r.message, form_values[\"assigned_to\"]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (selected_attachments) {\n\t\t\t\t\t\tme.add_attachments(r.message, selected_attachments);\n\t\t\t\t\t}\n\t\t\t\t\tif (cur_frm) {\n\t\t\t\t\t\t// clear input\n\t\t\t\t\t\tcur_frm.timeline.input && cur_frm.timeline.input.val(\"\");\n\t\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while creating the document. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tassign_document(doc, assignee) {\n\t\tif (doc.doctype != \"ToDo\") {\n\t\t\tfrappe.call({\n\t\t\t\tmethod:'frappe.desk.form.assign_to.add',\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: doc.doctype,\n\t\t\t\t\tname: doc.name,\n\t\t\t\t\tassign_to: assignee,\n\t\t\t\t},\n\t\t\t\tcallback:function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"The document has been assigned to {0}\", [assignee]),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"The document could not be correctly assigned\"),\n\t\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t}\n\n\tadd_attachments(doc, attachments) {\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.utils.file_manager.add_attachments',\n\t\t\targs: {\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tattachments: JSON.stringify(attachments)\n\t\t\t},\n\t\t\tcallback:function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"The attachments could not be correctly linked to the new document\"),\n\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n};\n\nfunction get_doc_mappings() {\n\tconst doc_map = {\n\t\t\"Event\": {\n\t\t\t\"field_map\": {\n\t\t\t\t\"interaction_type\": \"doctype\",\n\t\t\t\t\"summary\": \"subject\",\n\t\t\t\t\"description\": \"description\",\n\t\t\t\t\"category\": \"event_category\",\n\t\t\t\t\"due_date\": \"starts_on\",\n\t\t\t\t\"public\": \"event_type\"\n\t\t\t},\n\t\t\t\"reqd_fields\": [\"summary\", \"due_date\"],\n\t\t\t\"hidden_fields\": []\n\t\t} ,\n\t\t\"ToDo\": {\n\t\t\t\"field_map\": {\n\t\t\t\t\"interaction_type\": \"doctype\",\n\t\t\t\t\"description\": \"description\",\n\t\t\t\t\"due_date\": \"date\",\n\t\t\t\t\"reference_doctype\": \"reference_type\",\n\t\t\t\t\"reference_document\": \"reference_name\",\n\t\t\t\t\"assigned_to\": \"owner\"\n\t\t\t},\n\t\t\t\"reqd_fields\": [\"description\"],\n\t\t\t\"hidden_fields\": [\"public\", \"category\"]\n\t\t}\n\t};\n\n\treturn doc_map;\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport ListFilter from './list_filter';\nfrappe.provide('frappe.views');\n\n// opts:\n// stats = list of fields\n// doctype\n// parent\n// set_filter = function called on click\n\nfrappe.views.ListSidebar = class ListSidebar {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.cat_tags = [];\n\t}\n\n\tmake() {\n\t\tvar sidebar_content = frappe.render_template(\"list_sidebar\", { doctype: this.doctype });\n\n\t\tthis.sidebar = $('<div class=\"list-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.setup_reports();\n\t\tthis.setup_list_filter();\n\t\tthis.setup_views();\n\t\tthis.setup_kanban_boards();\n\t\tthis.setup_calendar_view();\n\t\tthis.setup_email_inbox();\n\t\tthis.setup_keyboard_shortcuts();\n\t\tthis.setup_list_group_by();\n\n\t\t// do not remove\n\t\t// used to trigger custom scripts\n\t\t$(document).trigger('list_sidebar_setup');\n\n\t\tif (this.list_view.list_view_settings && this.list_view.list_view_settings.disable_sidebar_stats) {\n\t\t\tthis.sidebar.find('.sidebar-stat').remove();\n\t\t} else {\n\t\t\tthis.sidebar.find('.list-stats').on('click', (e) => {\n\t\t\t\tthis.reload_stats();\n\t\t\t});\n\t\t}\n\n\t}\n\n\tsetup_views() {\n\t\tvar show_list_link = false;\n\n\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Calendar\"]').removeClass(\"hide\");\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Gantt\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\t\t//show link for kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"]').removeClass('hide');\n\t\tif (this.doctype === \"Communication\" && frappe.boot.email_accounts.length) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Inbox\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (frappe.treeview_settings[this.doctype] || frappe.get_meta(this.doctype).is_tree) {\n\t\t\tthis.sidebar.find(\".tree-link\").removeClass(\"hide\");\n\t\t}\n\n\t\tthis.current_view = 'List';\n\t\tvar route = frappe.get_route();\n\t\tif (route.length > 2 && frappe.views.view_modes.includes(route[2])) {\n\t\t\tthis.current_view = route[2];\n\n\t\t\tif (this.current_view === 'Kanban') {\n\t\t\t\tthis.kanban_board = route[3];\n\t\t\t} else if (this.current_view === 'Inbox') {\n\t\t\t\tthis.email_account = route[3];\n\t\t\t}\n\t\t}\n\n\t\t// disable link for current view\n\t\tthis.sidebar.find('.list-link[data-view=\"' + this.current_view + '\"] a')\n\t\t\t.attr('disabled', 'disabled').addClass('disabled');\n\n\t\t//enable link for Kanban view\n\t\tthis.sidebar.find('.list-link[data-view=\"Kanban\"] a, .list-link[data-view=\"Inbox\"] a')\n\t\t\t.attr('disabled', null).removeClass('disabled');\n\n\t\t// show image link if image_view\n\t\tif (this.list_view.meta.image_field) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"Image\"]').removeClass('hide');\n\t\t\tshow_list_link = true;\n\t\t}\n\n\t\tif (show_list_link) {\n\t\t\tthis.sidebar.find('.list-link[data-view=\"List\"]').removeClass('hide');\n\t\t}\n\t}\n\n\tsetup_reports() {\n\t\t// add reports linked to this doctype to the dropdown\n\t\tvar me = this;\n\t\tvar added = [];\n\t\tvar dropdown = this.page.sidebar.find('.reports-dropdown');\n\t\tvar divider = false;\n\n\t\tvar add_reports = function(reports) {\n\t\t\t$.each(reports, function(name, r) {\n\t\t\t\tif (!r.ref_doctype || r.ref_doctype == me.doctype) {\n\t\t\t\t\tvar report_type = r.report_type === 'Report Builder' ?\n\t\t\t\t\t\t`List/${r.ref_doctype}/Report` : 'query-report';\n\n\t\t\t\t\tvar route = r.route || report_type + '/' + (r.title || r.name);\n\n\t\t\t\t\tif (added.indexOf(route) === -1) {\n\t\t\t\t\t\t// don't repeat\n\t\t\t\t\t\tadded.push(route);\n\n\t\t\t\t\t\tif (!divider) {\n\t\t\t\t\t\t\tme.get_divider().appendTo(dropdown);\n\t\t\t\t\t\t\tdivider = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$('<li><a href=\"#' + route + '\">' +\n\t\t\t\t\t\t\t__(r.title || r.name) + '</a></li>').appendTo(dropdown);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// from reference doctype\n\t\tif (this.list_view.settings.reports) {\n\t\t\tadd_reports(this.list_view.settings.reports);\n\t\t}\n\n\t\t// Sort reports alphabetically\n\t\tvar reports = Object.values(frappe.boot.user.all_reports).sort((a,b) => a.title.localeCompare(b.title)) || [];\n\n\t\t// from specially tagged reports\n\t\tadd_reports(reports);\n\t}\n\n\tsetup_list_filter() {\n\t\tthis.list_filter = new ListFilter({\n\t\t\twrapper: this.page.sidebar.find('.list-filters'),\n\t\t\tdoctype: this.doctype,\n\t\t\tlist_view: this.list_view\n\t\t});\n\t}\n\n\tsetup_kanban_boards() {\n\t\tconst $dropdown = this.page.sidebar.find('.kanban-dropdown');\n\t\tfrappe.views.KanbanView.setup_dropdown_in_sidebar(this.doctype, $dropdown);\n\t}\n\n\tsetup_calendar_view() {\n\t\tconst doctype = this.doctype;\n\n\t\tfrappe.db.get_list('Calendar View', {\n\t\t\tfilters: {\n\t\t\t\treference_doctype: doctype\n\t\t\t}\n\t\t}).then(result => {\n\t\t\tif (!(result && Array.isArray(result) && result.length)) return;\n\t\t\tconst calendar_views = result;\n\t\t\tconst $link_calendar = this.sidebar.find('.list-link[data-view=\"Calendar\"]');\n\n\t\t\tlet default_link = '';\n\t\t\tif (frappe.views.calendar[this.doctype]) {\n\t\t\t\t// has standard calendar view\n\t\t\t\tdefault_link = `<li><a href=\"#List/${doctype}/Calendar/Default\">\n\t\t\t\t\t${ __(\"Default\") }</a></li>`;\n\t\t\t}\n\t\t\tconst other_links = calendar_views.map(\n\t\t\t\tcalendar_view => `<li><a href=\"#List/${doctype}/Calendar/${calendar_view.name}\">\n\t\t\t\t\t${ __(calendar_view.name) }</a>\n\t\t\t\t</li>`\n\t\t\t).join('');\n\n\t\t\tconst dropdown_html = `\n\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t<a class=\"dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t\t\t${ __(\"Calendar\") } <span class=\"caret\"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class=\"dropdown-menu calendar-dropdown\" style=\"max-height: 300px; overflow-y: auto;\">\n\t\t\t\t\t\t${default_link}\n\t\t\t\t\t\t${other_links}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\t$link_calendar.removeClass('hide');\n\t\t\t$link_calendar.html(dropdown_html);\n\t\t});\n\t}\n\n\tsetup_email_inbox() {\n\t\t// get active email account for the user and add in dropdown\n\t\tif (this.doctype != \"Communication\")\n\t\t\treturn;\n\n\t\tlet $dropdown = this.page.sidebar.find('.email-account-dropdown');\n\t\tlet divider = false;\n\n\t\tif (has_common(frappe.user_roles, [\"System Manager\", \"Administrator\"])) {\n\t\t\t$(`<li class=\"new-email-account\"><a>${__(\"New Email Account\")}</a></li>`)\n\t\t\t\t.appendTo($dropdown);\n\t\t}\n\n\t\tlet accounts = frappe.boot.email_accounts;\n\t\taccounts.forEach((account) => {\n\t\t\tlet email_account = (account.email_id == \"All Accounts\") ? \"All Accounts\" : account.email_account;\n\t\t\tlet route = [\"List\", \"Communication\", \"Inbox\", email_account].join('/');\n\t\t\tlet display_name = [\"All Accounts\", \"Sent Mail\", \"Spam\", \"Trash\"].includes(account.email_id) ? __(account.email_id) : account.email_id;\n\t\t\t\n\t\t\tif (!divider) {\n\t\t\t\tthis.get_divider().appendTo($dropdown);\n\t\t\t\tdivider = true;\n\t\t\t}\n\t\t\t$(`<li><a href=\"#${route}\">${display_name}</a></li>`).appendTo($dropdown);\n\t\t\tif (account.email_id === \"Sent Mail\")\n\t\t\t\tdivider = false;\n\t\t});\n\n\t\t$dropdown.find('.new-email-account').click(function() {\n\t\t\tfrappe.new_doc(\"Email Account\");\n\t\t});\n\t}\n\n\tsetup_keyboard_shortcuts() {\n\t\tthis.sidebar.find('.list-link > a, .list-link > .btn-group > a').each((i, el) => {\n\t\t\tfrappe.ui.keys\n\t\t\t\t.get_shortcut_group(this.page)\n\t\t\t\t.add($(el));\n\t\t});\n\t}\n\n\tsetup_list_group_by() {\n\t\tthis.list_group_by = new frappe.views.ListGroupBy({\n\t\t\tdoctype: this.doctype,\n\t\t\tsidebar: this,\n\t\t\tlist_view: this.list_view,\n\t\t\tpage: this.page\n\t\t});\n\t}\n\n\tget_cat_tags() {\n\t\treturn this.cat_tags;\n\t}\n\n\tget_stats() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.reportview.get_sidebar_stats',\n\t\t\ttype: 'GET',\n\t\t\targs: {\n\t\t\t\tstats: me.stats,\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\t// wait for list filter area to be generated before getting filters, or fallback to default filters\n\t\t\t\tfilters: (me.list_view.filter_area ? me.list_filter.get_current_filters() : me.default_filters) || []\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_stat(\"_user_tags\", (r.message.stats || {})[\"_user_tags\"]);\n\t\t\t\tlet stats_dropdown = me.sidebar.find('.list-stats-dropdown');\n\t\t\t\tfrappe.utils.setup_search(stats_dropdown, '.stat-link', '.stat-label');\n\t\t\t}\n\t\t});\n\t}\n\n\trender_stat(field, stat, tags) {\n\t\tvar me = this;\n\t\tvar sum = 0;\n\t\tvar stats = [];\n\t\tvar label = frappe.meta.docfield_map[this.doctype][field] ?\n\t\t\tfrappe.meta.docfield_map[this.doctype][field].label : field;\n\n\t\tstat = (stat || []).sort(function(a, b) {\n\t\t\treturn b[1] - a[1];\n\t\t});\n\t\t$.each(stat, function(i, v) {\n\t\t\tsum = sum + v[1];\n\t\t});\n\n\t\tif (tags) {\n\t\t\tfor (var t in tags) {\n\t\t\t\tvar nfound = -1;\n\t\t\t\tfor (var i in stat) {\n\t\t\t\t\tif (tags[t] === stat[i][0]) {\n\t\t\t\t\t\tstats.push(stat[i]);\n\t\t\t\t\t\tnfound = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (nfound < 0) {\n\t\t\t\t\tstats.push([tags[t], 0]);\n\t\t\t\t} else {\n\t\t\t\t\tme.tempstats[\"_user_tags\"].splice(nfound, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfield = \"_user_tags\";\n\t\t} else {\n\t\t\tstats = stat;\n\t\t}\n\t\tvar context = {\n\t\t\tfield: field,\n\t\t\tstat: stats,\n\t\t\tsum: sum,\n\t\t\tlabel: field === '_user_tags' ? (tags ? __(label) : __(\"Tags\")) : __(label),\n\t\t};\n\t\t$(frappe.render_template(\"list_sidebar_stat\", context))\n\t\t\t.on(\"click\", \".stat-link\", function() {\n\t\t\t\tvar fieldname = $(this).attr('data-field');\n\t\t\t\tvar label = $(this).attr('data-label');\n\t\t\t\tvar condition = \"like\";\n\t\t\t\tvar existing = me.list_view.filter_area.filter_list.get_filter(fieldname);\n\t\t\t\tif(existing) {\n\t\t\t\t\texisting.remove();\n\t\t\t\t}\n\t\t\t\tif (label == \"No Tags\") {\n\t\t\t\t\tlabel = \"%,%\";\n\t\t\t\t\tcondition = \"not like\";\n\t\t\t\t}\n\t\t\t\tme.list_view.filter_area.filter_list.add_filter(me.list_view.doctype, fieldname, condition, label)\n\t\t\t\t\t.then(function() {\n\t\t\t\t\t\tme.list_view.refresh();\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.appendTo(this.sidebar.find(\".list-stats-dropdown\"));\n\t}\n\n\tset_fieldtype(df) {\n\n\t\t// scrub\n\t\tif (df.fieldname == \"docstatus\") {\n\t\t\tdf.fieldtype = \"Select\",\n\t\t\tdf.options = [\n\t\t\t\t{ value: 0, label: \"Draft\" },\n\t\t\t\t{ value: 1, label: \"Submitted\" },\n\t\t\t\t{ value: 2, label: \"Cancelled\" },\n\t\t\t];\n\t\t} else if (df.fieldtype == 'Check') {\n\t\t\tdf.fieldtype = 'Select';\n\t\t\tdf.options = [{ value: 0, label: 'No' },\n\t\t\t\t{ value: 1, label: 'Yes' }\n\t\t\t];\n\t\t} else if (['Text', 'Small Text', 'Text Editor', 'Code', 'Tag', 'Comments',\n\t\t\t'Dynamic Link', 'Read Only', 'Assign'\n\t\t].indexOf(df.fieldtype) != -1) {\n\t\t\tdf.fieldtype = 'Data';\n\t\t} else if (df.fieldtype == 'Link' && this.$w.find('.condition').val() != \"=\") {\n\t\t\tdf.fieldtype = 'Data';\n\t\t}\n\t\tif (df.fieldtype === \"Data\" && (df.options || \"\").toLowerCase() === \"email\") {\n\t\t\tdf.options = null;\n\t\t}\n\t}\n\n\treload_stats() {\n\t\tthis.sidebar.find(\".stat-link\").remove();\n\t\tthis.sidebar.find(\".stat-no-records\").remove();\n\t\tthis.get_stats();\n\t}\n\n\tget_divider() {\n\t\treturn $('<li role=\"separator\" class=\"divider\"></li>');\n\t}\n};\n","\nfrappe.provide('frappe.views');\n\nfrappe.views.ListGroupBy = class ListGroupBy {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make_wrapper();\n\n\t\tthis.user_settings = frappe.get_user_settings(this.doctype);\n\t\tthis.group_by_fields = ['assigned_to', 'owner'];\n\t\tif(this.user_settings.group_by_fields) {\n\t\t\tthis.group_by_fields = this.group_by_fields.concat(this.user_settings.group_by_fields);\n\t\t}\n\t\tthis.render_group_by_items();\n\t\tthis.make_group_by_fields_modal();\n\t\tthis.setup_dropdown();\n\t\tthis.setup_filter_by();\n\t}\n\n\tmake_group_by_fields_modal() {\n\t\tlet d = new frappe.ui.Dialog ({\n\t\t\ttitle: __(\"Select Filters\"),\n\t\t\tfields: this.get_group_by_dropdown_fields()\n\t\t});\n\n\t\td.set_primary_action(\"Save\", ({ group_by_fields }) => {\n\t\t\tfrappe.model.user_settings.save(this.doctype, 'group_by_fields', group_by_fields || null);\n\t\t\tthis.group_by_fields = group_by_fields ? ['assigned_to', 'owner', ...group_by_fields] : ['assigned_to', 'owner'];\n\t\t\tthis.render_group_by_items();\n\t\t\td.hide();\n\t\t});\n\n\t\td.$body.prepend(`<div class=\"filters-search\">\n\t\t\t<input type=\"text\" placeholder=\"${__('Search')}\" data-element=\"search\" class=\"form-control input-xs\">\n\t\t</div>`);\n\n\t\tthis.page.sidebar.find(\".add-list-group-by a\").on(\"click\", () => {\n\t\t\tfrappe.utils.setup_search(d.$body, '.unit-checkbox', '.label-area');\n\t\t\td.show();\n\t\t});\n\t}\n\n\tmake_wrapper() {\n\t\tthis.$wrapper = this.sidebar.sidebar.find('.list-group-by');\n\t\tlet html = `\n\t\t\t<li class=\"list-sidebar-label\">\n\t\t\t\t${__('Filter By')}\n\t\t\t</li>\n\t\t\t<div class=\"list-group-by-fields\">\n\t\t\t</div>\n\t\t\t<li class=\"add-list-group-by list-link\">\n\t\t\t\t<a class=\"add-group-by hidden-xs text-muted\">\n\t\t\t\t\t${__(\"Add Fields\")} <i class=\"octicon octicon-plus\" style=\"margin-left: 2px;\"></i>\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t`;\n\t\tthis.$wrapper.html(html);\n\t}\n\n\trender_group_by_items() {\n\t\tlet get_item_html = (fieldname) => {\n\t\t\tlet label, fieldtype;\n\t\t\tif (fieldname === 'assigned_to') {\n\t\t\t\tlabel = __('Assigned To');\n\t\t\t} else if (fieldname === 'owner') {\n\t\t\t\tlabel = __('Created By');\n\t\t\t} else {\n\t\t\t\tlabel = frappe.meta.get_label(this.doctype, fieldname);\n\t\t\t\tlet docfield = frappe.meta.get_docfield(this.doctype, fieldname);\n\t\t\t\tif (!docfield) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfieldtype = docfield.fieldtype;\n\t\t\t}\n\n\t\t\treturn `<li class=\"group-by-field list-link\">\n\t\t\t\t<div class=\"btn-group\">\n\t\t\t\t\t<a class = \"dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"\n\t\t\t\t\tdata-label=\"${label}\" data-fieldname=\"${fieldname}\" data-fieldtype=\"${fieldtype}\"\n\t\t\t\t\thref=\"#\" onclick=\"return false;\">\n\t\t\t\t\t\t${__(label)} <span class=\"caret\"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class=\"dropdown-menu group-by-dropdown\" role=\"menu\">\n\t\t\t\t\t\t<li><div class=\"list-loading text-center group-by-loading text-muted\">\n\t\t\t\t\t\t\t${__(\"Loading...\")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</li>`;\n\t\t};\n\t\tlet html = this.group_by_fields.map(get_item_html).join('');\n\t\tthis.$wrapper.find('.list-group-by-fields').html(html);\n\t}\n\n\tsetup_dropdown() {\n\t\tthis.$wrapper.on('click', '.group-by-field', (e)=> {\n\t\t\tlet dropdown = $(e.currentTarget).find('.group-by-dropdown');\n\t\t\tlet fieldname = $(e.currentTarget).find('a').attr('data-fieldname');\n\t\t\tlet fieldtype = $(e.currentTarget).find('a').attr('data-fieldtype');\n\t\t\tthis.get_group_by_count(fieldname).then(field_count_list => {\n\t\t\t\tif (field_count_list.length) {\n\t\t\t\t\tthis.render_dropdown_items(field_count_list, fieldtype, dropdown);\n\t\t\t\t\tfrappe.utils.setup_search(dropdown, '.group-by-item', '.group-by-value', 'data-name');\n\t\t\t\t} else {\n\t\t\t\t\tdropdown.html(\n\t\t\t\t\t\t`<div class=\"list-loading text-center group-by-empty text-muted\">\n\t\t\t\t\t\t${__(\"No filters found\")}\n\t\t\t\t\t\t</div>`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_group_by_dropdown_fields() {\n\t\tlet group_by_fields = [];\n\t\tlet fields = this.list_view.meta.fields.filter((f)=> [\"Select\", \"Link\", \"Data\", \"Int\", \"Check\"].includes(f.fieldtype));\n\t\tgroup_by_fields.push({\n\t\t\tlabel: __(this.doctype),\n\t\t\tfieldname: 'group_by_fields',\n\t\t\tfieldtype: 'MultiCheck',\n\t\t\tcolumns: 2,\n\t\t\toptions: fields\n\t\t\t\t.map(df => ({\n\t\t\t\t\tlabel: __(df.label),\n\t\t\t\t\tvalue: df.fieldname,\n\t\t\t\t\tchecked: this.group_by_fields.includes(df.fieldname)\n\t\t\t\t}))\n\t\t});\n\t\treturn group_by_fields;\n\t}\n\n\tget_group_by_count(field) {\n\t\tlet current_filters = this.list_view.get_filters_for_args();\n\n\t\t// remove filter of the current field\n\t\tcurrent_filters =\n\t\t\tcurrent_filters.filter((f_arr) => !f_arr.includes(field === 'assigned_to' ? '_assign': field));\n\n\t\tlet args =  {\n\t\t\tdoctype: this.doctype,\n\t\t\tcurrent_filters: current_filters,\n\t\t\tfield: field,\n\t\t};\n\n\n\t\treturn frappe.call('frappe.desk.listview.get_group_by_count', args).then((r) => {\n\t\t\tlet field_counts = r.message || [];\n\t\t\tfield_counts = field_counts.filter(f => f.count !== 0);\n\t\t\tlet current_user = field_counts.find(f => f.name === frappe.session.user);\n\t\t\tfield_counts = field_counts.filter(f => !['Guest', 'Administrator', frappe.session.user].includes(f.name));\n\t\t\t// Set frappe.session.user on top of the list\n\t\t\tif (current_user) field_counts.unshift(current_user);\n\t\t\treturn field_counts;\n\t\t});\n\t}\n\n\trender_dropdown_items(fields, fieldtype, dropdown) {\n\t\tlet get_dropdown_html = (field) => {\n\t\t\tlet label = field.name == null ? __('Not Specified') : field.name;\n\t\t\tif (label === frappe.session.user) {\n\t\t\t\tlabel = __('Me');\n\t\t\t} else if (fieldtype && fieldtype == 'Check') {\n\t\t\t\tlabel = label == '0'? __('No'): __('Yes');\n\t\t\t}\n\t\t\tlet value = field.name == null ? '' : encodeURIComponent(field.name);\n\n\t\t\treturn `<li class=\"group-by-item\" data-value=\"${value}\">\n\t\t\t\t<a class=\"badge-hover\" href=\"#\" onclick=\"return false;\">\n\t\t\t\t\t<span class=\"group-by-value\" data-name=\"${field.name}\">${label}</span>\n\t\t\t\t\t<span class=\"badge pull-right group-by-count\">${field.count}</span>\n\t\t\t\t</a>\n\t\t\t</li>`;\n\t\t};\n\t\tlet standard_html = `\n\t\t\t<div class=\"dropdown-search\">\n\t\t\t\t<input type=\"text\" placeholder=\"${__('Search')}\" data-element=\"search\" class=\"dropdown-search-input form-control input-xs\">\n\t\t\t</div>\n\t\t`;\n\n\t\tlet dropdown_html = standard_html + fields.map(get_dropdown_html).join('');\n\t\tdropdown.html(dropdown_html);\n\t}\n\n\tsetup_filter_by() {\n\t\tthis.$wrapper.on('click', '.group-by-item', (e) => {\n\t\t\tlet $target = $(e.currentTarget);\n\t\t\tlet fieldname = $target.parents('.group-by-field').find('a').data('fieldname');\n\t\t\tlet value = typeof $target.data('value') === 'string'\n\t\t\t\t? decodeURIComponent($target.data('value').trim())\n\t\t\t\t: $target.data('value');\n\t\t\tfieldname = fieldname === 'assigned_to' ? '_assign': fieldname;\n\n\t\t\treturn this.list_view.filter_area.remove(fieldname)\n\t\t\t\t.then(() => {\n\t\t\t\t\tlet operator = '=';\n\t\t\t\t\tif (value === '') {\n\t\t\t\t\t\toperator = 'is';\n\t\t\t\t\t\tvalue = 'not set';\n\t\t\t\t\t}\n\t\t\t\t\tif (fieldname === '_assign') {\n\t\t\t\t\t\toperator = 'like';\n\t\t\t\t\t\tvalue = `%${value}%`;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.list_view.filter_area.add(this.doctype, fieldname, operator, value);\n\t\t\t\t});\n\t\t});\n\t}\n\n};\n","frappe.provide('frappe.views');\n\nfrappe.views.GanttView = class GanttView extends frappe.views.ListView {\n\tget view_name() {\n\t\treturn 'Gantt';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = this.page_title + ' ' + __('Gantt');\n\t\t\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\t\t\t\tif(this.calendar_settings.order_by) {\n\t\t\t\t\tthis.sort_by = this.calendar_settings.order_by;\n\t\t\t\t\tthis.sort_order = 'asc';\n\t\t\t\t} else {\n\t\t\t\t\tthis.sort_by = this.view_user_settings.sort_by || this.calendar_settings.field_map.start;\n\t\t\t\t\tthis.sort_order = this.view_user_settings.sort_order || 'asc';\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.prepare_tasks();\n\t}\n\n\tprepare_tasks() {\n\t\tvar me = this;\n\t\tvar meta = this.meta;\n\t\tvar field_map = this.calendar_settings.field_map;\n\n\t\tthis.tasks = this.data.map(function (item) {\n\t\t\t// set progress\n\t\t\tvar progress = 0;\n\t\t\tif (field_map.progress && $.isFunction(field_map.progress)) {\n\t\t\t\tprogress = field_map.progress(item);\n\t\t\t} else if (field_map.progress) {\n\t\t\t\tprogress = item[field_map.progress];\n\t\t\t}\n\n\t\t\t// title\n\t\t\tvar label;\n\t\t\tif (meta.title_field) {\n\t\t\t\tlabel = $.format(\"{0} ({1})\", [item[meta.title_field], item.name]);\n\t\t\t} else {\n\t\t\t\tlabel = item[field_map.title];\n\t\t\t}\n\n\t\t\tvar r = {\n\t\t\t\tstart: item[field_map.start],\n\t\t\t\tend: item[field_map.end],\n\t\t\t\tname: label,\n\t\t\t\tid: item[field_map.id || 'name'],\n\t\t\t\tdoctype: me.doctype,\n\t\t\t\tprogress: progress,\n\t\t\t\tdependencies: item.depends_on_tasks || \"\"\n\t\t\t};\n\n\t\t\tif (item.color && frappe.ui.color.validate_hex(item.color)) {\n\t\t\t\tr['custom_class'] = 'color-' + item.color.substr(1);\n\t\t\t}\n\n\t\t\tif (item.is_milestone) {\n\t\t\t\tr['custom_class'] = 'bar-milestone';\n\t\t\t}\n\n\t\t\treturn r;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.load_lib.then(() => {\n\t\t\tthis.render_gantt();\n\t\t});\n\t}\n\n\trender_header() {\n\n\t}\n\n\trender_gantt() {\n\t\tconst me = this;\n\t\tconst gantt_view_mode = this.view_user_settings.gantt_view_mode || 'Day';\n\t\tconst field_map = this.calendar_settings.field_map;\n\t\tconst date_format = 'YYYY-MM-DD';\n\n\t\tthis.$result.empty();\n\n\t\tthis.gantt = new Gantt(this.$result[0], this.tasks, {\n\t\t\tview_mode: gantt_view_mode,\n\t\t\tdate_format: \"YYYY-MM-DD\",\n\t\t\ton_click: task => {\n\t\t\t\tfrappe.set_route('Form', task.doctype, task.id);\n\t\t\t},\n\t\t\ton_date_change: (task, start, end) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t[field_map.start]: moment(start).format(date_format),\n\t\t\t\t\t[field_map.end]: moment(end).format(date_format)\n\t\t\t\t});\n\t\t\t},\n\t\t\ton_progress_change: (task, progress) => {\n\t\t\t\tif (!me.can_write) return;\n\t\t\t\tvar progress_fieldname = 'progress';\n\n\t\t\t\tif ($.isFunction(field_map.progress)) {\n\t\t\t\t\tprogress_fieldname = null;\n\t\t\t\t} else if (field_map.progress) {\n\t\t\t\t\tprogress_fieldname = field_map.progress;\n\t\t\t\t}\n\n\t\t\t\tif (progress_fieldname) {\n\t\t\t\t\tfrappe.db.set_value(task.doctype, task.id, {\n\t\t\t\t\t\t[progress_fieldname]: parseInt(progress)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ton_view_change: mode => {\n\t\t\t\t// save view mode\n\t\t\t\tme.save_view_user_settings({\n\t\t\t\t\tgantt_view_mode: mode\n\t\t\t\t});\n\t\t\t},\n\t\t\tcustom_popup_html: task => {\n\t\t\t\tvar item = me.get_item(task.id);\n\n\t\t\t\tvar html =\n\t\t\t\t\t`<div class=\"title\">${task.name}</div>\n\t\t\t\t\t<div class=\"subtitle\">${moment(task._start).format('MMM D')} - ${moment(task._end).format('MMM D')}</div>`;\n\n\t\t\t\t// custom html in doctype settings\n\t\t\t\tvar custom = me.settings.gantt_custom_popup_html;\n\t\t\t\tif (custom && $.isFunction(custom)) {\n\t\t\t\t\tvar ganttobj = task;\n\t\t\t\t\thtml = custom(ganttobj, item);\n\t\t\t\t}\n\t\t\t\treturn '<div class=\"details-container\">' + html + '</div>';\n\t\t\t}\n\t\t});\n\t\tthis.setup_view_mode_buttons();\n\t\tthis.set_colors();\n\t}\n\n\tsetup_view_mode_buttons() {\n\t\t// view modes (for translation) __(\"Day\"), __(\"Week\"), __(\"Month\"),\n\t\t//__(\"Half Day\"), __(\"Quarter Day\")\n\n\t\tlet $btn_group = this.$paging_area.find('.gantt-view-mode');\n\t\tif ($btn_group.length > 0) return;\n\n\t\tconst view_modes = this.gantt.options.view_modes || [];\n\t\tconst active_class = view_mode => this.gantt.view_is(view_mode) ? 'btn-info' : '';\n\t\tconst html =\n\t\t\t`<div class=\"btn-group gantt-view-mode\">\n\t\t\t\t${view_modes.map(value => `<button type=\"button\"\n\t\t\t\t\t\tclass=\"btn btn-default btn-sm btn-view-mode ${active_class(value)}\"\n\t\t\t\t\t\tdata-value=\"${value}\">\n\t\t\t\t\t\t${__(value)}\n\t\t\t\t\t</button>`).join('')}\n\t\t\t</div>`;\n\n\t\tthis.$paging_area.find('.level-left').append(html);\n\n\t\t// change view mode asynchronously\n\t\tconst change_view_mode = (value) => setTimeout(() => this.gantt.change_view_mode(value), 0);\n\n\t\tthis.$paging_area.on('click', '.btn-view-mode', e => {\n\t\t\tconst $btn = $(e.currentTarget);\n\t\t\tthis.$paging_area.find('.btn-view-mode').removeClass('btn-info');\n\t\t\t$btn.addClass('btn-info');\n\n\t\t\tconst value = $btn.data().value;\n\t\t\tchange_view_mode(value);\n\t\t});\n\t}\n\n\tset_colors() {\n\t\tconst classes = this.tasks\n\t\t\t.map(t => t.custom_class)\n\t\t\t.filter(c => c && c.startsWith('color-'));\n\n\t\tlet style = classes.map(c => {\n\t\t\tconst class_name = c.replace('#', '');\n\t\t\tconst bar_color = '#' + c.substr(6);\n\t\t\tconst progress_color = frappe.ui.color.get_contrast_color(bar_color);\n\t\t\treturn `\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar {\n\t\t\t\t\tfill: ${bar_color};\n\t\t\t\t}\n\t\t\t\t.gantt .bar-wrapper.${class_name} .bar-progress {\n\t\t\t\t\tfill: ${progress_color};\n\t\t\t\t}\n\t\t\t`;\n\t\t}).join(\"\");\n\n\t\tstyle = `<style>${style}</style>`;\n\t\tthis.$result.prepend(style);\n\t}\n\n\tget_item(name) {\n\t\treturn this.data.find(item => item.name === name);\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t\"assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.css\",\n\t\t\t\"assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.min.js\"\n\t\t];\n\t}\n};\n\n","// Copyright (c) 2018, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.views.calendar\");\nfrappe.provide(\"frappe.views.calendars\");\n\nfrappe.views.CalendarView = class CalendarView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Calendar'] || {};\n\t\t\troute.push(user_settings.last_calendar || 'Default');\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\ttoggle_result_area() {}\n\n\tget view_name() {\n\t\treturn 'Calendar';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = __('{0} Calendar', [this.page_title]);\n\t\t\t\tthis.calendar_settings = frappe.views.calendar[this.doctype] || {};\n\t\t\t\tthis.calendar_name = frappe.get_route()[3];\n\t\t\t});\n\t}\n\n\tsetup_view() {\n\n\t}\n\n\tbefore_render() {\n\t\tsuper.before_render();\n\t\tthis.save_view_user_settings({\n\t\t\tlast_calendar: this.calendar_name\n\t\t});\n\t}\n\n\trender() {\n\t\tif (this.calendar) {\n\t\t\tthis.calendar.refresh();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.load_lib\n\t\t\t.then(() => this.get_calendar_preferences())\n\t\t\t.then(options => {\n\t\t\t\tthis.calendar = new frappe.views.Calendar(options);\n\t\t\t});\n\t}\n\n\tget_calendar_preferences() {\n\t\tconst options = {\n\t\t\tdoctype: this.doctype,\n\t\t\tparent: this.$result,\n\t\t\tpage: this.page,\n\t\t\tlist_view: this\n\t\t};\n\t\tconst calendar_name = this.calendar_name;\n\n\t\treturn new Promise(resolve => {\n\t\t\tif (calendar_name === 'Default') {\n\t\t\t\tObject.assign(options, frappe.views.calendar[this.doctype]);\n\t\t\t\tresolve(options);\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doc('Calendar View', calendar_name, () => {\n\t\t\t\t\tconst doc = frappe.get_doc('Calendar View', calendar_name);\n\t\t\t\t\tObject.assign(options, {\n\t\t\t\t\t\tfield_map: {\n\t\t\t\t\t\t\tid: \"name\",\n\t\t\t\t\t\t\tstart: doc.start_date_field,\n\t\t\t\t\t\t\tend: doc.end_date_field,\n\t\t\t\t\t\t\ttitle: doc.subject_field,\n\t\t\t\t\t\t\tallDay: doc.all_day ? 1 : 0\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve(options);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fullcalendar/fullcalendar.min.css',\n\t\t\t'assets/frappe/js/lib/fullcalendar/fullcalendar.min.js',\n\t\t\t'assets/frappe/js/lib/fullcalendar/locale-all.js'\n\t\t];\n\t}\n};\n\nfrappe.views.Calendar = Class.extend({\n\tinit: function(options) {\n\t\t$.extend(this, options);\n\t\tthis.get_default_options();\n\t},\n\tget_default_options: function() {\n\t\treturn new Promise ((resolve) => {\n\t\t\tlet defaultView = localStorage.getItem('cal_defaultView');\n\t\t\tlet weekends = localStorage.getItem('cal_weekends');\n\t\t\tlet defaults = {\n\t\t\t\t'defaultView': defaultView ? defaultView : \"month\",\n\t\t\t\t'weekends': weekends ? weekends : true\n\t\t\t};\n\t\t\tresolve(defaults);\n\t\t}).then(defaults => {\n\t\t\tthis.make_page();\n\t\t\tthis.setup_options(defaults);\n\t\t\tthis.make();\n\t\t\tthis.setup_view_mode_button(defaults);\n\t\t\tthis.bind();\n\t\t});\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\n\t\t// add links to other calendars\n\t\tme.page.clear_user_actions();\n\t\t$.each(frappe.boot.calendars, function(i, doctype) {\n\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\tme.page.add_menu_item(__(doctype), function() {\n\t\t\t\t\tfrappe.set_route(\"List\", doctype, \"Calendar\");\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$(this.parent).on(\"show\", function() {\n\t\t\tme.$cal.fullCalendar(\"refetchEvents\");\n\t\t});\n\t},\n\n\tmake: function() {\n\t\tthis.$wrapper = this.parent;\n\t\tthis.$cal = $(\"<div>\").appendTo(this.$wrapper);\n\t\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.$wrapper,\n\t\t\t__(\"Select or drag across time slots to create a new event.\"));\n\t\tthis.footnote_area.css({\"border-top\": \"0px\"});\n\n\t\tthis.$cal.fullCalendar(this.cal_options);\n\t\tthis.set_css();\n\t},\n\tsetup_view_mode_button: function(defaults) {\n\t\tvar me = this;\n\t\t$(me.footnote_area).find('.btn-weekend').detach();\n\t\tlet btnTitle = (defaults.weekends) ? __('Hide Weekends') : __('Show Weekends');\n\t\tconst btn = `<button class=\"btn btn-default btn-xs btn-weekend\">${btnTitle}</button>`;\n\t\tme.footnote_area.append(btn);\n\t},\n\tset_localStorage_option: function(option, value) {\n\t\tlocalStorage.removeItem(option);\n\t\tlocalStorage.setItem(option, value);\n\t},\n\tbind: function() {\n\t\tconst me = this;\n\t\tlet btn_group = me.$wrapper.find(\".fc-button-group\");\n\t\tbtn_group.on(\"click\", \".btn\", function() {\n\t\t\tlet value = ($(this).hasClass('fc-agendaWeek-button')) ? 'agendaWeek' : (($(this).hasClass('fc-agendaDay-button')) ? 'agendaDay' : 'month');\n\t\t\tme.set_localStorage_option(\"cal_defaultView\", value);\n\t\t});\n\n\t\tme.$wrapper.on(\"click\", \".btn-weekend\", function() {\n\t\t\tme.cal_options.weekends = !me.cal_options.weekends;\n\t\t\tme.$cal.fullCalendar('option', 'weekends', me.cal_options.weekends);\n\t\t\tme.set_localStorage_option(\"cal_weekends\", me.cal_options.weekends);\n\t\t\tme.set_css();\n\t\t\tme.setup_view_mode_button(me.cal_options);\n\t\t});\n\t},\n\tset_css: function() {\n\t\t// flatify buttons\n\t\tthis.$wrapper.find(\"button.fc-state-default\")\n\t\t\t.removeClass(\"fc-state-default\")\n\t\t\t.addClass(\"btn btn-default\");\n\n\t\tthis.$wrapper.find(\".fc-button-group\").addClass(\"btn-group\");\n\n\t\tthis.$wrapper.find('.fc-prev-button span')\n\t\t\t.attr('class', '').addClass('fa fa-chevron-left');\n\t\tthis.$wrapper.find('.fc-next-button span')\n\t\t\t.attr('class', '').addClass('fa fa-chevron-right');\n\n\t\tvar btn_group = this.$wrapper.find(\".fc-button-group\");\n\t\tbtn_group.find(\".fc-state-active\").addClass(\"active\");\n\n\t\tbtn_group.find(\".btn\").on(\"click\", function() {\n\t\t\tbtn_group.find(\".btn\").removeClass(\"active\");\n\t\t\t$(this).addClass(\"active\");\n\t\t});\n\t},\n\tfield_map: {\n\t\t\"id\": \"name\",\n\t\t\"start\": \"start\",\n\t\t\"end\": \"end\",\n\t\t\"allDay\": \"all_day\",\n\t},\n\tcolor_map: {\n\t\t\"danger\": \"red\",\n\t\t\"success\": \"green\",\n\t\t\"warning\": \"orange\",\n\t\t\"default\": \"blue\"\n\t},\n\tget_system_datetime: function(date) {\n\t\tdate._offset = (moment(date).tz(frappe.sys_defaults.time_zone)._offset);\n\t\treturn frappe.datetime.convert_to_system_tz(date);\n\t},\n\tsetup_options: function(defaults) {\n\t\tvar me = this;\n\t\tthis.cal_options = {\n\t\t\tlocale: frappe.boot.user.language || \"en\",\n\t\t\theader: {\n\t\t\t\tleft: 'title',\n\t\t\t\tcenter: '',\n\t\t\t\tright: 'prev,today,next month,agendaWeek,agendaDay'\n\t\t\t},\n\t\t\teditable: true,\n\t\t\tselectable: true,\n\t\t\tselectHelper: true,\n\t\t\tforceEventDuration: true,\n\t\t\tdefaultView: defaults.defaultView,\n\t\t\tweekends: defaults.weekends,\n\t\t\tnowIndicator: true,\n\t\t\tevents: function(start, end, timezone, callback) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: me.get_events_method || \"frappe.desk.calendar.get_events\",\n\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\targs: me.get_args(start, end),\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tvar events = r.message || [];\n\t\t\t\t\t\tevents = me.prepare_events(events);\n\t\t\t\t\t\tcallback(events);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\teventRender: function(event, element) {\n\t\t\t\telement.attr('title', event.tooltip);\n\t\t\t},\n\t\t\teventClick: function(event) {\n\t\t\t\t// edit event description or delete\n\t\t\t\tvar doctype = event.doctype || me.doctype;\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\tfrappe.set_route(\"Form\", doctype, event.name);\n\t\t\t\t}\n\t\t\t},\n\t\t\teventDrop: function(event, delta, revertFunc) {\n\t\t\t\tme.update_event(event, revertFunc);\n\t\t\t},\n\t\t\teventResize: function(event, delta, revertFunc) {\n\t\t\t\tme.update_event(event, revertFunc);\n\t\t\t},\n\t\t\tselect: function(startDate, endDate, jsEvent, view) {\n\t\t\t\tif (view.name===\"month\" && (endDate - startDate)===86400000) {\n\t\t\t\t\t// detect single day click in month view\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar event = frappe.model.get_new_doc(me.doctype);\n\n\t\t\t\tevent[me.field_map.start] = me.get_system_datetime(startDate);\n\n\t\t\t\tif(me.field_map.end)\n\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(endDate);\n\n\t\t\t\tif(me.field_map.allDay) {\n\t\t\t\t\tvar all_day = (startDate._ambigTime && endDate._ambigTime) ? 1 : 0;\n\n\t\t\t\t\tevent[me.field_map.allDay] = all_day;\n\n\t\t\t\t\tif (all_day)\n\t\t\t\t\t\tevent[me.field_map.end] = me.get_system_datetime(moment(endDate).subtract(1, \"s\"));\n\t\t\t\t}\n\n\t\t\t\tfrappe.set_route(\"Form\", me.doctype, event.name);\n\t\t\t},\n\t\t\tdayClick: function(date, jsEvent, view) {\n\t\t\t\tif(view.name === 'month') {\n\t\t\t\t\tconst $date_cell = $('td[data-date=' + date.format('YYYY-MM-DD') + \"]\");\n\n\t\t\t\t\tif($date_cell.hasClass('date-clicked')) {\n\t\t\t\t\t\tme.$cal.fullCalendar('changeView', 'agendaDay');\n\t\t\t\t\t\tme.$cal.fullCalendar('gotoDate', date);\n\t\t\t\t\t\tme.$wrapper.find('.date-clicked').removeClass('date-clicked');\n\n\t\t\t\t\t\t// update \"active view\" btn\n\t\t\t\t\t\tme.$wrapper.find('.fc-month-button').removeClass('active');\n\t\t\t\t\t\tme.$wrapper.find('.fc-agendaDay-button').addClass('active');\n\t\t\t\t\t}\n\n\t\t\t\t\tme.$wrapper.find('.date-clicked').removeClass('date-clicked');\n\t\t\t\t\t$date_cell.addClass('date-clicked');\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tif(this.options) {\n\t\t\t$.extend(this.cal_options, this.options);\n\t\t}\n\t},\n\tget_args: function(start, end) {\n\t\tvar args = {\n\t\t\tdoctype: this.doctype,\n\t\t\tstart: this.get_system_datetime(start),\n\t\t\tend: this.get_system_datetime(end),\n\t\t\tfields: this.fields,\n\t\t\tfilters: this.list_view.filter_area.get(),\n\t\t\tfield_map: this.field_map\n\t\t};\n\t\treturn args;\n\t},\n\trefresh: function() {\n\t\tthis.$cal.fullCalendar('refetchEvents');\n\t},\n\tprepare_events: function(events) {\n\t\tvar me = this;\n\n\t\treturn (events || []).map(d => {\n\t\t\td.id = d.name;\n\t\t\td.editable = frappe.model.can_write(d.doctype || me.doctype);\n\n\t\t\t// do not allow submitted/cancelled events to be moved / extended\n\t\t\tif(d.docstatus && d.docstatus > 0) {\n\t\t\t\td.editable = false;\n\t\t\t}\n\n\t\t\t$.each(me.field_map, function(target, source) {\n\t\t\t\td[target] = d[source];\n\t\t\t});\n\n\t\t\tif(!me.field_map.allDay)\n\t\t\t\td.allDay = 1;\n\n\t\t\t// convert to user tz\n\t\t\td.start = frappe.datetime.convert_to_user_tz(d.start);\n\t\t\td.end = frappe.datetime.convert_to_user_tz(d.end);\n\n\t\t\t// show event on single day if start or end date is invalid\n\t\t\tif (!frappe.datetime.validate(d.start) && d.end) {\n\t\t\t\td.start = frappe.datetime.add_days(d.end, -1);\n\t\t\t}\n\n\t\t\tif (d.start && !frappe.datetime.validate(d.end)) {\n\t\t\t\td.end = frappe.datetime.add_days(d.start, 1);\n\t\t\t}\n\n\t\t\tme.fix_end_date_for_event_render(d);\n\t\t\tme.prepare_colors(d);\n\n\t\t\td.title = frappe.utils.html2text(d.title);\n\t\t\t\n\t\t\treturn d;\n\t\t});\n\t},\n\tprepare_colors: function(d) {\n\t\tlet color, color_name;\n\t\tif(this.get_css_class) {\n\t\t\tcolor_name = this.color_map[this.get_css_class(d)] || 'blue';\n\n\t\t\tif (color_name.startsWith(\"#\")) {\n\t\t\t\tcolor_name = frappe.ui.color.validate_hex(color_name) ?\n\t\t\t\t\tcolor_name : 'blue';\n\t\t\t}\n\n\t\t\td.backgroundColor = frappe.ui.color.get(color_name, 'extra-light');\n\t\t\td.textColor = frappe.ui.color.get(color_name, 'dark');\n\t\t} else {\n\t\t\tcolor = d.color;\n\t\t\tif (!frappe.ui.color.validate_hex(color) || !color) {\n\t\t\t\tcolor = frappe.ui.color.get('blue', 'extra-light');\n\t\t\t}\n\t\t\td.backgroundColor = color;\n\t\t\td.textColor = frappe.ui.color.get_contrast_color(color);\n\t\t}\n\t\treturn d;\n\t},\n\tupdate_event: function(event, revertFunc) {\n\t\tvar me = this;\n\t\tfrappe.model.remove_from_locals(me.doctype, event.name);\n\t\treturn frappe.call({\n\t\t\tmethod: me.update_event_method || \"frappe.desk.calendar.update_event\",\n\t\t\targs: me.get_update_args(event),\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tfrappe.show_alert(__(\"Unable to update event\"));\n\t\t\t\t\trevertFunc();\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function() {\n\t\t\t\trevertFunc();\n\t\t\t}\n\t\t});\n\t},\n\tget_update_args: function(event) {\n\t\tvar me = this;\n\t\tvar args = {\n\t\t\tname: event[this.field_map.id]\n\t\t};\n\n\t\targs[this.field_map.start] = me.get_system_datetime(event.start);\n\n\t\tif(this.field_map.allDay)\n\t\t\targs[this.field_map.allDay] = (event.start._ambigTime && event.end._ambigTime) ? 1 : 0;\n\n\t\tif(this.field_map.end) {\n\t\t\tif (!event.end) {\n\t\t\t\tevent.end = event.start.add(1, \"hour\");\n\t\t\t}\n\n\t\t\targs[this.field_map.end] = me.get_system_datetime(event.end);\n\n\t\t\tif (args[this.field_map.allDay]) {\n\t\t\t\targs[this.field_map.end] = me.get_system_datetime(moment(event.end).subtract(1, \"s\"));\n\t\t\t}\n\t\t}\n\n\t\targs.doctype = event.doctype || this.doctype;\n\n\t\treturn { args: args, field_map: this.field_map };\n\t},\n\n\tfix_end_date_for_event_render: function(event) {\n\t\tif (event.allDay) {\n\t\t\t// We use inclusive end dates. This workaround fixes the rendering of events\n\t\t\tevent.start = event.start ? $.fullCalendar.moment(event.start).stripTime() : null;\n\t\t\tevent.end = event.end ? $.fullCalendar.moment(event.end).add(1, \"day\").stripTime() : null;\n\t\t}\n\t}\n});\n","frappe.provide('frappe.views');\n\nfrappe.views.DashboardView = class DashboardView extends frappe.views.ListView {\n\tget view_name() {\n\t\treturn 'Dashboard';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.dashboard_settings = frappe.get_user_settings(this.doctype)['dashboard_settings'] || null;\n\t\t\t});\n\t}\n\n\trender() {\n\n\t}\n\n\tsetup_view() {\n\t\tif (this.chart_group || this.number_card_group) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setup_dashboard_page();\n\t\tthis.setup_dashboard_customization();\n\t\tthis.make_dashboard();\n\t\tthis.setup_events();\n\t}\n\n\tsetup_dashboard_customization() {\n\t\tthis.$customize = this.$chart_header.find('.customize-dashboard');\n\t\tthis.$save_or_discard = this.$chart_header.find('.customize-options');\n\t}\n\n\tsetup_dashboard_page() {\n\t\tconst dashboard_name = __('{0} Dashboard', [this.doctype]);\n\t\tconst chart_wrapper_html = `<div class=\"dashboard-view\"></div>`;\n\n\t\tthis.$frappe_list.html(chart_wrapper_html);\n\t\tthis.page.clear_secondary_action();\n\t\tthis.$dashboard_page = this.$page.find('.layout-main-section-wrapper').addClass('dashboard-page');\n\t\tthis.$page.find('.page-form').empty().html(\n\t\t\t`<div class=\"dashboard-header\">\n\t\t\t\t<div class=\"text-muted\">\n\t\t\t\t\t<span class=\"uppercase header-title\"> ${dashboard_name} </span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"text-muted customize-dashboard\" data-action=\"customize\">${__('Customize')}</div>\n\t\t\t\t<div class=\"small text-muted customize-options small-bounce\">\n\t\t\t\t\t<span class=\"reset-customization customize-option\" data-action=\"reset_dashboard_customization\">${__('Reset')}</span>\n\t\t\t\t\t<span> / </span>\n\t\t\t\t\t<span class=\"save-customization customize-option\" data-action=\"save_dashboard_customization\">${__('Save')}</span>\n\t\t\t\t\t<span> / </span>\n\t\t\t\t\t<span class=\"discard-customization customize-option\" data-action=\"discard_dashboard_customization\">${__('Discard')}</span>\n\t\t\t\t</div>\n\t\t\t</div>`);\n\n\t\tthis.$dashboard_wrapper = this.$page.find('.dashboard-view');\n\t\tthis.$chart_header = this.$page.find('.dashboard-header');\n\n\t\tfrappe.utils.bind_actions_with_object(this.$dashboard_page, this);\n\t}\n\n\tmake_dashboard() {\n\t\tif (this.dashboard_settings) {\n\t\t\tthis.charts = this.dashboard_settings.charts;\n\t\t\tthis.number_cards = this.dashboard_settings.number_cards;\n\t\t\tthis.render_dashboard();\n\t\t} else {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.fetch_dashboard_items(\n\t\t\t\t\t'Dashboard Chart',\n\t\t\t\t\t{\n\t\t\t\t\t\tchart_type: ['in', ['Count', 'Sum', 'Group By']],\n\t\t\t\t\t\tdocument_type: this.doctype,\n\t\t\t\t\t\tis_public: 1,\n\t\t\t\t\t},\n\t\t\t\t\t'charts'\n\t\t\t\t),\n\t\t\t\t() => this.fetch_dashboard_items('Number Card',\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument_type: this.doctype,\n\t\t\t\t\t\tis_public: 1,\n\t\t\t\t\t},\n\t\t\t\t\t'number_cards'\n\t\t\t\t),\n\t\t\t\t() => this.render_dashboard()\n\t\t\t]);\n\t\t}\n\t}\n\n\trender_dashboard() {\n\t\tthis.$dashboard_wrapper.empty();\n\n\t\tfrappe.dashboard_utils.get_dashboard_settings().then(settings => {\n\t\t\tthis.dashboard_chart_settings = settings.chart_config ? JSON.parse(settings.chart_config) : {};\n\t\t\tthis.charts.map(chart => {\n\t\t\t\tchart.label = chart.chart_name;\n\t\t\t\tchart.chart_settings = this.dashboard_chart_settings[chart.chart_name] || {};\n\t\t\t});\n\t\t\tthis.render_dashboard_charts();\n\t\t});\n\t\tthis.render_number_cards();\n\n\t\tif (!this.charts.length && !this.number_cards.length) {\n\t\t\tthis.render_empty_state();\n\t\t}\n\t}\n\n\tsetup_events() {\n\t\t$(document.body).on('toggleFullWidth', () => this.render_dashboard());\n\t\t$(document.body).on('toggleListSidebar', () => this.render_dashboard());\n\t}\n\n\tfetch_dashboard_items(doctype, filters, obj_name) {\n\t\treturn frappe.db.get_list(doctype, {\n\t\t\tfilters: filters,\n\t\t\tfields: ['*']\n\t\t}).then(items => {\n\t\t\tthis[obj_name] = items;\n\t\t});\n\t}\n\n\trender_number_cards() {\n\t\tthis.number_card_group = new frappe.widget.WidgetGroup({\n\t\t\tcontainer: this.$dashboard_wrapper,\n\t\t\ttype: \"number_card\",\n\t\t\tcolumns: 3,\n\t\t\toptions: {\n\t\t\t\tallow_sorting: true,\n\t\t\t\tallow_create: true,\n\t\t\t\tallow_delete: true,\n\t\t\t\tallow_hiding: true,\n\t\t\t},\n\t\t\tdefault_values: {doctype: this.doctype},\n\t\t\twidgets: this.number_cards || [],\n\t\t\tin_customize_mode: this.in_customize_mode || false,\n\t\t});\n\n\t\tthis.in_customize_mode && this.number_card_group.customize();\n\t}\n\n\trender_dashboard_charts() {\n\t\tthis.chart_group = new frappe.widget.WidgetGroup({\n\t\t\tcontainer: this.$dashboard_wrapper,\n\t\t\ttype: \"chart\",\n\t\t\tcolumns: 2,\n\t\t\toptions: {\n\t\t\t\tallow_sorting: true,\n\t\t\t\tallow_create: true,\n\t\t\t\tallow_delete: true,\n\t\t\t\tallow_hiding: true,\n\t\t\t\tallow_resize: true,\n\t\t\t},\n\t\t\tcustom_dialog: () => this.show_add_chart_dialog(),\n\t\t\twidgets: this.charts,\n\t\t\tin_customize_mode: this.in_customize_mode || false,\n\t\t});\n\n\t\tthis.in_customize_mode && this.chart_group.customize();\n\t\tthis.chart_group.container.find('.widget-group-head').hide();\n\t}\n\n\trender_empty_state() {\n\t\tconst no_result_message_html =\n\t\t\t`<p>${__(\"You haven't added any Dashboard Charts or Number Cards yet.\")}\n\t\t\t<br>${__(\"Click On Customize to add your first widget\")}</p>`;\n\n\t\tconst customize_button =\n\t\t\t`<p><button class=\"btn btn-primary btn-sm\" data-action=\"customize\">\n\t\t\t\t${__('Customize')}\n\t\t\t</button></p>`;\n\n\t\tconst empty_state_image = '/assets/frappe/images/ui-states/empty.png';\n\n\t\tconst empty_state_html = `<div class=\"msg-box no-border empty-dashboard\">\n\t\t\t<div>\n\t\t\t\t<img src=\"${empty_state_image}\" alt=\"Generic Empty State\" class=\"null-state\">\n\t\t\t</div>\n\t\t\t${no_result_message_html}\n\t\t\t${customize_button}\n\t\t</div>`;\n\n\t\tthis.$dashboard_wrapper.append(empty_state_html);\n\t\tthis.$empty_state = this.$dashboard_wrapper.find('.empty-dashboard');\n\t}\n\n\tcustomize() {\n\t\tif (this.in_customize_mode) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.$empty_state) {\n\t\t\tthis.$empty_state.remove();\n\t\t}\n\n\t\tthis.toggle_customize(true);\n\t\tthis.in_customize_mode = true;\n\t\tthis.chart_group.customize();\n\t\tthis.number_card_group.customize();\n\t}\n\n\tget_widgets_to_save(widget_group) {\n\t\tconst config = widget_group.get_widget_config();\n\t\tlet widgets = [];\n\t\tconfig.order.map(widget_name => {\n\t\t\twidgets.push(config.widgets[widget_name]);\n\t\t});\n\t\treturn this.remove_duplicates(widgets);\n\t}\n\n\tsave_dashboard_customization() {\n\t\tthis.toggle_customize(false);\n\n\t\tconst charts = this.get_widgets_to_save(this.chart_group);\n\t\tconst number_cards = this.get_widgets_to_save(this.number_card_group);\n\n\t\tthis.dashboard_settings = {\n\t\t\tcharts: charts,\n\t\t\tnumber_cards: number_cards,\n\t\t};\n\n\t\tfrappe.model.user_settings.save(this.doctype, 'dashboard_settings', this.dashboard_settings);\n\t\tthis.make_dashboard();\n\t}\n\n\tdiscard_dashboard_customization() {\n\t\tthis.dashboard_settings = frappe.get_user_settings(this.doctype)['dashboard_settings'] || null;\n\t\tthis.toggle_customize(false);\n\t\tthis.render_dashboard();\n\t}\n\n\treset_dashboard_customization() {\n\t\tfrappe.confirm(__(\"Are you sure you want to reset all customizations?\"), () => {\n\t\t\tthis.dashboard_settings = null;\n\t\t\tfrappe.model.user_settings.save(\n\t\t\t\tthis.doctype, 'dashboard_settings', this.dashboard_settings\n\t\t\t).then(() => this.make_dashboard());\n\n\t\t\tthis.toggle_customize(false);\n\t\t});\n\t}\n\n\ttoggle_customize(show) {\n\t\tthis.$customize.toggle(!show);\n\t\tthis.$save_or_discard.toggle(show);\n\t\tthis.in_customize_mode = show;\n\t}\n\n\tshow_add_chart_dialog() {\n\t\tlet fields = this.get_field_options();\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(`Add a ${this.doctype} Chart`),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'new_or_existing',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tlabel: 'Choose an existing chart or create a new chart',\n\t\t\t\t\toptions: ['New Chart', 'Existing Chart'],\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Chart',\n\t\t\t\t\tfieldname: 'chart',\n\t\t\t\t\tfieldtype: 'Link',\n\t\t\t\t\tget_query: () => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t'query': 'frappe.desk.doctype.dashboard_chart.dashboard_chart.get_charts_for_user',\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\tdocument_type: this.doctype,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\toptions: 'Dashboard Chart',\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"Existing Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'sb_2',\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"New Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Chart Label',\n\t\t\t\t\tfieldname: 'label',\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tmandatory_depends_on: 'eval: doc.new_or_existing == \"New Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'cb_1',\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Chart Type',\n\t\t\t\t\tfieldname: 'chart_type',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\toptions: ['Time Series', 'Group By'],\n\t\t\t\t\tmandatory_depends_on: 'eval: doc.new_or_existing == \"New Chart\"',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'sb_2',\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tlabel: 'Chart Config',\n\t\t\t\t\tdepends_on: 'eval: doc.chart_type == \"Time Series\" && doc.new_or_existing == \"New Chart\"',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Function',\n\t\t\t\t\tfieldname: 'chart_function',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\toptions: ['Count', 'Sum', 'Average'],\n\t\t\t\t\tdefault: 'Count',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Timespan',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'timespan',\n\t\t\t\t\tdepends_on: 'eval: doc.chart_type == \"Time Series\"',\n\t\t\t\t\toptions: ['Last Year', 'Last Quarter', 'Last Month', 'Last Week'],\n\t\t\t\t\tdefault: 'Last Year',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'cb_2',\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Value Based On',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'based_on',\n\t\t\t\t\toptions: fields.value_fields,\n\t\t\t\t\tdepends_on: 'eval: doc.chart_function==\"Sum\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Time Series Based On',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'based_on',\n\t\t\t\t\toptions: fields.date_fields,\n\t\t\t\t\tmandatory_depends_on: 'eval: doc.chart_type == \"Time Series\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Time Interval',\n\t\t\t\t\tfieldname: 'time_interval',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tdepends_on: 'eval: doc.chart_type == \"Time Series\"',\n\t\t\t\t\toptions: ['Yearly', 'Quarterly', 'Monthly', 'Weekly', 'Daily'],\n\t\t\t\t\tdefault: 'Monthly'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'sb_2',\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tlabel: 'Chart Config',\n\t\t\t\t\tdepends_on: 'eval: doc.chart_type == \"Group By\" && doc.new_or_existing == \"New Chart\"',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Group By Type',\n\t\t\t\t\tfieldname: 'group_by_type',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\toptions: ['Count', 'Sum', 'Average'],\n\t\t\t\t\tdefault: 'Count',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Aggregate Function Based On',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'aggregate_function_based_on',\n\t\t\t\t\toptions: fields.aggregate_function_fields,\n\t\t\t\t\tdepends_on: 'eval: [\"Sum\", \"Avergage\"].includes(doc.group_by_type)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'cb_2',\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Group By Based On',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\tfieldname: 'group_by_based_on',\n\t\t\t\t\toptions: fields.group_by_fields,\n\t\t\t\t\tdefault: 'Last Year',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Number of Groups',\n\t\t\t\t\tfieldtype: 'Int',\n\t\t\t\t\tfieldname: 'number_of_groups',\n\t\t\t\t\tdefault: 0,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'sb_3',\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"New Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Chart Type',\n\t\t\t\t\tfieldname: 'type',\n\t\t\t\t\tfieldtype: 'Select',\n\t\t\t\t\toptions: ['Line', 'Bar', 'Percentage', 'Pie'],\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"New Chart\"'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'cb_1',\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Chart Color',\n\t\t\t\t\tfieldname: 'color',\n\t\t\t\t\tfieldtype: 'Color',\n\t\t\t\t\tdepends_on: 'eval: doc.new_or_existing == \"New Chart\"',\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __('Add'),\n\t\t\tprimary_action: (values) => {\n\t\t\t\tlet chart = values;\n\t\t\t\tif (chart.new_or_existing == 'New Chart') {\n\t\t\t\t\tchart.chart_name = chart.label;\n\t\t\t\t\tchart.chart_type = chart.chart_type == 'Time Series' ? chart.chart_function : chart.chart_type;\n\t\t\t\t\tchart.document_type = this.doctype;\n\t\t\t\t\tchart.filters_json = '[]';\n\t\t\t\t\tfrappe.xcall('frappe.desk.doctype.dashboard_chart.dashboard_chart.create_dashboard_chart', {'args': chart}).then((doc)=> {\n\t\t\t\t\t\tthis.chart_group.new_widget.on_create({'chart_name': doc.chart_name, 'name': doc.chart_name, 'label': chart.label});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.chart_group.new_widget.on_create({'chart_name': chart.chart, 'label': chart.chart, 'name': chart.chart});\n\t\t\t\t}\n\t\t\t\tdialog.hide();\n\t\t\t}\n\t\t});\n\t\tdialog.show();\n\t}\n\n\tget_field_options() {\n\t\tlet date_fields = [\n\t\t\t{label: __('Created On'), value: 'creation'},\n\t\t\t{label: __('Last Modified On'), value: 'modified'}\n\t\t];\n\t\tlet value_fields = [];\n\t\tlet group_by_fields = [];\n\t\tlet aggregate_function_fields = [];\n\n\t\tfrappe.get_meta(this.doctype).fields.map(df => {\n\t\t\tif (['Date', 'Datetime'].includes(df.fieldtype)) {\n\t\t\t\tdate_fields.push({label: df.label, value: df.fieldname});\n\t\t\t}\n\t\t\tif (frappe.model.numeric_fieldtypes.includes(df.fieldtype)) {\n\t\t\t\tif (df.fieldtype == 'Currency') {\n\t\t\t\t\tif (!df.options || df.options !== 'Company:company:default_currency') {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvalue_fields.push({label: df.label, value: df.fieldname});\n\t\t\t\taggregate_function_fields.push({label: df.label, value: df.fieldname});\n\t\t\t}\n\t\t\tif (['Link', 'Select'].includes(df.fieldtype)) {\n\t\t\t\tgroup_by_fields.push({label: df.label, value: df.fieldname});\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tdate_fields: date_fields,\n\t\t\tvalue_fields: value_fields,\n\t\t\tgroup_by_fields: group_by_fields,\n\t\t\taggregate_function_fields: aggregate_function_fields\n\t\t};\n\t}\n\n\tremove_duplicates(items) {\n\t\treturn items.filter((item, index) => items.indexOf(item) === index);\n\t}\n\n};\n","/**\n * frappe.views.ImageView\n */\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.ImageView = class ImageView extends frappe.views.ListView {\n\tget view_name() {\n\t\treturn 'Image';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.page_title = this.page_title + ' ' + __('Images');\n\t\t\t})\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_columns();\n\t\tthis.setup_check_events();\n\t}\n\n\tset_fields() {\n\t\tthis.fields = [\n\t\t\t'name',\n\t\t\t...this.get_fields_in_list_view().map((el)=> el.fieldname),\n\t\t\tthis.meta.title_field,\n\t\t\tthis.meta.image_field\n\t\t];\n\t}\n\n\tprepare_data(data) {\n\t\tsuper.prepare_data(data);\n\t\tthis.items = this.data.map(d => {\n\t\t\t// absolute url if cordova, else relative\n\t\t\td._image_url = this.get_image_url(d);\n\t\t\treturn d;\n\t\t});\n\t}\n\n\trender() {\n\t\tthis.get_attached_images()\n\t\t\t.then(() => {\n\t\t\t\tthis.render_image_view();\n\n\t\t\t\tif (!this.gallery) {\n\t\t\t\t\tthis.setup_gallery();\n\t\t\t\t} else {\n\t\t\t\t\tthis.gallery.prepare_pswp_items(this.items, this.images_map);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\trender_image_view() {\n\t\tvar html = this.items.map(this.item_html.bind(this)).join(\"\");\n\n\t\tthis.$result.html(`\n\t\t\t${this.get_header_html()}\n\t\t\t<div class=\"image-view-container small\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`);\n\t}\n\n\titem_details_html(item) {\n\t\tconst info_fields = this.get_fields_in_list_view().map((el)=> el.fieldname)  || [];\n\t\tlet info_html = `<div><ul class=\"list-unstyled image-view-info\">`;\n\t\tinfo_fields.forEach((field, index) => {\n\t\t\tif (item[field]) {\n\t\t\t\tif (index == 0) info_html += `<li>${item[field]}</li>`;\n\t\t\t\telse info_html += `<li class=\"text-muted\">${item[field]}</li>`;\n\t\t\t}\n\t\t})\n\t\tinfo_html += `</ul></div>`;\n\t\treturn info_html;\n\t}\n\n\titem_html(item) {\n\t\titem._name = encodeURI(item.name);\n\t\tconst encoded_name = item._name;\n\t\tconst title = strip_html(item[this.meta.title_field || 'name']);\n\t\tconst _class = !item._image_url ? 'no-image' : '';\n\t\tconst _html = item._image_url ?\n\t\t\t`<img data-name=\"${encoded_name}\" src=\"${ item._image_url }\" alt=\"${ title }\">` :\n\t\t\t`<span class=\"placeholder-text\">\n\t\t\t\t${ frappe.get_abbr(title) }\n\t\t\t</span>`;\n\n\t\tlet details = this.item_details_html(item);\n\n\t\treturn `\n\t\t\t<div class=\"image-view-item\">\n\t\t\t\t<div class=\"image-view-header\">\n\t\t\t\t\t<div class=\"list-row-col list-subject ellipsis level\">\n\t\t\t\t\t\t${this.get_subject_html(item)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"image-view-body\">\n\t\t\t\t\t<a  data-name=\"${encoded_name}\"\n\t\t\t\t\t\ttitle=\"${encoded_name}\"\n\t\t\t\t\t\thref=\"${this.get_form_link(item)}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"image-field ${_class}\"\n\t\t\t\t\t\t\tdata-name=\"${encoded_name}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${_html}\n\t\t\t\t\t\t\t<button class=\"btn btn-default zoom-view\" data-name=\"${encoded_name}\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-search-plus\"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t${details}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_image_url(data) {\n\t\tvar url;\n\t\turl = data.image ? data.image : data[this.meta.image_field];\n\n\t\t// absolute url for mobile\n\t\tif (window.cordova && !frappe.utils.is_url(url)) {\n\t\t\turl = frappe.base_url + url;\n\t\t}\n\t\tif (url) {\n\t\t\treturn url;\n\t\t}\n\t\treturn null;\n\t}\n\n\tget_attached_images() {\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.core.doctype.file.file.get_attached_images',\n\t\t\targs: {\n\t\t\t\tdoctype: this.doctype,\n\t\t\t\tnames: this.items.map(i => i.name)\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tthis.images_map = Object.assign(this.images_map || {}, r.message);\n\t\t});\n\t}\n\n\tget_header_html() {\n\t\treturn this.get_header_html_skeleton(`\n\t\t\t<div class=\"list-row-col list-subject level \">\n\t\t\t\t<input class=\"level-item list-check-all hidden-xs\" type=\"checkbox\" title=\"Select All\">\n\t\t\t\t<span class=\"level-item list-liked-by-me\">\n\t\t\t\t\t<i class=\"octicon octicon-heart text-extra-muted\" title=\"Likes\"></i>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"level-item\"></span>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tsetup_gallery() {\n\t\tvar me = this;\n\t\tthis.gallery = new frappe.views.GalleryView({\n\t\t\tdoctype: this.doctype,\n\t\t\titems: this.items,\n\t\t\twrapper: this.$result,\n\t\t\timages_map: this.images_map\n\t\t});\n\t\tthis.$result.on('click', '.btn.zoom-view', function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tvar name = $(this).data().name;\n\t\t\tname = decodeURIComponent(name);\n\t\t\tme.gallery.show(name);\n\t\t\treturn false;\n\t\t});\n\t}\n};\n\nfrappe.views.GalleryView = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tvar me = this;\n\n\t\tthis.lib_ready = this.load_lib();\n\t\tthis.lib_ready.then(function () {\n\t\t\tme.prepare();\n\t\t});\n\t},\n\tprepare: function () {\n\t\t// keep only one pswp dom element\n\t\tthis.pswp_root = $('body > .pswp');\n\t\tif (this.pswp_root.length === 0) {\n\t\t\tvar pswp = frappe.render_template('photoswipe_dom');\n\t\t\tthis.pswp_root = $(pswp).appendTo('body');\n\t\t}\n\t},\n\tprepare_pswp_items: function (_items, _images_map) {\n\t\tvar me = this;\n\n\t\tif (_items) {\n\t\t\t// passed when more button clicked\n\t\t\tthis.items = this.items.concat(_items);\n\t\t\tthis.images_map = _images_map;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst items = this.items.map(function (i) {\n\t\t\t\tconst query = 'img[data-name=\"' + i._name + '\"]';\n\t\t\t\tlet el = me.wrapper.find(query).get(0);\n\n\t\t\t\tlet width, height;\n\t\t\t\tif (el) {\n\t\t\t\t\twidth = el.naturalWidth;\n\t\t\t\t\theight = el.naturalHeight;\n\t\t\t\t}\n\n\t\t\t\tif (!el) {\n\t\t\t\t\tel = me.wrapper.find('.image-field[data-name=\"' + i._name + '\"]').get(0);\n\t\t\t\t\twidth = el.getBoundingClientRect().width;\n\t\t\t\t\theight = el.getBoundingClientRect().height;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsrc: i._image_url,\n\t\t\t\t\tmsrc: i._image_url,\n\t\t\t\t\tname: i.name,\n\t\t\t\t\tw: width,\n\t\t\t\t\th: height,\n\t\t\t\t\tel: el\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis.pswp_items = items;\n\t\t\tresolve();\n\t\t});\n\t},\n\tshow: function (docname) {\n\t\tthis.lib_ready\n\t\t\t.then(() => this.prepare_pswp_items())\n\t\t\t.then(() => this._show(docname));\n\t},\n\t_show: function (docname) {\n\t\tconst me = this;\n\t\tconst items = this.pswp_items;\n\t\tconst item_index = items.findIndex(item => item.name === docname);\n\n\t\tvar options = {\n\t\t\tindex: item_index,\n\t\t\tgetThumbBoundsFn: function (index) {\n\t\t\t\tconst query = 'img[data-name=\"' + items[index]._name + '\"]';\n\t\t\t\tlet thumbnail = me.wrapper.find(query).get(0);\n\n\t\t\t\tif (!thumbnail) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n\t\t\t\t\trect = thumbnail.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\tx: rect.left,\n\t\t\t\t\ty: rect.top + pageYScroll,\n\t\t\t\t\tw: rect.width\n\t\t\t\t};\n\t\t\t},\n\t\t\thistory: false,\n\t\t\tshareEl: false,\n\t\t\tshowHideOpacity: true\n\t\t};\n\n\t\t// init\n\t\tthis.pswp = new PhotoSwipe(\n\t\t\tthis.pswp_root.get(0),\n\t\t\tPhotoSwipeUI_Default,\n\t\t\titems,\n\t\t\toptions\n\t\t);\n\t\tthis.browse_images();\n\t\tthis.pswp.init();\n\t},\n\tbrowse_images: function () {\n\t\tconst $more_items = this.pswp_root.find('.pswp__more-items');\n\t\tconst images_map = this.images_map;\n\t\tlet last_hide_timeout = null;\n\n\t\tthis.pswp.listen('afterChange', function () {\n\t\t\tconst images = images_map[this.currItem.name];\n\t\t\tif (!images || images.length === 1) {\n\t\t\t\t$more_items.html('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thide_more_items_after_2s();\n\t\t\tconst html = images.map(img_html).join(\"\");\n\t\t\t$more_items.html(html);\n\t\t});\n\n\t\tthis.pswp.listen('beforeChange', hide_more_items);\n\t\tthis.pswp.listen('initialZoomOut', hide_more_items);\n\t\tthis.pswp.listen('destroy', () => {\n\t\t\t$(document).off('mousemove', hide_more_items_after_2s);\n\t\t});\n\n\t\t// Replace current image on click\n\t\t$more_items.on('click', '.pswp__more-item', (e) => {\n\t\t\tconst img_el = e.target;\n\t\t\tconst index = this.pswp.items.findIndex(i => i.name === this.pswp.currItem.name);\n\n\t\t\tthis.pswp.goTo(index);\n\t\t\tthis.pswp.items.splice(index, 1, {\n\t\t\t\tsrc: img_el.src,\n\t\t\t\tw: img_el.naturalWidth,\n\t\t\t\th: img_el.naturalHeight,\n\t\t\t\tname: this.pswp.currItem.name\n\t\t\t});\n\t\t\tthis.pswp.invalidateCurrItems();\n\t\t\tthis.pswp.updateSize(true);\n\t\t});\n\n\t\t// hide more-images 2s after mousemove\n\t\t$(document).on('mousemove', hide_more_items_after_2s);\n\n\t\tfunction hide_more_items_after_2s() {\n\t\t\tclearTimeout(last_hide_timeout);\n\t\t\tshow_more_items();\n\t\t\tlast_hide_timeout = setTimeout(hide_more_items, 2000);\n\t\t}\n\n\t\tfunction show_more_items() {\n\t\t\t$more_items.show();\n\t\t}\n\n\t\tfunction hide_more_items() {\n\t\t\t$more_items.hide();\n\t\t}\n\n\t\tfunction img_html(src) {\n\t\t\treturn `<div class=\"pswp__more-item\">\n\t\t\t\t<img src=\"${src}\">\n\t\t\t</div>`;\n\t\t}\n\t},\n\tload_lib: function () {\n\t\treturn new Promise(resolve => {\n\t\t\tvar asset_dir = 'assets/frappe/js/lib/photoswipe/';\n\t\t\tfrappe.require([\n\t\t\t\tasset_dir + 'photoswipe.css',\n\t\t\t\tasset_dir + 'default-skin.css',\n\t\t\t\tasset_dir + 'photoswipe.js',\n\t\t\t\tasset_dir + 'photoswipe-ui-default.js'\n\t\t\t], resolve);\n\t\t});\n\t}\n});","frappe.provide('frappe.views');\n\nfrappe.views.KanbanView = class KanbanView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (route.length === 3) {\n\t\t\tconst doctype = route[1];\n\t\t\tconst user_settings = frappe.get_user_settings(doctype)['Kanban'] || {};\n\t\t\tif (!user_settings.last_kanban_board) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('Missing parameter Kanban Board Name')\n\t\t\t\t});\n\t\t\t\tfrappe.set_route('List', doctype, 'List');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\troute.push(user_settings.last_kanban_board);\n\t\t\tfrappe.set_route(route);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tget view_name() {\n\t\treturn 'Kanban';\n\t}\n\n\tsetup_defaults() {\n\t\treturn super.setup_defaults()\n\t\t\t.then(() => {\n\t\t\t\tthis.board_name = frappe.get_route()[3];\n\t\t\t\tthis.page_title = this.board_name;\n\t\t\t\tthis.card_meta = this.get_card_meta();\n\n\t\t\t\tthis.menu_items.push({\n\t\t\t\t\tlabel: __('Save filters'),\n\t\t\t\t\taction: () => {\n\t\t\t\t\t\tthis.save_kanban_board_filters();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn this.get_board();\n\t\t\t});\n\t}\n\n\tget_board() {\n\t\treturn frappe.db.get_doc('Kanban Board', this.board_name)\n\t\t\t.then(board => {\n\t\t\t\tthis.board = board;\n\t\t\t\tthis.board.filters_array = JSON.parse(this.board.filters || '[]');\n\t\t\t\tthis.filters = this.board.filters_array;\n\t\t\t});\n\t}\n\n\tbefore_refresh() {\n\n\t}\n\n\tsetup_view() {\n\t\tthis.setup_realtime_updates();\n\t}\n\n\tset_fields() {\n\t\tsuper.set_fields();\n\t\tthis._add_field(this.card_meta.title_field);\n\t}\n\n\tbefore_render() {\n\t\tfrappe.model.user_settings.save(this.doctype, 'last_view', this.view_name);\n\t\tthis.save_view_user_settings({\n\t\t\tlast_kanban_board: this.board_name\n\t\t});\n\t}\n\n\trender_list() {\n\n\t}\n\n\ton_filter_change() {\n\t\tif (JSON.stringify(this.board.filters_array) !== JSON.stringify(this.filter_area.get())) {\n\t\t\tthis.page.set_indicator(__('Not Saved'), 'orange');\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t}\n\n\tsave_kanban_board_filters() {\n\t\tconst filters = this.filter_area.get();\n\n\t\tfrappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.save_filters',\n\t\t\targs: {\n\t\t\t\tboard_name: this.board_name,\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}).then(r => {\n\t\t\tif (r.exc) {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: __('There was an error saving filters')\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: 'green',\n\t\t\t\tmessage: __('Filters saved')\n\t\t\t});\n\n\t\t\tthis.board.filters_array = filters;\n\t\t\tthis.on_filter_change();\n\t\t});\n\t}\n\n\tget_fields() {\n\t\tthis.fields.push([this.board.field_name, this.board.reference_doctype]);\n\t\treturn super.get_fields();\n\t}\n\n\trender() {\n\t\tconst board_name = this.board_name;\n\t\tif (this.kanban && board_name === this.kanban.board_name) {\n\t\t\tthis.kanban.update(this.data);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.kanban = new frappe.views.KanbanBoard({\n\t\t\tdoctype: this.doctype,\n\t\t\tboard: this.board,\n\t\t\tboard_name: board_name,\n\t\t\tcards: this.data,\n\t\t\tcard_meta: this.card_meta,\n\t\t\twrapper: this.$result,\n\t\t\tcur_list: this,\n\t\t\tuser_settings: this.view_user_settings\n\t\t});\n\t}\n\n\tget_card_meta() {\n\t\tvar meta = frappe.get_meta(this.doctype);\n\t\tvar doc = frappe.model.get_new_doc(this.doctype);\n\t\tvar title_field = null;\n\t\tvar quick_entry = false;\n\n\t\tif (this.meta.title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, this.meta.title_field);\n\t\t}\n\n\t\tthis.meta.fields.forEach((df) => {\n\t\t\tconst is_valid_field =\n\t\t\t\tin_list(['Data', 'Text', 'Small Text', 'Text Editor'], df.fieldtype)\n\t\t\t\t&& !df.hidden;\n\n\t\t\tif (is_valid_field && !title_field) {\n\t\t\t\t// can be mapped to textarea\n\t\t\t\ttitle_field = df;\n\t\t\t}\n\t\t});\n\n\t\t// quick entry\n\t\tvar mandatory = meta.fields.filter((df) => df.reqd && !doc[df.fieldname]);\n\n\t\tif (mandatory.some(df => frappe.model.table_fields.includes(df.fieldtype)) || mandatory.length > 1) {\n\t\t\tquick_entry = true;\n\t\t}\n\n\t\tif (!title_field) {\n\t\t\ttitle_field = frappe.meta.get_field(this.doctype, 'name');\n\t\t}\n\n\t\treturn {\n\t\t\tquick_entry: quick_entry,\n\t\t\ttitle_field: title_field\n\t\t};\n\t}\n\n\tget required_libs() {\n\t\treturn [\n\t\t\t'assets/frappe/js/lib/fluxify.min.js',\n\t\t\t'assets/frappe/js/frappe/views/kanban/kanban_board.js'\n\t\t];\n\t}\n};\n\n\nfrappe.views.KanbanView.setup_dropdown_in_sidebar = function(doctype, $dropdown) {\n\t// get kanban boards and append to dropdown\n\tget_kanban_boards()\n\t\t.then((kanban_boards) => {\n\t\t\tif (!kanban_boards) return;\n\n\t\t\t$('<li role=\"separator\" class=\"divider\"></li>').appendTo($dropdown);\n\n\t\t\tkanban_boards.forEach(board => {\n\t\t\t\tconst route = ['List', board.reference_doctype, 'Kanban', board.name].join('/');\n\n\t\t\t\t$(`<li>\n\t\t\t\t\t<a href=\"#${route}\">\n\t\t\t\t\t\t<span>${__(board.name)}</span>\n\t\t\t\t\t${board.private ? '<i class=\"fa fa-lock fa-fw text-warning\"></i>' : ''}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t\t`).appendTo($dropdown);\n\t\t\t});\n\t\t});\n\n\t$dropdown.on('click', '.new-kanban-board', () => {\n\t\tconst dialog = new_kanban_dialog();\n\t\tdialog.show();\n\t});\n\n\tfunction make_kanban_board(board_name, field_name, project) {\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.doctype.kanban_board.kanban_board.quick_kanban_board',\n\t\t\targs: {\n\t\t\t\tdoctype,\n\t\t\t\tboard_name,\n\t\t\t\tfield_name,\n\t\t\t\tproject\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar kb = r.message;\n\t\t\t\tif (kb.filters) {\n\t\t\t\t\tfrappe.provide('frappe.kanban_filters');\n\t\t\t\t\tfrappe.kanban_filters[kb.kanban_board_name] = kb.filters;\n\t\t\t\t}\n\t\t\t\tfrappe.set_route('List', doctype, 'Kanban', kb.kanban_board_name);\n\t\t\t}\n\t\t});\n\t}\n\n\tlet dialog = null;\n\n\tfunction new_kanban_dialog() {\n\t\tif (dialog) return dialog;\n\n\t\tconst fields = get_fields_for_dialog();\n\n\t\tlet primary_action_label = fields.length > 1 ? __('Save') : '';\n\t\tlet primary_action = fields.length > 1 ?\n\t\t\t({ board_name, field_name, project }) => {\n\t\t\t\tmake_kanban_board(board_name, field_name, project)\n\t\t\t\t\t.then(() => dialog.hide(), (err) => frappe.msgprint(err));\n\t\t\t} : null;\n\n\t\tdialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('New Kanban Board'),\n\t\t\tfields,\n\t\t\tprimary_action_label,\n\t\t\tprimary_action\n\t\t});\n\t\treturn dialog;\n\t}\n\n\tfunction get_fields_for_dialog() {\n\n\t\tlet fields = [{\n\t\t\tfieldtype: 'Data',\n\t\t\tfieldname: 'board_name',\n\t\t\tlabel: __('Kanban Board Name'),\n\t\t\treqd: 1,\n\t\t\tdescription: ['Note', 'ToDo'].includes(doctype) ?\n\t\t\t\t__('This Kanban Board will be private') : ''\n\t\t}];\n\n\t\tif (doctype === 'Task') {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\tfieldname: 'project',\n\t\t\t\tlabel: __('Project'),\n\t\t\t\toptions: 'Project'\n\t\t\t});\n\t\t}\n\n\t\tconst select_fields =\n\t\t\tfrappe.get_meta(doctype).fields\n\t\t\t\t.filter(df => {\n\t\t\t\t\treturn df.fieldtype === 'Select' &&\n\t\t\t\t\t\tdf.fieldname !== 'kanban_column';\n\t\t\t\t});\n\n\t\tif (select_fields.length > 0) {\n\t\t\tfields.push({\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\tfieldname: 'field_name',\n\t\t\t\tlabel: __('Columns based on'),\n\t\t\t\toptions: select_fields.map(df => ({label: df.label, value: df.fieldname})),\n\t\t\t\tdefault: select_fields[0],\n\t\t\t\treqd: 1,\n\t\t\t});\n\t\t} else {\n\t\t\tfields = [{\n\t\t\t\tfieldtype: 'HTML',\n\t\t\t\toptions: `\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p class=\"text-medium\">\n\t\t\t\t\t\t${__('No fields found that can be used as a Kanban Column. Use the Customize Form to add a Custom Field of type \"Select\".')}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<a class=\"btn btn-xs btn-default\" href=\"#Form/Customize Form?doc_type=${doctype}\">\n\t\t\t\t\t\t\t${__('Customize Form')}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t}];\n\t\t}\n\n\t\treturn fields;\n\t}\n\n\tfunction get_kanban_boards() {\n\t\treturn frappe.call('frappe.desk.doctype.kanban_board.kanban_board.get_kanban_boards', { doctype })\n\t\t\t.then(r => r.message);\n\t}\n};\n","/**\n * frappe.views.InboxView\n */\n\nfrappe.provide(\"frappe.views\");\n\nfrappe.views.InboxView = class InboxView extends frappe.views.ListView {\n\tstatic load_last_view() {\n\t\tconst route = frappe.get_route();\n\t\tif (!route[3] && frappe.boot.email_accounts.length) {\n\t\t\tlet email_account;\n\t\t\tif (frappe.boot.email_accounts[0].email_id == \"All Accounts\") {\n\t\t\t\temail_account = \"All Accounts\";\n\t\t\t} else {\n\t\t\t\temail_account = frappe.boot.email_accounts[0].email_account;\n\t\t\t}\n\t\t\tfrappe.set_route(\"List\", \"Communication\", \"Inbox\", email_account);\n\t\t\treturn true;\n\t\t} else if (!route[3] || (route[3] !== \"All Accounts\" && !is_valid(route[3]))) {\n\t\t\tfrappe.throw(__('No email account associated with the User. Please add an account under User > Email Inbox.'));\n\t\t}\n\t\treturn false;\n\n\t\tfunction is_valid(email_account) {\n\t\t\treturn frappe.boot.email_accounts.find(d => d.email_account === email_account);\n\t\t}\n\t}\n\n\tget view_name() {\n\t\treturn 'Inbox';\n\t}\n\n\tshow() {\n\t\tsuper.show();\n\t\t// save email account in user_settings\n\t\tthis.save_view_user_settings({\n\t\t\tlast_email_account: this.current_email_account\n\t\t});\n\t}\n\n\tsetup_defaults() {\n\t\tsuper.setup_defaults();\n\n\t\t// initialize with saved order by\n\t\tthis.sort_by = this.view_user_settings.sort_by || 'communication_date';\n\t\tthis.sort_order = this.view_user_settings.sort_order || 'desc';\n\n\t\tthis.email_account = frappe.get_route()[3];\n\t\tthis.page_title = this.email_account;\n\t\tthis.filters = this.get_inbox_filters();\n\t}\n\n\tsetup_columns() {\n\t\t// setup columns for list view\n\t\tthis.columns = [];\n\t\tthis.columns.push({\n\t\t\ttype: 'Subject',\n\t\t\tdf: {\n\t\t\t\tlabel: __('Subject'),\n\t\t\t\tfieldname: 'subject'\n\t\t\t}\n\t\t});\n\t\tthis.columns.push({\n\t\t\ttype: 'Field',\n\t\t\tdf: {\n\t\t\t\tlabel: this.is_sent_emails ? __(\"To\") : __(\"From\"),\n\t\t\t\tfieldname: this.is_sent_emails ? 'recipients' : 'sender'\n\t\t\t}\n\t\t});\n\t}\n\n\tget_seen_class(doc) {\n\t\tconst seen =\n\t\t\tBoolean(doc.seen) || JSON.parse(doc._seen || '[]').includes(frappe.session.user)\n\t\t\t\t? ''\n\t\t\t\t: 'bold';\n\t\treturn seen;\n\t}\n\n\tget is_sent_emails() {\n\t\tconst f = this.filter_area.get()\n\t\t\t.find(filter => filter[1] === 'sent_or_received');\n\t\treturn f && f[3] === 'Sent';\n\t}\n\n\trender_header() {\n\t\tthis.$result.find('.list-row-head').remove();\n\t\tthis.$result.prepend(this.get_header_html());\n\t}\n\n\trender() {\n\t\tthis.setup_columns();\n\t\tthis.render_header();\n\t\tthis.render_list();\n\t\tthis.on_row_checked();\n\t\tthis.render_count();\n\t\tthis.render_tags();\n\t}\n\n\tget_meta_html(email) {\n\t\tconst attachment = email.has_attachment ?\n\t\t\t`<span class=\"fa fa-paperclip fa-large\" title=\"${__('Has Attachments')}\"></span>` : '';\n\n\t\tconst form_link = frappe.utils.get_form_link(email.reference_doctype, email.reference_name);\n\t\tconst link = email.reference_doctype && email.reference_doctype !== this.doctype ?\n\t\t\t`<a class=\"text-muted grey\" href=\"${form_link}\"\n\t\t\t\ttitle=\"${__('Linked with {0}', [email.reference_doctype])}\">\n\t\t\t\t<i class=\"fa fa-link fa-large\"></i>\n\t\t\t</a>` : '';\n\n\t\tconst communication_date = comment_when(email.communication_date, true);\n\t\tconst status =\n\t\t\temail.status == \"Closed\" ? `<span class=\"fa fa-check fa-large\" title=\"${__(email.status)}\"></span>` :\n\t\t\t\temail.status == \"Replied\" ? `<span class=\"fa fa-mail-reply fa-large\" title=\"${__(email.status)}\"></span>` :\n\t\t\t\t\t\"\";\n\n\t\treturn `\n\t\t\t<div class=\"level-item list-row-activity\">\n\t\t\t\t${link}\n\t\t\t\t${attachment}\n\t\t\t\t${status}\n\t\t\t\t${communication_date}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tget_inbox_filters() {\n\t\tvar email_account = this.email_account;\n\t\tvar default_filters = [\n\t\t\t[\"Communication\", \"communication_type\", \"=\", \"Communication\", true],\n\t\t\t[\"Communication\", \"communication_medium\", \"=\", \"Email\", true],\n\t\t];\n\t\tvar filters = [];\n\t\tif (email_account === \"Sent\") {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Sent\", true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t} else if (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"email_status\", \"=\", email_account, true],\n\t\t\t\t[\"Communication\", \"email_account\", \"in\", frappe.boot.all_accounts, true]\n\t\t\t]);\n\t\t} else {\n\t\t\tvar op = \"=\";\n\t\t\tif (email_account == \"All Accounts\") {\n\t\t\t\top = \"in\";\n\t\t\t\temail_account = frappe.boot.all_accounts;\n\t\t\t}\n\n\t\t\tfilters = default_filters.concat([\n\t\t\t\t[\"Communication\", \"sent_or_received\", \"=\", \"Received\", true],\n\t\t\t\t[\"Communication\", \"status\", \"=\", \"Open\", true],\n\t\t\t\t[\"Communication\", \"email_account\", op, email_account, true],\n\t\t\t\t[\"Communication\", \"email_status\", \"not in\", \"Spam,Trash\", true],\n\t\t\t]);\n\t\t}\n\n\t\treturn filters;\n\t}\n\n\tget_no_result_message() {\n\t\tvar email_account = this.email_account;\n\t\tvar args;\n\t\tif (in_list([\"Spam\", \"Trash\"], email_account)) {\n\t\t\treturn __(\"No {0} mail\", [email_account]);\n\t\t} else if (!email_account && !frappe.boot.email_accounts.length) {\n\t\t\t// email account is not configured\n\t\t\targs = {\n\t\t\t\tdoctype: \"Email Account\",\n\t\t\t\tmsg: __(\"No Email Account\"),\n\t\t\t\tlabel: __(\"New Email Account\"),\n\t\t\t};\n\t\t} else {\n\t\t\t// no sent mail\n\t\t\targs = {\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tmsg: __(\"No Emails\"),\n\t\t\t\tlabel: __(\"Compose Email\")\n\t\t\t};\n\t\t}\n\n\t\tconst html = frappe.model.can_create(args.doctype) ?\n\t\t\t`<p>${args.msg}</p>\n\t\t\t<p>\n\t\t\t\t<button class=\"btn btn-primary btn-sm btn-new-doc\">\n\t\t\t\t\t${args.label}\n\t\t\t\t</button>\n\t\t\t</p>\n\t\t\t` :\n\t\t\t`<p>${ __(\"No Email Accounts Assigned\") }</p>`;\n\n\t\treturn `\n\t\t\t<div class=\"msg-box no-border\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tmake_new_doc() {\n\t\tif (!this.email_account && !frappe.boot.email_accounts.length) {\n\t\t\tfrappe.route_options = {\n\t\t\t\t'email_id': frappe.session.user_email\n\t\t\t};\n\t\t\tfrappe.new_doc('Email Account');\n\t\t} else {\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: {}\n\t\t\t});\n\t\t}\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.treeview_settings\");\nfrappe.provide('frappe.views.trees');\nwindow.cur_tree = null;\n\nfrappe.views.TreeFactory = class TreeFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tfrappe.model.with_doctype(route[1], function() {\n\t\t\tvar options = {\n\t\t\t\tdoctype: route[1],\n\t\t\t\tmeta: frappe.get_meta(route[1])\n\t\t\t};\n\n\t\t\tif (!frappe.treeview_settings[route[1]] && !frappe.meta.get_docfield(route[1], \"is_group\")) {\n\t\t\t\tfrappe.msgprint(__(\"Tree view not available for {0}\", [route[1]] ));\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t$.extend(options, frappe.treeview_settings[route[1]] || {});\n\t\t\tfrappe.views.trees[options.doctype] = new frappe.views.TreeView(options);\n\t\t});\n\t}\n}\n\nfrappe.views.TreeView = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\tthis.opts = {};\n\t\tthis.opts.get_tree_root = true;\n\t\tthis.opts.show_expand_all = true;\n\t\t$.extend(this.opts, opts);\n\t\tthis.doctype = opts.doctype;\n\t\tthis.args = {doctype: me.doctype};\n\t\tthis.page_name = frappe.get_route_str();\n\t\tthis.get_tree_nodes =  me.opts.get_tree_nodes || \"frappe.desk.treeview.get_children\";\n\n\t\tthis.get_permissions();\n\t\tthis.make_page();\n\t\tthis.make_filters();\n\n\t\tif (me.opts.get_tree_root) {\n\t\t\tthis.get_root();\n\t\t}\n\n\t\tthis.onload();\n\t\tthis.set_menu_item();\n\t\tthis.set_primary_action();\n\t},\n\tget_permissions: function(){\n\t\tthis.can_read = frappe.model.can_read(this.doctype);\n\t\tthis.can_create = frappe.boot.user.can_create.indexOf(this.doctype) !== -1 ||\n\t\t\t\t\tfrappe.boot.user.in_create.indexOf(this.doctype) !== -1;\n\t\tthis.can_write = frappe.model.can_write(this.doctype);\n\t\tthis.can_delete = frappe.model.can_delete(this.doctype);\n\t},\n\tmake_page: function() {\n\t\tvar me = this;\n\t\tthis.parent = frappe.container.add_page(this.page_name);\n\t\tfrappe.ui.make_app_page({parent:this.parent, single_column:true});\n\n\t\tthis.page = this.parent.page;\n\t\tfrappe.container.change_to(this.page_name);\n\t\tfrappe.breadcrumbs.add(me.opts.breadcrumb || locals.DocType[me.doctype].module, me.doctype);\n\n\t\tthis.set_title();\n\n\t\tthis.page.main.css({\n\t\t\t\"min-height\": \"300px\",\n\t\t\t\"padding-bottom\": \"25px\"\n\t\t});\n\n\t\tif(this.opts.show_expand_all) {\n\t\t\tthis.page.add_inner_button(__('Expand All'), function() {\n\t\t\t\tme.tree.load_children(me.tree.root_node, true);\n\t\t\t});\n\t\t}\n\n\t\tif(this.opts.view_template) {\n\t\t\tvar row = $('<div class=\"row\"><div>').appendTo(this.page.main);\n\t\t\tthis.body = $('<div class=\"col-sm-6 col-xs-12\"></div>').appendTo(row);\n\t\t\tthis.node_view = $('<div class=\"col-sm-6 hidden-xs\"></div>').appendTo(row);\n\t\t} else {\n\t\t\tthis.body = this.page.main;\n\t\t}\n\t},\n\tset_title: function() {\n\t\tthis.page.set_title(this.opts.title || __('{0} Tree', [__(this.doctype)]));\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\t\tthis.opts.onload && this.opts.onload(me);\n\t},\n\tmake_filters: function(){\n\t\tvar me = this;\n\t\tfrappe.treeview_settings.filters = []\n\t\t$.each(this.opts.filters || [], function(i, filter) {\n\t\t\tif(frappe.route_options && frappe.route_options[filter.fieldname]) {\n\t\t\t\tfilter.default = frappe.route_options[filter.fieldname]\n\t\t\t}\n\n\t\t\tif(!filter.disable_onchange) {\n\t\t\t\tfilter.change = function() {\n\t\t\t\t\tfilter.on_change && filter.on_change();\n\t\t\t\t\tvar val = this.get_value();\n\t\t\t\t\tme.args[filter.fieldname] = val;\n\t\t\t\t\tif (val) {\n\t\t\t\t\t\tme.root_label = val;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tme.root_label = me.opts.root_label;\n\t\t\t\t\t}\n\t\t\t\t\tme.set_title();\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tme.page.add_field(filter);\n\n\t\t\tif (filter.default) {\n\t\t\t\t$(\"[data-fieldname='\"+filter.fieldname+\"']\").trigger(\"change\");\n\t\t\t}\n\t\t})\n\t},\n\tget_root: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: me.get_tree_nodes,\n\t\t\targs: me.args,\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tme.root_label = r.message[0][\"value\"];\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tmake_tree: function() {\n\t\t$(this.parent).find(\".tree\").remove();\n\n\t\tthis.tree = new frappe.ui.Tree({\n\t\t\tparent: this.body,\n\t\t\tlabel: this.args[this.opts.root_label] || this.root_label || this.opts.root_label,\n\t\t\texpandable: true,\n\n\t\t\targs: this.args,\n\t\t\tmethod: this.get_tree_nodes,\n\n\t\t\t// array of button props: {label, condition, click, btnClass}\n\t\t\ttoolbar: this.get_toolbar(),\n\n\t\t\tget_label: this.opts.get_label,\n\t\t\ton_render: this.opts.onrender,\n\t\t\ton_click: (node) => { this.select_node(node); },\n\t\t});\n\n\t\tcur_tree = this.tree;\n\t\tthis.post_render();\n\t},\n\n\tpost_render: function() {\n\t\tvar me = this;\n\t\tme.opts.post_render && me.opts.post_render(me);\n\t},\n\n\tselect_node: function(node) {\n\t\tvar me = this;\n\t\tif(this.opts.click) {\n\t\t\tthis.opts.click(node);\n\t\t}\n\t\tif(this.opts.view_template) {\n\t\t\tthis.node_view.empty();\n\t\t\t$(frappe.render_template(me.opts.view_template,\n\t\t\t\t{data:node.data, doctype:me.doctype})).appendTo(this.node_view);\n\t\t}\n\t},\n\tget_toolbar: function() {\n\t\tvar me = this;\n\n\t\tvar toolbar = [\n\t\t\t{\n\t\t\t\tlabel:__(me.can_write? \"Edit\": \"Details\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn !node.is_root && me.can_read;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.set_route(\"Form\", me.doctype, node.label);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Add Child\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\treturn me.can_create && node.expandable && !node.hide_add;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tme.new_node();\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Rename\"),\n\t\t\t\tcondition: function(node) {\n\t\t\t\t\tlet allow_rename = true;\n\t\t\t\t\tif (me.doctype && frappe.get_meta(me.doctype)) {\n\t\t\t\t\t\tif(!frappe.get_meta(me.doctype).allow_rename) allow_rename = false;\n\t\t\t\t\t}\n\t\t\t\t\treturn !node.is_root && me.can_write && allow_rename;\n\t\t\t\t},\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.rename_doc(me.doctype, node.label, function(new_name) {\n\t\t\t\t\t\tnode.$tree_link.find('a').text(new_name);\n\t\t\t\t\t\tnode.label = new_name;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel:__(\"Delete\"),\n\t\t\t\tcondition: function(node) { return !node.is_root && me.can_delete; },\n\t\t\t\tclick: function(node) {\n\t\t\t\t\tfrappe.model.delete_doc(me.doctype, node.label, function() {\n\t\t\t\t\t\tnode.parent.remove();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tbtnClass: \"hidden-xs\"\n\t\t\t}\n\t\t]\n\n\t\tif(this.opts.toolbar && this.opts.extend_toolbar) {\n\t\t\ttoolbar = toolbar.filter(btn => {\n\t\t\t\treturn !me.opts.toolbar.find(d => d[\"label\"]==btn[\"label\"]);\n\t\t\t});\n\t\t\treturn toolbar.concat(this.opts.toolbar)\n\t\t} else if (this.opts.toolbar && !this.opts.extend_toolbar) {\n\t\t\treturn this.opts.toolbar\n\t\t} else {\n\t\t\treturn toolbar\n\t\t}\n\t},\n\tnew_node: function() {\n\t\tvar me = this;\n\t\tvar node = me.tree.get_selected_node();\n\n\t\tif(!(node && node.expandable)) {\n\t\t\tfrappe.msgprint(__(\"Select a group node first.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.prepare_fields();\n\n\t\t// the dialog\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __('New {0}',[__(me.doctype)]),\n\t\t\tfields: me.fields\n\t\t});\n\n\t\tvar args = $.extend({}, me.args);\n\t\targs[\"parent_\"+me.doctype.toLowerCase().replace(/ /g,'_')] = me.args[\"parent\"];\n\n\t\td.set_value(\"is_group\", 0);\n\t\td.set_values(args);\n\n\t\t// create\n\t\td.set_primary_action(__(\"Create New\"), function() {\n\t\t\tvar btn = this;\n\t\t\tvar v = d.get_values();\n\t\t\tif(!v) return;\n\n\t\t\tv.parent = node.label;\n\t\t\tv.doctype = me.doctype;\n\n\t\t\tif(node.is_root){\n\t\t\t\tv['is_root'] = node.is_root;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tv['is_root'] = false;\n\t\t\t}\n\n\t\t\td.hide();\n\t\t\tfrappe.dom.freeze(__('Creating {0}', [me.doctype]));\n\n\t\t\t$.extend(args, v)\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: me.opts.add_tree_node || \"frappe.desk.treeview.add_node\",\n\t\t\t\targs: args,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(node.expanded) {\n\t\t\t\t\t\t\tme.tree.toggle_node(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.tree.load_children(node, true);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\td.show();\n\t},\n\tprepare_fields: function(){\n\t\tvar me = this;\n\n\t\tthis.fields = [\n\t\t\t{fieldtype:'Check', fieldname:'is_group', label:__('Group Node'),\n\t\t\t\tdescription: __(\"Further nodes can be only created under 'Group' type nodes\")}\n\t\t]\n\n\t\tif (this.opts.fields) {\n\t\t\tthis.fields = this.opts.fields;\n\t\t}\n\n\t\tthis.ignore_fields = this.opts.ignore_fields || [];\n\n\t\tvar mandatory_fields = $.map(me.opts.meta.fields, function(d) {\n\t\t\treturn (d.reqd || d.bold && !d.read_only) ? d : null });\n\n\t\tvar opts_field_names = this.fields.map(function(d) {\n\t\t\treturn d.fieldname\n\t\t})\n\n\t\tmandatory_fields.map(function(d) {\n\t\t\tif($.inArray(d.fieldname, me.ignore_fields) === -1 && $.inArray(d.fieldname, opts_field_names) === -1) {\n\t\t\t\tme.fields.push(d)\n\t\t\t}\n\t\t})\n\t},\n\tprint_tree: function() {\n\t\tif(!frappe.model.can_print(this.doctype)) {\n\t\t\tfrappe.msgprint(__(\"You are not allowed to print this report\"));\n\t\t\treturn false;\n\t\t}\n\t\tvar tree = $(\".tree:visible\").html();\n\t\tvar me = this;\n\t\tfrappe.ui.get_print_settings(false, function(print_settings) {\n\t\t\tvar title =  __(me.docname || me.doctype);\n\t\t\tfrappe.render_tree({title: title, tree: tree, print_settings:print_settings});\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.core.doctype.access_log.access_log.make_access_log\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.doctype,\n\t\t\t\t\treport_name: me.page_name,\n\t\t\t\t\tpage: tree,\n\t\t\t\t\tmethod: 'Print'\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tset_primary_action: function(){\n\t\tvar me = this;\n\t\tif (!this.opts.disable_add_node && this.can_create) {\n\t\t\tme.page.set_primary_action(__(\"New\"), function() {\n\t\t\t\tme.new_node();\n\t\t\t}, \"octicon octicon-plus\")\n\t\t}\n\t},\n\tset_menu_item: function(){\n\t\tvar me = this;\n\n\t\tthis.menu_items = [\n\t\t\t{\n\t\t\t\tlabel: __('View List'),\n\t\t\t\taction: function() {\n\t\t\t\t\tfrappe.set_route('List', me.doctype);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.print_tree();\n\t\t\t\t}\n\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __('Refresh'),\n\t\t\t\taction: function() {\n\t\t\t\t\tme.make_tree();\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\n\t\tif (me.opts.menu_items) {\n\t\t\tme.menu_items.push.apply(me.menu_items, me.opts.menu_items)\n\t\t}\n\n\t\t$.each(me.menu_items, function(i, menu_item){\n\t\t\tvar has_perm = true;\n\t\t\tif(menu_item[\"condition\"]) {\n\t\t\t\thas_perm = eval(menu_item[\"condition\"]);\n\t\t\t}\n\n\t\t\tif (has_perm) {\n\t\t\t\tme.page.add_menu_item(menu_item[\"label\"], menu_item[\"action\"]);\n\t\t\t}\n\t\t});\n\t}\n});\n\n\n\n\n\n\n\n\n"],"names":["frappe","has_indicator","doctype","model","is_submittable","listview_settings","get_indicator","workflow","get_state_fieldname","meta","has_field","doc","__unsaved","__","workflows","without_workflow","settings","workflow_fieldname","value","colour","locals","style","Success","Warning","Danger","Primary","Inverse","Info","docstatus","has_indicator_for_draft","has_indicator_for_cancelled","indicator","status","utils","guess_colour","enabled","disabled","ui","Filter","[object Object]","opts","$","extend","this","undefined","filter_utils","set_conditions","set_conditions_from_config","make","conditions","nested_set_conditions","push","ref","invalid_condition_map","Date","Datetime","Data","Select","Link","Currency","Color","Check","map","c","filter","boot","additional_filters_config","filters_config","Object","keys","let","key","label","fieldtype","valid_for_fieldtypes","includes","filter_edit_area","render_template","appendTo","parent","find","make_select","set_events","setup","fieldselect","FieldSelect","parent_doctype","filter_fields","select","fieldname","set_field","set_value","on","remove","removeClass","on_change","update_filter_tag","change","field","condition","get_condition","add_condition_help","empty","df","const","set_values","is_new","promise","Promise","resolve","addClass","hidden","then","$filter_tag","hide","_filter_value_set","set_filter_button_text","make_tag","original_type","set_condition","Array","isArray","join","trim","cur","k","original_docfield","fields_by_name","console","warn","copy_dict","read_only","is_filter","get_default_condition","set_fieldtype","options","selected_doctype","selected_fieldname","args","depends_on","field_name","filter_value","filter_list","get_filter_value","xcall","get_field","make_field","old_fieldtype","old_text","get_value","hide_invalid_conditions","toggle_nested_set_conditions","field_area","get","f","form","make_control","only_input","refresh","wrapper","keydown","e","which","get_selected_value","val","trigger_change","$condition_field","get_filter_tag_element","insertAfter","bind_tag","bind","filter_button","closest","show","toggle","html","get_filter_button_text","get_formatted_value","description","invalid_conditions","show_condition","nested_set_doctypes","forEach","0","1","2","cint","format","only_value","strip","indexOf","startsWith","endsWith","in_list","split","v","reqd","ignore_link_validation","toLowerCase","get_timespan_options","periods","period_map","Last","Today","This","Next","period","p","FilterGroup","filters","window","fltr","append","get_container_template","clear_filter_button","length","add_filter","toggle_clear_filter","clear_filters","promises","run_serially","validate_args","is_new_filter","arguments","push_new_filter","std_fields_list","throw","bold","filter_exists","_push_new_filter","setup_state","update","update_filters","filter_items","base_list","exists","f_value","equal","arrays_equal","slice","get_filters","reduce","acc","assign","Class","init","me","$input","select_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","item","repl","data","originalEvent","text","get_item","i","add_field_option","build_options","clear","parts","each","table_fields","std_filters","std_fields","d","doctype_obj","istable","concat","with_blank","main_table_fields","docfield_list","sort","perm","has_perm","permlevel","table_df","child_table_fields","link_field","get_docfields","table","no_value_type","Tags","tagsList","onTagAdd","onTagRemove","onTagClick","onChange","placeholder","$wrapper","$ul","$inputWrapper","getListElement","$placeholder","deactivate","select_tag","tagValue","xss_sanitise","addTag","keypress","keyCode","focusout","activate","focus","addTags","$tag","getTag","insertBefore","splice","labels","$element","className","$li","$searchTag","$removeTag","searchdialog","search","init_search","attr","removeTag","$toggle_tag","TagEditor","setup_tags","user_tags","initialized","tags","tag","refreshing","call","method","get_args","callback","r","fetch_tags","setup_awesomplete","setup_complete","input","target","frm","txt","message","trigger","dt","dn","docname","clearTags","setTimeout","is_liked","get_liked_by","session","user","liked","_liked_by","JSON","parse","toggle_like","$btn","name","add","hasClass","css","quiet","exc","action_buttons","replace","liked_by","idx","stringify","click_toggle_like","$count","siblings","not_liked","setup_like_popover","$parent","selector","check_not_liked","dom","is_touchscreen","target_element","popover","animation","placement","template","content","decodeURI","liked_by_list","avatar","full_name","children","click","ev","currentTarget","dataset","set_route","container","provide","views","BaseList","before_refresh","init_promise","tasks","setup_defaults","set_stats","setup_fields","setup_page","setup_side_bar","setup_main_section","setup_view","fn","page_name","get_route_str","page_title","get_meta","user_settings","get_user_settings","start","page_length","can_create","can_write","fields","sort_by","sort_order","primary_action","secondary_action","action","menu_items","class","set_fields","build_fields","title_field","_add_field","is_value_type","in_list_view","Boolean","uniqBy","stats","workflow_state_fieldname","page","$page","page_form","setup_page_head","set_title","set_menu_items","set_breadcrumbs","$secondary_action","set_secondary_action","icon","$item","add_menu_item","standard","shortcut","breadcrumbs","module","list_sidebar","ListSidebar","list_view","show_sidebar","localStorage","show_or_hide_sidebar","document","body","toggleClass","setup_list_wrapper","setup_filter_area","setup_sort_selector","setup_result_area","setup_no_result_area","setup_freeze_area","setup_paging_area","$frappe_list","main","filter_area","FilterArea","set","sort_selector","SortSelector","$filter_list_wrapper","onchange","on_sort_change","$result","$no_result","get_no_result_message","$freeze","$paging_area","$this","is","get_full_column_name","get_filters_for_args","get_fields","order_by","get_sql_string","view","freeze","freeze_on_refresh","freeze_message","get_call_args","prepare_data","toggle_result_area","before_render","render","after_render","dict","values","show_more","names","get_checked_items","standard_filters_wrapper","trigger_refresh","make_standard_filters","make_filter_list","standard_filters","get_standard_filters","from","set_standard_filter","non_standard_filters","add_filters","on_filter_change","fields_dict","out","get_filter","refresh_list_view","custom_filter_configs","config","doctype_fields","in_standard_filter","unshift","default_value","defaults","get_user_default","default","add_field","default_filters","view_modes","is_valid","view_mode","BulkOperations","docs","print_settings","get_doc","allow_print_for_draft","allow_print_for_cancelled","valid_docs","has_role","msgprint","dialog","Dialog","title","get_print_formats","set_primary_action","default_print_format","with_letterhead","print_format","print_sel","json_string","open","encodeURIComponent","docnames","done","items","failed","_server_messages","play_sound","assign_to","AssignToDialog","obj","bulk_assign","re_assign","field_mappings","field_options","status_regex","default_field","test","set_value_field","disable_primary_action","enable_primary_action","show_alert","primary_action_label","dialogObj","new_df","match","replace_field","ListSettings","listview","subject_field","with_doctype","get_listview_fields","setup_remove_fields","add_new_fields","show_dialog","list_view_settings","get_values","removed_listview_fields","removed_fields","refresh_columns","update_fields","field_count","fields_html","total_fields","parseInt","is_sortable","show_sortable_handle","can_remove","Sortable","getElementsByClassName","handle","draggable","onUpdate","onclick","column_selector","remove_fields","getAttribute","existing_fields","set_removed_fields","get_removed_listview_fields","fields_order","reset_listview_fields","get_doctype_fields","columns","set_subject_field","set_status_field","get_docfield","set_list_view_fields","type","multiselect_fields","checked","new_fields","column","ListView","route","get_route","last_view","super","disable_scroll_to_top","has_permissions","view_name","view_user_settings","saved_filters","validate_filters","get_menu_items","patch_refresh_and_load_lib","get_list_view_settings","valid_fields","set_actions_menu_items","actions_menu_items","get_actions_menu_items","workflow_action_menu_items","get_workflow_action_menu_items","workflow_action_items","add_actions_menu_item","is_workflow_action","match_rules_list","get_match_rules","restricted_list","prepend","show_restrictions","condition_list","get_fields_in_list_view","image_field","add_fields","track_seen","throttle","load_lib","required_libs","require","setInterval","make_new_doc","clear_primary_action","is_non_std_field","new_doc","setup_columns","render_header","render_skeleton","setup_events","onload","show_restricted_list_indicator_if_applicable","refresh_header","get_df","fields_in_list_view","reorder_listview_fields","innerWidth","fld","col","documentation","help_link","get_documentation_link","no_result_message","new_button_label","empty_state_image","disable_count","with_comment_count","route_options","parse_filters_from_route_options","toggle_actions_menu_button","show_actions_menu","toggle_workflow_actions","hide_actions_menu","get_header_html","$row","get_list_row_html_skeleton","save","save_view_user_settings","setup_new_doc_event","reload_stats","render_list","on_row_checked","render_count","render_tags","_idx","get_list_row_html","get_count_str","str","$list_rows","tag_html","_user_tags","subject_html","$columns","is_numeric_field","get_header_html_skeleton","left","right","get_column_html","get_meta_html","get_left_html","get_right_html","get_indicator_html","Subject","Field","get_subject_html","_value","formatters","fetch_from","strip_html","escape_html","Math","round","escape","field_html","hide_name_column","get_form_link","button","get_description","get_label","modified","comment_when","last_assignee","_assign","_comment_count","get_indicator_dot","current_count","count_without_children","db","count","total_count","_seen","subject","toString","escaped_subject","heart_class","seen","get_seen_class","encodeURI","setup_filterable","setup_list_click","setup_tag_event","setup_check_events","setup_like","setup_realtime_updates","setup_action_handler","setup_keyboard_navigation","focus_next","activeElement","next","focus_prev","prev","check_row","get_list_row_if_focused","is_current_page","is_input_focused","handle_navigation","direction","add_shortcut","$list_row","metaKey","ctrlKey","stopPropagation","filters_to_apply","datetime","get_today","$target","$check","prop","preventDefault","link","location","href","$button","shiftKey","$checkbox_cursor","name_1","name_2","findIndex","min_index","max_index","toggle_tags","disable_auto_refresh","realtime","is_being_edited","call_args","datum","index","a","b","a_value","b_value","return_value","$checks","set_rows_as_checked","el","$list_head_subject","$checkbox_actions","only_docnames","check","cstr","unescape","query_params","full_url","get_share_url","can_import","reference_doctype","can_set_user_permissions","allow","user_roles","custom","doc_type","toggle_side_bar","share_url","developer_mode","show_list_settings","workflow_actions","has_workflow","get_all_transition_actions","checked_items","actions","bulk_operations","is_field_editable","field_doc","some","has_editable_fields","edit","apply_assignment_rule","can_print","print","has_submit_permission","confirm","submit_or_cancel","can_cancel","can_delete","delete","value_array","get_doctype_for_field","j","trees","tree","on_update","event","trigger_list_update","get_list_view","cur_list","ListFactory","Factory","issingle","set_re_route","view_class","load_last_view","change_to","make_page","set_cur_list","re_route_to_view","set_module_breadcrumb","last_route","route_history","history","go","prev_route","module_links","set_doctype_module","ListFilter","can_add_global","$input_area","$list_filters","filter_input","toUpperCase","input_class","render_input","label_area","is_global_input","bind_save_filter","bind_click_filter","bind_remove_filter","get_list_filters","filter_template","set_description","get_filters_values","remove_filter","debounce","has_value","filter_name_exists","save_filter","help_text","filter_name","insert","for_user","get_current_filters","delete_doc","get_list","or_filters","redirect_to_home_if_invalid_route","get_doc_mappings","Event","field_map","interaction_type","summary","category","due_date","public","reqd_fields","hidden_fields","ToDo","reference_document","assigned_to","cat_tags","sidebar_content","sidebar","setup_reports","setup_list_filter","setup_views","setup_kanban_boards","setup_calendar_view","setup_email_inbox","setup_keyboard_shortcuts","setup_list_group_by","disable_sidebar_stats","show_list_link","calendar","email_accounts","treeview_settings","is_tree","current_view","kanban_board","email_account","added","dropdown","divider","add_reports","reports","ref_doctype","report_type","get_divider","all_reports","localeCompare","list_filter","$dropdown","KanbanView","setup_dropdown_in_sidebar","result","calendar_views","$link_calendar","default_link","other_links","calendar_view","dropdown_html","has_common","account","email_id","display_name","get_shortcut_group","list_group_by","ListGroupBy","render_stat","stats_dropdown","setup_search","stat","sum","docfield_map","t","nfound","tempstats","context","existing","$w","get_stats","make_wrapper","group_by_fields","render_group_by_items","make_group_by_fields_modal","setup_dropdown","setup_filter_by","get_group_by_dropdown_fields","$body","docfield","get_group_by_count","field_count_list","render_dropdown_items","current_filters","f_arr","field_counts","current_user","parents","decodeURIComponent","operator","GanttView","calendar_settings","prepare_tasks","progress","isFunction","end","id","dependencies","depends_on_tasks","color","validate_hex","substr","is_milestone","render_gantt","gantt_view_mode","gantt","Gantt","date_format","on_click","task","on_date_change","moment","on_progress_change","progress_fieldname","on_view_change","mode","custom_popup_html","_start","_end","gantt_custom_popup_html","setup_view_mode_buttons","set_colors","view_is","change_view_mode","custom_class","class_name","bar_color","get_contrast_color","CalendarView","last_calendar","calendar_name","get_calendar_preferences","Calendar","with_doc","start_date_field","end_date_field","allDay","all_day","get_default_options","defaultView","getItem","weekends","setup_options","setup_view_mode_button","clear_user_actions","calendars","can_read","$cal","fullCalendar","footnote_area","set_footnote","border-top","cal_options","set_css","detach","btn","set_localStorage_option","option","removeItem","setItem","btn_group","color_map","danger","success","warning","get_system_datetime","date","_offset","tz","sys_defaults","time_zone","convert_to_system_tz","locale","language","header","center","editable","selectable","selectHelper","forceEventDuration","nowIndicator","events","timezone","get_events_method","prepare_events","eventRender","element","tooltip","eventClick","eventDrop","delta","revertFunc","update_event","eventResize","startDate","endDate","jsEvent","get_new_doc","_ambigTime","subtract","dayClick","$date_cell","source","convert_to_user_tz","validate","add_days","fix_end_date_for_event_render","prepare_colors","html2text","color_name","get_css_class","backgroundColor","textColor","remove_from_locals","update_event_method","get_update_args","error","stripTime","DashboardView","dashboard_settings","chart_group","number_card_group","setup_dashboard_page","setup_dashboard_customization","make_dashboard","$customize","$chart_header","$save_or_discard","dashboard_name","clear_secondary_action","$dashboard_page","$dashboard_wrapper","bind_actions_with_object","charts","number_cards","render_dashboard","fetch_dashboard_items","chart_type","document_type","is_public","dashboard_utils","get_dashboard_settings","dashboard_chart_settings","chart_config","chart","chart_name","chart_settings","render_dashboard_charts","render_number_cards","render_empty_state","obj_name","widget","WidgetGroup","allow_sorting","allow_create","allow_delete","allow_hiding","default_values","widgets","in_customize_mode","customize","allow_resize","custom_dialog","show_add_chart_dialog","empty_state_html","$empty_state","toggle_customize","widget_group","get_widget_config","order","widget_name","remove_duplicates","get_widgets_to_save","get_field_options","get_query","query","mandatory_depends_on","value_fields","date_fields","aggregate_function_fields","new_or_existing","chart_function","filters_json","new_widget","on_create","numeric_fieldtypes","ImageView","_image_url","get_image_url","get_attached_images","render_image_view","gallery","prepare_pswp_items","images_map","setup_gallery","item_html","info_fields","info_html","_name","encoded_name","_class","_html","get_abbr","details","item_details_html","url","image","cordova","is_url","base_url","GalleryView","lib_ready","prepare","pswp_root","pswp","_items","_images_map","width","height","naturalWidth","naturalHeight","getBoundingClientRect","src","msrc","w","h","pswp_items","_show","getThumbBoundsFn","thumbnail","pageYScroll","pageYOffset","documentElement","scrollTop","rect","x","y","top","shareEl","showHideOpacity","PhotoSwipe","PhotoSwipeUI_Default","browse_images","$more_items","last_hide_timeout","hide_more_items_after_2s","clearTimeout","hide_more_items","img_html","listen","images","currItem","off","img_el","goTo","invalidateCurrItems","updateSize","asset_dir","last_kanban_board","board_name","card_meta","get_card_meta","save_kanban_board_filters","get_board","board","filters_array","set_indicator","clear_indicator","kanban","KanbanBoard","cards","quick_entry","mandatory","kanban_boards","private","new_kanban_dialog","select_fields","get_fields_for_dialog","project","kb","kanban_filters","kanban_board_name","make_kanban_board","err","InboxView","last_email_account","current_email_account","get_inbox_filters","is_sent_emails","email","attachment","has_attachment","form_link","reference_name","communication_date","all_accounts","op","msg","CommunicationComposer","user_email","FileView","last_folder","home_folder","current_folder","file_menu_items","file_manager","cut","paste","prompt","file_name","folder","grid_view","FileUploader","restrictions","allowed_file_types","on_success","file","prepare_datum","is_folder","icon_class","is_image_file","file_url","_title","is_private","render_grid_view","get_route_url","folders","curr","breadcrumbs_html","get_breadcrumbs_html","created_on","file_size","FileSize","route_url","creation","now_date","str_to_user","setup_drag_drop","dataTransfer","files","toggle_cut_paste_buttons","$paste_btn","menu_btn_group","can_paste","old_folder","$cut_btn","cur_tree","TreeFactory","TreeView","get_tree_root","show_expand_all","get_tree_nodes","get_permissions","make_filters","get_root","set_menu_item","in_create","add_page","make_app_page","single_column","breadcrumb","DocType","min-height","padding-bottom","add_inner_button","load_children","root_node","view_template","row","node_view","disable_onchange","root_label","make_tree","Tree","expandable","toolbar","get_toolbar","on_render","onrender","node","select_node","post_render","is_root","hide_add","new_node","btnClass","allow_rename","rename_doc","new_name","$tree_link","extend_toolbar","get_selected_node","prepare_fields","add_tree_node","expanded","toggle_node","always","unfreeze","ignore_fields","mandatory_fields","opts_field_names","inArray","print_tree","get_print_settings","render_tree","report_name","disable_add_node","apply","menu_item","eval","InteractionComposer","no_submit_on_enter","create_action","display","select_attachments","render_attach","filename","interaction_docs","set_df_property","set_reqd_hidden_fields","get_event_categories","categories","get_input","add_options","setup_attach","doc_mapping","attach","attachments","attachment_uploaded","cur_frm","get_files","urllib","get_full_url","get_primary_btn","form_values","selected_attachments","create_interaction","interaction_values","reference_docname","assign_document","add_attachments","timeline","reload_doc","assignee"],"mappings":"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"}