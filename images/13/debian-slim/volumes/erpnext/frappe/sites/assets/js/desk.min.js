var Rollup=function(exports){"use strict";var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}!function(e){var t=/xyz/.test(function(){})?/\b_super\b/:/.*/;function r(){}r.extend=function(e){var n=this.prototype,a=Object.create(n);for(var i in e)a[i]="function"==typeof e[i]&&"function"==typeof n[i]&&t.test(e[i])?function(e,t){return function(){var r=this._super;this._super=n[e];var a=t.apply(this,arguments);return this._super=r,a}}(i,e[i]):e[i];var o="function"==typeof a.init?a.hasOwnProperty("init")?a.init:function(){n.init.apply(this,arguments)}:function(){};return o.prototype=a,a.constructor=o,o.extend=r.extend,o},e.Class=r}(commonjsGlobal);var _class={};function format(e,t){return null==e?e:(this.unkeyed_index=0,e.replace(/\{(\w*)\}/g,function(e,r){if(""===r&&(r=this.unkeyed_index,this.unkeyed_index++),r==+r)return void 0!==t[r]?t[r]:e}.bind(this)))}String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),n=r.length>>>0;if(0===n)return!1;for(var a=0|t,i=Math.max(a>=0?a:n-Math.abs(a),0);i<n;){if(r[i]===e)return!0;i++}return!1}}),"function"!=typeof String.prototype.trimLeft&&(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}),"function"!=typeof String.prototype.trimRight&&(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e){var t=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var a=t[n];if(null!=a)for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(r[i]=a[i])}return r},writable:!0,configurable:!0}),window.frappe||(window.frappe={}),frappe.provide=function(e){for(var t=e.split("."),r=window,n=0;n<t.length;n++){var a=t[n];r[a]||(r[a]={}),r=r[a]}return r},frappe.provide("locals"),frappe.provide("frappe.flags"),frappe.provide("frappe.settings"),frappe.provide("frappe.utils"),frappe.provide("frappe.ui.form"),frappe.provide("frappe.modules"),frappe.provide("frappe.templates"),frappe.provide("frappe.test_data"),frappe.provide("frappe.utils"),frappe.provide("frappe.model"),frappe.provide("frappe.user"),frappe.provide("frappe.session"),frappe.provide("locals.DocType"),frappe.provide("frappe.listview_settings"),frappe.provide("frappe.tour"),frappe.provide("frappe.listview_parent_route"),window.NEWLINE="\n",window.TAB=9,window.UP_ARROW=38,window.DOWN_ARROW=40,window.cur_frm=null,frappe.require=function(e,t){"string"==typeof e&&(e=[e]),frappe.assets.execute(e,t)},frappe.assets={check:function(){if(window._version_number!=localStorage.getItem("_version_number")&&(frappe.assets.clear_local_storage(),console.log("Cleared App Cache.")),localStorage._last_load){var e=new Date-new Date(localStorage._last_load);(e<1e4||e>864e5)&&frappe.assets.clear_local_storage()}else frappe.assets.clear_local_storage();frappe.assets.init_local_storage()},init_local_storage:function(){localStorage._last_load=new Date,localStorage._version_number=window._version_number,frappe.boot&&(localStorage.metadata_version=frappe.boot.metadata_version)},clear_local_storage:function(){for(var e in $.each(["_last_load","_version_number","metadata_version","page_info","last_visited"],function(e,t){localStorage.removeItem(t)}),localStorage)0!==e.indexOf("desk_assets:")&&0!==e.indexOf("_page:")&&0!==e.indexOf("_doctype:")&&0!==e.indexOf("preferred_breadcrumbs:")||localStorage.removeItem(e);console.log("localStorage cleared")},executed_:[],execute:function(e,t){for(var r=[],n=0,a=e.length;n<a;n++)frappe.assets.exists(e[n])||r.push(e[n]);r.length?frappe.assets.fetch(r,function(){frappe.assets.eval_assets(e,t)}):frappe.assets.eval_assets(e,t)},eval_assets:function(e,t){for(var r=0,n=e.length;r<n;r++){var a=e[r];-1===frappe.assets.executed_.indexOf(a)&&(frappe.assets.handler[frappe.assets.extn(a)](frappe.assets.get(a),a),frappe.assets.executed_.push(a))}t&&t()},exists:function(e){return-1!==frappe.assets.executed_.indexOf(e)||!frappe.boot.developer_mode&&!!frappe.assets.get(e)},fetch:function(e,t){frappe.call({type:"GET",method:"frappe.client.get_js",args:{items:e},callback:function(r){$.each(e,function(e,t){frappe.assets.add(t,r.message[e])}),t()},freeze:!0})},add:function(e,t){if("localStorage"in window)try{frappe.assets.set(e,t)}catch(r){frappe.assets.clear_local_storage(),frappe.assets.set(e,t)}},get:function(e){return localStorage.getItem("desk_assets:"+e)},set:function(e,t){localStorage.setItem("desk_assets:"+e,t)},extn:function(e){return-1!=e.indexOf("?")&&(e=e.split("?").slice(-1)[0]),e.split(".").slice(-1)[0]},handler:{js:function(e,t){frappe.dom.eval(e)},css:function(e,t){frappe.dom.set_style(e)}}},jQuery&&(jQuery.format=format),frappe.provide("frappe.form.formatters"),frappe.form.link_formatters={},frappe.form.formatters={_right:function(e,t){return t&&(t.inline||t.only_value)?e:"<div style='text-align: right'>"+e+"</div>"},Data:function(e){return null==e?"":e},Select:function(e){return __(frappe.form.formatters.Data(e))},Float:function(e,t,r,n){var a=t.precision||cint(frappe.boot.sysdefaults&&frappe.boot.sysdefaults.float_precision)||null;if(t.options&&t.options.trim())return t.precision=a,frappe.form.formatters.Currency(e,t,r,n);if(!(r||{}).always_show_decimals&&!is_null(e)){var i=cstr(e).split(".");null!=i[1]&&0!==cint(i[1])||(a=0)}return frappe.form.formatters._right(null==e||""===e?"":format_number(e,null,a),r)},Int:function(e,t,r){return frappe.form.formatters._right(null==e?"":cint(e),r)},Percent:function(e,t,r){return frappe.form.formatters._right(flt(e,2)+"%",r)},Rating:function(e){return'<span class="rating">\n\t'+Array.from(new Array(5)).map(function(t,r){return'<i class="fa fa-fw fa-star '+(r<(e||0)?"star-click":"")+' star-icon" data-idx="'+(r+1)+'"></i>'}).join("")+"\n\t\t</span>"},Currency:function(e,t,r,n){var a=frappe.meta.get_field_currency(t,n),i=t.precision||cint(frappe.boot.sysdefaults.currency_precision)||2;if(i>2){var o=cstr(e).split("."),s=o.length>1?o[1]:"";if(s.length<3||s.length<i){var l=frappe.model.get_value(":Currency",a,"fraction_units")||100;s.length<cstr(l).length&&(i=cstr(l).length-1)}}return e=null==e||""===e?"":format_currency(e,a,i),r&&r.only_value?e:frappe.form.formatters._right(e,r)},Check:function(e){return e?'<i class="fa fa-check" style="margin-right: 3px;"></i>':'<i class="fa fa-square disabled-check"></i>'},Link:function(e,t,r,n){var a=t._options||t.options,i=e;return e&&e.match&&e.match(/^['"].*['"]$/)&&e.replace(/^.(.*).$/,"$1"),r&&(r.for_print||r.only_value)?e:(frappe.form.link_formatters[a]&&n&&a!==n.doctype&&(e=frappe.form.link_formatters[a](e,n)),e?"'"==e[0]&&"'"==e[e.length-1]?e.substring(1,e.length-1):t&&t.link_onclick?repl('<a onclick="%(onclick)s">%(value)s</a>',{onclick:t.link_onclick.replace(/"/g,"&quot;"),value:e}):t&&a?'<a class="grey"\n\t\t\t\thref="#Form/'+encodeURIComponent(a)+"/"+encodeURIComponent(i)+'"\n\t\t\t\tdata-doctype="'+a+'"\n\t\t\t\tdata-name="'+i+'">\n\t\t\t\t'+__(r&&r.label||e)+"</a>":e:"")},Date:function(e){return frappe.datetime.str_to_user?(e&&"Invalid date"===(e=frappe.datetime.str_to_user(e))&&(e=null),e||""):e},DateRange:function(e){return $.isArray(e)?__("{0} to {1}",[frappe.datetime.str_to_user(e[0]),frappe.datetime.str_to_user(e[1])]):e||""},Datetime:function(e){if(e){var t=moment(frappe.datetime.convert_to_user_tz(e));return frappe.boot.sysdefaults.time_zone&&(t=t.tz(frappe.boot.sysdefaults.time_zone)),t.format(frappe.boot.sysdefaults.date_format.toUpperCase()+" "+frappe.boot.sysdefaults.time_format)}return""},Text:function(e){if(e){for(var t=["<p","<div","<br","<table"],r=!1,n=0;n<t.length;n++)if(e.match(t[n])){r=!0;break}r||(e=frappe.utils.replace_newlines(e))}return frappe.form.formatters.Data(e)},Time:function(e){return e&&(e=frappe.datetime.str_to_user(e,!0)),e||""},Duration:function(e,t){if(e){var r=frappe.utils.get_duration_options(t);e=frappe.utils.get_formatted_duration(e,r)}return e||""},LikedBy:function(e){var t="";return $.each(JSON.parse(e||"[]"),function(e,r){r&&(t+=frappe.avatar(r))}),t},Tag:function(e){var t="";return $.each((e||"").split(","),function(e,r){r&&(t+='<span class="label label-info" \t\t\t\tstyle="margin-right: 7px; cursor: pointer;"\t\t\t\tdata-field="_user_tags" data-label="'+r+'">'+r+"</span>")}),t},Comment:function(e){return e},Assign:function(e){var t="";return $.each(JSON.parse(e||"[]"),function(e,r){r&&(t+='<span class="label label-warning" \t\t\t\tstyle="margin-right: 7px;"\t\t\t\tdata-field="_assign">'+r+"</span>")}),t},SmallText:function(e){return frappe.form.formatters.Text(e)},TextEditor:function(e){var t=frappe.form.formatters.Text(e);return $(t).find(".ql-editor").length||(t='<div class="ql-editor read-mode">'+t+"</div>"),t},Code:function(e){return"<pre>"+(null==e?"":$("<div>").text(e).html())+"</pre>"},WorkflowState:function(e){var t=frappe.get_doc("Workflow State",e);return t?repl("<span class='label label-%(style)s' \t\t\t\tdata-workflow-state='%(value)s'\t\t\t\tstyle='padding-bottom: 4px; cursor: pointer;'>\t\t\t\t<i class='fa fa-small fa-white fa-%(icon)s'></i> %(value)s</span>",{value:e,style:t.style.toLowerCase(),icon:t.icon}):"<span class='label'>"+e+"</span>"},Email:function(e){return $("<div></div>").text(e).html()},FileSize:function(e){return e>1048576?e=flt(flt(e)/1048576,1)+"M":e>1024&&(e=flt(flt(e)/1024,1)+"K"),e},TableMultiSelect:function(e,t,r){e=e||[];var n=frappe.get_meta(t.options).fields.find(function(e){return"Link"===e.fieldtype});return e.map(function(e){var t=e[n.fieldname];return frappe.format(t,n,r,e)}).join(", ")}},frappe.form.get_formatter=function(e){return e||(e="Data"),frappe.form.formatters[e.replace(/ /g,"")]||frappe.form.formatters.Data},frappe.format=function(e,t,r,n){t||(t={fieldtype:"Data"});var a=t.fieldtype||"Data";"Dynamic Link"===a&&(a="Link",t._options=n?n[t.options]:null);var i=(t.formatter||frappe.form.get_formatter(a))(e,t,r,n);return"string"==typeof i&&(i=frappe.dom.remove_script_and_style(i)),i},frappe.get_format_helper=function(e){var t={get_formatted:function(t){var r=frappe.meta.get_docfield(e.doctype,t);return r||console.log("fieldname not found: "+t),frappe.format(e[t],r,{inline:1},e)}};return $.extend(t,e),t},frappe.provide("frappe.dom"),frappe.dom={id_count:0,freeze_count:0,by_id:function(e){return document.getElementById(e)},get_unique_id:function(){var e="unique-"+frappe.dom.id_count;return frappe.dom.id_count++,e},set_unique_id:function(e){var t=$(e);if(t.attr("id"))return t.attr("id");var r="unique-"+frappe.dom.id_count;return t.attr("id",r),frappe.dom.id_count++,r},eval:function(e){if(e){var t=document.createElement("script");t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}},remove_script_and_style:function(e){var t=["script","style","noscript","title","meta","base","head"];if(!new RegExp(t.map(function(e){return"<"+e+">.*<\\/"+e+">"}).join("|")).test(e))return e;var r=document.createElement("div");r.innerHTML=e;var n=!1;t.forEach(function(e){var t=r.getElementsByTagName(e);for(i=t.length;i--;)n=!0,t[i].parentNode.removeChild(t[i])});for(var a=r.getElementsByTagName("link"),i=a.length;i--;)"stylesheet"==a[i].getAttribute("rel")&&(n=!0,a[i].parentNode.removeChild(a[i]));return n?r.innerHTML:e},is_element_in_viewport:function(e,t){void 0===t&&(t=0),"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var r=e.getBoundingClientRect();return r.top+t>=0&&r.left+t>=0&&r.bottom-t<=$(window).height()&&r.right-t<=$(window).width()},is_element_in_modal:function(e){return Boolean($(e).parents(".modal").length)},set_style:function(e,t){if(e){var r=document.createElement("style");if(r.type="text/css",t){var n=document.getElementById(t);n&&n.parentNode.removeChild(n),r.id=t}return r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(r),r}},add:function(e,t,r,n,a,i){e&&e.substr&&(e=frappe.dom.by_id(e));var o=document.createElement(t);return e&&e.appendChild(o),r&&("img"==t.toLowerCase()?o.src=r:o.className=r),n&&frappe.dom.css(o,n),a&&(o.innerHTML=a),i&&(o.onclick=i),o},css:function(e,t){return e&&t&&$.extend(e.style,t),e},activate:function(e,t,r,n){void 0===n&&(n="active"),e.find("."+r+"."+n).removeClass(n),t.addClass(n)},freeze:function(e,t){if($("#freeze").length)$("#freeze").addClass("in");else{var r=$('<div id="freeze" class="modal-backdrop fade"></div>').on("click",function(){if(cur_frm&&cur_frm.cur_grid)return cur_frm.cur_grid.toggle_view(),!1}).appendTo("#body_div");r.html(repl('<div class="freeze-message-container"><div class="freeze-message"><p class="lead">%(msg)s</p></div></div>',{msg:e||""})),setTimeout(function(){r.addClass("in")},1)}t&&$("#freeze").addClass(t),frappe.dom.freeze_count++},unfreeze:function(){if(frappe.dom.freeze_count&&(frappe.dom.freeze_count--,!frappe.dom.freeze_count))$("#freeze").removeClass("in").remove()},save_selection:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount){for(var t=[],r=0,n=e.rangeCount;r<n;++r)t.push(e.getRangeAt(r));return t}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restore_selection:function(e){if(e)if(window.getSelection){var t=window.getSelection();t.removeAllRanges();for(var r=0,n=e.length;r<n;++r)t.addRange(e[r])}else document.selection&&e.select&&e.select()},is_touchscreen:function(){return"ontouchstart"in window},handle_broken_images:function(e){$(e).find("img").on("error",function(e){$(e.currentTarget).addClass("no-image")})},scroll_to_bottom:function(e){var t=$(e);t.scrollTop(t[0].scrollHeight)},file_to_base64:function(e){return new Promise(function(t){var r=new FileReader;r.onload=function(){t(r.result)},r.readAsDataURL(e)})},scroll_to_section:function(e){setTimeout(function(){var t=$('a:contains("'+e+'")');t.length&&(t.parent().hasClass("collapsed")&&t.click(),frappe.ui.scroll(t.parent().parent()))},200)},pixel_to_inches:function(e){var t=$('<div id="dpi" style="height: 1in; width: 1in; left: 100%; position: fixed; top: 100%;"></div>');t.appendTo(document.body);var r=e/document.getElementById("dpi").offsetWidth;return t.remove(),r}},frappe.ellipsis=function(e,t){return t||(t=20),(e=cstr(e)).length>t&&(e=e.substr(0,t)+"..."),e},frappe.run_serially=function(e){var t=Promise.resolve();return e.forEach(function(e){e&&(t=t.then?t.then(e):Promise.resolve())}),t},frappe.load_image=function(e,t,r,n){void 0===n&&(n=function(){});var a=new Image;a.onload=function(){t(this)},a.onerror=r,n(a),a.src=e},frappe.timeout=function(e){return new Promise(function(t){setTimeout(function(){return t()},1e3*e)})},frappe.scrub=function(e,t){return void 0===t&&(t="_"),e.replace(/ /g,t).toLowerCase()},frappe.get_modal=function(e,t){return $('<div class="modal fade" style="overflow: auto;" tabindex="-1">\n\t\t<div class="modal-dialog">\n\t\t\t<div class="modal-content">\n\t\t\t\t<div class="modal-header">\n\t\t\t\t\t<div class="flex justify-between">\n\t\t\t\t\t\t<div class="fill-width flex">\n\t\t\t\t\t\t\t<span class="indicator hidden"></span>\n\t\t\t\t\t\t\t<h4 class="modal-title" style="font-weight: bold;">'+e+'</h4>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class="text-right buttons">\n\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-sm btn-modal-minimize hide">\n\t\t\t\t\t\t\t\t\t<i class="octicon octicon-chevron-down" style="padding: 1px 0px;"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-sm btn-modal-close" data-dismiss="modal">\n\t\t\t\t\t\t\t\t\t<i class="octicon octicon-x visible-xs" style="padding: 1px 0px;"></i>\n\t\t\t\t\t\t\t\t\t<span class="hidden-xs">'+__("Close")+'</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button type="button" class="btn btn-primary btn-sm hide">\n\t\t\t\t\t\t\t\t\t'+__("Confirm")+'\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-body ui-front">'+t+"</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>")},frappe.is_online=function(){return 1==frappe.boot.developer_mode||(!("onLine"in navigator)||navigator.onLine)},$(window).on("online",function(){frappe.show_alert({indicator:"green",message:__("You are connected to internet.")})}),$(window).on("offline",function(){frappe.show_alert({indicator:"orange",message:__("Connection lost. Some features might not work.")})}),frappe.ui.form.Layout=Class.extend({init:function(e){this.views={},this.pages=[],this.sections=[],this.fields_list=[],this.fields_dict={},$.extend(this,e)},make:function(){!this.parent&&this.body&&(this.parent=this.body),this.wrapper=$('<div class="form-layout">').appendTo(this.parent),this.message=$('<div class="form-message text-muted small hidden"></div>').appendTo(this.wrapper),this.fields||(this.fields=this.get_doctype_fields()),this.setup_tabbing(),this.render()},show_empty_form_message:function(){this.wrapper.find(".frappe-control:visible").length||this.wrapper.find(".section-head.collapsed").length||this.show_message(__("This form does not have any input"))},get_doctype_fields:function(){var e=[{parent:this.frm.doctype,fieldtype:"Data",fieldname:"__newname",reqd:1,hidden:1,label:__("Name"),get_status:function(e){return e.frm&&e.frm.is_new()&&e.frm.meta.autoname&&["prompt","name"].includes(e.frm.meta.autoname.toLowerCase())?"Write":"None"}}];return e=e.concat(frappe.meta.sort_docfields(frappe.meta.docfield_map[this.doctype]))},show_message:function(e,t){this.message_color&&this.message.removeClass(this.message_color),this.message_color=t&&["yellow","blue"].includes(t)?t:"blue",e?("<"!==e.substr(0,1)&&(e="<div>"+e+"</div>"),this.message.removeClass("hidden").addClass(this.message_color),$(e).appendTo(this.message)):this.message.empty().addClass("hidden")},render:function(e){var t=this,r=e||this.fields;this.section=null,this.column=null,this.with_dashboard&&this.setup_dashboard_section(),this.no_opening_section()&&this.make_section(),$.each(r,function(e,r){switch(r.fieldtype){case"Fold":t.make_page(r);break;case"Section Break":t.make_section(r);break;case"Column Break":t.make_column(r);break;default:t.make_field(r)}})},no_opening_section:function(){return this.fields[0]&&"Section Break"!=this.fields[0].fieldtype||!this.fields.length},setup_dashboard_section:function(){this.no_opening_section()&&this.fields.unshift({fieldtype:"Section Break"}),this.fields.unshift({fieldtype:"Section Break",fieldname:"_form_dashboard",label:__("Dashboard"),cssClass:"form-dashboard",collapsible:1})},replace_field:function(e,t,r){if(t.fieldname=e,this.fields_dict[e]&&this.fields_dict[e].df){var n=this.init_field(t,r);this.fields_dict[e].$wrapper.remove(),this.fields_list.splice(this.fields_dict[e],1,n),this.fields_dict[e]=n,this.frm&&(n.perm=this.frm.perm),this.section.fields_list.splice(this.section.fields_dict[e],1,n),this.section.fields_dict[e]=n,this.refresh_fields([t])}},make_field:function(e,t,r){!this.section&&this.make_section(),!this.column&&this.make_column();var n=this.init_field(e,r);this.fields_list.push(n),this.fields_dict[e.fieldname]=n,this.frm&&(n.perm=this.frm.perm),this.section.fields_list.push(n),this.section.fields_dict[e.fieldname]=n,n.section=this.section},init_field:function(e,t){void 0===t&&(t=!1);var r=frappe.ui.form.make_control({df:e,doctype:this.doctype,parent:this.column.wrapper.get(0),frm:this.frm,render_input:t,doc:this.doc});return r.layout=this,r},make_page:function(e){var t=this,r=$('<div class="form-clickable-section text-center">\t\t\t\t<a class="btn-fold h6 text-muted">'+__("Show more details")+"</a>\t\t\t</div>").appendTo(this.wrapper);this.page=$('<div class="form-page second-page hide"></div>').appendTo(this.wrapper),this.fold_btn=r.find(".btn-fold").on("click",function(){var e=$(this).parent().next();e.hasClass("hide")?($(this).removeClass("btn-fold").html(__("Hide details")),e.removeClass("hide"),frappe.utils.scroll_to($(this),!0,30),t.folded=!1):($(this).addClass("btn-fold").html(__("Show more details")),e.addClass("hide"),t.folded=!0)}),this.section=null,this.folded=!0},unfold:function(){this.fold_btn.trigger("click")},make_section:function(e){this.section=new frappe.ui.form.Section(this,e),e&&(this.fields_dict[e.fieldname]=this.section,this.fields_list.push(this.section)),this.column=null},make_column:function(e){this.column=new frappe.ui.form.Column(this.section,e),e&&e.fieldname&&this.fields_list.push(this.column)},refresh:function(e){e&&(this.doc=e),this.frm&&this.wrapper.find(".empty-form-alert").remove(),this.attach_doc_and_docfields(!0),this.frm&&this.frm.wrapper&&$(this.frm.wrapper).trigger("refresh-fields"),this.refresh_dependency(),this.refresh_sections(),this.frm&&this.refresh_section_collapse()},refresh_sections:function(){var e=0;this.wrapper.find(".form-section:not(.hide-control)").each(function(){var t=$(this).removeClass("empty-section").removeClass("visible-section").removeClass("shaded-section");t.find(".frappe-control:not(.hide-control)").length||t.hasClass("form-dashboard")?(t.addClass("visible-section"),e%2&&t.addClass("shaded-section"),e++):t.addClass("empty-section")})},refresh_fields:function(e){var t=e.map(function(e){if(e.fieldname)return e.fieldname});this.fields_list.map(function(e){t.includes(e.df.fieldname)&&(e.refresh(),e.df.default&&e.set_input(e.df.default))})},add_fields:function(e){this.render(e),this.refresh_fields(e)},refresh_section_collapse:function(){if(this.doc)for(var e=0;e<this.sections.length;e++){var t=this.sections[e],r=t.df;if(r&&r.collapsible){var n=!0;r.collapsible_depends_on&&(n=!this.evaluate_depends_on_value(r.collapsible_depends_on)),n&&t.has_missing_mandatory()&&(n=!1),"_form_dashboard"===r.fieldname&&(n="yes"===localStorage.getItem("collapseFormDashboard")),t.collapse(n)}}},attach_doc_and_docfields:function(e){for(var t=this,r=0,n=this.fields_list.length;r<n;r++){var a=this.fields_list[r];t.doc&&(a.doc=t.doc,a.doctype=t.doc.doctype,a.docname=t.doc.name,a.df=frappe.meta.get_docfield(t.doc.doctype,a.df.fieldname,t.frm?t.frm.doc.name:t.doc.name)||a.df,t.frm&&(a.perm=t.frm.perm)),e&&a.df&&a.refresh&&a.refresh()}},refresh_section_count:function(){this.wrapper.find(".section-count-label:visible").each(function(e){$(this).html(e+1)})},setup_tabbing:function(){var e=this;this.wrapper.on("keydown",function(t){if(9==t.which){var r=$(t.target),n=r.attr("data-doctype"),a=r.attr("data-fieldname");if(n)return e.handle_tab(n,a,t.shiftKey)}})},handle_tab:function(e,t,r){var n=null,a=null,i=this.fields_list,o=!1;if(e!=this.doctype){if(!(n=this.get_open_grid_row())||!n.layout)return;i=n.layout.fields_list}for(var s=0,l=i.length;s<l;s++){if(i[s].df.fieldname==t){if(r){a?this.set_focus(a):$(this.primary_button).focus();break}if(s<l-1&&(o=this.focus_on_next_field(s,i)),o)break}this.is_visible(i[s])&&(a=i[s])}return o||(n?n.doc.idx==n.grid.grid_rows.length?n.toggle_view(!1,function(){n.grid.frm.layout.handle_tab(n.grid.df.parent,n.grid.df.fieldname)}):n.grid.grid_rows[n.doc.idx].toggle_view(!0):$(this.primary_button).focus()),!1},focus_on_next_field:function(e,t){for(var r=e+1,n=t.length;r<n;r++){var a=t[r];if(this.is_visible(a)){if("Table"===a.df.fieldtype)return a.grid.grid_rows&&a.grid.grid_rows.length||a.grid.add_new_row(),a.grid.grid_rows[0].show_form(),!0;if(!in_list(frappe.model.no_value_type,a.df.fieldtype))return this.set_focus(a),!0}}},is_visible:function(e){return"Write"===e.disp_status&&e.$wrapper&&e.$wrapper.is(":visible")},set_focus:function(e){"Table"==e.df.fieldtype?e.grid.grid_rows.length?e.grid.grid_rows[0].toggle_view(!0):e.grid.add_new_row(1):e.editor?e.editor.set_focus():e.$input&&e.$input.focus()},get_open_grid_row:function(){return $(".grid-row-open").data("grid_row")},refresh_dependency:function(){var e=!1;for(var t in this.fields_list){(n=this.fields_list[t]).dependencies_clear=!0,(n.df.depends_on||n.df.mandatory_depends_on||n.df.read_only_depends_on)&&(e=!0)}if(e){for(var r=this.fields_list.length-1;r>=0;r--){var n;(n=this.fields_list[r]).guardian_has_value=!0,n.df.depends_on&&(n.guardian_has_value=this.evaluate_depends_on_value(n.df.depends_on),n.guardian_has_value?n.df.hidden_due_to_dependency&&(n.df.hidden_due_to_dependency=!1,n.refresh()):n.df.hidden_due_to_dependency||(n.df.hidden_due_to_dependency=!0,n.refresh())),n.df.mandatory_depends_on&&this.set_dependant_property(n.df.mandatory_depends_on,n.df.fieldname,"reqd"),n.df.read_only_depends_on&&this.set_dependant_property(n.df.read_only_depends_on,n.df.fieldname,"read_only")}this.refresh_section_count()}},set_dependant_property:function(e,t,r){var n,a=this.evaluate_depends_on_value(e);this.frm?n=this.frm:this.is_dialog&&(n=this),n&&(a?n.set_df_property(t,r,1):n.set_df_property(t,r,0))},evaluate_depends_on_value:function(expression){var out=null,doc=this.doc;if(!doc&&this.get_values)var doc=this.get_values(!0);if(doc){var parent=this.frm?this.frm.doc:null;if("boolean"==typeof expression)out=expression;else if("function"==typeof expression)out=expression(doc);else if("eval:"==expression.substr(0,5))try{out=eval(expression.substr(5)),parent&&parent.istable&&expression.includes("is_submittable")&&(out=!0)}catch(e){frappe.throw(__('Invalid "depends_on" expression'))}else if("fn:"==expression.substr(0,3)&&this.frm)out=this.frm.script_manager.trigger(expression.substr(3),this.doctype,this.docname);else{var value=doc[expression];out=$.isArray(value)?!!value.length:!!value}return out}}}),frappe.ui.form.Section=Class.extend({init:function(e,t){this.layout=e,this.df=t||{},this.fields_list=[],this.fields_dict={},this.make(),this.row={wrapper:this.wrapper},this.df.collapsible&&"_form_dashboard"!==this.df.fieldname&&this.collapse(!0),this.refresh()},make:function(){this.layout.page||(this.layout.page=$('<div class="form-page"></div>').appendTo(this.layout.wrapper)),this.wrapper=$('<div class="row form-section">').appendTo(this.layout.page),this.layout.sections.push(this),this.df&&(this.df.label&&this.make_head(),this.df.description&&$('<div class="col-sm-12 small text-muted form-section-description">'+__(this.df.description)+"</div>").appendTo(this.wrapper),this.df.cssClass&&this.wrapper.addClass(this.df.cssClass),this.df.hide_border&&this.wrapper.toggleClass("hide-border",!0)),this.body=$('<div class="section-body">').appendTo(this.wrapper)},make_head:function(){var e=this;this.df.collapsible?(this.head=$('<div class="section-head"><a class="h6 uppercase">'+__(this.df.label)+'</a><span class="octicon octicon-chevron-down collapse-indicator"></span></div>').appendTo(this.wrapper),this.collapse_link=this.head.on("click",function(){e.collapse()}),this.indicator=this.head.find(".collapse-indicator")):$('<div class="col-sm-12"><h6 class="form-section-heading uppercase">'+__(this.df.label)+"</h6></div>").appendTo(this.wrapper)},refresh:function(){if(this.df){var e=this.df.hidden||this.df.hidden_due_to_dependency;!e&&this.layout&&this.layout.frm&&!this.layout.frm.get_perm(this.df.permlevel||0,"read")&&(e=!0),this.wrapper.toggleClass("hide-control",!!e)}},collapse:function(e){this.head&&this.body&&(void 0===e&&(e=!this.body.hasClass("hide")),"_form_dashboard"===this.df.fieldname&&localStorage.setItem("collapseFormDashboard",e?"yes":"no"),this.body.toggleClass("hide",e),this.head.toggleClass("collapsed",e),this.indicator.toggleClass("octicon-chevron-down",e),this.indicator.toggleClass("octicon-chevron-up",!e),this.fields_list.forEach(function(e){"Signature"==e.df.fieldtype&&e.refresh()}))},is_collapsed:function(){return this.body.hasClass("hide")},has_missing_mandatory:function(){for(var e=!1,t=0,r=this.fields_list.length;t<r;t++){var n=this.fields_list[t].df;if(n.reqd&&null==this.layout.doc[n.fieldname]){e=!0;break}}return e}}),frappe.ui.form.Column=Class.extend({init:function(e,t){t||(t={}),this.df=t,this.section=e,this.make(),this.resize_all_columns()},make:function(){this.wrapper=$('<div class="form-column">\t\t\t<form>\t\t\t</form>\t\t</div>').appendTo(this.section.body).find("form").on("submit",function(){return!1}),this.df.label&&$('<label class="control-label">'+__(this.df.label)+"</label>").appendTo(this.wrapper)},resize_all_columns:function(){var e=cint(12/this.section.wrapper.find(".form-column").length);this.section.wrapper.find(".form-column").removeClass().addClass("form-column").addClass("col-sm-"+e)},refresh:function(){this.section.refresh()}}),frappe.provide("frappe.ui"),frappe.ui.FieldGroup=frappe.ui.form.Layout.extend({init:function(e){$.extend(this,e),this.dirty=!1,this._super(),$.each(this.fields||[],function(e,t){!t.fieldname&&t.label&&(t.fieldname=t.label.replace(/ /g,"_").toLowerCase())}),this.values&&this.set_values(this.values)},make:function(){var e=this,t=this;this.fields&&(this._super(),this.refresh(),$.each(this.fields_list,function(e,r){if(r.df.default){var n=r.df.default;"Today"==n&&"Date"==r.df.fieldtype&&(n=frappe.datetime.get_today()),r.set_input(n),t.refresh_dependency()}}),this.no_submit_on_enter||this.catch_enter_as_submit(),$(this.wrapper).find("input, select").on("change",function(){e.dirty=!0,frappe.run_serially([function(){return frappe.timeout(.1)},function(){return t.refresh_dependency()}])}))},first_button:!1,focus_on_first_input:function(){this.no_focus||$.each(this.fields_list,function(e,t){if(!in_list(["Date","Datetime","Time","Check"],t.df.fieldtype)&&t.set_focus)return t.set_focus(),!1})},catch_enter_as_submit:function(){var e=this;$(this.body).find('input[type="text"], input[type="password"], select').keypress(function(t){13==t.which&&e.has_primary_action&&(t.preventDefault(),e.get_primary_btn().trigger("click"))})},get_input:function(e){var t=this.fields_dict[e];return $(t.txt?t.txt:t.input)},get_field:function(e){return this.fields_dict[e]},get_values:function(e){var t={},r=[];for(var n in this.fields_dict){var a=this.fields_dict[n];if(a.get_value){var i=a.get_value();a.df.reqd&&is_null(i)&&r.push(__(a.df.label)),is_null(i)||(t[a.df.fieldname]=i)}}return r.length&&!e?(frappe.msgprint({title:__("Missing Values Required"),message:__("Following fields have missing values:")+"<br><br><ul><li>"+r.join("<li>")+"</ul>",indicator:"orange"}),null):t},get_value:function(e){var t=this.fields_dict[e];return t&&(t.get_value?t.get_value():null)},set_value:function(e,t){var r=this;return new Promise(function(n){var a=r.fields_dict[e];a?a.set_value(t).then(function(){a.set_input(t),r.refresh_dependency(),n()}):n()})},set_input:function(e,t){return this.set_value(e,t)},set_values:function(e){var t=[];for(var r in e)this.fields_dict[r]&&t.push(this.set_value(r,e[r]));return Promise.all(t)},clear:function(){for(var e in this.fields_dict){var t=this.fields_dict[e];t&&t.set_input&&t.set_input(t.df.default||"")}},set_df_property:function(e,t,r){var n=this.get_field(e);n.df[t]=r,n.refresh()}}),frappe.provide("frappe.ui"),window.cur_dialog=null,frappe.ui.open_dialogs=[],frappe.ui.Dialog=class extends frappe.ui.FieldGroup{constructor(e){super(),this.display=!1,this.is_dialog=!0,$.extend(this,{animate:!0,size:null},e),this.make()}make(){var e=this;this.$wrapper=frappe.get_modal("",""),this.static&&(this.$wrapper.modal({backdrop:"static",keyboard:!1}),this.get_close_btn().hide()),this.wrapper=this.$wrapper.find(".modal-dialog").get(0),"small"==this.size?$(this.wrapper).addClass("modal-sm"):"large"==this.size&&$(this.wrapper).addClass("modal-lg"),this.make_head(),this.modal_body=this.$wrapper.find(".modal-body"),this.$body=$("<div></div>").appendTo(this.modal_body),this.body=this.$body.get(0),this.$message=$('<div class="hide modal-message"></div>').appendTo(this.modal_body),this.header=this.$wrapper.find(".modal-header"),this.buttons=this.header.find(".buttons"),this.set_indicator(),super.make(),this.action=this.action||{primary:{},secondary:{}},(this.primary_action||this.action.primary&&this.action.primary.onsubmit)&&this.set_primary_action(this.primary_action_label||this.action.primary.label||__("Submit"),this.primary_action||this.action.primary.onsubmit),this.secondary_action&&this.set_secondary_action(this.secondary_action),(this.secondary_action_label||this.action.secondary&&this.action.secondary.label)&&this.get_close_btn().html(this.secondary_action_label||this.action.secondary.label),this.minimizable&&(this.header.find(".modal-title").click(function(){return e.toggle_minimize()}),this.get_minimize_btn().removeClass("hide").on("click",function(){return e.toggle_minimize()}));var t=this;this.$wrapper.on("hide.bs.modal",function(){t.display=!1,t.secondary_action&&t.secondary_action(),frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]===t&&(frappe.ui.open_dialogs.pop(),frappe.ui.open_dialogs.length?window.cur_dialog=frappe.ui.open_dialogs[frappe.ui.open_dialogs.length-1]:window.cur_dialog=null),t.onhide&&t.onhide(),t.on_hide&&t.on_hide()}).on("shown.bs.modal",function(){t.display=!0,window.cur_dialog=t,frappe.ui.open_dialogs.push(t),t.focus_on_first_input(),t.on_page_show&&t.on_page_show(),$(document).trigger("frappe.ui.Dialog:shown")}).on("scroll",function(){var e=$("input:focus");e.length&&["Date","Datetime","Time"].includes(e.attr("data-fieldtype"))&&e.blur()})}get_primary_btn(){return this.$wrapper.find(".modal-header .btn-primary")}get_minimize_btn(){return this.$wrapper.find(".modal-header .btn-modal-minimize")}set_message(e){this.$message.removeClass("hide"),this.$body.addClass("hide"),this.$message.text(e)}clear_message(){this.$message.addClass("hide"),this.$body.removeClass("hide")}clear(){super.clear(),this.clear_message()}set_primary_action(e,t){this.has_primary_action=!0;var r=this;return this.get_primary_btn().removeClass("hide").html(e).click(function(){r.primary_action_fulfilled=!0;var e=r.get_values();e&&t&&t.apply(r,[e])})}set_secondary_action(e){this.get_close_btn().on("click",e)}set_secondary_action_label(e){this.get_close_btn().removeClass("hide").html(e)}disable_primary_action(){this.get_primary_btn().addClass("disabled")}enable_primary_action(){this.get_primary_btn().removeClass("disabled")}make_head(){this.set_title(this.title)}set_title(e){this.$wrapper.find(".modal-title").html(e)}set_indicator(){this.indicator&&this.header.find(".indicator").removeClass().addClass("indicator "+this.indicator)}show(){return this.animate?this.$wrapper.addClass("fade"):this.$wrapper.removeClass("fade"),this.$wrapper.modal("show"),this.clear_message(),this.primary_action_fulfilled=!1,this.is_visible=!0,this}hide(){this.$wrapper.modal("hide"),this.is_visible=!1}get_close_btn(){return this.$wrapper.find(".btn-modal-close")}no_cancel(){this.get_close_btn().toggle(!1)}cancel(){this.get_close_btn().trigger("click")}toggle_minimize(){var e=this.$wrapper.closest(".modal").toggleClass("modal-minimize");e.attr("tabindex")?e.removeAttr("tabindex"):e.attr("tabindex",-1),this.get_minimize_btn().find("i").toggleClass("octicon-chevron-down").toggleClass("octicon-chevron-up"),this.is_minimized=!this.is_minimized,this.on_minimize_toggle&&this.on_minimize_toggle(this.is_minimized),this.header.find(".modal-title").toggleClass("cursor-pointer")}},frappe.provide("frappe.messages"),frappe.messages.waiting=function(e,t){return $(frappe.messages.get_waiting_message(t)).appendTo(e)},frappe.messages.get_waiting_message=function(e){return repl('<div class="msg-box" style="width: 63%; margin: 30px auto;">\t\t<p class="text-center">%(msg)s</p></div>',{msg:e})},frappe.throw=function(e){throw"string"==typeof e&&(e={message:e,title:__("Error")}),e.indicator||(e.indicator="red"),frappe.msgprint(e),new Error(e.message)},frappe.confirm=function(e,t,r){var n=new frappe.ui.Dialog({title:__("Confirm"),fields:[{fieldtype:"HTML",options:'<p class="frappe-confirm-message">'+e+"</p>"}],primary_action_label:__("Yes"),primary_action:function(){t&&t(),n.hide()},secondary_action_label:__("No")});return n.show(),n.confirm_dialog=!0,r&&(n.onhide=function(){n.primary_action_fulfilled||r()}),n},frappe.warn=function(e,t,r,n){var a=new frappe.ui.Dialog({title:e,indicator:"red",fields:[{fieldtype:"HTML",fieldname:"warning_message",options:'<div class="frappe-warning-message">'+t+"</div>"}],primary_action_label:n,primary_action:function(){r&&r(),a.hide()},secondary_action_label:__("Cancel")});return a.buttons.find(".btn-primary").removeClass("btn-primary").addClass("btn-danger"),$('<div class="modal-footer"></div>').insertAfter($(a.modal_body)).html(a.buttons),a.show(),a},frappe.prompt=function(e,t,r,n){"string"==typeof e&&(e=[{label:e,fieldname:"value",fieldtype:"Data",reqd:1}]),$.isArray(e)||(e=[e]);var a=new frappe.ui.Dialog({fields:e,title:r||__("Enter Value")});return a.set_primary_action(n||__("Submit"),function(){var e=a.get_values();e&&(a.hide(),t(e))}),a.show(),a},frappe.msgprint=function(e,t,r){if(e){if($.isPlainObject(e))var n=e;else if("string"==typeof e&&"{"===e.substr(0,1))n=JSON.parse(e);else n={message:e,title:t};if(n.indicator||(n.indicator="blue"),n.message instanceof Array)n.message.forEach(function(e){frappe.msgprint(e)});else{if(!n.alert){if(frappe.msg_dialog||(frappe.msg_dialog=new frappe.ui.Dialog({title:__("Message"),onhide:function(){frappe.msg_dialog.custom_onhide&&frappe.msg_dialog.custom_onhide(),frappe.msg_dialog.msg_area.empty()},minimizable:n.is_minimizable||r}),frappe.msg_dialog.msg_area=$('<div class="msgprint">').appendTo(frappe.msg_dialog.body),frappe.msg_dialog.clear=function(){frappe.msg_dialog.msg_area.empty()},frappe.msg_dialog.indicator=frappe.msg_dialog.header.find(".indicator")),n.primary_action){if(n.primary_action.server_action&&"string"==typeof n.primary_action.server_action&&(n.primary_action.action=function(){frappe.call({method:n.primary_action.server_action,args:{args:n.primary_action.args},callback:function(){n.primary_action.hide_on_success&&frappe.hide_msgprint()}})}),n.primary_action.client_action&&"string"==typeof n.primary_action.client_action){for(var a=n.primary_action.client_action.split("."),i=window,o=0,s=a;o<s.length;o+=1){var l=s[o];i=i[l]}n.primary_action.action=function(){"function"==typeof i&&i(n.primary_action.args)}}frappe.msg_dialog.set_primary_action(__(n.primary_action.label||"Done"),n.primary_action.action)}else frappe.msg_dialog.has_primary_action&&(frappe.msg_dialog.get_primary_btn().addClass("hide"),frappe.msg_dialog.has_primary_action=!1);n.secondary_action&&(frappe.msg_dialog.set_secondary_action(n.secondary_action.action),frappe.msg_dialog.set_secondary_action_label(__(n.secondary_action.label||"Close"))),null==n.message&&(n.message=""),-1==n.message.search(/<br>|<p>|<li>/)&&(e=frappe.utils.replace_newlines(n.message));var p=!1;return n.clear?frappe.msg_dialog.msg_area.empty():p=frappe.msg_dialog.msg_area.html(),!n.title&&p||frappe.msg_dialog.set_title(n.title||__("Message")),n.indicator?frappe.msg_dialog.indicator.removeClass().addClass("indicator "+n.indicator):frappe.msg_dialog.indicator.removeClass().addClass("hidden"),n.wide?frappe.msg_dialog.wrapper.classList.contains("msgprint-dialog")&&frappe.msg_dialog.wrapper.classList.remove("msgprint-dialog"):frappe.msg_dialog.wrapper.classList.add("msgprint-dialog"),n.scroll?frappe.msg_dialog.body.classList.add("msgprint-scroll"):frappe.msg_dialog.body.classList.contains("msgprint-scroll")&&frappe.msg_dialog.body.classList.remove("msgprint-scroll"),p&&frappe.msg_dialog.msg_area.append("<hr>"),frappe.msg_dialog.msg_area.append(n.message),frappe.msg_dialog.$wrapper.css("z-index",2e3),frappe.msg_dialog.show(),frappe.msg_dialog}frappe.show_alert(n)}}},window.msgprint=frappe.msgprint,frappe.hide_msgprint=function(e){frappe.msg_dialog&&frappe.msg_dialog.msg_area&&frappe.msg_dialog.msg_area.empty(),frappe.msg_dialog&&frappe.msg_dialog.$wrapper.is(":visible")&&(e&&frappe.msg_dialog.$wrapper.removeClass("fade"),frappe.msg_dialog.hide(),e&&frappe.msg_dialog.$wrapper.addClass("fade"))},frappe.update_msgprint=function(e){!frappe.msg_dialog||frappe.msg_dialog&&!frappe.msg_dialog.$wrapper.is(":visible")?frappe.msgprint(e):frappe.msg_dialog.msg_area.html(e)},frappe.verify_password=function(e){frappe.prompt({fieldname:"password",label:__("Enter your password"),fieldtype:"Password",reqd:1},function(t){frappe.call({method:"frappe.core.doctype.user.user.verify_password",args:{password:t.password},callback:function(t){t.exc||e()}})},__("Verify Password"),__("Verify"))},frappe.show_progress=function(e,t,r,n){if(void 0===r&&(r=100),frappe.cur_progress&&frappe.cur_progress.title===e&&frappe.cur_progress.is_visible)var a=frappe.cur_progress;else(a=new frappe.ui.Dialog({title:e})).progress=$('<div>\n\t\t\t<div class="progress">\n\t\t\t\t<div class="progress-bar"></div>\n\t\t\t</div>\n\t\t\t<p class="description text-muted small"></p>\n\t\t</div').appendTo(a.body),a.progress_bar=a.progress.css({"margin-top":"10px"}).find(".progress-bar"),a.$wrapper.removeClass("fade"),a.show(),frappe.cur_progress=a;return n&&a.progress.find(".description").text(n),a.percent=cint(100*flt(t)/r),a.progress_bar.css({width:a.percent+"%"}),a},frappe.hide_progress=function(){frappe.cur_progress&&(frappe.cur_progress.hide(),frappe.cur_progress=null)},frappe.show_alert=function(e,t,r){var n;void 0===t&&(t=7),void 0===r&&(r={}),"string"==typeof e&&(e={message:e}),$("#dialog-container").length||$('<div id="dialog-container"><div id="alert-container"></div></div>').appendTo("body"),e.body&&(n=e.body);var a=$('\n\t\t<div class="alert desk-alert">\n\t\t\t<div class="alert-message small"></div>\n\t\t\t<div class="alert-body" style="display: none"></div>\n\t\t\t<a class="close">&times;</a>\n\t\t</div>');return e.indicator&&a.find(".alert-message").append('<span class="indicator '+e.indicator+'"></span>'),a.find(".alert-message").append(e.message),n&&a.find(".alert-body").show().html(n),a.hide().appendTo("#alert-container").show().css("transform","translateX(0)"),a.find(".close, button").click(function(){return a.remove(),!1}),Object.keys(r).map(function(e){a.find("[data-action="+e+"]").on("click",r[e])}),a.delay(1e3*t).fadeOut(300),a},Object.defineProperty(window,"show_alert",{get:function(){return console.warn("Please use `frappe.show_alert` instead of `show_alert`. It will be deprecated soon."),frappe.show_alert}}),frappe.provide("frappe.ui.keys");var shortcut_groups=new WeakMap,shortcut_group_list=[];frappe.ui.keys.shortcut_groups=shortcut_groups,frappe.ui.keys.get_shortcut_group=function(e){return shortcut_groups.has(e)||shortcut_groups.set(e,new frappe.ui.keys.AltShortcutGroup),shortcut_groups.get(e)};var listener_added=!1,$current_dropdown=null,$body=$(document.body);function get_shortcut_for_key(e){var t=shortcut_group_list.filter(function(t){return e in t.shortcuts_dict}).map(function(t){return t.shortcuts_dict[e]}).filter(function(e){return e.$target.is(":visible")}),r=null;return $current_dropdown&&$current_dropdown.is(".open")&&(r=t.find(function(e){return $.contains($current_dropdown[0],e.$target[0])})),r||(r=t.find(function(e){return $.contains(window.cur_page.page.page.wrapper[0],e.$target[0])}))}frappe.ui.keys.bind_shortcut_group_event=function(){function e(){$current_dropdown?($current_dropdown.addClass("alt-pressed"),$body.removeClass("alt-pressed")):($body.addClass("alt-pressed"),$current_dropdown&&$current_dropdown.removeClass("alt-pressed"))}function t(){$current_dropdown&&$current_dropdown.removeClass("alt-pressed"),$body.removeClass("alt-pressed")}listener_added||(listener_added=!0,$(document).on("keydown",function(t){var r=(frappe.ui.keys.key_map[t.which]||"").toLowerCase();if("alt"===r&&e(),!(t.shiftKey||t.ctrlKey||t.metaKey)&&r&&t.altKey){var n=get_shortcut_for_key(r);n&&(t.preventDefault(),n.$target[0].click()),e()}}),$(document).on("keyup",function(e){"Alt"===e.key&&t()}),$(document).on("mousemove",function(){t()}))},frappe.ui.keys.AltShortcutGroup=class{constructor(){this.shortcuts_dict={},$current_dropdown=null,this.bind_events(),frappe.ui.keys.bind_shortcut_group_event(),shortcut_group_list.push(this)}bind_events(){$(document).on("show.bs.dropdown",function(e){$current_dropdown&&$current_dropdown.removeClass("alt-pressed");var t=$(e.target);t.is(".dropdown, .btn-group")&&($current_dropdown=t)}),$(document).on("hide.bs.dropdown",function(){$current_dropdown&&$current_dropdown.removeClass("alt-pressed"),$current_dropdown=null})}add(e,t){var r=this;t||(t=e);var n=t.text().trim(),a=n.split("").find(function(e){var t=(e=e.toLowerCase())>="a"&&e<="z";return!r.is_taken(e)&&t});if(a){for(var i in this.shortcuts_dict){var o=this.shortcuts_dict[i];if(o.text===n)return o.$target=e,o.$text_el=t,void this.underline_text(o)}var s={$target:e,$text_el:t,letter:a,text:n};this.shortcuts_dict[a.toLowerCase()]=s,this.underline_text(s)}}underline_text(e){e.$text_el.attr("data-label",e.text);var t=!1,r=e.text.split("").map(function(r){return r!==e.letter||t||(r='<span class="alt-underline">'+r+"</span>",t=!0),r}).join("");r=e.$text_el.html().replace(e.text.trim(),r.trim()),e.$text_el.html(r)}is_taken(e){var t=frappe.ui.keys.standard_shortcuts.filter(function(e){return!e.page}).some(function(t){return t.shortcut==="alt+"+e});return e in this.shortcuts_dict||t}},frappe.provide("frappe.ui.keys.handlers"),frappe.ui.keys.setup=function(){$(window).on("keydown",function(e){var t=frappe.ui.keys.get_key(e);if(frappe.ui.keys.handlers[t]){for(var r=null,n=0,a=frappe.ui.keys.handlers[t].length;n<a;n++){var i=frappe.ui.keys.handlers[t][n].apply(this,[e]);!1===i&&(r=i)}return r}})};var standard_shortcuts=[];function close_grid_and_dialog(){var e=$(".grid-row-open");return e.length?(e.data("grid_row").toggle_view(!1),!1):cur_dialog&&!cur_dialog.no_cancel_flag?(cur_dialog.cancel(),!1):void 0}frappe.ui.keys.standard_shortcuts=standard_shortcuts,frappe.ui.keys.add_shortcut=function(e){void 0===e&&(e={});var t=e.shortcut,r=e.action,n=e.description,a=e.page,i=e.target,o=e.condition,s=e.ignore_inputs;if(void 0===s&&(s=!1),i instanceof jQuery){var l=i;r=function(){l[0].click()}}o||(o=function(){return!0});var p=function(e){if((!$(document.activeElement).is("input, select, textarea, [contenteditable=true]")||s)&&o()&&(!a||a.wrapper.is(":visible"))){var t=r(e);(t||void 0===t)&&e.preventDefault()}};p.page=a,frappe.ui.keys.off(t,a),frappe.ui.keys.on(t,p);var c=standard_shortcuts.findIndex(function(e){return e.shortcut===t}),d={shortcut:t,action:r,description:n,page:a,condition:o};-1===c?standard_shortcuts.push(d):standard_shortcuts[c]=d},frappe.ui.keys.show_keyboard_shortcut_dialog=function(){if(!frappe.ui.keys.is_dialog_shown){var e=standard_shortcuts.filter(function(e){return!e.page}),t=standard_shortcuts.filter(function(e){return e.page&&e.page===window.cur_page.page.page}),r=i(e,__("Global Shortcuts")),n=i(t,__("Page Shortcuts")),a=new frappe.ui.Dialog({title:__("Keyboard Shortcuts"),on_hide:function(){frappe.ui.keys.is_dialog_shown=!1}});a.$body.append(r),a.$body.append(n),a.$body.append('\n\t\t<div class="text-muted">\n\t\t\t'+__("Press Alt Key to trigger additional shortcuts in Menu and Sidebar")+"\n\t\t</div>\n\t"),a.show(),frappe.ui.keys.is_dialog_shown=!0}function i(e,t){if(!e.length)return"";var r=e.filter(function(e){return!e.condition||e.condition()}).map(function(e){var t=e.shortcut.split("+").map(frappe.utils.to_title_case).join("+");return frappe.utils.is_mac()&&(t=t.replace("Ctrl","⌘")),'<tr>\n\t\t\t\t\t<td width="40%"><kbd>'+t+'</kbd></td>\n\t\t\t\t\t<td width="60%">'+(e.description||"")+"</td>\n\t\t\t\t</tr>"}).join("");return r='<h5 style="margin: 0;">'+t+'</h5>\n\t\t\t<table style="margin-top: 10px;" class="table table-bordered">\n\t\t\t\t'+r+"\n\t\t\t</table>"}},frappe.ui.keys.get_key=function(e){var t=e.keyCode||e.which,r=frappe.ui.keys.key_map[t]||String.fromCharCode(t);return(e.ctrlKey||e.metaKey)&&(r="ctrl+"+r),e.shiftKey&&(r="shift+"+r),e.altKey&&(r="alt+"+r),e.altKey&&e.ctrlKey,r.toLowerCase()},frappe.ui.keys.on=function(e,t){frappe.ui.keys.handlers[e]||(frappe.ui.keys.handlers[e]=[]),frappe.ui.keys.handlers[e].push(t)},frappe.ui.keys.off=function(e,t){var r=frappe.ui.keys.handlers[e];r&&0!==r.length&&(frappe.ui.keys.handlers[e]=r.filter(function(e){return!!t&&e.page!==t}))},frappe.ui.keys.add_shortcut({shortcut:"ctrl+s",action:function(e){return frappe.app.trigger_primary_action(),e.preventDefault(),!1},description:__("Trigger Primary Action"),ignore_inputs:!0}),frappe.ui.keys.add_shortcut({shortcut:"ctrl+g",action:function(e){return $("#navbar-search").focus(),e.preventDefault(),!1},description:__("Open Awesomebar")}),frappe.ui.keys.add_shortcut({shortcut:"ctrl+h",action:function(e){e.preventDefault(),$(".navbar-home img").click()},description:__("Navigate Home")}),frappe.ui.keys.add_shortcut({shortcut:"alt+s",action:function(e){e.preventDefault(),$(".dropdown-navbar-user a").eq(0).click()},description:__("Open Settings")}),frappe.ui.keys.add_shortcut({shortcut:"shift+/",action:function(){frappe.ui.keys.show_keyboard_shortcut_dialog()},description:__("Show Keyboard Shortcuts")}),frappe.ui.keys.add_shortcut({shortcut:"alt+h",action:function(e){e.preventDefault(),$(".dropdown-help a").eq(0).click()},description:__("Open Help")}),frappe.ui.keys.on("escape",function(e){close_grid_and_dialog()}),frappe.ui.keys.on("esc",function(e){close_grid_and_dialog()}),frappe.ui.keys.on("enter",function(e){window.cur_dialog&&cur_dialog.confirm_dialog&&cur_dialog.get_primary_btn().trigger("click")}),frappe.ui.keys.on("ctrl+down",function(e){var t=frappe.ui.form.get_open_grid_form();t&&t.toggle_view(!1,function(){t.open_next()})}),frappe.ui.keys.on("ctrl+up",function(e){var t=frappe.ui.form.get_open_grid_form();t&&t.toggle_view(!1,function(){t.open_prev()})}),frappe.ui.keys.add_shortcut({shortcut:"shift+ctrl+r",action:function(){frappe.ui.toolbar.clear_cache()},description:__("Clear Cache and Reload")}),frappe.ui.keys.key_map={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",91:"meta",18:"alt",27:"escape",37:"left",39:"right",38:"up",40:"down",32:"space",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",191:"/",188:"<",190:">"},"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(e,t){frappe.ui.keys.key_map[65+t]=e}),frappe.ui.keyCode={ESCAPE:27,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,TAB:9,SPACE:32,BACKSPACE:8},$(document).on("keydown",".dropdown-toggle",function(e){e.which===frappe.ui.keyCode.ESCAPE&&$(e.currentTarget).blur()}),frappe.provide("frappe.ui"),frappe.ui.color_map={red:["#ffc4c4","#ff8989","#ff4d4d","#a83333"],brown:["#ffe8cd","#ffd19c","#ffb868","#a87945"],orange:["#ffd2c2","#ffa685","#ff7846","#a85b5b"],peach:["#ffd7d7","#ffb1b1","#ff8989","#a84f2e"],yellow:["#fffacd","#fff168","#fff69c","#a89f45"],yellowgreen:["#ebf8cc","#d9f399","#c5ec63","#7b933d"],green:["#cef6d1","#9deca2","#6be273","#428b46"],cyan:["#d2f8ed","#a4f3dd","#77ecca","#49937e"],skyblue:["#d2f1ff","#a6e4ff","#78d6ff","#4f8ea8"],blue:["#d2d2ff","#a3a3ff","#7575ff","#4d4da8"],purple:["#dac7ff","#b592ff","#8e58ff","#5e3aa8"],pink:["#f8d4f8","#f3aaf0","#ec7dea","#934f92"],white:["#d1d8dd","#fafbfc","#ffffff",""],black:["#8D99A6","#6c7680","#36414c","#212a33"]},frappe.ui.color={get:function(e,t){return e&&t?this.get_color_shade(e,t):e?this.get_color_shade(e,"default"):frappe.ui.color_map},get_color:function(e){var t=Object.keys(frappe.ui.color_map);if(t.includes(e))return frappe.ui.color_map[e];console.warn("'color_name' can be one of "+t+" and not "+e)},get_color_shade:function(e,t){var r={default:2,light:1,"extra-light":0,dark:3};if(Object.keys(r).includes(t))return frappe.ui.color_map[e][r[t]];console.warn("'shade' can be one of "+Object.keys(r)+" and not "+t)},all:function(){return Object.values(frappe.ui.color_map).reduce(function(e,t){return e.concat(t)},[])},names:function(){return Object.keys(frappe.ui.color_map)},is_standard:function(e){return!!e&&(e.startsWith("#")?this.all().includes(e):this.names().includes(e))},get_color_name:function(e){for(var t in frappe.ui.color_map){if(frappe.ui.color_map[t].includes(e))return t}},get_contrast_color:function(e){if(this.validate_hex(e)){if(!this.is_standard(e))return this.brightness(e)<128?this.lighten(e,.5):this.lighten(e,-.5);var t=this.get_color_name(e);return this.get_color(t).indexOf(e)<=1?this.get(t,"dark"):this.get(t,"extra-light")}},validate_hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},lighten:function(e,t){var r=parseInt(e.slice(1),16),n=t<0?0:255,a=t<0?-1*t:t,i=r>>16,o=r>>8&255,s=255&r;return"#"+(16777216+65536*(Math.round((n-i)*a)+i)+256*(Math.round((n-o)*a)+o)+(Math.round((n-s)*a)+s)).toString(16).slice(1)},hex_to_rgb:function(e){return e.startsWith("#")&&(e=e.substring(1)),{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}},brightness:function(e){var t=this.hex_to_rgb(e);return(299*t.r+587*t.g+114*t.b)/1e3}},frappe.provide("frappe.ui"),frappe.ui.Sidebar=class{constructor(e){var t=e.wrapper,r=e.css_class;this.wrapper=t,this.css_class=r,this.items={},this.make_dom()}make_dom(){this.wrapper.html('\n\t\t\t<div class="'+this.css_class+' overlay-sidebar hidden-xs hidden-sm">\n\t\t\t</div>\n\t\t'),this.$sidebar=this.wrapper.find("."+this.css_class)}add_item(e,t,r){var n,a;if(void 0===r&&(r=!1),n=t||0!==this.wrapper.find(".sidebar-menu").length?this.get_section(t):this.get_section(),e instanceof jQuery)a=$("<li>"),e.appendTo(a);else{var i="<li class="+(r?"h6":"")+">\n\t\t\t\t<a "+(e.href?'href="'+e.href+'"':"")+">"+e.label+"</a>\n\t\t\t</li>";a=$(i).click(function(){return e.on_click&&e.on_click()})}n.append(a),e.name&&(this.items[e.name]=a)}remove_item(e){this.items[e]&&this.items[e].remove()}get_section(e){void 0===e&&(e="");var t=$(this.wrapper.find('[data-section-heading="'+e+'"]'));return t.length?t:(t=$('\n\t\t\t<ul class="list-unstyled sidebar-menu" data-section-heading="'+(e||"default")+'">\n\t\t\t\t'+(e?'<li class="h6">'+e+"</li>":"")+"\n\t\t\t</ul>\n\t\t"),this.$sidebar.append(t),t)}},frappe.ui.LinkPreview=class{constructor(){this.popovers_list=[],this.LINK_CLASSES='a[data-doctype], input[data-fieldtype="Link"], .popover',this.popover_timeout=null,this.setup_events()}setup_events(){var e=this;$(document.body).on("mouseover",this.LINK_CLASSES,function(t){e.link_hovered=!0,e.element=$(t.currentTarget),e.is_link="a"===e.element.get(0).tagName.toLowerCase(),e.element.parents().find(".popover").length||(e.identify_doc(),e.popover=e.element.data("bs.popover"),e.name&&e.doctype&&e.setup_popover_control(t))}),this.handle_popover_hide()}identify_doc(){this.is_link?(this.doctype=this.element.attr("data-doctype"),this.name=this.element.attr("data-name"),this.href=this.element.attr("href")):(this.href=this.element.parents(".control-input-wrapper").find(".control-value a").attr("href"),this.doctype=this.element.attr("data-target"),this.name=this.element.val())}setup_popover_control(e){var t=this;(frappe.boot.link_preview_doctypes||[]).includes(this.doctype)&&(this.element.on("change",function(){t.new_popover=!0}),!this.popover||this.new_popover?this.data_timeout=setTimeout(function(){t.create_popover(e)},100):this.popover_timeout=setTimeout(function(){t.element.is(":focus")||t.show_popover(e)},1e3))}create_popover(e){var t=this;this.new_popover=!1,this.element.is(":focus")||this.get_preview_data().then(function(r){r&&(t.popover_timeout&&clearTimeout(t.popover_timeout),t.popover_timeout=setTimeout(function(){if(t.popover){var n=t.get_popover_html(r);t.popover.options.content=n}else t.init_preview_popover(r);t.show_popover(e)},1e3))})}show_popover(e){var t=this;if(this.default_timeout=setTimeout(function(){t.clear_all_popovers()},1e4),this.is_link)this.element.popover("show");else{var r=e.pageX;this.element.popover("show");var n=$(".popover").width();$(".control-field-popover").css("left",r-n/2+"px")}}handle_popover_hide(){var e=this;$(document).on("mouseout",this.LINK_CLASSES,function(){$(".popover:hover").length||(e.link_hovered=!1),e.link_hovered||(e.data_timeout&&clearTimeout(e.data_timeout),e.popover_timeout&&clearTimeout(e.popover_timeout),e.default_timeout&&clearTimeout(e.default_timeout),e.clear_all_popovers())}),$(window).on("hashchange",function(){e.clear_all_popovers()})}clear_all_popovers(){this.popovers_list.forEach(function(e){return e.hide()})}get_preview_data(){return frappe.xcall("frappe.desk.link_preview.get_preview_data",{doctype:this.doctype,docname:this.name})}init_preview_popover(e){var t=this.get_popover_html(e);this.element.popover({container:"body",html:!0,content:t,trigger:"manual",placement:"top auto",animation:!1});var r=this.element.data("bs.popover").tip();r.addClass("link-preview-popover"),r.toggleClass("control-field-popover",this.is_link),this.popovers_list.push(this.element.data("bs.popover"))}get_popover_html(e){this.href||(this.href=window.location.href),this.href&&this.href.includes(" ")&&(this.href=this.href.replace(new RegExp(" ","g"),"%20"));var t="",r="",n="";e.preview_image&&(t='\n\t\t\t\t<div class="preview-header">\n\t\t\t\t\t<img src="'+encodeURI(e.preview_image)+'" onerror="this.src=\'/assets/frappe/images/fallback-thumbnail.jpg\'" class="preview-image"></img>\n\t\t\t\t</div>\n\t\t\t');return e.preview_title!=e.name&&(r='<a class="text-muted" href='+this.href+">"+e.name+"</a>"),Object.keys(e).forEach(function(t){if(!["preview_image","preview_title","name"].includes(t)){var r=frappe.ellipsis(e[t],280);n+="\n\t\t\t\t\t<div class=\"preview-field\">\n\t\t\t\t\t\t<div class='small preview-label text-muted bold'>"+t+'</div>\n\t\t\t\t\t\t<div class="small preview-value">'+r+"</div>\n\t\t\t\t\t</div>\n\t\t\t\t"}}),n='<div class="preview-table">'+n+"</div>",'\n\t\t\t<div class="preview-popover-header">'+t+'\n\t\t\t\t<div class="preview-header">\n\t\t\t\t\t<div class="preview-main">\n\t\t\t\t\t\t<a class="preview-name bold" href='+this.href+">"+e.preview_title+'</a>\n\t\t\t\t\t\t<span class="text-muted small">'+this.doctype+" "+r+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<hr>\n\t\t\t<div class="popover-body">\n\t\t\t\t'+n+"\n\t\t\t</div>\n\t\t"}},frappe.provide("frappe.request"),frappe.provide("frappe.request.error_handlers"),frappe.request.url="/",frappe.request.ajax_count=0,frappe.request.waiting_for_ajax=[],frappe.xcall=function(e,t){return new Promise(function(r,n){frappe.call({method:e,args:t,callback:function(e){r(e.message)},error:function(e){n(e.message)}})})},frappe.call=function(e){if(!frappe.is_online())return frappe.show_alert({indicator:"orange",message:__("You are not connected to Internet. Retry after sometime.")},3),e.always&&e.always(),$.ajax();"string"==typeof arguments[0]&&(e={method:arguments[0],args:arguments[1],callback:arguments[2],headers:arguments[3]}),e.quiet&&(e.no_spinner=!0);var t=$.extend({},e.args);e.module&&e.page?t.cmd=e.module+".page."+e.page+"."+e.page+"."+e.method:e.doc?$.extend(t,{cmd:"runserverobj",docs:frappe.get_doc(e.doc.doctype,e.doc.name),method:e.method,args:e.args}):e.method&&(t.cmd=e.method);var r=e.url;if(!r){if(r="/api/method/"+t.cmd,window.cordova){var n=frappe.request.url;r=(n=n.slice(0,n.length-1))+r}delete t.cmd}return frappe.request.call({type:e.type||"POST",args:t,success:function(t,r){if(t.task_id)frappe.socketio.subscribe(t.task_id,e),e.queued&&e.queued(t);else if(e.callback)return e.callback(t,r)},error:e.error,always:e.always,btn:e.btn,freeze:e.freeze,freeze_message:e.freeze_message,headers:e.headers||{},error_handlers:e.error_handlers||{},async:e.async,silent:e.silent,url:r})},frappe.request.call=function(e){frappe.request.prepare(e);var t={200:function(t,r){e.success_callback&&e.success_callback(t,r.responseText)},401:function(e){frappe.app.session_expired_dialog&&frappe.app.session_expired_dialog.display?frappe.app.redirect_to_login():frappe.app.handle_session_expired()},404:function(e){frappe.msgprint({title:__("Not found"),indicator:"red",message:__("The resource you are looking for is not available")})},403:function(e){if("Guest"===frappe.session.user)frappe.app.handle_session_expired();else if(e.responseJSON&&e.responseJSON._error_message)frappe.msgprint({title:__("Not permitted"),indicator:"red",message:e.responseJSON._error_message}),e.responseJSON._server_messages=null;else if(e.responseJSON&&e.responseJSON._server_messages){if(-1!==JSON.parse(e.responseJSON._server_messages).indexOf(__("Not permitted")))return}else frappe.msgprint({title:__("Not permitted"),indicator:"red",message:__("You do not have enough permissions to access this resource. Please contact your manager to get access.")})},508:function(e){frappe.utils.play_sound("error"),frappe.msgprint({title:__("Please try again"),indicator:"red",message:__("Another transaction is blocking this one. Please try again in a few seconds.")})},413:function(e,t){frappe.msgprint({indicator:"red",title:__("File too big"),message:__("File size exceeded the maximum allowed size of {0} MB",[(frappe.boot.max_file_size||5242880)/1048576])})},417:function(t){var r=t.responseJSON;if(!r)try{r=JSON.parse(t.responseText)}catch(e){r=t.responseText}e.error_callback&&e.error_callback(r)},501:function(t,r){"string"==typeof t&&(t=JSON.parse(t)),e.error_callback&&e.error_callback(t,r.responseText)},500:function(t){frappe.utils.play_sound("error");try{e.error_callback&&e.error_callback(),frappe.request.report_error(t,e)}catch(r){frappe.request.report_error(t,e)}},504:function(t){frappe.msgprint(__("Request Timed Out")),e.error_callback&&e.error_callback()},502:function(e){frappe.msgprint(__("Internal Server Error"))}},r={url:e.url||frappe.request.url,data:e.args,type:e.type,dataType:e.dataType||"json",async:e.async,headers:Object.assign({"X-Frappe-CSRF-Token":frappe.csrf_token,Accept:"application/json","X-Frappe-CMD":e.args&&e.args.cmd||""},e.headers),cache:!1};return e.args&&e.args.doctype&&(r.headers["X-Frappe-Doctype"]=encodeURIComponent(e.args.doctype)),frappe.last_request=r.data,$.ajax(r).done(function(e,r,n){try{"string"==typeof e&&(e=JSON.parse(e)),(e.docs||e.docinfo)&&frappe.model.sync(e),e.__messages&&$.extend(frappe._messages,e.__messages);var a=t[n.statusCode().status];a&&a(e,n)}catch(e){console.log("Unable to handle success response"),console.trace(e)}}).always(function(t,r,n){try{if("string"==typeof t&&(t=JSON.parse(t)),t.responseText){t=JSON.parse(t.responseText)}}catch(e){t=null}frappe.request.cleanup(e,t),e.always&&e.always(t)}).fail(function(r,n){try{var a=t[r.statusCode().status];a?a(r):e.error_callback&&e.error_callback(r)}catch(e){console.log("Unable to handle failed response"),console.trace(e)}})},frappe.request.prepare=function(e){for(var t in $("body").attr("data-ajax-state","triggered"),e.btn&&$(e.btn).prop("disabled",!0),e.freeze&&frappe.dom.freeze(e.freeze_message),e.args)e.args[t]&&($.isPlainObject(e.args[t])||$.isArray(e.args[t]))&&(e.args[t]=JSON.stringify(e.args[t]));if(!e.args.cmd&&!e.url)throw console.log(e),"Incomplete Request";e.success_callback=e.success,e.error_callback=e.error,delete e.success,delete e.error},frappe.request.cleanup=function(e,t){if(e.btn&&$(e.btn).prop("disabled",!1),$("body").attr("data-ajax-state","complete"),e.freeze&&frappe.dom.unfreeze(),t){if(t.session_expired||"Guest"===frappe.session.user)return void frappe.app.handle_session_expired();var r=frappe.request.error_handlers[t.exc_type]||[],n=e.error_handlers?e.error_handlers[t.exc_type]:null,a=[].concat(r,n).filter(Boolean);t.exc_type&&a.forEach(function(e){e(t)}),t._server_messages&&!e.silent&&0===a.length&&(t._server_messages=JSON.parse(t._server_messages),frappe.hide_msgprint(),frappe.msgprint(t._server_messages)),t.exc&&(t.exc=JSON.parse(t.exc),t.exc instanceof Array?$.each(t.exc,function(e,t){t&&console.log(t)}):console.log(t.exc)),t._debug_messages&&(e.args&&(console.log("======== arguments ========"),console.log(e.args),console.log("========")),$.each(JSON.parse(t._debug_messages),function(e,t){console.log(t)}),console.log("======== response ========"),delete t._debug_messages,console.log(t),console.log("========"))}frappe.last_response=t},frappe.after_server_call=function(){return frappe.request.ajax_count?new Promise(function(e){frappe.request.waiting_for_ajax.push(function(){e()})}):null},frappe.after_ajax=function(e){return new Promise(function(t){if(frappe.request.ajax_count)frappe.request.waiting_for_ajax.push(function(){if(e)return t(e());t()});else{if(e)return t(e());t()}})},frappe.request.report_error=function(e,t){var r,n=JSON.parse(e.responseText);if(n.exc){try{r=(JSON.parse(n.exc)||[]).join("\n")}catch(e){r=n.exc}delete n.exc}else r="";if(r){var a=frappe.boot.error_report_email;t=frappe.request.cleanup_request_opts(t),frappe.error_dialog||(frappe.error_dialog=new frappe.ui.Dialog({title:"Server Error",primary_action_label:__("Report"),primary_action:function(){var e;a?(e=["<h5>Please type some additional information that could help us reproduce this issue:</h5>",'<div style="min-height: 100px; border: 1px solid #bbb; \t\t\t\tborder-radius: 5px; padding: 15px; margin-bottom: 15px;"></div>',"<hr>","<h5>App Versions</h5>","<pre>"+JSON.stringify(frappe.boot.versions,null,"\t")+"</pre>","<h5>Route</h5>","<pre>"+frappe.get_route_str()+"</pre>","<hr>","<h5>Error Report</h5>","<pre>"+r+"</pre>","<hr>","<h5>Request Data</h5>","<pre>"+JSON.stringify(t,null,"\t")+"</pre>","<hr>","<h5>Response JSON</h5>","<pre>"+JSON.stringify(n,null,"\t")+"</pre>"].join("\n"),new frappe.views.CommunicationComposer({subject:"Error Report ["+frappe.datetime.nowdate()+"]",recipients:a,message:e,doc:{doctype:"User",name:frappe.session.user}}).dialog.$wrapper.css("z-index",cint(frappe.msg_dialog.$wrapper.css("z-index"))+1)):frappe.msgprint(__("Support Email Address Not Specified")),frappe.error_dialog.hide()}}),frappe.error_dialog.wrapper.classList.add("msgprint-dialog"));var i=strip(r).split("\n");frappe.error_dialog.$body.html(i[i.length-1]),frappe.error_dialog.show()}},frappe.request.cleanup_request_opts=function(e){var t=(e.args||{}).doc;return t&&(t=JSON.parse(t),$.each(Object.keys(t),function(e,r){-1!==r.indexOf("password")&&t[r]&&(t[r]="*****")}),e.args.doc=JSON.stringify(t)),e},frappe.request.on_error=function(e,t){frappe.request.error_handlers[e]=frappe.request.error_handlers[e]||[],frappe.request.error_handlers[e].push(t)},$(document).ajaxSend(function(){frappe.request.ajax_count++}),$(document).ajaxComplete(function(){frappe.request.ajax_count--,frappe.request.ajax_count||($.each(frappe.request.waiting_for_ajax||[],function(e,t){t()}),frappe.request.waiting_for_ajax=[])}),frappe.socketio={open_tasks:{},open_docs:[],emit_queue:[],init:function(port){void 0===port&&(port=3e3),window.io&&(frappe.boot.disable_async||frappe.socketio.socket||("https:"==window.location.protocol?frappe.socketio.socket=io.connect(frappe.socketio.get_host(port),{secure:!0}):"http:"==window.location.protocol?frappe.socketio.socket=io.connect(frappe.socketio.get_host(port)):"file:"==window.location.protocol&&(frappe.socketio.socket=io.connect(window.localStorage.server)),frappe.socketio.socket?(frappe.socketio.socket.on("msgprint",function(e){frappe.msgprint(e)}),frappe.socketio.socket.on("eval_js",function(message){eval(message)}),frappe.socketio.socket.on("progress",function(e){e.progress&&(e.percent=flt(e.progress[0])/e.progress[1]*100),e.percent&&(100==e.percent?frappe.hide_progress():frappe.show_progress(e.title||__("Progress"),e.percent,100,e.description))}),frappe.socketio.setup_listeners(),frappe.socketio.setup_reconnect(),frappe.socketio.uploader=new frappe.socketio.SocketIOUploader,$(document).on("form-load form-rename",function(e,t){if(!t.is_new()){for(var r=0,n=frappe.socketio.open_docs.length;r<n;r++){var a=frappe.socketio.open_docs[r];if(t.doctype==a.doctype&&t.docname==a.name)return!1}frappe.socketio.doc_subscribe(t.doctype,t.docname)}}),$(document).on("form-refresh",function(e,t){t.is_new()||frappe.socketio.doc_open(t.doctype,t.docname)}),$(document).on("form-unload",function(e,t){t.is_new()||frappe.socketio.doc_close(t.doctype,t.docname)}),$(document).on("form-typing",function(e,t){frappe.socketio.form_typing(t.doctype,t.docname)}),$(document).on("form-stopped-typing",function(e,t){frappe.socketio.form_stopped_typing(t.doctype,t.docname)}),window.onbeforeunload=function(){cur_frm&&!cur_frm.is_new()&&cur_frm.doc&&frappe.socketio.doc_close(cur_frm.doctype,cur_frm.docname)}):console.log("Unable to connect to "+frappe.socketio.get_host(port))))},get_host:function(e){void 0===e&&(e=3e3);var t=window.location.origin;if(window.dev_server){var r=t.split(":");e=frappe.boot.socketio_port||e.toString()||"3000",r.length>2&&(t=r[0]+":"+r[1]),t=t+":"+e}return t},subscribe:function(e,t){frappe.socketio.socket.emit("task_subscribe",e),frappe.socketio.socket.emit("progress_subscribe",e),frappe.socketio.open_tasks[e]=t},task_subscribe:function(e){frappe.socketio.socket.emit("task_subscribe",e)},task_unsubscribe:function(e){frappe.socketio.socket.emit("task_unsubscribe",e)},doc_subscribe:function(e,t){frappe.flags.doc_subscribe?console.log("throttled"):(frappe.flags.doc_subscribe=!0,setTimeout(function(){frappe.flags.doc_subscribe=!1},1e3),frappe.socketio.socket.emit("doc_subscribe",e,t),frappe.socketio.open_docs.push({doctype:e,docname:t}))},doc_unsubscribe:function(e,t){frappe.socketio.socket.emit("doc_unsubscribe",e,t),frappe.socketio.open_docs=$.filter(frappe.socketio.open_docs,function(r){return r.doctype===e&&r.name===t?null:r})},doc_open:function(e,t){(!frappe.socketio.last_doc||frappe.socketio.last_doc[0]!=e&&frappe.socketio.last_doc[1]!=t)&&frappe.socketio.socket.emit("doc_open",e,t),frappe.socketio.last_doc=[e,t]},doc_close:function(e,t){frappe.socketio.socket.emit("doc_close",e,t),frappe.socketio.socket.emit("doc_typing_stopped",e,t)},form_typing:function(e,t){frappe.socketio.socket.emit("doc_typing",e,t)},form_stopped_typing:function(e,t){frappe.socketio.socket.emit("doc_typing_stopped",e,t)},setup_listeners:function(){frappe.socketio.socket.on("task_status_change",function(e){frappe.socketio.process_response(e,e.status.toLowerCase())}),frappe.socketio.socket.on("task_progress",function(e){frappe.socketio.process_response(e,"progress")})},setup_reconnect:function(){frappe.socketio.socket.on("connect",function(){setTimeout(function(){$.each(frappe.socketio.open_tasks,function(e,t){frappe.socketio.subscribe(e,t)}),$.each(frappe.socketio.open_docs,function(e){locals[e.doctype]&&locals[e.doctype][e.name]&&frappe.socketio.doc_subscribe(e.doctype,e.name)}),cur_frm&&cur_frm.doc&&frappe.socketio.doc_open(cur_frm.doc.doctype,cur_frm.doc.name)},5e3)})},process_response:function(e,t){if(e){var r=frappe.socketio.open_tasks[e.task_id];r[t]&&r[t](e),"success"===t&&r.callback&&r.callback(e),frappe.request.cleanup(r,e),r.always&&r.always(e),e.status_code&&e.status_code>400&&r.error&&r.error(e)}}},frappe.provide("frappe.realtime"),frappe.realtime.on=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.on(e,t)},frappe.realtime.off=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.off(e,t)},frappe.realtime.publish=function(e,t){frappe.socketio.socket&&frappe.socketio.socket.emit(e,t)},frappe.socketio.SocketIOUploader=class{constructor(){var e=this;frappe.socketio.socket.on("upload-request-slice",function(t){var r=t.currentSlice*e.chunk_size,n=e.file.slice(r,r+Math.min(e.chunk_size,e.file.size-r));e.on_progress&&e.on_progress(r/e.file.size*100),e.reader.readAsArrayBuffer(n),e.started=!0,e.keep_alive()}),frappe.socketio.socket.on("upload-end",function(t){e.reader=null,e.file=null,"/public"===t.file_url.substr(0,7)&&(t.file_url=t.file_url.substr(7)),e.callback(t)}),frappe.socketio.socket.on("upload-error",function(t){e.disconnect(!1),frappe.msgprint({title:__("Upload Failed"),message:t.error,indicator:"red"})}),frappe.socketio.socket.on("disconnect",function(){e.disconnect()})}start(e){var t=this;void 0===e&&(e={});var r=e.file;void 0===r&&(r=null);var n=e.is_private;void 0===n&&(n=0);var a=e.filename;void 0===a&&(a="");var i=e.callback;void 0===i&&(i=null);var o=e.on_progress;void 0===o&&(o=null);var s=e.chunk_size;void 0===s&&(s=24576);var l=e.fallback;if(void 0===l&&(l=null),this.reader&&frappe.throw(__("File Upload in Progress. Please try again in a few moments.")),!frappe.socketio.socket.connected||frappe.boot.sysdefaults&&!frappe.boot.sysdefaults.use_socketio_to_upload_file)return l?l():frappe.throw(__("Socketio is not connected. Cannot upload"));this.reader=new FileReader,this.file=r,this.chunk_size=s,this.callback=i,this.on_progress=o,this.fallback=l,this.started=!1,this.reader.onload=function(){frappe.socketio.socket.emit("upload-accept-slice",{is_private:n,name:a,type:t.file.type,size:t.file.size,data:t.reader.result}),t.keep_alive()};var p=r.slice(0,this.chunk_size);this.reader.readAsArrayBuffer(p)}keep_alive(){var e=this;this.next_check&&clearTimeout(this.next_check),this.next_check=setTimeout(function(){e.started||(e.fallback?e.fallback():e.disconnect()),e.disconnect()},3e3)}disconnect(e){void 0===e&&(e=!0),this.reader&&(this.reader=null,this.file=null,frappe.hide_progress(),e&&frappe.msgprint({title:__("File Upload"),message:__("File Upload Disconnected. Please try again."),indicator:"red"}))}};var isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,fastDeepEqual=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){var n,a,i,o=isArray(t),s=isArray(r);if(o&&s){if((a=t.length)!=r.length)return!1;for(n=a;0!=n--;)if(!e(t[n],r[n]))return!1;return!0}if(o!=s)return!1;var l=t instanceof Date,p=r instanceof Date;if(l!=p)return!1;if(l&&p)return t.getTime()==r.getTime();var c=t instanceof RegExp,d=r instanceof RegExp;if(c!=d)return!1;if(c&&d)return t.toString()==r.toString();var u=keyList(t);if((a=u.length)!==keyList(r).length)return!1;for(n=a;0!=n--;)if(!hasProp.call(r,u[n]))return!1;for(n=a;0!=n--;)if(!e(t[i=u[n]],r[i]))return!1;return!0}return t!=t&&r!=r};frappe.provide("frappe.utils"),Object.assign(frappe.utils,{get_random:function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t},get_file_link:function(e){return e=cstr(e),frappe.utils.is_url(e)?e:-1===e.indexOf("/")?"files/"+e:e},replace_newlines:function(e){return e?e.replace(/\n/g,"<br>"):""},is_html:function(e){return!!e&&!(-1==e.indexOf("<br>")&&-1==e.indexOf("<p")&&-1==e.indexOf("<img")&&-1==e.indexOf("<div")&&!e.includes("<span"))},is_mac:function(){return"MacIntel"===window.navigator.platform},is_xs:function(){return $(document).width()<768},is_sm:function(){return $(document).width()<991&&$(document).width()>=768},is_md:function(){return $(document).width()<1199&&$(document).width()>=991},is_json:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},strip_whitespace:function(e){return(e||"").replace(/<p>\s*<\/p>/g,"").replace(/<br>(\s*<br>\s*)+/g,"<br><br>")},encode_tags:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;"};return e.replace(/[&<>]/g,function(e){return t[e]||e})},strip_original_content:function(e){var t=[],r=[],n=-1===e.indexOf("<br>")?"\n":"<br>";return $.each(e.split(n),function(e,n){var a=strip(n);!a||">"!==a.substr(0,1)&&"&gt;"!==a.substr(0,4)?(t.push(n),r=[]):r.push(n)}),t.join(n)},escape_html:function(e){return $("<div></div>").text(e||"").html()},html2text:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent},is_url:function(e){return"http://"==e.toLowerCase().substr(0,7)||"https://"==e.toLowerCase().substr(0,8)},to_title_case:function(e,t){void 0===t&&(t=!1);var r=t?" ":"";return e.toLowerCase().replace(/(?:^|[\s-/])\w/g,function(e){return e.toUpperCase()}).replace(/-|_/g,r)},toggle_blockquote:function(e){if(!e)return e;var t=$("<div></div>").html(e);return t.find("blockquote").parent("blockquote").addClass("hidden").before('<p><a class="text-muted btn btn-default toggle-blockquote" style="padding: 2px 7px 0px; line-height: 1;"> \t\t\t\t\t• • • \t\t\t\t</a></p>'),t.html()},scroll_to:function(e,t,r,n){n=n||$("html, body");var a=0;if(e&&"number"==typeof e)a=e;else if(e){var i=$(".navbar").height()+$(".page-head").height();a=$(e).offset().top-i-cint(r)}a<0&&(a=0),a!=n.scrollTop()&&(!1!==t?n.animate({scrollTop:a}):n.scrollTop(a))},filter_dict:function(e,t){var r=[];return"string"==typeof t?[e[t]]:($.each(e,function(e,n){for(var a in t)if($.isArray(t[a])){if("in"==t[a][0]){if(-1==t[a][1].indexOf(n[a]))return}else if("not in"==t[a][0]){if(-1!=t[a][1].indexOf(n[a]))return}else if("<"==t[a][0]){if(!(n[a]<t[a]))return}else if("<="==t[a][0]){if(!(n[a]<=t[a]))return}else if(">"==t[a][0]){if(!(n[a]>t[a]))return}else if(">="==t[a][0]&&!(n[a]>=t[a]))return}else if(n[a]!=t[a])return;r.push(n)}),r)},comma_or:function(e){return frappe.utils.comma_sep(e," "+__("or")+" ")},comma_and:function(e){return frappe.utils.comma_sep(e," "+__("and")+" ")},comma_sep:function(e,t){return e instanceof Array?0==e.length?"":1==e.length?e[0]:e.slice(0,e.length-1).join(", ")+t+e.slice(-1)[0]:e},set_footnote:function(e,t,r){return e||(e=$('<div class="text-muted footnote-area level">').appendTo(t)),r?e.html(r):(e.remove(),e=null),e},get_args_dict_from_url:function(e){var t={};return $.each(decodeURIComponent(e).split("&"),function(e,r){r=r.split("="),t[r[0]]=r[1]}),t},get_url_from_dict:function(e){return $.map(e,function(e,t){return null!==e?encodeURIComponent(t)+"="+encodeURIComponent(e):null}).join("&")||""},validate_type:function(e,t){var r;switch(t){case"phone":r=/^([0-9\ \+\_\-\,\.\*\#\(\)]){1,20}$/;break;case"name":r=/^[\w][\w'-]*([ \w][\w'-]+)*$/;break;case"number":r=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":r=/^\d+$/;break;case"alphanum":r=/^\w+$/;break;case"email":r=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;break;case"url":r=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;break;case"dateIso":r=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;default:return!1}return""!==e&&r.test(e)},guess_style:function(e,t,r){var n=t||"default",a="darkgrey";return e&&(has_words(["Pending","Review","Medium","Not Approved"],e)?(n="warning",a="orange"):has_words(["Open","Urgent","High","Failed","Rejected","Error"],e)?(n="danger",a="red"):has_words(["Closed","Finished","Converted","Completed","Complete","Confirmed","Approved","Yes","Active","Available","Paid","Success"],e)?(n="success",a="green"):has_words(["Submitted"],e)&&(n="info",a="blue")),r?a:n},guess_colour:function(e){return frappe.utils.guess_style(e,null,!0)},get_indicator_color:function(e){return frappe.db.get_list("Workflow State",{filters:{name:e},fields:["name","style"]}).then(function(e){var t=e[0];if(!t.style)return frappe.utils.guess_colour(t.name);return{Success:"green",Warning:"orange",Danger:"red",Primary:"blue"}[t.style]})},sort:function(e,t,r,n){if(!e||e.length<2)return e||[];var a={string:function(e,r){return cstr(e[t]).localeCompare(cstr(r[t]))},number:function(e,r){return flt(e[t])-flt(r[t])}};return r||(r="string"==typeof e[0][t]?"string":"number"),e.sort(a[r]),n&&e.reverse(),e},unique:function(e){for(var t={},r=[],n=0,a=e.length;n<a;n++)t.hasOwnProperty(e[n])||(t[e[n]]=null,r.push(e[n]));return r},remove_nulls:function(e){for(var t=[],r=0,n=e.length;r<n;r++)is_null(e[r])||t.push(e[r]);return t},all:function(e){for(var t=0,r=e.length;t<r;t++)if(!e[t])return!1;return!0},dict:function(e,t){var r=[];return $.each(t,function(t,n){var a={};$.each(e,function(e,t){a[t]=n[e]}),r.push(a)}),r},sum:function(e){return e.reduce(function(e,t){return flt(e)+flt(t)},0)},arrays_equal:function(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if($.isArray(e[r])){if(!frappe.utils.arrays_equal(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0},intersection:function(e,t){var r=0,n=0,a=new Array;for(e=[].concat(e).sort(),t=[].concat(t).sort();r<e.length&&n<t.length;)e[r]<t[n]?r++:e[r]>t[n]?n++:(a.push(e[r]),r++,n++);return a},resize_image:function(e,t,r,n){var a=new Image;r||(r=600),n||(n=400),a.src=e.result,a.onload=function(){var e=a.width,i=a.height;e>i?e>r&&(i*=r/e,e=r):i>n&&(e*=n/i,i=n);var o=document.createElement("canvas");o.width=e,o.height=i,o.getContext("2d").drawImage(this,0,0,e,i);var s=o.toDataURL("image/jpeg");setTimeout(function(){t(s)},10)}},csv_to_array:function(e,t){t=t||",";for(var r=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),n=[[]],a=null;a=r.exec(e);){var i,o=a[1];o.length&&o!==t&&n.push([]),i=a[2]?a[2].replace(new RegExp('""',"g"),'"'):a[3],n[n.length-1].push(i)}return n},warn_page_name_change:function(e){frappe.msgprint(__("Note: Changing the Page Name will break previous URL to this page."))},notify:function(e,t,r,n){console.log("push notifications are evil and deprecated")},set_title:function(e){frappe._original_title=e,frappe._title_prefix&&(e=frappe._title_prefix+" "+e.replace(/<[^>]*>/g,"")),document.title=e},set_title_prefix:function(e){frappe._title_prefix=e,frappe.utils.set_title(frappe._original_title)},is_image_file:function(e){return!!e&&(e=e.split("?")[0],/\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(e))},play_sound:function(e){try{if(frappe.boot.user.mute_sounds)return;var t=$("#sound-"+e)[0];t.volume=t.getAttribute("volume"),t.play()}catch(t){console.log("Cannot play sound",e,t)}},split_emails:function(e){var t=[];return e?(e.split(/[,\n](?=(?:[^"]|"[^"]*")*$)/g).forEach(function(e){(e=e.trim())&&t.push(e)}),t):t},supportsES6:function(){try{return new Function("(a = 0) => a"),!0}catch(e){return!1}}(),throttle:function(e,t,r){var n,a,i,o=null,s=0;r||(r={});var l=function(){s=!1===r.leading?0:Date.now(),o=null,i=e.apply(n,a),o||(n=a=null)};return function(){var p=Date.now();s||!1!==r.leading||(s=p);var c=t-(p-s);return n=this,a=arguments,c<=0||c>t?(o&&(clearTimeout(o),o=null),s=p,i=e.apply(n,a),o||(n=a=null)):o||!1===r.trailing||(o=setTimeout(l,c)),i}},debounce:function(e,t,r){var n;return function(){var a=this,i=arguments,o=r&&!n;clearTimeout(n),n=setTimeout(function(){n=null,r||e.apply(a,i)},t),o&&e.apply(a,i)}},get_form_link:function(e,t,r,n){void 0===r&&(r=!1),void 0===n&&(n=null),n=n||t;var a=["#Form",e=encodeURIComponent(e),t=encodeURIComponent(t)].join("/");return r?'<a href="'+a+'">'+n+"</a>":a},get_route_label:function(e){var t=e.split("/");return"Report"===t[2]||"query-report"===t[0]?__("{0} Report",[t[3]||t[1]]):"List"===t[0]?__("{0} List",[t[1]]):"modules"===t[0]?__("{0} Modules",[t[1]]):"dashboard"===t[0]?__("{0} Dashboard",[t[1]]):__(frappe.utils.to_title_case(t[0],!0))},report_column_total:function(e,t,r){return t.column.disable_total?"":e.length>0?"Percent"==t.column.fieldtype||"mean"===r?e.reduce(function(e,t){return e+flt(t)})/e.length:"Int"==t.column.fieldtype?e.reduce(function(e,t){return e+cint(t)}):frappe.model.is_numeric_field(t.column.fieldtype)?e.reduce(function(e,t){return e+flt(t)}):null:null},setup_search:function(e,t,r,n){var a=e.find('[data-element="search"]').show();a.focus().val("");var i=e.find(t).show();a.off("keyup").on("keyup",function(){var e=a.val().toLowerCase();e=e.replace(/^\s+|\s+$/g,"");for(var t=0;t<i.length;t++){var o=i.eq(t).find(r),s=o.text().toLowerCase(),l="";n&&o.attr(n)&&(l=o.attr(n).toLowerCase()),s.includes(e)||l.includes(e)?i.eq(t).css("display",""):i.eq(t).css("display","none")}})},deep_equal:function(e,t){return fastDeepEqual(e,t)},file_name_ellipsis:function(e,t){var r=2*t/3,n=t-r,a=e.split("."),i=a.pop(),o=a.join(""),s=o.slice(0,r),l=o.slice(-n);return o.length>t?s+"..."+l+"."+i:e},get_decoded_string:function(e){var t=e.split(",")[1];return decodeURIComponent(escape(atob(t)))},copy_to_clipboard:function(e){var t=$("<input>");$("body").append(t),t.val(e).select(),document.execCommand("copy"),t.remove(),frappe.show_alert({indicator:"green",message:__("Copied to clipboard.")})},is_rtl:function(){return["ar","he","fa"].includes(frappe.boot.lang)},bind_actions_with_object:function(e,t){return $(e).off("click.class_actions"),$(e).on("click.class_actions","[data-action]",function(e){var r=$(e.currentTarget),n=r.data("action");t[n]&&t[n](e,r)}),e},get_browser:function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:e[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})},get_formatted_duration:function(e,t){var r="";if(e){var n=frappe.utils.seconds_to_duration(e,t);n.days&&(r+=n.days+__("d",null,"Days (Field: Duration)")),n.hours&&(r+=r.length?" ":"",r+=n.hours+__("h",null,"Hours (Field: Duration)")),n.minutes&&(r+=r.length?" ":"",r+=n.minutes+__("m",null,"Minutes (Field: Duration)")),n.seconds&&(r+=r.length?" ":"",r+=n.seconds+__("s",null,"Seconds (Field: Duration)"))}return r},seconds_to_duration:function(e,t){var r=e,n={days:Math.floor(r/86400),hours:Math.floor(r%86400/3600),minutes:Math.floor(r%3600/60),seconds:Math.floor(r%60)};return t.hide_days&&(n.hours=Math.floor(r/3600),n.days=0),n},duration_to_seconds:function(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=0);var a=0;return e&&(a+=24*e*60*60),t&&(a+=60*t*60),r&&(a+=60*r),n&&(a+=n),a},get_duration_options:function(e){return{hide_days:e.hide_days,hide_seconds:e.hide_seconds}}}),Array.prototype.uniqBy||(Object.defineProperty(Array.prototype,"uniqBy",{value:function(e){var t={};return this.filter(function(r){var n=e(r);return!t.hasOwnProperty(n)&&(t[n]=!0)})}}),Object.defineProperty(Array.prototype,"move",{value:function(e,t){this.splice(t,0,this.splice(e,1)[0])}})),String.prototype.plural=function(e){var t,r,n,a,i,o={move:"moves",foot:"feet",goose:"geese",sex:"sexes",child:"children",man:"men",tooth:"teeth",person:"people"};if(["sheep","fish","deer","moose","series","species","money","rice","information","equipment"].indexOf(this.toLowerCase())>=0)return this;for(t in o)if(e?(r=new RegExp(o[t]+"$","i"),n=t):(r=new RegExp(t+"$","i"),n=o[t]),r.test(this))return this.replace(r,n);for(i in a=e?{"(quiz)zes$":"$1","(matr)ices$":"$1ix","(vert|ind)ices$":"$1ex","^(ox)en$":"$1","(alias)es$":"$1","(octop|vir)i$":"$1us","(cris|ax|test)es$":"$1is","(shoe)s$":"$1","(o)es$":"$1","(bus)es$":"$1","([m|l])ice$":"$1ouse","(x|ch|ss|sh)es$":"$1","(m)ovies$":"$1ovie","(s)eries$":"$1eries","([^aeiouy]|qu)ies$":"$1y","([lr])ves$":"$1f","(tive)s$":"$1","(hive)s$":"$1","(li|wi|kni)ves$":"$1fe","(shea|loa|lea|thie)ves$":"$1f","(^analy)ses$":"$1sis","((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$":"$1$2sis","([ti])a$":"$1um","(n)ews$":"$1ews","(h|bl)ouses$":"$1ouse","(corpse)s$":"$1","(us)es$":"$1",s$:""}:{"(quiz)$":"$1zes","^(ox)$":"$1en","([m|l])ouse$":"$1ice","(matr|vert|ind)ix|ex$":"$1ices","(x|ch|ss|sh)$":"$1es","([^aeiouy]|qu)y$":"$1ies","(hive)$":"$1s","(?:([^f])fe|([lr])f)$":"$1$2ves","(shea|lea|loa|thie)f$":"$1ves",sis$:"ses","([ti])um$":"$1a","(tomat|potat|ech|her|vet)o$":"$1oes","(bu)s$":"$1ses","(alias)$":"$1es","(octop)us$":"$1i","(ax|test)is$":"$1es","(us)$":"$1es","([^s]+)$":"$1s"})if((r=new RegExp(i,"i")).test(this))return this.replace(r,a[i]);return this},frappe.provide("frappe.utils");var EventEmitterMixin={init:function(){this.jq=jQuery({})},trigger:function(e,t){!this.jq&&this.init(),this.jq.trigger(e,t)},once:function(e,t){!this.jq&&this.init(),this.jq.one(e,function(e,r){return t(r)})},on:function(e,t){!this.jq&&this.init(),this.jq.bind(e,function(e,r){return t(r)})},off:function(e,t){!this.jq&&this.init(),this.jq.unbind(e,function(e,r){return t(r)})}};frappe.utils.make_event_emitter=function(e){return Object.assign(e,EventEmitterMixin),e},frappe.provide("frappe.views"),frappe.re_route={"#login":""},frappe.route_titles={},frappe.route_flags={},frappe.route_history=[],frappe.view_factory={},frappe.view_factories=[],frappe.route_options=null,frappe.route_hooks={},frappe.route=function(){if(frappe.app){if(void 0!==frappe.re_route[window.location.hash]){var e=frappe.get_route_str(frappe.re_route[window.location.hash]),t=frappe.get_route_str(frappe._cur_route);if(decodeURIComponent(e)===decodeURIComponent(t))return void window.history.back();window.location.hash=frappe.re_route[window.location.hash]}frappe._cur_route=window.location.hash;var r=frappe.get_route();if(!1!==r){if(frappe.route_history.push(r),r[0]){var n=frappe.utils.to_title_case(r[0]);if("Workspace"===n&&frappe.views.pageview.show(""),r[1]&&frappe.views[n+"Factory"])frappe.view_factory[n]||(frappe.view_factory[n]=new frappe.views[n+"Factory"]),frappe.view_factory[n].show();else{var a=frappe.utils.xss_sanitise(r[0]);frappe.views.pageview&&frappe.views.pageview.show(a)}}else frappe.views.pageview.show("");frappe.route_titles[window.location.hash]?frappe.utils.set_title(frappe.route_titles[window.location.hash]):setTimeout(function(){frappe.route_titles[frappe.get_route_str()]=frappe._original_title||document.title},1e3),window.mixpanel&&window.mixpanel.track(r.slice(0,2).join(" "))}}},frappe.get_route=function(e){e=frappe.get_raw_route_str(e).split("/");var t=null,r=(e=$.map(e,frappe._decode_str))[e.length-1];if(r.indexOf("?")<r.indexOf("=")?(t=r.split("?"),e[e.length-1]=t[0]):t=r,t.length>1){var n=frappe.utils.get_query_params(t[1]);frappe.route_options=$.extend(frappe.route_options||{},n)}return e&&"Module"===e[0]?(frappe.set_route("modules",e[1]),!1):e},frappe.get_prev_route=function(){return frappe.route_history&&frappe.route_history.length>1?frappe.route_history[frappe.route_history.length-2]:[]},frappe._decode_str=function(e){try{return decodeURIComponent(e)}catch(t){if(t instanceof URIError)return e;throw t}},frappe.get_raw_route_str=function(e){return e||(e=window.location.hash),"#"==e.substr(0,1)&&(e=e.substr(1)),"!"==e.substr(0,1)&&(e=e.substr(1)),e},frappe.get_route_str=function(e){var t=frappe.get_raw_route_str(e);return e=$.map(t.split("/"),frappe._decode_str).join("/")},frappe.set_route=function(){var e=arguments;return new Promise(function(t){var r=e;1===r.length&&$.isArray(r[0])&&(r=r[0]);var n=$.map(r,function(e){return $.isPlainObject(e)?(frappe.route_options=e,null):((e=String(e))&&e.match(/[%'"]/)&&(e=encodeURIComponent(e)),e)}).join("/");window.location.hash=n,frappe.provide("frappe.app"),frappe.app.set_favicon&&frappe.app.set_favicon(),setTimeout(function(){frappe.after_ajax&&frappe.after_ajax(function(){t()})},100)})},frappe.set_re_route=function(){var e=window.location.hash;frappe.set_route.apply(null,arguments),frappe.re_route[e]=window.location.hash},frappe.has_route_options=function(){return Boolean(Object.keys(frappe.route_options||{}).length)},frappe._cur_route=null,$(window).on("hashchange",function(){frappe.route_titles[frappe._cur_route]=frappe._original_title||document.title,window.location.hash!=frappe._cur_route&&(window.cur_dialog&&(cur_dialog.minimizable?cur_dialog.is_minimized||cur_dialog.toggle_minimize():cur_dialog.hide()),frappe.route(),frappe.route.trigger("change"))}),frappe.utils.make_event_emitter(frappe.route),frappe.provide("frappe.route"),frappe.route_history_queue=[];var routes_to_skip=["Form","social","setup-wizard"],save_routes=frappe.utils.debounce(function(){var e=frappe.route_history_queue;frappe.route_history_queue=[],frappe.xcall("frappe.deferred_insert.deferred_insert",{doctype:"Route History",records:e}).catch(function(){frappe.route_history_queue.concat(e)})},1e4);function is_route_useful(e){return!!e[1]&&!("List"===e[0]&&!e[2]||routes_to_skip.includes(e[0]))}function prettyDate(e,t){if(!e)return"";"string"==typeof e&&(e=frappe.datetime.convert_to_user_tz(e),e=new Date((e||"").replace(/-/g,"/").replace(/[TZ]/g," ").replace(/\.[0-9]*/,"")));var r=((new Date).getTime()-e.getTime())/1e3,n=Math.floor(r/86400);if(isNaN(n)||n<0)return"";if(t){if(0!=n)return n<7?__("{0} d",[n]):n<31?__("{0} w",[Math.ceil(n/7)]):n<365?__("{0} M",[Math.ceil(n/30)]):__("{0} y",[Math.ceil(n/365)]);if(r<60)return __("now");if(r<3600)return __("{0} m",[Math.floor(r/60)]);if(r<86400)return __("{0} h",[Math.floor(r/3600)])}else{if(0!=n)return 1==n?__("yesterday"):n<7?__("{0} days ago",[n]):n<14?__("1 week ago"):n<31?__("{0} weeks ago",[Math.ceil(n/7)]):n<62?__("1 month ago"):n<365?__("{0} months ago",[Math.ceil(n/30)]):n<730?__("1 year ago"):__("{0} years ago",[Math.ceil(n/365)]);if(r<60)return __("just now");if(r<120)return __("1 minute ago");if(r<3600)return __("{0} minutes ago",[Math.floor(r/60)]);if(r<7200)return __("1 hour ago");if(r<86400)return __("{0} hours ago",[Math.floor(r/3600)])}}frappe.route.on("change",function(){is_route_useful(frappe.get_route())&&(frappe.route_history_queue.push({user:frappe.session.user,creation:frappe.datetime.now_datetime(),route:frappe.get_route_str()}),save_routes())}),frappe.defaults={get_user_default:function(e){var t=frappe.boot.user.defaults,r=t[e];if(!r&&frappe.defaults.is_a_user_permission_key(e)&&(r=t[frappe.model.scrub(e)]),$.isArray(r)&&(r=r[0]),frappe.defaults.in_user_permission(e,r))return r},get_user_defaults:function(e){var t=frappe.boot.user.defaults,r=t[e];return frappe.defaults.is_a_user_permission_key(e)&&(r=r&&$.isArray(r)&&1===r.length?r[0]:t[e]||t[frappe.model.scrub(e)]),$.isArray(r)||(r=[r]),r.filter(function(t){if(frappe.defaults.in_user_permission(e,t))return t}),r},get_global_default:function(e){var t=frappe.sys_defaults[e];return $.isArray(t)&&(t=t[0]),t},get_global_defaults:function(e){var t=frappe.sys_defaults[e];return $.isArray(t)||(t=[t]),t},set_default:function(e,t,r){return"string"!=typeof t&&(t=JSON.stringify(t)),frappe.boot.user.defaults[e]=t,frappe.call({method:"frappe.client.set_default",args:{key:e,value:t},callback:r||function(e){}})},set_user_default_local:function(e,t){frappe.boot.user.defaults[e]=t},get_default:function(e){var t=frappe.boot.user.defaults,r=t[e];if(frappe.defaults.is_a_user_permission_key(e)&&(r=r&&$.isArray(r)&&1===r.length?r[0]:t[frappe.model.scrub(e)]),frappe.defaults.in_user_permission(e,r)&&r)try{return JSON.parse(r)}catch(e){return r}},is_a_user_permission_key:function(e){return-1===e.indexOf(":")&&e!==frappe.model.scrub(e)},in_user_permission:function(e,t){var r=this.get_user_permissions()[frappe.model.unscrub(e)];return!r||!r.length||r.some(function(e){return e.doc===t})},get_user_permissions:function(){return this._user_permissions||{}},update_user_permissions:function(){var e=this;frappe.call("frappe.core.doctype.user_permission.user_permission.get_user_permissions").then(function(t){t.message&&(e._user_permissions=Object.assign({},t.message))})}},frappe.RoleEditor=Class.extend({init:function(e,t,r){var n=this;this.frm=t,this.wrapper=e,this.disable=r,$(e).html('<div class="help">'+__("Loading")+"...</div>"),frappe.call({method:"frappe.core.doctype.user.user.get_all_roles",callback:function(e){n.roles=e.message,n.show_roles(),n.frm.doc&&n.frm.roles_editor.show()}})},show_roles:function(){var e=this;if($(this.wrapper).empty(),"User"!=e.frm.doctype){var t=$('<p><button class="btn btn-default btn-add btn-sm" style="margin-right: 5px;"></button>\t\t\t\t<button class="btn btn-sm btn-default btn-remove"></button></p>').appendTo($(this.wrapper));t.find(".btn-add").html(__("Add all roles")).on("click",function(){$(e.wrapper).find('input[type="checkbox"]').each(function(e,t){$(t).is(":checked")||(t.checked=!0)})}),t.find(".btn-remove").html(__("Clear all roles")).on("click",function(){$(e.wrapper).find('input[type="checkbox"]').each(function(e,t){$(t).is(":checked")&&(t.checked=!1)})})}$.each(this.roles,function(t,r){$(e.wrapper).append(repl('<div class="user-role" \t\t\t\tdata-user-role="%(role_value)s">\t\t\t\t<input type="checkbox" style="margin-top:0px;" class="box"> \t\t\t\t<a href="#" class="grey role">%(role_display)s</a>\t\t\t</div>',{role_value:r,role_display:__(r)}))}),$(this.wrapper).find('input[type="checkbox"]').change(function(){e.set_roles_in_table(),e.frm.dirty()}),$(this.wrapper).find(".user-role a").click(function(){return e.show_permissions($(this).parent().attr("data-user-role")),!1})},show:function(){var e=this;$(".box").attr("disabled",this.disable),$(this.wrapper).find('input[type="checkbox"]').each(function(e,t){t.checked=!1}),$.each(e.frm.doc.roles||[],function(t,r){var n=$(e.wrapper).find('[data-user-role="'+r.role+'"] input[type="checkbox"]').get(0);n&&(n.checked=!0)}),this.set_enable_disable()},set_enable_disable:function(){$(".box").attr("disabled",!!this.disable)},set_roles_in_table:function(){var e=this.get_roles(),t={},r=[],n=this;$.each(n.frm.doc.roles||[],function(e,n){t[n.role]=n.name,r.push(n.role)}),$.each(e.unchecked_roles,function(e,n){-1!=r.indexOf(n)&&frappe.model.clear_doc("Has Role",t[n])}),$.each(e.checked_roles,function(e,t){-1==r.indexOf(t)&&(frappe.model.add_child(n.frm.doc,"Has Role","roles").role=t)}),refresh_field("roles")},get_roles:function(){var e=[],t=[];return $(this.wrapper).find("[data-user-role]").each(function(){$(this).find('input[type="checkbox"]:checked').length?e.push($(this).attr("data-user-role")):t.push($(this).attr("data-user-role"))}),{checked_roles:e,unchecked_roles:t}},show_permissions:function(e){var t=this;return this.perm_dialog||this.make_perm_dialog(),$(this.perm_dialog.body).empty(),frappe.call({method:"frappe.core.doctype.user.user.get_perm_info",args:{role:e},callback:function(r){var n=$(t.perm_dialog.body);n.append('<table class="user-perm"><thead><tr><th style="text-align: left">'+__("Document Type")+"</th><th>"+__("Level")+"</th><th>"+__("Read")+"</th><th>"+__("Write")+"</th><th>"+__("Create")+"</th><th>"+__("Delete")+"</th><th>"+__("Submit")+"</th><th>"+__("Cancel")+"</th><th>"+__("Amend")+"</th><th>"+__("Set User Permissions")+"</th></tr></thead><tbody></tbody></table>");for(var a=0,i=r.message.length;a<i;a++){var o=r.message[a];for(var s in o)"parent"!=s&&"permlevel"!=s&&(o[s]?o[s]='<i class="fa fa-check"></i>':o[s]="");n.find("tbody").append(repl('<tr>\t\t\t\t\t\t<td style="text-align: left">%(parent)s</td>\t\t\t\t\t\t<td>%(permlevel)s</td>\t\t\t\t\t\t<td>%(read)s</td>\t\t\t\t\t\t<td>%(write)s</td>\t\t\t\t\t\t<td>%(create)s</td>\t\t\t\t\t\t<td>%(delete)s</td>\t\t\t\t\t\t<td>%(submit)s</td>\t\t\t\t\t\t<td>%(cancel)s</td>\t\t\t\t\t\t<td>%(amend)s</td>\t\t\t\t\t\t<td>%(set_user_permissions)s</td>\t\t\t\t\t\t</tr>',o))}t.perm_dialog.set_title(e),t.perm_dialog.show()}})},make_perm_dialog:function(){this.perm_dialog=new frappe.ui.Dialog({title:__("Role Permissions")}),this.perm_dialog.$wrapper.find(".modal-dialog").css("width","800px")}}),frappe.template={compiled:{},debug:{}},frappe.template.compile=function(e,t){var r=t||e;if(!frappe.template.compiled[r]){-1!==e.indexOf("'")&&e.replace(/'/g,"\\'");var n="var _p=[],print=function(){_p.push.apply(_p,arguments)};with(obj){\n_p.push('"+(e=(e=(e=(e=(e=(e=(e=e.replace(/{{/g,"{%=").replace(/}}/g,"%}")).replace(/{%\s?if\s?\s?not\s?([^\(][^%{]+)\s?%}/g,"{% if (! $1) { %}")).replace(/{%\s?if\s?([^\(][^%{]+)\s?%}/g,"{% if ($1) { %}")).replace(/{%\s?for\s([a-z._]+)\sin\s([a-z._]+)\s?%}/g,function(e,t,r,n,a){var i=frappe.utils.get_random(3),o=frappe.utils.get_random(3);return"{% for (var "+i+"=0, "+o+"="+r+".length; "+i+"<"+o+"; "+i+"++) { var "+t+" = "+r+"["+i+"]; "+t+"._index = "+i+"; %}"})).replace(/{%\s?endif\s?%}/g,"{% }; %}")).replace(/{%\s?else\s?%}/g,"{% } else { %}")).replace(/{%\s?endfor\s?%}/g,"{% }; %}")).replace(/[\r\t\n]/g," ").split("{%").join("\t").replace(/((^|%})[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%}/g,"',$1,'").split("\t").join("');\n").split("%}").join("\n_p.push('").split("\r").join("\\'")+"');}return _p.join('');";frappe.template.debug[t]=n;try{frappe.template.compiled[r]=new Function("obj",n)}catch(e){console.log("Error in Template:"),console.log(n),e.lineNumber&&(console.log("Error in Line "+e.lineNumber+", Col "+e.columnNumber+":"),console.log(n.split("\n")[e.lineNumber-1]))}}return frappe.template.compiled[r]},frappe.render=function(e,t,r){return frappe.template.compile(e,r)(t)},frappe.render_template=function(e,t){if(-1!==e.indexOf(" "))var r=e;else r=frappe.templates[e];return void 0===t&&(t={}),frappe.render(r,t,e)},frappe.render_grid=function(e){e.grid&&(e.columns=e.grid.getColumns(),e.data=e.grid.getData().getItems()),null==e.landscape&&(e.columns&&e.columns.length>10?e.landscape=!0:e.landscape=!1),e.content||(e.content=frappe.render_template(e.template||"print_grid",e)),e.base_url=frappe.urllib.get_base_url(),e.print_css=frappe.boot.print_css;var t=frappe.render_template("print_template",e),r=window.open();r||frappe.msgprint(__("Please enable pop-ups in your browser")),r.document.write(t),r.document.close()},frappe.render_tree=function(e){e.base_url=frappe.urllib.get_base_url(),e.landscape=!1,e.print_css=frappe.boot.print_css;var t=frappe.render_template("print_tree",e),r=window.open();r||frappe.msgprint(__("Please enable pop-ups in your browser")),r.document.write(t),r.document.close()},frappe.render_pdf=function(e,t){void 0===t&&(t={});var r=new FormData;r.append("html",e),t.orientation&&r.append("orientation",t.orientation);var n=new Blob([],{type:"text/xml"});r.append("blob",n);var a=new XMLHttpRequest;a.open("POST","/api/method/frappe.utils.print_format.report_to_pdf"),a.setRequestHeader("X-Frappe-CSRF-Token",frappe.csrf_token),a.responseType="arraybuffer",a.onload=function(e){if(200===this.status){var t=new Blob([e.currentTarget.response],{type:"application/pdf"}),r=URL.createObjectURL(t);window.open(r)}},a.send(r)},frappe.templates.page='<div class="page-head flex align-center">  <div class="container">   <div class="row flex align-center">    <div class="col-md-7 col-sm-8 col-xs-6 page-title">          <h1 class="flex" style="margin: auto;">      <div class="title-image hide hidden-md hidden-lg">      </div>      <div class="flex fill-width title-area" style="max-width: 100%">       <div class="ellipsis title-text"></div>       <span class="indicator whitespace-nowrap hide"></span>      </div>     </h1>    </div>    <div class="text-right col-md-5 col-sm-4 col-xs-6 page-actions">          <span class="checked-items-status text-ellipsis text-muted small hide hidden-xs hidden-sm" style="margin-right: 20px;">## items selected</span>     <h6 class="ellipsis sub-heading hide text-muted"></h6>     <span class="page-icon-group hide hidden-xs hidden-sm"></span>           <div class="btn-group menu-btn-group hide">      <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" aria-expanded="false">       <span class="hidden-xs">        <span class="menu-btn-group-label">{%= __("Menu") %}</span>        <span class="caret"></span>       </span>       <span class="visible-xs">        <i class="octicon octicon-triangle-down"></i>       </span>      </button>      <ul class="dropdown-menu" role="menu"></ul>     </div>     <button class="btn btn-secondary btn-default btn-sm hide"></button>     <div class="btn-group actions-btn-group hide">      <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown" aria-expanded="false">       <span class="hidden-xs">        <span class="actions-btn-group-label">{%= __("Actions") %}</span>        <span class="caret"></span>       </span>       <span class="visible-xs octicon octicon-check"></span>      </button>      <ul class="dropdown-menu" role="menu">      </ul>     </div>     <button class="btn btn-primary btn-sm hide primary-action"></button>    </div>   </div>  </div> </div> <div class="container page-body">  <div class="page-toolbar hide">   <div class="container">   </div>  </div>  <div class="page-wrapper">   <div class="page-content">    <div class="workflow-button-area btn-group pull-right hide"></div>    <div class="clearfix"></div>   </div>  </div> </div>',frappe.ui.make_app_page=function(e){return e.parent.page=new frappe.ui.Page(e),e.parent.page},frappe.ui.pages={},frappe.ui.Page=Class.extend({init:function(e){$.extend(this,e),this.set_document_title=!0,this.buttons={},this.fields_dict={},this.views={},this.make(),frappe.ui.pages[frappe.get_route_str()]=this},make:function(){this.wrapper=$(this.parent),this.add_main_section()},get_empty_state:function(e,t,r){return $('<div class="page-card-container">\n\t\t\t<div class="page-card">\n\t\t\t\t<div class="page-card-head">\n\t\t\t\t\t<span class="indicator blue">\n\t\t\t\t\t\t'+e+"</span>\n\t\t\t\t</div>\n\t\t\t\t<p>"+t+'</p>\n\t\t\t\t<div>\n\t\t\t\t\t<button class="btn btn-primary btn-sm">'+r+"</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>")},load_lib:function(e){frappe.require(this.required_libs,e)},add_main_section:function(){$(frappe.render_template("page",{})).appendTo(this.wrapper),this.single_column?this.add_view("main",'<div class="row layout-main">\t\t\t\t\t<div class="col-md-12 layout-main-section-wrapper">\t\t\t\t\t\t<div class="layout-main-section"></div>\t\t\t\t\t\t<div class="layout-footer hide"></div>\t\t\t\t\t</div>\t\t\t\t</div>'):this.add_view("main",'<div class="row layout-main">\t\t\t\t<div class="col-md-2 layout-side-section"></div>\t\t\t\t<div class="col-md-10 layout-main-section-wrapper">\t\t\t\t\t<div class="layout-main-section"></div>\t\t\t\t\t<div class="layout-footer hide"></div>\t\t\t\t</div>\t\t\t</div>'),this.setup_page()},setup_page:function(){this.$title_area=this.wrapper.find("h1"),this.$sub_title_area=this.wrapper.find("h6"),void 0!==this.set_document_title&&(this.set_document_title=this.set_document_title),this.title&&this.set_title(this.title),this.icon&&this.get_main_icon(this.icon),this.body=this.main=this.wrapper.find(".layout-main-section"),this.sidebar=this.wrapper.find(".layout-side-section"),this.footer=this.wrapper.find(".layout-footer"),this.indicator=this.wrapper.find(".indicator"),this.page_actions=this.wrapper.find(".page-actions"),this.btn_primary=this.page_actions.find(".primary-action"),this.btn_secondary=this.page_actions.find(".btn-secondary"),this.menu=this.page_actions.find(".menu-btn-group .dropdown-menu"),this.menu_btn_group=this.page_actions.find(".menu-btn-group"),this.actions=this.page_actions.find(".actions-btn-group .dropdown-menu"),this.actions_btn_group=this.page_actions.find(".actions-btn-group"),this.page_form=$('<div class="page-form row hide"></div>').prependTo(this.main),this.inner_toolbar=$('<div class="form-inner-toolbar hide"></div>').prependTo(this.main),this.icon_group=this.page_actions.find(".page-icon-group"),this.make_page&&this.make_page();var e=this.menu_btn_group.find("button");frappe.ui.keys.get_shortcut_group(this.page_actions[0]).add(e,e.find(".menu-btn-group-label"));var t=this.actions_btn_group.find("button");frappe.ui.keys.get_shortcut_group(this.page_actions[0]).add(t,t.find(".actions-btn-group-label"))},set_indicator:function(e,t){this.clear_indicator().removeClass("hide").html("<span>"+e+"</span>").addClass(t)},add_action_icon:function(e,t){return $('<a class="text-muted no-decoration"><i class="'+e+'"></i></a>').appendTo(this.icon_group.removeClass("hide")).click(t)},clear_indicator:function(){return this.indicator.removeClass().addClass("indicator whitespace-nowrap hide")},get_icon_label:function(e,t){return'<i class="visible-xs '+e+'"></i><span class="hidden-xs">'+t+"</span>"},set_action:function(e,t){var r=this;t.icon&&(t.label=this.get_icon_label(t.icon,t.label)),this.clear_action_of(e),e.removeClass("hide").prop("disabled",!1).html(t.label).on("click",function(){var n=t.click.apply(this);r.btn_disable_enable(e,n)}),t.working_label&&e.attr("data-working-label",t.working_label);var n=e.find("span");frappe.ui.keys.get_shortcut_group(this).add(e,n.length?n:e)},set_primary_action:function(e,t,r,n){return this.set_action(this.btn_primary,{label:e,click:t,icon:r,working_label:n}),this.btn_primary},set_secondary_action:function(e,t,r,n){return this.set_action(this.btn_secondary,{label:e,click:t,icon:r,working_label:n}),this.btn_secondary},clear_action_of:function(e){e.addClass("hide").unbind("click").removeAttr("data-working-label")},clear_primary_action:function(){this.clear_action_of(this.btn_primary)},clear_secondary_action:function(){this.clear_action_of(this.btn_secondary)},clear_actions:function(){this.clear_primary_action(),this.clear_secondary_action()},clear_icons:function(){this.icon_group.addClass("hide").empty()},add_menu_item:function(e,t,r,n){return this.add_dropdown_item({label:e,click:t,standard:r,parent:this.menu,shortcut:n})},clear_menu:function(){this.clear_btn_group(this.menu)},show_menu:function(){this.menu_btn_group.removeClass("hide")},hide_menu:function(){this.menu_btn_group.addClass("hide")},show_icon_group:function(){this.icon_group.removeClass("hide")},hide_icon_group:function(){this.icon_group.addClass("hide")},show_actions_menu:function(){this.actions_btn_group.removeClass("hide")},hide_actions_menu:function(){this.actions_btn_group.addClass("hide")},add_action_item:function(e,t,r){return this.add_dropdown_item({label:e,click:t,standard:r,parent:this.actions})},add_actions_menu_item:function(e,t,r){return this.add_dropdown_item({label:e,click:t,standard:r,parent:this.actions,show_parent:!1})},clear_actions_menu:function(){this.clear_btn_group(this.actions)},add_dropdown_item:function(e){var t,r=e.label,n=e.click,a=e.standard,i=e.parent,o=e.shortcut,s=e.show_parent;if(void 0===s&&(s=!0),s&&i.parent().removeClass("hide"),o){var l=this.prepare_shortcut_obj(o,n,r);t=$('<li><a class="grey-link dropdown-item" href="#" onClick="return false;">\n\t\t\t\t<span class="menu-item-label">'+r+'</span>\n\t\t\t\t<span class="text-muted pull-right">'+l.shortcut_label+"</span>\n\t\t\t</a><li>"),frappe.ui.keys.add_shortcut(l)}else t=$('<li><a class="grey-link dropdown-item" href="#" onClick="return false;">\n\t\t\t\t<span class="menu-item-label">'+r+"</span></a><li>");var p=t.find("a").on("click",n);if(!this.is_in_group_button_dropdown(i,"li > a.grey-link",r))return a?t.appendTo(i):(this.divider=i.find(".divider"),this.divider.length||(this.divider=$('<li class="divider user-action"></li>').prependTo(i)),t.addClass("user-action").insertBefore(this.divider)),frappe.ui.keys.get_shortcut_group(i.get(0)).add(p,p.find(".menu-item-label")),p},prepare_shortcut_obj:function(e,t,r){var n;return n="string"==typeof e?{shortcut:e}:e,frappe.utils.is_mac()?n.shortcut_label=n.shortcut.replace("Ctrl","⌘"):n.shortcut_label=n.shortcut,n.shortcut=n.shortcut.toLowerCase(),n.action||(n.action=t),n.description||(n.description=r),n.page=this,n},is_in_group_button_dropdown:function(e,t,r){return t||(t="li"),!(!r||!e)&&$(e).find(t+":contains('"+r+"')").filter(function(){var e=$(this).html();return $(e).attr("data-label")===r}).length>0},clear_btn_group:function(e){e.empty(),e.parent().addClass("hide")},add_divider:function(){return $('<li class="divider"></li>').appendTo(this.menu)},get_or_add_inner_group_button:function(e){var t=this.inner_toolbar.find('.btn-group[data-label="'+encodeURIComponent(e)+'"]');return t.length||(t=$('<div class="btn-group" data-label="'+encodeURIComponent(e)+'" style="margin-left: 10px;">\t\t\t\t<button type="button" class="btn btn-default dropdown-toggle btn-xs" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\t\t\t\t'+e+' <span class="caret"></span></button>\t\t\t\t<ul role="menu" class="dropdown-menu" style="margin-top: -8px;"></ul></div>').appendTo(this.inner_toolbar)),t},get_inner_group_button:function(e){return this.inner_toolbar.find('.btn-group[data-label="'+encodeURIComponent(e)+'"]')},set_inner_btn_group_as_primary:function(e){this.get_or_add_inner_group_button(e).find("button").removeClass("btn-default").addClass("btn-primary")},btn_disable_enable:function(e,t){t&&t.then?(e.prop("disabled",!0),t.then(function(){e.prop("disabled",!1)})):t&&t.always&&(e.prop("disabled",!0),t.always(function(){e.prop("disabled",!1)}))},add_inner_button:function(e,t,r,n){void 0===n&&(n="default");var a=this,i=function(){var e=$(this),r=t();a.btn_disable_enable(e,r)};if(!r){var o=this.inner_toolbar.find('button[data-label="'+encodeURIComponent(e)+'"]');return 0==o.length?$('<button data-label="'+encodeURIComponent(e)+'" class="btn btn-'+n+' btn-xs" style="margin-left: 10px;">'+__(e)+"</btn>").on("click",i).appendTo(this.inner_toolbar.removeClass("hide")):o}var s=this.get_or_add_inner_group_button(r);if($(this.inner_toolbar).removeClass("hide"),!this.is_in_group_button_dropdown(s.find(".dropdown-menu"),"li",e))return $('<li><a href="#" onclick="return false;" data-label="'+encodeURIComponent(e)+'">'+e+"</a></li>").on("click",i).appendTo(s.find(".dropdown-menu"))},remove_inner_button:function(e,t){if("string"==typeof e&&(e=[e]),e=e.map(function(e){return __(e)}),t){var r=this.get_inner_group_button(__(t));r.length&&r.find('.dropdown-menu li a[data-label="'+encodeURIComponent(e)+'"]').remove(),0===r.find(".dropdown-menu li a").length&&r.remove()}else this.inner_toolbar.find('button[data-label="'+encodeURIComponent(e)+'"]').remove()},add_inner_message:function(e){var t=$("<span class='inner-page-message text-muted small'>"+e+"</div>");return this.inner_toolbar.find(".inner-page-message").remove(),this.inner_toolbar.removeClass("hide").prepend(t),t},clear_inner_toolbar:function(){this.inner_toolbar.empty().addClass("hide")},add_sidebar_item:function(e,t,r,n){var a=this.sidebar.find(".sidebar-menu.standard-actions"),i=$("<li>"),o=$("<a>").html(e).on("click",t).appendTo(i);return r?i.insertAfter(a.find(r)):n?i.prependTo(a):i.appendTo(a),o},clear_user_actions:function(){this.menu.find(".user-action").remove()},get_title_area:function(){return this.$title_area},set_title:function(e,t,r,n){void 0===t&&(t=""),void 0===r&&(r=!0),void 0===n&&(n=""),e||(e=""),r&&(e=strip_html(e)),this.title=e,frappe.utils.set_title(n||e),t&&(e='<span class="'+t+' text-muted" style="font-size: inherit;"></span> '+e),this.$title_area.find(".title-text").html(e)},set_title_sub:function(e){this.$sub_title_area.html(e).toggleClass("hide",!e)},get_main_icon:function(e){return this.$title_area.find(".title-icon").html('<i class="'+e+' fa-fw"></i> ').toggle(!0)},add_help_button:function(e){},add_button:function(e,t,r,n){},add_dropdown_button:function(e,t,r,n){frappe.ui.toolbar.add_dropdown_button(e,t,r,n)},add_label:function(e){return this.show_form(),$("<label class='col-md-1 page-only-label'>"+e+" </label>").appendTo(this.page_form)},add_select:function(e,t){return this.add_field({label:e,fieldtype:"Select"}).$wrapper.find("select").empty().add_options(t)},add_data:function(e){return this.add_field({label:e,fieldtype:"Data"}).$wrapper.find("input").attr("placeholder",e)},add_date:function(e,t){return this.add_field({label:e,fieldtype:"Date",default:t}).$wrapper.find("input").attr("placeholder",e)},add_check:function(e){return $("<div class='checkbox'><label><input type='checkbox'>"+e+"</label></div>").appendTo(this.page_form).find("input")},add_break:function(){this.page_form.append('<div class="clearfix invisible-xs"></div>')},add_field:function(e){this.show_form(),e.placeholder||(e.placeholder=e.label);var t=frappe.ui.form.make_control({df:e,parent:this.page_form,only_input:"Check"!=e.fieldtype});if(t.refresh(),$(t.wrapper).addClass("col-md-2").attr("title",__(e.label)).tooltip(),"HTML"!=e.fieldtype)return t.$input||t.make_input(),t.$input.addClass("input-sm").attr("placeholder",__(e.label)),"Check"===e.fieldtype&&$(t.wrapper).find(":first-child").removeClass("col-md-offset-4 col-md-8"),"Button"==e.fieldtype&&($(t.wrapper).find(".page-control-label").html("&nbsp;"),t.$input.addClass("btn-sm").css({width:"100%","margin-top":"-1px"})),e.default&&t.set_input(e.default),this.fields_dict[e.fieldname||e.label]=t,t},clear_fields:function(){this.page_form.empty()},show_form:function(){this.page_form.removeClass("hide")},hide_form:function(){this.page_form.addClass("hide")},get_form_values:function(){var e={};return this.page_form.fields_dict.forEach(function(t,r){e[r]=t.get_value()}),e},add_view:function(e,t){var r=t;return"string"==typeof t&&(r=$(t)),this.views[e]=r.appendTo($(this.wrapper).find(".page-content")),this.current_view?this.views[e].toggle(!1):this.current_view=this.views[e],this.views[e]},set_view:function(e){this.current_view_name!==e&&(this.current_view&&this.current_view.toggle(!1),this.current_view=this.views[e],this.previous_view_name=this.current_view_name,this.current_view_name=e,this.views[e].toggle(!0),this.wrapper.trigger("view-change"))}}),frappe.provide("frappe.ui"),frappe.ui.Slide=class{constructor(e){void 0===e&&(e=null),$.extend(this,e),this.setup()}setup(){this.$wrapper=$('<div class="slide-wrapper hidden"></div>').attr({"data-slide-id":this.id,"data-slide-name":this.name}).appendTo(this.parent)}make(){this.before_load&&this.before_load(this),this.$body=$('<div class="slide-body">\n\t\t\t<div class="content text-center">\n\t\t\t\t<p class="title lead">'+this.title+'</p>\n\t\t\t</div>\n\t\t\t<div class="form-wrapper">\n\t\t\t\t<div class="form"></div>\n\t\t\t\t<div class="add-more text-center" style="margin-top: 5px;">\n\t\t\t\t\t<a class="form-more-btn hide btn btn-default btn-xs">\n\t\t\t\t\t\t<span>Add More</span>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>').appendTo(this.$wrapper),this.$content=this.$body.find(".content"),this.$form=this.$body.find(".form"),this.$primary_btn=this.slides_footer.find(".primary"),this.$form_wrapper=this.$body.find(".form-wrapper"),this.image_src&&this.$content.append($('<img src="'+this.image_src+'" style="margin: 20px;">')),this.help&&this.$content.append($('<p class="slide-help">'+this.help+"</p>")),this.reqd_fields=[],this.refresh(),this.made=!0}refresh(){this.render_parent_dots(),this.done?this.setup_done_state():this.setup_form()}setup_form(){this.form=new frappe.ui.FieldGroup({fields:this.get_atomic_fields(),body:this.$form[0],no_submit_on_enter:!0}),this.form.make(),this.add_more&&this.bind_more_button(),this.set_reqd_fields(),this.onload&&this.onload(this),this.set_reqd_fields()}setup_done_state(){}get_atomic_fields(){var e=this,t=JSON.parse(JSON.stringify(this.fields));return this.add_more&&(this.count=1,t=t.map(function(t,r){return t.fieldname&&(t.fieldname+="_1"),1===r&&e.mandatory_entry&&(t.reqd=1),t.static||t.label&&t.label,t})),t}set_reqd_fields(){var e=this,t=this.form.fields_dict;this.reqd_fields=[],Object.keys(t).map(function(r){t[r].df.reqd&&e.reqd_fields.push(t[r])})}set_values(){return this.values=this.form.get_values(),null!==this.values&&!(this.validate&&!this.validate())}bind_more_button(){var e=this;this.$more=this.$body.find(".form-more-btn"),this.$more.removeClass("hide").on("click",function(){e.count++;var t=JSON.parse(JSON.stringify(e.fields));e.form.add_fields(t.map(function(t){return t.fieldname&&(t.fieldname+="_"+e.count),t.static||t.label&&t.label,t.reqd=0,t})),e.count===e.max_count&&e.$more.addClass("hide")})}resetup_primary_button(){this.unbind_primary_action(),this.bind_fields_to_action_btn(),this.reset_action_button_state(),this.bind_primary_action()}bind_fields_to_action_btn(){var e=this;this.reqd_fields.map(function(t){t.$wrapper.on("change input click",function(){e.reset_action_button_state()}),t.$wrapper.on("keydown","input",function(t){"Enter"==t.key&&e.reset_action_button_state()})})}reset_action_button_state(){this.reqd_fields.filter(function(e){return!e.get_value()}).length?this.slides_footer.find(".action").addClass("disabled"):this.slides_footer.find(".action").removeClass("disabled")}unbind_primary_action(){this.slides_footer.find(".primary").off()}bind_primary_action(){var e=this;this.slides_footer.find(".primary").on("click.primary_action",function(){e.primary_action()})}is_last_slide(){return this.id===this.parent[0].children.length-1}before_show(){}show_slide(){this.$wrapper.removeClass("hidden"),this.before_show(),this.resetup_primary_button(),this.done?this.$primary_btn.hide():(this.$body.find(".form-control").first().focus(),this.$primary_btn.show())}hide_slide(){this.$wrapper.addClass("hidden")}get_input(e){return this.form.get_input(e)}get_field(e){return this.form.get_field(e)}get_value(e){return this.form.get_value(e)}destroy(){this.$body.remove()}primary_action(){}},frappe.ui.Slides=class{constructor(e){var t=e.parent;void 0===t&&(t=null);var r=e.slides;void 0===r&&(r=[]);var n=e.slide_class;void 0===n&&(n=null);var a=e.unidirectional;void 0===a&&(a=0);var i=e.done_state;void 0===i&&(i=0);var o=e.before_load;void 0===o&&(o=null);var s=e.on_update;void 0===s&&(s=null),this.parent=t,this.slides=r,this.slide_class=n,this.unidirectional=a,this.done_state=i,this.before_load=o,this.on_update=s,this.slide_dict={},this.made_slide_ids=[],this.values={},this.make()}make(){this.container=$("<div>").addClass("slides-wrapper").attr({tabindex:-1}).appendTo(this.parent),this.$slide_progress=$("<div>").addClass("slides-progress text-center text-extra-muted").appendTo(this.container),this.$body=$("<div>").addClass("slide-container").appendTo(this.container),this.$footer=$("<div>").addClass("slide-footer").appendTo(this.container),this.render_progress_dots(),this.make_prev_next_buttons(),this.before_load&&this.before_load(this.$footer),this.setup(),this.show_slide(0)}setup(){var e=this;this.slides.map(function(t,r){e.slide_dict[r]?e.made_slide_ids.includes(r+"")&&(e.slide_dict[r].destroy(),e.slide_dict[r].make()):(e.slide_dict[r]=new e.slide_class($.extend(e.slides[r],{parent:e.$body,slides_footer:e.$footer,render_parent_dots:e.render_progress_dots.bind(e),id:r})),e.unidirectional||e.slide_dict[r].make())})}refresh(e){this.render_progress_dots(),this.show_hide_prev_next(e),this.$body.find(".form-control").first().focus()}render_progress_dots(){var e=this;this.$slide_progress.empty(),this.slides.map(function(t,r){var n=$('<i class="fa fa-fw fa-circle"> </i> ').attr({"data-step-id":r});e.done_state&&(e.slide_dict[r]&&e.slide_dict[r].done||t.done)&&n.addClass("text-success"),(e.unidirectional&&r<=e.current_id||r===e.current_id)&&n.addClass("active"),e.$slide_progress.append(n)}),this.completed=0,this.slides.map(function(t,r){e.slide_dict[r]?e.slide_dict[r].done&&e.completed++:t.done&&e.completed++}),this.on_update&&this.on_update(this.completed,this.slides.length),this.unidirectional||this.bind_progress_dots()}make_prev_next_buttons(){var e=this;$('<div class="row">\n\t\t\t<div class="col-sm-4 text-left prev-div">\n\t\t\t\t<a class="prev-btn btn btn-default btn-sm" tabindex="0">'+__("Previous")+'</a>\n\t\t\t</div>\n\t\t\t<div class="col-sm-8 text-right next-div">\n\t\t\t\t<a class="next-btn btn btn-default btn-sm" tabindex="0">'+__("Next")+"</a>\n\t\t\t</div>\n\t\t</div>").appendTo(this.$footer),this.$prev_btn=this.$footer.find(".prev-btn").attr("tabIndex",0).on("click",function(){e.show_slide(e.current_id-1)}),this.$next_btn=this.$footer.find(".next-btn").attr("tabIndex",0).on("click",function(){(!e.unidirectional||e.unidirectional&&e.current_slide.set_values())&&e.show_slide(e.current_id+1)})}bind_progress_dots(){var e=this;this.$slide_progress.find(".fa-circle").addClass("link").on("click",function(){var t=$(this).attr("data-step-id");e.show_slide(t)})}before_show_slide(){return!0}show_slide(e){e=cint(e),!this.before_show_slide()||this.current_slide&&this.current_id===e||(this.update_values(),this.current_slide&&this.current_slide.hide_slide(),this.unidirectional&&!this.slide_dict[e].made&&this.slide_dict[e].make(),this.current_id=e,this.current_slide=this.slide_dict[e],this.current_slide.show_slide(),this.refresh(e))}destroy_slide(e){this.slide_dict[e]&&this.slide_dict[e].destroy(),this.slide_dict[e]=null}on_update(e,t){}show_hide_prev_next(e){0===e?this.$prev_btn.hide():this.$prev_btn.show(),e+1===this.slides.length?this.$next_btn.hide():this.$next_btn.show()}get_values(){var e={};return $.each(this.slide_dict,function(t,r){r.values&&$.extend(e,r.values)}),e}update_values(){this.values=$.extend(this.values,this.get_values())}},frappe.find={page_primary_action:function(){return $(".page-actions:visible .btn-primary")},field:function(e,t){return new Promise(function(r){var n=$('[data-fieldname="'+e+'"] :input');t?(n.val(t).trigger("change"),frappe.after_ajax(function(){r(n)})):r(n)})}},frappe.ui.IconBar=Class.extend({init:function(e,t){this.parent=e,this.buttons={},this.make(t)},make:function(e){this.$wrapper=$('<div class="iconbar-wrapper hide"></div>').appendTo(this.parent);for(var t=0;t<e;t++)this.get_group(t+1)},get_group:function(e){var t=this.$wrapper.find(".iconbar-"+e+" ul");return t.length||(t=$('<div class="iconbar iconbar-'+e+' hide"><ul></ul></div>').appendTo(this.$wrapper).find("ul")),t},add_btn:function(e,t,r,n){var a=this.get_group(e),i=$('<li><i class="'+t+'"></i></li>').appendTo(a).on("click",function(){return n.apply(this),!1});return i.find("i").attr("title",r).tooltip(),this.$wrapper.find(".iconbar-"+e).removeClass("hide"),this.show(),i},hide:function(e){e?(this.$wrapper.find(".iconbar-"+e).addClass("hide"),this.check_if_all_hidden()):this.$wrapper.addClass("hide").trigger("hidden")},show:function(e){e?(this.$wrapper.find(".iconbar-"+e).removeClass("hide"),this.show()):this.$wrapper.hasClass("hide")&&this.$wrapper.removeClass("hide").trigger("shown")},clear:function(e){this.$wrapper.find(".iconbar-"+e).addClass("hide").find("ul").empty(),this.check_if_all_hidden()},check_if_all_hidden:function(){this.$wrapper.find(".iconbar:visible").length||this.hide()}}),frappe.ui.form.LinkSelector=Class.extend({init:function(e){$.extend(this,e);var t=this;"[Select]"!=this.doctype?frappe.model.with_doctype(this.doctype,function(e){t.make()}):this.make()},make:function(){var e=this;this.start=0,this.dialog=new frappe.ui.Dialog({title:__("Select {0}",["[Select]"==this.doctype?__("value"):__(this.doctype)]),fields:[{fieldtype:"Data",fieldname:"txt",label:__("Beginning with"),description:__("You can use wildcard %")},{fieldtype:"HTML",fieldname:"results"},{fieldtype:"Button",fieldname:"more",label:__("More"),click:function(){e.start+=20,e.search()}}],primary_action_label:__("Search"),primary_action:function(){e.start=0,e.search()}}),this.txt&&this.dialog.fields_dict.txt.set_input(this.txt),this.dialog.get_input("txt").on("keypress",function(t){13===t.which&&(e.start=0,e.search())}),this.dialog.show(),this.search()},search:function(){var e={txt:this.dialog.fields_dict.txt.get_value(),searchfield:"name",start:this.start},t=this;this.target.set_custom_query&&this.target.set_custom_query(e),this.target.is_grid&&this.target.fieldinfo[this.fieldname]&&this.target.fieldinfo[this.fieldname].get_query&&$.extend(e,this.target.fieldinfo[this.fieldname].get_query(cur_frm.doc)),frappe.link_search(this.doctype,e,function(r){var n=t.dialog.fields_dict.results.$wrapper;(0===e.start&&n.empty(),r.values.length?$.each(r.values,function(e,r){$(repl('<div class="row link-select-row">\t\t\t\t\t\t<div class="col-xs-4">\t\t\t\t\t\t\t<b><a href="#">%(name)s</a></b></div>\t\t\t\t\t\t<div class="col-xs-8">\t\t\t\t\t\t\t<span class="text-muted">%(values)s</span></div>\t\t\t\t\t\t</div>',{name:r[0],values:r.splice(1).join(", ")})).appendTo(n).find("a").attr("data-value",r[0]).click(function(){var e=$(this).attr("data-value");return t.target.is_grid?t.set_in_grid(e):(t.target.doctype?t.target.parse_validate_and_set_in_model(e):(t.target.set_input(e),t.target.$input.trigger("change")),t.dialog.hide()),!1})}):$('<p><br><span class="text-muted">'+__("No Results")+"</span>"+(frappe.model.can_create(t.doctype)?'<br><br><a class="new-doc btn btn-default btn-sm">'+__("Create a new {0}",[__(t.doctype)])+"</a>":"")+"</p>").appendTo(n).find(".new-doc").click(function(){frappe.new_doc(t.doctype)}),r.values.length<20)&&t.dialog.fields_dict.more.$wrapper.hide()},this.dialog.get_primary_btn())},set_in_grid:function(e){var t=this,r=!1,n=null;if(this.qty_fieldname)frappe.prompt({fieldname:"qty",fieldtype:"Float",label:"Qty",default:1,reqd:1},function(a){$.each(t.target.frm.doc[t.target.df.fieldname]||[],function(n,i){if(i[t.fieldname]===e)return frappe.model.set_value(i.doctype,i.name,t.qty_fieldname,a.qty),frappe.show_alert(__("Added {0} ({1})",[e,i[t.qty_fieldname]])),r=!0,!1}),r||frappe.run_serially([function(){n=t.target.add_new_row()},function(){return frappe.timeout(.1)},function(){return frappe.model.set_value(n.doctype,n.name,t.fieldname,e)},function(){return frappe.timeout(.5)},function(){return frappe.model.set_value(n.doctype,n.name,t.qty_fieldname,a.qty)},function(){return frappe.show_alert(__("Added {0} ({1})",[e,a.qty]))}])},__("Set Quantity"),__("Set"));else if(t.dynamic_link_field){n=t.target.add_new_row();frappe.model.set_value(n.doctype,n.name,t.dynamic_link_field,t.dynamic_link_reference),frappe.model.set_value(n.doctype,n.name,t.fieldname,e),frappe.show_alert(__("{0} {1} added",[t.dynamic_link_reference,e]))}else{n=t.target.add_new_row();frappe.model.set_value(n.doctype,n.name,t.fieldname,e),frappe.show_alert(__("{0} added",[e]))}}}),frappe.link_search=function(e,t,r,n){t||(t={txt:""}),t.doctype=e,t.searchfield||(t.searchfield="name"),frappe.call({method:"frappe.desk.search.search_widget",type:"GET",args:t,callback:function(e){r&&r(e)},btn:n})},frappe.ui.form.MultiSelectDialog=class{constructor(e){Object.assign(this,e);var t=this;"[Select]"!=this.doctype?frappe.model.with_doctype(this.doctype,function(){t.make()}):this.make()}make(){var e=this,t=this;this.page_length=20,this.start=0;var r=this.get_primary_filters();r=r.concat([{fieldtype:"HTML",fieldname:"results_area"},{fieldtype:"Button",fieldname:"more_btn",label:__("More"),click:function(){e.start+=20,e.get_results()}}]),this.data_fields&&(r.push({fieldtype:"Section Break"}),r=r.concat(this.data_fields));var n=this.doctype.plural();this.dialog=new frappe.ui.Dialog({title:__("Select {0}",["[Select]"==this.doctype?__("value"):__(n)]),fields:r,primary_action_label:this.primary_action_label||__("Get Items"),secondary_action_label:__("Make {0}",[t.doctype]),primary_action:function(){var e=t.get_custom_filters();t.action(t.get_checked_values(),cur_dialog.get_values(),t.args,e)},secondary_action:function(e){if(e){if(frappe.route_options={},Array.isArray(t.setters))for(var r=0,n=t.setters;r<n.length;r+=1){var a=n[r];frappe.route_options[a.fieldname]=t.dialog.fields_dict[a.fieldname].get_value()||void 0}else Object.keys(t.setters).forEach(function(e){frappe.route_options[e]=t.dialog.fields_dict[e].get_value()||void 0});frappe.new_doc(t.doctype,!0)}}}),this.add_filters_group&&this.make_filter_area(),this.$parent=$(this.dialog.body),this.$wrapper=this.dialog.fields_dict.results_area.$wrapper.append('<div class="results"\n\t\t\tstyle="border: 1px solid #d1d8dd; border-radius: 3px; height: 300px; overflow: auto;"></div>'),this.$results=this.$wrapper.find(".results"),this.$results.append(this.make_list_row()),this.args={},this.bind_events(),this.get_results(),this.dialog.show()}get_primary_filters(){var e=this,t=[],r=new Array(3);return r[0]=[{fieldtype:"Data",label:__("Search"),fieldname:"search_term"}],r[1]=[],r[2]=[],$.isArray(this.setters)?this.setters.forEach(function(e,t){r[(t+1)%3].push(e)}):Object.keys(this.setters).forEach(function(t,n){var a=frappe.meta.docfield_map[e.doctype][t];r[(n+1)%3].push({fieldtype:a.fieldtype,label:a.label,fieldname:t,options:a.options,default:e.setters[t]})}),Object.seal&&Object.seal(r),t=r[0].concat([{fieldtype:"Column Break"}],r[1],[{fieldtype:"Column Break"}],r[2],[{fieldtype:"Section Break",fieldname:"primary_filters_sb"}]),this.add_filters_group&&t.push({fieldtype:"HTML",fieldname:"filter_area"}),t}make_filter_area(){var e=this;this.filter_group=new frappe.ui.FilterGroup({parent:this.dialog.get_field("filter_area").$wrapper,doctype:this.doctype,on_change:function(){e.get_results()}})}get_custom_filters(){return this.add_filters_group&&this.filter_group?this.filter_group.get_filters().reduce(function(e,t){var r;return Object.assign(e,((r={})[t[1]]=[t[2],t[3]],r))},{}):[]}bind_events(){var e=this,t=this;this.$results.on("click",".list-item-container",function(e){$(e.target).is(":checkbox")||$(e.target).is("a")||$(this).find(":checkbox").trigger("click")}),this.$results.on("click",".list-item--head :checkbox",function(t){e.$results.find(".list-item-container .list-row-check").prop("checked",$(t.target).is(":checked"))}),this.$parent.find(".input-with-feedback").on("change",function(){frappe.flags.auto_scroll=!1,e.get_results()}),this.$parent.find('[data-fieldtype="Data"]').on("input",function(){var r=$(e);clearTimeout(r.data("timeout")),r.data("timeout",setTimeout(function(){frappe.flags.auto_scroll=!1,t.empty_list(),t.get_results()},300))})}get_checked_values(){return this.$results.find(".list-item-container").map(function(){if($(this).find(".list-row-check:checkbox:checked").length>0)return $(this).attr("data-item-name")}).get()}get_checked_items(){var e=this.get_checked_values();return this.results.filter(function(t){return e.includes(t.name)})}make_list_row(e){void 0===e&&(e={});var t=this,r=0===Object.keys(e).length,n="",a=["name"];if($.isArray(this.setters))for(var i=0,o=this.setters;i<o.length;i+=1){var s=o[i];a.push(s.fieldname)}else a=a.concat(Object.keys(this.setters));a.forEach(function(a){n+='<div class="list-item__content ellipsis">\n\t\t\t\t'+(r?'<span class="ellipsis text-muted" title="'+__(frappe.model.unscrub(a))+'">'+__(frappe.model.unscrub(a))+"</span>":"name"!==a?'<span class="ellipsis result-row" title="'+__(e[a]||"")+'">'+__(e[a]||"")+"</span>":'<a href="'+("#Form/"+t.doctype+"/"+e[a]||"")+'" class="list-id ellipsis" title="'+__(e[a]||"")+'">\n\t\t\t\t\t\t\t'+__(e[a]||"")+"</a>")+"\n\t\t\t</div>"});var l=$('<div class="list-item">\n\t\t\t<div class="list-item__content" style="flex: 0 0 10px;">\n\t\t\t\t<input type="checkbox" class="list-row-check" data-item-name="'+e.name+'" '+(e.checked?"checked":"")+">\n\t\t\t</div>\n\t\t\t"+n+"\n\t\t</div>");return r?l.addClass("list-item--head"):l=$('<div class="list-item-container" data-item-name="'+e.name+'"></div>').append(l),$(".modal-dialog .list-item--head").css("z-index",0),l}render_result_list(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!0);var n=this,a=n.dialog.fields_dict.more_btn.$wrapper;if(!frappe.flags.auto_scroll&&r&&this.empty_list(),a.hide(),0!==e.length){t&&a.show();var i=this.get_checked_values();e.filter(function(e){return!i.includes(e.name)}).forEach(function(e){n.$results.append(n.make_list_row(e))}),frappe.flags.auto_scroll&&this.$results.animate({scrollTop:n.$results.prop("scrollHeight")},500)}}empty_list(){var e=this.get_checked_items().map(function(e){return Object.assign({},e,{checked:!0})});this.$results.find(".list-item-container").remove(),this.render_result_list(e,0,!1)}get_results(){var e=this,t=this.get_query?this.get_query().filters:{}||{},r=[];if($.isArray(this.setters))for(var n=0,a=this.setters;n<a.length;n+=1){var i=a[n];t[i.fieldname]=e.dialog.fields_dict[i.fieldname].get_value()||void 0,e.args[i.fieldname]=t[i.fieldname],r.push(i.fieldname)}else Object.keys(this.setters).forEach(function(n){var a=e.dialog.fields_dict[n].get_value();"Data"==e.dialog.fields_dict[n].df.fieldtype&&a?t[n]=["like","%"+a+"%"]:(t[n]=a||void 0,e.args[n]=t[n],r.push(n))});var o=this.get_custom_filters();Object.assign(t,o);var s={doctype:e.doctype,txt:e.dialog.fields_dict.search_term.get_value(),filters:t,filter_fields:r,start:this.start,page_length:this.page_length+1,query:this.get_query?this.get_query().query:"",as_dict:1};frappe.call({type:"GET",method:"frappe.desk.search.search_widget",no_spinner:!0,args:s,callback:function(t){var r=0;e.results=[],t.values.length&&(t.values.length>e.page_length&&(t.values.pop(),r=1),t.values.forEach(function(t){t.checked=0,e.results.push(t)})),e.render_result_list(e.results,r)}})}},frappe._.get_data_uri=function(e){var t=$(e),r=t.width(),n=t.height(),a=$("<canvas/>");return a[0].width=r,a[0].height=n,a[0].getContext("2d").drawImage(t[0],0,0,r,n),a[0].toDataURL("image/png")},frappe.ui.Capture=class{constructor(e){void 0===e&&(e={}),this.options=frappe.ui.Capture.OPTIONS,this.set_options(e)}set_options(e){return this.options=Object.assign({},frappe.ui.Capture.OPTIONS,e),this}render(){var e=this;return navigator.mediaDevices.getUserMedia({video:!0}).then(function(t){e.dialog=new frappe.ui.Dialog({title:e.options.title,animate:e.options.animate,action:{secondary:{label:"<b>&times</b>"}}});var r=$(frappe.ui.Capture.TEMPLATE),n=r.find("video")[0];n.srcObject=t,n.play(),$(e.dialog.body).html(r),r.find(".fc-btf").hide(),r.find(".fc-bcp").click(function(){var e=frappe._.get_data_uri(n);r.find(".fc-p").attr("src",e),r.find(".fc-s").hide(),r.find(".fc-p").show(),r.find(".fc-btu").hide(),r.find(".fc-btf").show()}),r.find(".fc-br").click(function(){r.find(".fc-p").hide(),r.find(".fc-s").show(),r.find(".fc-btf").hide(),r.find(".fc-btu").show()}),r.find(".fc-bs").click(function(){var t=frappe._.get_data_uri(n);e.hide(),e.callback&&e.callback(t)})})}show(){var e=this;this.render().then(function(){e.dialog.show()}).catch(function(t){if(e.options.error){var r='<span class="indicator red"/> '+frappe.ui.Capture.ERR_MESSAGE;frappe.show_alert(r,3)}throw t})}hide(){this.dialog&&this.dialog.hide()}submit(e){this.callback=e}},frappe.ui.Capture.OPTIONS={title:__("Camera"),animate:!1,error:!1},frappe.ui.Capture.ERR_MESSAGE=__("Unable to load camera."),frappe.ui.Capture.TEMPLATE='\n<div class="frappe-capture">\n\t<div class="panel panel-default">\n\t\t<img class="fc-p img-responsive"/>\n\t\t<div class="fc-s  embed-responsive embed-responsive-16by9">\n\t\t\t<video class="embed-responsive-item">'+frappe.ui.Capture.ERR_MESSAGE+'</video>\n\t\t</div>\n\t</div>\n\t<div>\n\t\t<div class="fc-btf">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-left">\n\t\t\t\t\t\t<button class="btn btn-default fc-br">\n\t\t\t\t\t\t\t<small>'+__("Retake")+'</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-right">\n\t\t\t\t\t\t<button class="btn btn-primary fc-bs">\n\t\t\t\t\t\t\t<small>'+__("Submit")+'</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="fc-btu">\n\t\t\t<div class="row">\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t<div class="pull-right">\n\t\t\t\t\t\t<button class="btn btn-default fc-bcp">\n\t\t\t\t\t\t\t<small>'+__("Take Photo")+"</small>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n",frappe.provide("frappe.ui"),frappe.ui.app_icon={get_html:function(e,t){var r=e.icon,n=e.color;r&&r.match(/([\uE000-\uF8FF]|\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDDFF])/g)&&(e.emoji=e.icon);var a="";return e.reverse&&(a="color: #36414C;"),n||(n="#4aa3df"),!r||e.emoji?r='<span class="inner" '+(e.reverse?'style="'+a+'"':"")+">"+(e.emoji||e._label[0].toUpperCase())+"</span>":"svg"===r.split(".").slice(-1)[0]?($.ajax({url:frappe.urllib.get_full_url(r),dataType:"text",async:!1,success:function(e){r=e}}),r='<object class="app-icon-svg">'+r+"</object>"):r='<i class="'+r+'" title="'+e._label+'" style="'+a+'"></i>','<div class="app-icon'+(t?" app-icon-small":"")+'" style="background-color: '+n+'" title="'+e._label+'">'+r+"</div>"}},frappe.ui.DropZone=class{constructor(e,t){this.options=Object.assign({},frappe.ui.DropZone.OPTIONS,t),this.$container=$(e),this.$wrapper=$(frappe.ui.DropZone.TEMPLATE),this.make()}make(){var e=this,t=this.$wrapper.find(".panel-body"),r=t.find(".dropzone-title");r.html(this.options.title),t.on("dragover",function(e){e.preventDefault(),r.html(__("Drop"))}),t.on("dragleave",function(t){t.preventDefault(),r.html(e.options.title)}),t.on("drop",function(t){t.preventDefault();var n=t.originalEvent.dataTransfer.files;e.options.drop(n),r.html(e.options.title)}),this.$container.html(this.$wrapper)}},frappe.ui.DropZone.TEMPLATE='\n<div class="panel panel-default"\n\tstyle="\n\t\tborder: none !important;\n\t\tbox-shadow: none !important;\n\t\tmargin-bottom: 0 !important\n\t">\n\t<div class="panel-body">\n\t\t<div class="dropzone-title text-muted text-center">\n\t\t</div>\n\t</div>\n</div>\n',frappe.ui.DropZone.OPTIONS={title:__("Drop Here")},frappe.provide("frappe.model"),$.extend(frappe.model,{no_value_type:["Section Break","Column Break","HTML","Table","Table MultiSelect","Button","Image","Fold","Heading"],layout_fields:["Section Break","Column Break","Fold"],std_fields_list:["name","owner","creation","modified","modified_by","_user_tags","_comments","_assign","_liked_by","docstatus","parent","parenttype","parentfield","idx"],core_doctypes_list:["DocType","DocField","DocPerm","User","Role","Has Role","Page","Module Def","Print Format","Report","Customize Form","Customize Form Field","Property Setter","Custom Field","Custom Script"],std_fields:[{fieldname:"name",fieldtype:"Link",label:__("ID")},{fieldname:"owner",fieldtype:"Link",label:__("Created By"),options:"User"},{fieldname:"idx",fieldtype:"Int",label:__("Index")},{fieldname:"creation",fieldtype:"Date",label:__("Created On")},{fieldname:"modified",fieldtype:"Date",label:__("Last Updated On")},{fieldname:"modified_by",fieldtype:"Data",label:__("Last Updated By")},{fieldname:"_user_tags",fieldtype:"Data",label:__("Tags")},{fieldname:"_liked_by",fieldtype:"Data",label:__("Liked By")},{fieldname:"_comments",fieldtype:"Text",label:__("Comments")},{fieldname:"_assign",fieldtype:"Text",label:__("Assigned To")},{fieldname:"docstatus",fieldtype:"Int",label:__("Document Status")}],numeric_fieldtypes:["Int","Float","Currency","Percent"],std_fields_table:[{fieldname:"parent",fieldtype:"Data",label:__("Parent")}],table_fields:["Table","Table MultiSelect"],new_names:{},events:{},user_settings:{},init:function(){frappe.realtime.on("doc_update",function(e){frappe.views.ListView.trigger_list_update(e);var t=locals[e.doctype]&&locals[e.doctype][e.name];t&&("Form"===frappe.get_route()[0]&&cur_frm.doc.doctype===t.doctype&&cur_frm.doc.name===t.name?frappe.ui.form.is_saving||e.modified==cur_frm.doc.modified||(t.__needs_refresh=!0,cur_frm.check_doctype_conflict()):t.__unsaved?t.__needs_refresh=!0:frappe.model.remove_from_locals(t.doctype,t.name))}),frappe.realtime.on("list_update",function(e){frappe.views.ListView.trigger_list_update(e)})},is_value_type:function(e){return"object"==typeof e&&(e=e.fieldtype),-1===frappe.model.no_value_type.indexOf(e)},is_non_std_field:function(e){return!frappe.model.std_fields_list.includes(e)},get_std_field:function(e,t){void 0===t&&(t=!1);var r=$.map([].concat(frappe.model.std_fields).concat(frappe.model.std_fields_table),function(t){if(t.fieldname==e)return t});if(!r.length){if(t)return{fieldname:e};frappe.msgprint(__("Unknown Column: {0}",[e]))}return r[0]},with_doctype:function(e,t,r){if(!locals.DocType[e]){var n=null,a=null;if(localStorage["_doctype:"+e]){var i=JSON.parse(localStorage["_doctype:"+e]);(a=i.filter(function(t){return t.name===e})[0])&&(n=a.modified)}return frappe.call({method:"frappe.desk.form.load.getdoctype",type:"GET",args:{doctype:e,with_parent:1,cached_timestamp:n},async:r,callback:function(r){if(r.exc)throw frappe.msgprint(__("Unable to load: {0}",[__(e)])),"No doctype";"use_cache"==r.message?frappe.model.sync(a):localStorage["_doctype:"+e]=JSON.stringify(r.docs),frappe.model.init_doctype(e),r.user_settings&&(frappe.model.user_settings[e]=JSON.parse(r.user_settings),frappe.model.user_settings[e].updated_on=moment().toString()),t&&t(r)}})}t&&t()},init_doctype:function(doctype){var meta=locals.DocType[doctype];meta.__list_js&&eval(meta.__list_js),meta.__calendar_js&&eval(meta.__calendar_js),meta.__map_js&&eval(meta.__map_js),meta.__tree_js&&eval(meta.__tree_js),meta.__templates&&$.extend(frappe.templates,meta.__templates)},with_doc:function(e,t,r){return new Promise(function(n){if(t||(t=e),!(locals[e]&&locals[e][t]&&frappe.model.get_docinfo(e,t)))return frappe.call({method:"frappe.desk.form.load.getdoc",type:"GET",args:{doctype:e,name:t},callback:function(a){r&&r(t,a),n(frappe.get_doc(e,t))}});r&&r(t),n(frappe.get_doc(e,t))})},get_docinfo:function(e,t){return frappe.model.docinfo[e]&&frappe.model.docinfo[e][t]||null},set_docinfo:function(e,t,r,n){frappe.model.docinfo[e]&&frappe.model.docinfo[e][t]&&(frappe.model.docinfo[e][t][r]=n)},get_shared:function(e,t){return frappe.model.get_docinfo(e,t).shared},get_server_module_name:function(e){var t=frappe.model.scrub(e),r=frappe.model.scrub(locals.DocType[e].module);return frappe.boot.module_app[r]+"."+r+".doctype."+t+"."+t},scrub:function(e){return e.replace(/ /g,"_").toLowerCase()},unscrub:function(e){return __(e||"").replace(/-|_/g," ").replace(/\w*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},can_create:function(e){return-1!==frappe.boot.user.can_create.indexOf(e)},can_read:function(e){return-1!==frappe.boot.user.can_read.indexOf(e)},can_write:function(e){return-1!==frappe.boot.user.can_write.indexOf(e)},can_get_report:function(e){return-1!==frappe.boot.user.can_get_report.indexOf(e)},can_delete:function(e){return!!e&&-1!==frappe.boot.user.can_delete.indexOf(e)},can_cancel:function(e){return!!e&&-1!==frappe.boot.user.can_cancel.indexOf(e)},has_workflow:function(e){return frappe.get_list("Workflow",{document_type:e,is_active:1}).length},is_submittable:function(e){return!!e&&(locals.DocType[e]&&locals.DocType[e].is_submittable)},is_table:function(e){return!!e&&(locals.DocType[e]&&locals.DocType[e].istable)},is_single:function(e){return!!e&&-1!=frappe.boot.single_types.indexOf(e)},is_tree:function(e){return!!e&&-1!=frappe.boot.treeviews.indexOf(e)},can_import:function(e,t){return!!frappe.user_roles.includes("System Manager")||(t?1===t.perm[0].import:-1!==frappe.boot.user.can_import.indexOf(e))},can_export:function(e,t){return!!frappe.user_roles.includes("System Manager")||(t?1===t.perm[0].export:-1!==frappe.boot.user.can_export.indexOf(e))},can_print:function(e,t){return t?1===t.perm[0].print:-1!==frappe.boot.user.can_print.indexOf(e)},can_email:function(e,t){return t?1===t.perm[0].email:-1!==frappe.boot.user.can_email.indexOf(e)},can_share:function(e,t){return t?1===t.perm[0].share:-1!==frappe.boot.user.can_share.indexOf(e)},can_set_user_permissions:function(e,t){return!!frappe.user_roles.includes("System Manager")||(t?1===t.perm[0].set_user_permissions:-1!==frappe.boot.user.can_set_user_permissions.indexOf(e))},has_value:function(e,t,r){var n=locals[e]&&locals[e][t]&&locals[e][t][r],a=frappe.meta.get_docfield(e,r,t);if(frappe.model.table_fields.includes(a.fieldtype)){var i=!1;$.each(locals[a.options]||{},function(r,n){if(n.parent==t&&n.parenttype==e&&n.parentfield==a.fieldname)return i=!0,!1})}else i=!is_null(n);return!!i},get_list:function(e,t){var r=locals[e]||locals[":"+e]||{};return $.isEmptyObject(r)?[]:frappe.utils.filter_dict(r,t)},get_value:function(e,t,r,n){if(!n){if("string"==typeof t&&locals[e]&&locals[e][t])return locals[e][t][r];var a=frappe.get_list(e,t);return a.length&&a[0]?a[0][r]:null}frappe.call({method:"frappe.client.get_value",args:{doctype:e,fieldname:r,filters:t},callback:function(e){e.exc||n(e.message)}})},set_value:function(e,t,r,n,a){var i;$.isPlainObject(e)?(i=e,n=r=t):i=locals[e]&&locals[e][t];var o=r,s=[];return $.isPlainObject(o)||((o={})[r]=n),$.each(o,function(e,t){i&&i[e]!==t?(i.__unedited&&(i[e]||t)&&(i.__unedited=!1),i[e]=t,s.push(function(){return frappe.model.trigger(e,t,i)})):in_list(["Link","Dynamic Link"],a)&&i&&s.push(function(){return frappe.model.trigger(e,t,i)})}),frappe.run_serially(s)},on:function(e,t,r){frappe.provide("frappe.model.events."+e),frappe.model.events[e][t]||(frappe.model.events[e][t]=[]),frappe.model.events[e][t].push(r)},trigger:function(e,t,r){var n=[],a=function(n,a){$.each(n||[],function(n,i){if(i){var o=i(e,t,a||r);return o&&o.then?o:frappe.after_server_call()}})};return frappe.model.events[r.doctype]&&(n.push(function(){return a(frappe.model.events[r.doctype][e])}),n.push(function(){return a(frappe.model.events[r.doctype]["*"])})),frappe.run_serially(n)},get_doc:function(e,t){if(t||(t=e),$.isPlainObject(t)){var r=frappe.get_list(e,t);return r&&r.length?r[0]:null}return locals[e]?locals[e][t]:null},get_children:function(e,t,r,n){if($.isPlainObject(e)){var a=e;n=r,r=t}else a=frappe.get_doc(e,t);var i=a[r]||[];return n?frappe.utils.filter_dict(i,n):i},clear_table:function(e,t){for(var r=0,n=(e[t]||[]).length;r<n;r++){var a=e[t][r];delete locals[a.doctype][a.name]}e[t]=[]},remove_from_locals:function(e,t){this.clear_doc(e,t),frappe.views.formview[e]&&delete frappe.views.formview[e].frm.opendocs[t]},clear_doc:function(e,t){var r=locals[e]&&locals[e][t];if(r){var n=null;if(r.parenttype){n=r.parent;var a=r.parenttype,i=r.parentfield}if(delete locals[e][t],n){var o=locals[a][n],s=[],l=1;$.each(o[i],function(e,r){r.name!=t&&(s.push(r),r.idx=l,l++),o[i]=s})}}},get_no_copy_list:function(e){for(var t=["name","amended_from","amendment_date","cancel_reason"],r=frappe.get_doc("DocType",e).fields||[],n=0,a=r.length;n<a;n++){var i=r[n];cint(i.no_copy)&&t.push(i.fieldname)}return t},delete_doc:function(e,t,r){var n=t,a=frappe.get_meta(e).title_field;if("hash"==frappe.get_meta(e).autoname&&a){n=frappe.model.get_value(e,t,a);n+=" ("+t+")"}frappe.confirm(__("Permanently delete {0}?",[n]),function(){return frappe.call({method:"frappe.client.delete",args:{doctype:e,name:t},callback:function(n,a){n.exc||(frappe.utils.play_sound("delete"),frappe.model.clear_doc(e,t),r&&r(n,a))}})})},rename_doc:function(e,t,r){var n=__("Merge with existing")+" <b>("+__("This cannot be undone")+")</b>",a=new frappe.ui.Dialog({title:__("Rename {0}",[__(t)]),fields:[{label:__("New Name"),fieldname:"new_name",fieldtype:"Data",reqd:1,default:t},{label:n,fieldtype:"Check",fieldname:"merge"}]});a.set_primary_action(__("Rename"),function(){var n=a.get_values();if(n)return frappe.call({method:"frappe.rename_doc",args:{doctype:e,old:t,new:n.new_name,merge:n.merge},btn:a.get_primary_btn(),callback:function(i,o){i.exc||($(document).trigger("rename",[e,t,i.message||n.new_name]),locals[e]&&locals[e][t]&&delete locals[e][t],a.hide(),r&&r(i.message))}})}),a.show()},round_floats_in:function(e,t){t||(t=frappe.meta.get_fieldnames(e.doctype,e.parent,{fieldtype:["in",["Currency","Float"]]}));for(var r=0,n=t.length;r<n;r++){var a=t[r];e[a]=flt(e[a],precision(a,e))}},validate_missing:function(e,t){e[t]||frappe.throw(__("Please specify")+": "+__(frappe.meta.get_label(e.doctype,t,e.parent||e.name)))},get_all_docs:function(e){var t=[e];for(var r in e)if($.isArray(e[r]))for(var n=e[r],a=0,i=n.length;a<i;a++)t.push(n[a]);return t},get_full_column_name:function(e,t){return e.includes("`tab")?e:"`tab"+t+"`.`"+e+"`"},is_numeric_field:function(e){if(e)return"object"==typeof e&&(e=e.fieldtype),frappe.model.numeric_fieldtypes.includes(e)}}),frappe.get_doc=frappe.model.get_doc,frappe.get_children=frappe.model.get_children,frappe.get_list=frappe.model.get_list,frappe.db={get_list:function(e,t){return t||(t={}),t.doctype=e,t.fields||(t.fields=["name"]),t.limit||(t.limit=20),new Promise(function(e){frappe.call({method:"frappe.model.db_query.get_list",args:t,type:"GET",callback:function(t){e(t.message)}})})},exists:function(e,t){return new Promise(function(r){frappe.db.get_value(e,{name:t},"name").then(function(e){e.message&&e.message.name?r(!0):r(!1)})})},get_value:function(e,t,r,n,a){return frappe.call({method:"frappe.client.get_value",type:"GET",args:{doctype:e,fieldname:r,filters:t,parent:a},callback:function(e){n&&n(e.message)}})},get_single_value:function(e,t){return new Promise(function(r){frappe.call({method:"frappe.client.get_single_value",args:{doctype:e,field:t},type:"GET"}).then(function(e){return r(e?e.message:null)})})},set_value:function(e,t,r,n,a){return frappe.call({method:"frappe.client.set_value",args:{doctype:e,name:t,fieldname:r,value:n},callback:function(e){a&&a(e.message)}})},get_doc:function(e,t,r){return void 0===r&&(r=null),new Promise(function(n,a){frappe.call({method:"frappe.client.get",type:"GET",args:{doctype:e,name:t,filters:r},callback:function(e){frappe.model.sync(e.message),n(e.message)}}).fail(a)})},insert:function(e){return frappe.xcall("frappe.client.insert",{doc:e})},delete_doc:function(e,t){return new Promise(function(r){frappe.call("frappe.client.delete",{doctype:e,name:t},function(e){return r(e.message)})})},count:function(e,t){void 0===t&&(t={});var r=t.filters||{},n=["count("+(Array.isArray(r)&&r.some(function(t){return t[0]!==e})?"distinct":"")+" "+frappe.model.get_full_column_name("name",e)+") AS total_count"];return frappe.call({type:"GET",method:"frappe.desk.reportview.get",args:{doctype:e,filters:r,fields:n}}).then(function(e){return e.message.values[0][0]})},get_link_options:function(e,t,r){return void 0===t&&(t=""),void 0===r&&(r={}),new Promise(function(n){frappe.call({type:"GET",method:"frappe.desk.search.search_link",args:{doctype:e,txt:t,filters:r},callback:function(e){n(e.results)}})})}},frappe.provide("frappe.meta.docfield_map"),frappe.provide("frappe.meta.docfield_copy"),frappe.provide("frappe.meta.docfield_list"),frappe.provide("frappe.meta.doctypes"),frappe.provide("frappe.meta.precision_map"),frappe.get_meta=function(e){return locals.DocType?locals.DocType[e]:null},$.extend(frappe.meta,{sync:function(e){$.each(e.fields,function(e,t){frappe.meta.add_field(t)}),frappe.meta.sync_messages(e),e.__print_formats&&frappe.model.sync(e.__print_formats),e.__workflow_docs&&frappe.model.sync(e.__workflow_docs)},add_field:function(e){for(var t in frappe.provide("frappe.meta.docfield_map."+e.parent),frappe.meta.docfield_map[e.parent][e.fieldname||e.label]=e,frappe.meta.docfield_list[e.parent]||(frappe.meta.docfield_list[e.parent]=[]),frappe.meta.docfield_list[e.parent]){var r=frappe.meta.docfield_list[e.parent][t];if(e.fieldname==r.fieldname)return}frappe.meta.docfield_list[e.parent].push(e)},make_docfield_copy_for:function(e,t){var r=frappe.meta.docfield_copy;r[e]||(r[e]={}),r[e][t]||(r[e][t]={});for(var n=frappe.meta.docfield_list[e]||[],a=0,i=n.length;a<i;a++){var o=n[a];r[e][t][o.fieldname||o.label]=copy_dict(o)}},get_field:function(e,t,r){var n=frappe.meta.get_docfield(e,t,r);return n||frappe.model.std_fields.every(function(e){return e.fieldname!==t||(n=e,!1)}),n},get_docfield:function(e,t,r){var n=frappe.meta.get_docfield_copy(e,r);return n?n[t]:null},set_formatter:function(e,t,r,n){frappe.meta.get_docfield(e,t,r).formatter=n},set_indicator_formatter:function(e,t,r,n,a){frappe.meta.get_docfield(e,t,r).formatter=function(e,t,r,i){return repl('<span class="indicator %(color)s">%(name)s</span>',{color:a(),name:n()})}},get_docfields:function(e,t,r){var n=frappe.meta.get_docfield_copy(e,t),a=frappe.meta.sort_docfields(n);return r&&(a=frappe.utils.filter_dict(a,r)),a},get_linked_fields:function(e){return $.map(frappe.get_meta(e).fields,function(e){return"Link"==e.fieldtype?e.options:null})},get_fields_to_check_permissions:function(e){var t=$.map(frappe.meta.get_docfields(e,name),function(e){return"Link"===e.fieldtype&&1!==e.ignore_user_permissions?e:null});return t=t.concat({label:"Name",fieldname:name,options:e})},sort_docfields:function(e){return $.map(e,function(e){return e}).sort(function(e,t){return e.idx-t.idx})},get_docfield_copy:function(e,t){return t?(frappe.meta.docfield_copy[e]&&frappe.meta.docfield_copy[e][t]||frappe.meta.make_docfield_copy_for(e,t),frappe.meta.docfield_copy[e][t]):frappe.meta.docfield_map[e]},get_fieldnames:function(e,t,r){return $.map(frappe.utils.filter_dict(frappe.meta.docfield_map[e],r),function(e){return e.fieldname})},has_field:function(e,t){var r=frappe.meta.docfield_map[e];return r&&r[t]},get_table_fields:function(e){return $.map(frappe.meta.docfield_list[e],function(e){return frappe.model.table_fields.includes(e.fieldtype)?e:null})},get_doctype_for_field:function(e,t){var r=null;return in_list(frappe.model.std_fields_list,t)?r=e:frappe.meta.has_field(e,t)?r=e:(frappe.meta.get_table_fields(e).every(function(e){return!frappe.meta.has_field(e.options,t)||(r=e.options,!1)}),r||console.log(__("Warning: Unable to find {0} in any table related to {1}",[t,__(e)]))),r},get_parentfield:function(e,t){var r=(frappe.get_doc("DocType",e).fields||[]).filter(function(e){return frappe.model.table_fields.includes(e.fieldtype)&&e.options===t});if(!r.length)throw"parentfield not found for "+e+", "+t;return r[0].fieldname},get_label:function(e,t,r){var n={owner:__("Owner"),creation:__("Created On"),modified:__("Last Modified On"),idx:__("Idx"),name:__("Name"),modified_by:__("Last Modified By")};if(n[t])return n[t];var a=this.get_docfield(e,t,r);return(a?a.label:"")||t},get_print_formats:function(e){var t=["Standard"],r=locals.DocType[e].default_print_format,n=frappe.model.get_doc(":Print Settings","Print Settings").enable_raw_printing,a=frappe.get_list("Print Format",{doc_type:e}).sort(function(e,t){return e>t?1:-1});if($.each(a,function(e,r){in_list(t,r.name)||"JS"===r.print_format_type||!cint(n)&&r.raw_printing||t.push(r.name)}),r&&"Standard"!=r){var i=t.indexOf(r);t.splice(i,1).sort(),t.unshift(r)}return t},sync_messages:function(e){e.__messages&&$.extend(frappe._messages,e.__messages)},get_field_currency:function(e,t){var r=frappe.boot.sysdefaults.currency;if(!t&&cur_frm&&(t=cur_frm.doc),e&&e.options)if(t&&-1!=e.options.indexOf(":")){var n=e.options.split(":");if(3==n.length){var a=t[n[1]];!a&&cur_frm&&(a=cur_frm.doc[n[1]]),r=frappe.model.get_value(n[0],a,n[2])||frappe.model.get_value(":"+n[0],a,n[2])||r}}else t&&t[e.options]?r=t[e.options]:cur_frm&&cur_frm.doc[e.options]&&(r=cur_frm.doc[e.options]);return r},get_field_precision:function(e,t){var r=null;if(e&&e.precision)r=cint(e.precision);else if(e&&"Currency"===e.fieldtype){if(!(r=cint(frappe.defaults.get_default("currency_precision")))){var n=get_number_format();r=get_number_format_info(n).precision}}else r=cint(frappe.defaults.get_default("float_precision"))||3;return r}}),$.extend(frappe.model,{docinfo:{},sync:function(e){var t;if(e.docs||e.docinfo||(e={docs:e}),$.isPlainObject(e.docs)&&(e.docs=[e.docs]),e.docs)for(var r=0,n=e.docs.length;r<n;r++){var a=e.docs[r];locals[a.doctype]&&locals[a.doctype][a.name]?frappe.model.update_in_locals(a):frappe.model.add_to_locals(a),a.__last_sync_on=new Date,"DocType"===a.doctype&&frappe.meta.sync(a),a.localname&&(frappe.model.new_names[a.localname]=a.name,$(document).trigger("rename",[a.doctype,a.localname,a.name]),delete locals[a.doctype][a.localname],0===r&&(frappe.model.docinfo[a.doctype][a.name]=frappe.model.docinfo[a.doctype][a.localname],frappe.model.docinfo[a.doctype][a.localname]=void 0))}e.docinfo&&(e.docs?t=e.docs[0]:cur_frm&&(t=cur_frm.doc),t&&(frappe.model.docinfo[t.doctype]||(frappe.model.docinfo[t.doctype]={}),frappe.model.docinfo[t.doctype][t.name]=e.docinfo));return e.docs},add_to_locals:function(e){locals[e.doctype]||(locals[e.doctype]={}),!e.name&&e.__islocal&&(e.parentfield||frappe.model.clear_doc(e),e.name=frappe.model.get_new_name(e.doctype),e.parentfield||frappe.provide("frappe.model.docinfo."+e.doctype+"."+e.name)),locals[e.doctype][e.name]=e;var t=frappe.get_meta(e.doctype);if(!(t?t.istable:e.parentfield))for(var r in e){var n=e[r];if($.isArray(n))for(var a=0,i=n.length;a<i;a++){var o=n[a];"object"!=typeof o||o.parent||(o.parent=e.name),frappe.model.add_to_locals(o)}}},update_in_locals:function(e){var t=locals[e.doctype][e.name],r=function(e,t){Object.keys(t).map(function(r){null==e[r]&&delete t[r]})};for(var n in e){var a=frappe.meta.get_field(e.doctype,n);if(a&&frappe.model.table_fields.includes(a.fieldtype)){e[n]instanceof Array||(e[n]=[]),t[n]instanceof Array||(t[n]=[]);for(var i=0;i<e[n].length;i++){var o=e[n][i],s=t[n][i];s?(locals[o.doctype]||(locals[o.doctype]={}),o.name||(o.name=frappe.model.get_new_name(e.doctype)),locals[o.doctype][o.name]||(delete locals[o.doctype][s.name],locals[o.doctype][o.name]=s),Object.assign(s,o),r(o,s)):(t[n].push(o),o.parent||(o.parent=e.name),frappe.model.add_to_locals(o))}if(t[n].length>e[n].length){for(var l=e[n].length;l<t[n].length;l++){var p=t[n][l];locals[p.doctype]&&locals[p.doctype][p.name]&&delete locals[p.doctype][p.name]}t[n].length=e[n].length}}else t[n]=e[n]}r(e,t)}}),frappe.provide("frappe.model"),$.extend(frappe.model,{new_names:{},new_name_count:{},get_new_doc:function(e,t,r,n){frappe.provide("locals."+e);var a={docstatus:0,doctype:e,name:frappe.model.get_new_name(e),__islocal:1,__unsaved:1,owner:frappe.session.user};if(frappe.model.set_default_values(a,t),t?($.extend(a,{parent:t.name,parentfield:r,parenttype:t.doctype}),t[r]||(t[r]=[]),a.idx=t[r].length+1,t[r].push(a)):frappe.provide("frappe.model.docinfo."+e+"."+a.name),frappe.model.add_to_locals(a),n&&frappe.model.create_mandatory_children(a),t||(a.__run_link_triggers=1),frappe.route_options&&frappe.route_options.name_field){var i=frappe.get_meta(e);i.autoname&&-1!==i.autoname.indexOf("field:")?a[i.autoname.substr(6)]=frappe.route_options.name_field:i.title_field&&(a[i.title_field]=frappe.route_options.name_field),delete frappe.route_options.name_field}return frappe.route_options&&!a.parent&&($.each(frappe.route_options,function(t,r){var n=frappe.meta.has_field(e,t);n&&in_list(["Link","Data","Select","Dynamic Link"],n.fieldtype)&&!n.no_copy&&(a[t]=r)}),frappe.route_options=null),a},make_new_doc_and_get_name:function(e,t){return frappe.model.get_new_doc(e,null,null,t).name},get_new_name:function(e){var t=frappe.model.new_name_count;return t[e]||(t[e]=0),t[e]++,__("New")+" "+__(e)+" "+t[e]},set_default_values:function(e,t){for(var r=e.doctype,n=frappe.meta.get_docfields(r),a=[],i=0;i<n.length;i++){var o=n[i];if(!in_list(frappe.model.no_value_type,o.fieldtype)&&null==e[o.fieldname]){var s=frappe.model.get_default_value(o,e,t);s?(in_list(["Int","Check"],o.fieldtype)?s=cint(s):in_list(["Currency","Float"],o.fieldtype)&&(s=flt(s)),e[o.fieldname]=s,a.push(o.fieldname)):"Select"==o.fieldtype&&o.options&&"string"==typeof o.options&&!in_list(["[Select]","Loading..."],o.options)&&(e[o.fieldname]=o.options.split("\n")[0])}}return a},create_mandatory_children:function(e){var t=frappe.get_meta(e.doctype);t&&t.istable||frappe.meta.get_docfields(e.doctype).forEach(function(t){"Table"===t.fieldtype&&t.reqd&&frappe.model.add_child(e,t.fieldname)})},get_default_value:function(e,t,r){var n,a="",i=frappe.defaults.get_user_permissions(),o=[],s=null;i&&(o=(n=frappe.perm.filter_allowed_docs_for_doctype(i[e.options],t.doctype)).allowed_records,s=n.default_doc);var l=frappe.get_meta(t.doctype),p="Link"===e.fieldtype&&!$.isEmptyObject(i)&&1!=e.ignore_user_permissions&&o.length;if("Link"===e.fieldtype&&"User"!==e.options){if(p&&s)return s;if(!e.ignore_user_permissions){var c=frappe.defaults.get_user_defaults(e.options);c&&1===c.length&&(a=c[0])}if(a||(a=frappe.defaults.get_user_default(e.fieldname)),!a&&e.remember_last_selected_value&&frappe.boot.user.last_selected_values&&(a=frappe.boot.user.last_selected_values[e.options]),a&&(!p||o.includes(a)))return a}if(e.default){if("__user"==e.default||"user"==e.default.toLowerCase())return frappe.session.user;if("user_fullname"==e.default)return frappe.session.user_fullname;if("Today"==e.default)return frappe.datetime.get_today();if("now"===(e.default||"").toLowerCase())return frappe.datetime.now_datetime();if(":"===e.default[0]){var d=frappe.model.get_default_from_boot_docs(e,t,r);if(!p||o.includes(d))return d}else if(e.fieldname===l.title_field)return"";var u=!p||o.includes(e.default);if("Link"!==e.fieldtype||"User"===e.options||u)return e.default}else if("Time"==e.fieldtype)return frappe.datetime.now_time()},get_default_from_boot_docs:function(e,t,r){if(frappe.get_list(e.default).length>0){var n=e.default.slice(1).toLowerCase().replace(" ","_"),a=r?r[n]:frappe.defaults.get_user_default(n),i=a?frappe.get_doc(e.default,a):null;if(i&&i[e.fieldname])return i[e.fieldname]}},add_child:function(e,t,r,n){2===arguments.length&&(r=t,t=frappe.meta.get_field(e.doctype,r).options),n=n?n-.1:(e[r]||[]).length+1;var a=frappe.model.get_new_doc(t,e,r);if(a.idx=n,n!==cint(n))for(var i=e[r].sort(function(e,t){return e.idx-t.idx}),o=0,s=i.length;o<s;o++){i[o].idx=o+1}return cur_frm&&cur_frm.doc==e&&cur_frm.dirty(),a},copy_doc:function(e,t,r,n){var a=["name","amended_from","amendment_date","cancel_reason"],i=frappe.model.get_new_doc(e.doctype,r,n);for(var o in e){var s=frappe.meta.get_docfield(e.doctype,o);if(s&&"__"!=o.substr(0,2)&&!in_list(a,o)&&(!s||t||1!=cint(s.no_copy))){var l=e[o]||[];if(frappe.model.table_fields.includes(s.fieldtype))for(var p=0,c=l.length;p<c;p++){var d=l[p];frappe.model.copy_doc(d,t,i,s.fieldname)}else i[o]=e[o]}}var u=frappe.session.user;return i.__islocal=1,i.docstatus=0,i.owner=u,i.creation="",i.modified_by=u,i.modified="",i},open_mapped_doc:function(e){return e.frm&&e.frm.doc.__unsaved?frappe.throw(__("You have unsaved changes in this form. Please save before you continue.")):!e.source_name&&e.frm?e.source_name=e.frm.doc.name:e.frm||(e.source_name=null),frappe.call({type:"POST",method:"frappe.model.mapper.make_mapped_doc",args:{method:e.method,source_name:e.source_name,args:e.args||null,selected_children:e.frm?e.frm.get_selected():null},freeze:!0,callback:function(t){t.exc||(frappe.model.sync(t.message),e.run_link_triggers&&(frappe.get_doc(t.message.doctype,t.message.name).__run_link_triggers=!0),frappe.set_route("Form",t.message.doctype,t.message.name))}})}}),frappe.create_routes={},frappe.new_doc=function(e,t,r){if("File"!==e)return new Promise(function(n){t&&$.isPlainObject(t)&&(frappe.route_options=t),frappe.model.with_doctype(e,function(){frappe.create_routes[e]?frappe.set_route(frappe.create_routes[e]).then(function(){return n()}):frappe.ui.form.make_quick_entry(e,null,r).then(function(){return n()})})});new frappe.ui.FileUploader({folder:t?t.folder:"Home"})},frappe.provide("frappe.perm"),Object.assign(window,{READ:"read",WRITE:"write",CREATE:"create",DELETE:"delete",SUBMIT:"submit",CANCEL:"cancel",AMEND:"amend"}),$.extend(frappe.perm,{rights:["read","write","create","delete","submit","cancel","amend","report","import","export","print","email","share","set_user_permissions"],doctype_perm:{},has_perm:function(e,t,r,n){t||(t=0),frappe.perm.doctype_perm[e]||(frappe.perm.doctype_perm[e]=frappe.perm.get_perm(e));var a=frappe.perm.doctype_perm[e];if(!a||!a[t])return!1;var i=!!a[t][r];if(0===t&&i&&n){var o=frappe.model.get_docinfo(e,n.name);o&&!o.permissions[r]&&(i=!1)}return i},get_perm:function(e,t){var r=[{read:0}],n=frappe.get_doc("DocType",e),a=frappe.session.user;if(("Administrator"===a||frappe.user_roles.includes("Administrator"))&&(r[0].read=1),!n)return r;if(frappe.perm.build_role_permissions(r,n),t){var i=frappe.model.get_docinfo(e,t.name);if(i&&i.permissions&&Object.keys(i.permissions).forEach(function(e){r[0][e]=i.permissions[e]}),$.isEmptyObject(r[0].if_owner)||(t.owner===a?$.extend(r[0],r[0].if_owner):$.each(r[0].if_owner,function(e){r[0].if_owner[e]&&(r[0][e]=0)})),i&&i.shared)for(var o=0;o<i.shared.length;o++){var s=i.shared[o];s.user===a&&(r[0].read=r[0].read||s.read,r[0].write=r[0].write||s.write,r[0].share=r[0].share||s.share,s.read&&(r[0].email=-1!==frappe.boot.user.can_email.indexOf(e)?1:0,r[0].print=-1!==frappe.boot.user.can_print.indexOf(e)?1:0))}}return frappe.model.can_read(e)&&!r[0].read&&(r[0].read=1),r},build_role_permissions:function(e,t){$.each(t.permissions||[],function(t,r){if(frappe.user_roles.includes(r.role)){var n=cint(r.permlevel);e[n]||(e[n]={},e[n].permlevel=n),$.each(frappe.perm.rights,function(t,a){e[n][a]=e[n][a]||r[a]||0})}}),$.each(e[0],function(t,r){r||delete e[0][t]}),$.each(e,function(t,r){void 0===r&&(e[t]={})})},get_match_rules:function(e,t){var r=[];t||(t="read");var n=frappe.perm.get_perm(e),a=frappe.defaults.get_user_permissions();if(a&&!$.isEmptyObject(a)){var i={},o=frappe.meta.get_fields_to_check_permissions(e);$.each(o,function(t,r){var n=a[r.options]||[],o=frappe.perm.get_allowed_docs_for_doctype(n,e);o.length&&(i[r.label]=o)}),$.isEmptyObject(i)||r.push(i)}return n[0].if_owner&&n[0].read&&r.push({Owner:frappe.session.user}),r},get_field_display_status:function(e,t,r,n){if(!r&&t&&(r=frappe.perm.get_perm(t.doctype,t)),!r)return e&&(cint(e.hidden)||cint(e.hidden_due_to_dependency))?"None":"Write";e.permlevel||(e.permlevel=0);var a=r[e.permlevel],i="None";if(a&&(a.write&&!e.disabled?i="Write":a.read&&(i="Read")),n&&console.log("By Permission:"+i),cint(e.hidden)&&(i="None"),n&&console.log("By Hidden:"+i),cint(e.hidden_due_to_dependency)&&(i="None"),n&&console.log("By Hidden Due To Dependency:"+i),!t)return i;"Write"===i&&cint(t.docstatus)>0&&(i="Read"),n&&console.log("By Submit:"+i);var o=cint(e.allow_on_submit);return"Read"===i&&o&&1===cint(t.docstatus)&&a.write&&(i="Write"),n&&console.log("By Allow on Submit:"+i),"Read"===i&&cur_frm&&cur_frm.state_fieldname&&(cint(cur_frm.read_only)||in_list(cur_frm.states.update_fields,e.fieldname)||e.fieldname==cur_frm.state_fieldname)&&(i="Read"),n&&console.log("By Workflow:"+i),"Write"===i&&cint(e.read_only)&&(i="Read"),n&&console.log("By Read Only:"+i),"Write"===i&&e.set_only_once&&!t.__islocal&&(i="Read"),n&&console.log("By Set Only Once:"+i),i},is_visible:function(e,t,r){return"string"==typeof e&&(e=frappe.meta.get_docfield(t.doctype,e,t.parent||t.name)),"None"!==frappe.perm.get_field_display_status(e,t,r)},get_allowed_docs_for_doctype:function(e,t){return frappe.perm.filter_allowed_docs_for_doctype(e,t,!1)},filter_allowed_docs_for_doctype:function(e,t,r){void 0===r&&(r=!0);var n=(e||[]).filter(function(e){return e.applicable_for===t||!e.applicable_for}),a=n.map(function(e){return e.doc});return r?{allowed_records:a,default_doc:(1===a.length?a:n.filter(function(e){return e.is_default}).map(function(e){return e.doc}))[0]}:a}}),frappe.provide("frappe.workflow"),frappe.workflow={state_fields:{},workflows:{},setup:function(e){var t=frappe.get_list("Workflow",{document_type:e});t.length?(frappe.workflow.workflows[e]=t[0],frappe.workflow.state_fields[e]=t[0].workflow_state_field):frappe.workflow.state_fields[e]=null},get_state_fieldname:function(e){return void 0===frappe.workflow.state_fields[e]&&frappe.workflow.setup(e),frappe.workflow.state_fields[e]},get_default_state:function(e,t){frappe.workflow.setup(e);var r=null;return $.each(frappe.workflow.workflows[e].states,function(e,n){if(cint(n.doc_status)===cint(t))return r=n.state,!1}),r},get_transitions:function(e){return frappe.workflow.setup(e.doctype),frappe.xcall("frappe.model.workflow.get_transitions",{doc:e})},get_document_state:function(e,t){return frappe.workflow.setup(e),frappe.get_children(frappe.workflow.workflows[e],"states",{state:t})[0]},is_self_approval_enabled:function(e){return frappe.workflow.workflows[e].allow_self_approval},is_read_only:function(e,t){var r=frappe.workflow.get_state_fieldname(e);if(r){var n=locals[e][t];if(!n)return!1;if(n.__islocal)return!1;var a=n[r]||frappe.workflow.get_default_state(e,n.docstatus),i=a?frappe.workflow.get_document_state(e,a)&&frappe.workflow.get_document_state(e,a).allow_edit:null;if(!frappe.user_roles.includes(i))return!0}return!1},get_update_fields:function(e){return $.unique($.map(frappe.workflow.workflows[e].states||[],function(e){return e.update_field}))},get_state:function(e){var t=e[this.get_state_fieldname(e.doctype)];return t||(t=this.get_default_state(e.doctype,e.docstatus)),t},get_all_transitions:function(e){return frappe.workflow.workflows[e].transitions||[]},get_all_transition_actions:function(e){return this.get_all_transitions(e).map(function(e){return e.action})}},frappe.provide("frappe.model.user_settings"),$.extend(frappe.model.user_settings,{get:function(e){return frappe.call("frappe.model.utils.user_settings.get",{doctype:e}).then(function(e){return JSON.parse(e.message||"{}")})},save:function(e,t,r){var n=frappe.model.user_settings[e]||{},a=$.extend(!0,{},n);return $.isPlainObject(r)?(a[t]=a[t]||{},$.extend(a[t],r)):a[t]=r,JSON.stringify(n)!==JSON.stringify(a)?this.update(e,a):Promise.resolve()},remove:function(e,t){var r=frappe.model.user_settings[e]||{};return delete r[t],this.update(e,r)},update:function(e,t){return frappe.call({method:"frappe.model.utils.user_settings.save",args:{doctype:e,user_settings:t},callback:function(t){frappe.model.user_settings[e]=t.message}})}}),frappe.get_user_settings=function(e,t){var r=frappe.model.user_settings[e]||{};return t&&(r=r[t]||{}),r},function(e){function t(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function r(e,r,n,a,i,o){return t(function(e,t){return e<<t|e>>>32-t}(t(t(r,e),t(a,o)),i),n)}function n(e,t,n,a,i,o,s){return r(t&n|~t&a,e,t,i,o,s)}function a(e,t,n,a,i,o,s){return r(t&a|n&~a,e,t,i,o,s)}function i(e,t,n,a,i,o,s){return r(t^n^a,e,t,i,o,s)}function o(e,t,n,a,i,o,s){return r(n^(t|~a),e,t,i,o,s)}function s(e,r){e[r>>5]|=128<<r%32,e[14+(r+64>>>9<<4)]=r;var s,l,p,c,d,u=1732584193,f=-271733879,_=-1732584194,h=271733878;for(s=0;s<e.length;s+=16)l=u,p=f,c=_,d=h,u=n(u,f,_,h,e[s],7,-680876936),h=n(h,u,f,_,e[s+1],12,-389564586),_=n(_,h,u,f,e[s+2],17,606105819),f=n(f,_,h,u,e[s+3],22,-1044525330),u=n(u,f,_,h,e[s+4],7,-176418897),h=n(h,u,f,_,e[s+5],12,1200080426),_=n(_,h,u,f,e[s+6],17,-1473231341),f=n(f,_,h,u,e[s+7],22,-45705983),u=n(u,f,_,h,e[s+8],7,1770035416),h=n(h,u,f,_,e[s+9],12,-1958414417),_=n(_,h,u,f,e[s+10],17,-42063),f=n(f,_,h,u,e[s+11],22,-1990404162),u=n(u,f,_,h,e[s+12],7,1804603682),h=n(h,u,f,_,e[s+13],12,-40341101),_=n(_,h,u,f,e[s+14],17,-1502002290),u=a(u,f=n(f,_,h,u,e[s+15],22,1236535329),_,h,e[s+1],5,-165796510),h=a(h,u,f,_,e[s+6],9,-1069501632),_=a(_,h,u,f,e[s+11],14,643717713),f=a(f,_,h,u,e[s],20,-373897302),u=a(u,f,_,h,e[s+5],5,-701558691),h=a(h,u,f,_,e[s+10],9,38016083),_=a(_,h,u,f,e[s+15],14,-660478335),f=a(f,_,h,u,e[s+4],20,-405537848),u=a(u,f,_,h,e[s+9],5,568446438),h=a(h,u,f,_,e[s+14],9,-1019803690),_=a(_,h,u,f,e[s+3],14,-187363961),f=a(f,_,h,u,e[s+8],20,1163531501),u=a(u,f,_,h,e[s+13],5,-1444681467),h=a(h,u,f,_,e[s+2],9,-51403784),_=a(_,h,u,f,e[s+7],14,1735328473),u=i(u,f=a(f,_,h,u,e[s+12],20,-1926607734),_,h,e[s+5],4,-378558),h=i(h,u,f,_,e[s+8],11,-2022574463),_=i(_,h,u,f,e[s+11],16,1839030562),f=i(f,_,h,u,e[s+14],23,-35309556),u=i(u,f,_,h,e[s+1],4,-1530992060),h=i(h,u,f,_,e[s+4],11,1272893353),_=i(_,h,u,f,e[s+7],16,-155497632),f=i(f,_,h,u,e[s+10],23,-1094730640),u=i(u,f,_,h,e[s+13],4,681279174),h=i(h,u,f,_,e[s],11,-358537222),_=i(_,h,u,f,e[s+3],16,-722521979),f=i(f,_,h,u,e[s+6],23,76029189),u=i(u,f,_,h,e[s+9],4,-640364487),h=i(h,u,f,_,e[s+12],11,-421815835),_=i(_,h,u,f,e[s+15],16,530742520),u=o(u,f=i(f,_,h,u,e[s+2],23,-995338651),_,h,e[s],6,-198630844),h=o(h,u,f,_,e[s+7],10,1126891415),_=o(_,h,u,f,e[s+14],15,-1416354905),f=o(f,_,h,u,e[s+5],21,-57434055),u=o(u,f,_,h,e[s+12],6,1700485571),h=o(h,u,f,_,e[s+3],10,-1894986606),_=o(_,h,u,f,e[s+10],15,-1051523),f=o(f,_,h,u,e[s+1],21,-2054922799),u=o(u,f,_,h,e[s+8],6,1873313359),h=o(h,u,f,_,e[s+15],10,-30611744),_=o(_,h,u,f,e[s+6],15,-1560198380),f=o(f,_,h,u,e[s+13],21,1309151649),u=o(u,f,_,h,e[s+4],6,-145523070),h=o(h,u,f,_,e[s+11],10,-1120210379),_=o(_,h,u,f,e[s+2],15,718787259),f=o(f,_,h,u,e[s+9],21,-343485551),u=t(u,l),f=t(f,p),_=t(_,c),h=t(h,d);return[u,f,_,h]}function l(e){var t,r="";for(t=0;t<32*e.length;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function p(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;for(t=0;t<8*e.length;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function c(e){var t,r,n="0123456789abcdef",a="";for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),a+=n.charAt(t>>>4&15)+n.charAt(15&t);return a}function d(e){return unescape(encodeURIComponent(e))}function u(e){return function(e){return l(s(p(e),8*e.length))}(d(e))}function f(e,t){return function(e,t){var r,n,a=p(e),i=[],o=[];for(i[15]=o[15]=void 0,a.length>16&&(a=s(a,8*e.length)),r=0;16>r;r+=1)i[r]=909522486^a[r],o[r]=1549556828^a[r];return n=s(i.concat(p(t)),512+8*t.length),l(s(o.concat(n),640))}(d(e),d(t))}function _(e,t,r){return t?r?f(t,e):function(e,t){return c(f(e,t))}(t,e):r?u(e):function(e){return c(u(e))}(e)}"function"==typeof define&&define.amd?define(function(){return _}):e.md5=_}(window),frappe.user_info=function(e){if(e||(e=frappe.session.user),"bot"===e.toLowerCase())return{fullname:__("Bot"),image:"/assets/frappe/images/ui/bot.png",abbr:"B"};if(frappe.boot.user_info&&frappe.boot.user_info[e])t=frappe.boot.user_info[e];else var t={fullname:frappe.utils.capitalize(e.split("@")[0])||"Unknown"};return t.abbr=frappe.get_abbr(t.fullname),t.color=frappe.get_palette(t.fullname),t},frappe.ui.set_user_background=function(e,t,r){if(t||(t="#page-desktop"),r||(r="Fill Screen"),e){window.cordova&&-1===e.indexOf("http")&&(e=frappe.base_url+e);var n=repl('background: url("%(src)s") center center;',{src:e})}else n="background-color: #4B4C9D;";frappe.dom.set_style(repl("%(selector)s { \t\t%(background)s \t\tbackground-attachment: fixed; \t\t%(style)s \t}",{selector:t,background:n,style:"Fill Screen"===r?"background-size: cover;":""}))},frappe.provide("frappe.user"),$.extend(frappe.user,{name:"Guest",full_name:function(e){return e===frappe.session.user?__("You"):frappe.user_info(e).fullname},image:function(e){return frappe.user_info(e).image},abbr:function(e){return frappe.user_info(e).abbr},has_role:function(e){for(var t in"string"==typeof e&&(e=[e]),e)if(-1!=(frappe.boot?frappe.boot.user.roles:["Guest"]).indexOf(e[t]))return!0},get_desktop_items:function(){return $.map(frappe.boot.allowed_modules,function(e){var t=e.module_name,r=frappe.modules[t]&&frappe.modules[t].type;if(-1===frappe.boot.user.allow_modules.indexOf(t))return null;var n=null;return"module"===r?(-1!=frappe.boot.user.allow_modules.indexOf(t)||frappe.modules[t].is_help)&&(n=t):"page"===r?-1!=frappe.boot.allowed_pages.indexOf(frappe.modules[t].link)&&(n=t):"list"===r?frappe.model.can_read(frappe.modules[t]._doctype)&&(n=t):"view"===r?n=t:"setup"===r?(frappe.user.has_role("System Manager")||frappe.user.has_role("Administrator"))&&(n=t):n=t,n})},is_report_manager:function(){return frappe.user.has_role(["Administrator","System Manager","Report Manager"])},get_formatted_email:function(e){var t=frappe.user.full_name(e);if(t){var r="";return-1!==t.search(/[\[\]\\()<>@,:;".]/)&&(r='"'),repl("%(quote)s%(fullname)s%(quote)s <%(email)s>",{fullname:t,email:e,quote:r})}return e},get_emails:function(){return Object.keys(frappe.boot.user_info).map(function(e){return frappe.boot.user_info[e].email})},toString:function(){return this.name}}),frappe.session_alive=!0,$(document).bind("mousemove",function(){!1===frappe.session_alive&&$(document).trigger("session_alive"),frappe.session_alive=!0,frappe.session_alive_timeout&&clearTimeout(frappe.session_alive_timeout),frappe.session_alive_timeout=setTimeout("frappe.session_alive=false;",3e4)}),frappe.avatar=function(e,t,r,n){var a;if(void 0===n&&(n=null),e)a=frappe.user_info(e);else{var i=r||frappe.get_cookie("full_name");a={image:null===n?frappe.get_cookie("user_image"):n,fullname:i,abbr:frappe.get_abbr(i),color:frappe.get_palette(i)}}if(r||(r=a.fullname),t||(t="avatar-small"),a.image||n)return n=n||a.image,'<span class="avatar '+t+'" title="'+r+'">\n\t\t\t\t<span class="avatar-frame" style=\'background-image: url("'+(window.cordova&&-1===n.indexOf("http")?frappe.base_url+n:n)+'")\'\n\t\t\t\t\ttitle="'+r+'"></span>\n\t\t\t</span>';var o=a.abbr;return"avatar-small"!==t&&"avatar-xs"!=t||(o=o.substr(0,1)),'<span class="avatar '+t+'" title="'+r+'">\n\t\t\t<div class="standard-image" style="background-color: '+a.color+';">\n\t\t\t\t'+o+"</div>\n\t\t</span>"},frappe.ui.scroll=function(e,t,r){var n=$(".navbar").height()+$(".page-head").height(),a=$(e).offset().top-n-cint(r);t?$("html, body").animate({scrollTop:a}):$(window).scrollTop(a)},frappe.get_palette=function(e){return"#fafbfc"},frappe.get_abbr=function(e,t){if(!e)return"";var r="";return $.each(e.split(" "),function(e,n){return!(r.length>=(t||2))&&(!n.trim().length||void(r+=n.trim()[0]))}),r||"?"},frappe.gravatars={},frappe.get_gravatar=function(e,t){void 0===t&&(t=0);var r=t?"s="+t:"d=retro";return frappe.gravatars[e]||(frappe.gravatars[e]="https://secure.gravatar.com/avatar/"+md5(e)+"?"+r),frappe.gravatars[e]},window.repl=function(e,t){if(null==e)return"";for(var r in t)e=e.split("%("+r+")s").join(t[r]);return e},window.replace_all=function(e,t,r){return e.split(t).join(r)},window.strip_html=function(e){return e.replace(/<[^>]*>/g,"")},window.strip=function(e,t){if(e){e=lstrip(e,t);return e=rstrip(e,t)}},window.lstrip=function(e,t){t||(t=["\n","\t"," "]);for(var r=e.substr(0,1);in_list(t,r);){r=(e=e.substr(1)).substr(0,1)}return e},window.rstrip=function(e,t){t||(t=["\n","\t"," "]);for(var r=e.substr(e.length-1);in_list(t,r);){r=(e=e.substr(0,e.length-1)).substr(e.length-1)}return e},frappe.get_cookie=function(e){return frappe.get_cookies()[e]},frappe.get_cookies=function(){var e=document.cookie,t=0,r={};return document.cookie.match(/^\s*\$Version=(?:"1"|1);\s*(.*)/)&&(e=RegExp.$1,t=1),0===t?e.split(/[,;]/).map(function(e){var t=e.split(/=/,2),n=decodeURIComponent(t[0].trimLeft()),a=t.length>1?decodeURIComponent(t[1].trimRight()):null;a&&'"'===a.charAt(0)&&(a=a.substr(1,a.length-2)),r[n]=a}):e.match(/(?:^|\s+)([!#$%&'*+\-.0-9A-Z^`a-z|~]+)=([!#$%&'*+\-.0-9A-Z^`a-z|~]*|"(?:[\x20-\x7E\x80\xFF]|\\[\x00-\x7F])*")(?=\s*[,;]|$)/g).map(function(e,t){var n=e,a='"'===t.charAt(0)?t.substr(1,-1).replace(/\\(.)/g,"$1"):t;r[n]=a}),r},frappe.palette=[["#FFC4C4",0],["#FFE8CD",0],["#FFD2C2",0],["#FF8989",0],["#FFD19C",0],["#FFA685",0],["#FF4D4D",1],["#FFB868",0],["#FF7846",1],["#A83333",1],["#A87945",1],["#A84F2E",1],["#D2D2FF",0],["#F8D4F8",0],["#DAC7FF",0],["#A3A3FF",0],["#F3AAF0",0],["#B592FF",0],["#7575FF",0],["#EC7DEA",0],["#8E58FF",1],["#4D4DA8",1],["#934F92",1],["#5E3AA8",1],["#EBF8CC",0],["#FFD7D7",0],["#D2F8ED",0],["#D9F399",0],["#FFB1B1",0],["#A4F3DD",0],["#C5EC63",0],["#FF8989",1],["#77ECCA",0],["#7B933D",1],["#A85B5B",1],["#49937E",1],["#FFFACD",0],["#D2F1FF",0],["#CEF6D1",0],["#FFF69C",0],["#A6E4FF",0],["#9DECA2",0],["#FFF168",0],["#78D6FF",0],["#6BE273",0],["#A89F45",1],["#4F8EA8",1],["#428B46",1]],frappe.is_mobile=function(){return $(document).width()<768},frappe.utils.xss_sanitise=function(e,t){var r=e,n={"<":"&lt",">":"&gt",'"':"&quot","'":"&#x27","/":"&#x2F"};if((t=Object.assign({},{strategies:["html","js"]},t)).strategies.includes("html"))for(var a in n){var i=n[a],o=new RegExp(a,"g");r=r.replace(o,i)}return t.strategies.includes("js")&&(r=r.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")),r},frappe.utils.sanitise_redirect=function(e){return function(e){function t(e){var t=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:/\n?]+)/gim.exec(e);return null==t?"":t[1]}return!!function(e){return/^(?:[a-z]+:)?\/\//i.test(e)}(e)&&t(location.href)!==t(e)}(e=frappe.utils.strip_url(e))?"":function(e){return e.replace(/j[\s]*(&#x.{1,7})?a[\s]*(&#x.{1,7})?v[\s]*(&#x.{1,7})?a[\s]*(&#x.{1,7})?s[\s]*(&#x.{1,7})?c[\s]*(&#x.{1,7})?r[\s]*(&#x.{1,7})?i[\s]*(&#x.{1,7})?p[\s]*(&#x.{1,7})?t/gi,"")}(frappe.utils.xss_sanitise(e,{strategies:["js"]}))},frappe.utils.strip_url=function(e){return e.replace(/^[^A-Za-z0-9(//)#]+/g,"")},frappe.utils.new_auto_repeat_prompt=function(e){var t=[{fieldname:"frequency",fieldtype:"Select",label:__("Frequency"),reqd:1,options:[{label:__("Daily"),value:"Daily"},{label:__("Weekly"),value:"Weekly"},{label:__("Monthly"),value:"Monthly"},{label:__("Quarterly"),value:"Quarterly"},{label:__("Half-yearly"),value:"Half-yearly"},{label:__("Yearly"),value:"Yearly"}]},{fieldname:"start_date",fieldtype:"Date",label:__("Start Date"),reqd:1,default:frappe.datetime.nowdate()},{fieldname:"end_date",fieldtype:"Date",label:__("End Date")}];frappe.prompt(t,function(t){frappe.call({method:"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat",args:{doctype:e.doc.doctype,docname:e.doc.name,frequency:t.frequency,start_date:t.start_date,end_date:t.end_date},callback:function(t){t.message&&(frappe.show_alert({message:__("Auto Repeat created for this document"),indicator:"green"}),e.reload_doc())}})},__("Auto Repeat"),__("Save"))},frappe.utils.get_page_view_count=function(e){return frappe.call("frappe.website.doctype.web_page_view.web_page_view.get_page_view_count",{path:e})},frappe.urllib={get_arg:function(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null==t?"":decodeURIComponent(t[1])},get_dict:function(){var e={},t=window.location.href.split("?")[1];if(!t)return e;if(-1!=t.indexOf("#")&&(t=t.split("#")[0]),!t)return e;t=t.split("&");for(var r=0;r<t.length;r++){var n=t[r].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e},get_base_url:function(){var e=frappe.base_url||window.location.origin;return"/"==e.substr(e.length-1,1)&&(e=e.substr(0,e.length-1)),e},get_full_url:function(e){return 0===e.indexOf("http://")||0===e.indexOf("https://")?e:"/"===e.substr(0,1)?frappe.urllib.get_base_url()+e:frappe.urllib.get_base_url()+"/"+e}},window.open_url_post=function(e,t,r){if(!window.cordova){var n=document.createElement("form");for(var a in n.action=e,n.method="POST",n.style.display="none",r&&(n.target="_blank"),t.csrf_token=frappe.csrf_token,t){var i=document.createElement("textarea");i.name=a;var o=t[a];"string"!=typeof o&&(o=JSON.stringify(o)),i.value=o,n.appendChild(i)}return document.body.appendChild(n),n.submit(),n}var s=e+"api/method/"+t.cmd+frappe.utils.make_query_string(t,!1);window.location.href=s},window.get_url_arg=frappe.urllib.get_arg,window.get_url_dict=frappe.urllib.get_dict,frappe.provide("frappe.datetime"),window.comment_when=function(e,t){return'<span class="frappe-timestamp '+(t?" mini":"")+'" data-timestamp="'+e+'" title="'+(frappe.datetime.str_to_user?frappe.datetime.str_to_user(e):e)+'">'+prettyDate(e,t)+"</span>"},frappe.datetime.comment_when=comment_when,frappe.datetime.prettyDate=prettyDate,frappe.datetime.refresh_when=function(){jQuery&&$(".frappe-timestamp").each(function(){$(this).html(prettyDate($(this).attr("data-timestamp"),$(this).hasClass("mini")))})},setInterval(function(){frappe.datetime.refresh_when()},6e4),frappe.click_button=function(e,t){var r="";"string"==typeof t&&(r=t+" ",t=0);var n=$(r+'.btn:contains("'+e+'"):visible');if(!n.length)throw"did not find any button containing "+e;return n.get(t||0).click(),frappe.timeout(.5)},frappe.click_link=function(e,t){var r=$('a:contains("'+e+'"):visible');if(!r.length)throw"did not find any link containing "+e;return r.get(t||0).click(),frappe.timeout(.5)},frappe.click_element=function(e,t){var r=$(""+e);if(!r.length)throw"did not find any link containing "+e;return r.get(t||0).click(),frappe.timeout(.5)},frappe.set_control=function(e,t){var r=$('.form-control[data-fieldname="'+e+'"]:visible');if(!r.length)throw"did not find any control with fieldname "+e;return r.val(t).trigger("change"),frappe.timeout(.5)},frappe.click_check=function(e,t){var r=$('.checkbox:contains("'+e+'") input');if(!r.length)throw"did not find any checkbox with label "+e;return r.get(t||0).click(),frappe.timeout(.5)};var showdown=createCommonjsModule(function(e){(function(){function t(e){var t={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:"Remove only spaces, ' and \" from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids",type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,description:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,description:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,description:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,description:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,description:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",description:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,description:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,description:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,description:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,description:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,description:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},completeHTMLDocument:{defaultValue:!1,description:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,description:"Enable support for document metadata (defined at the top of the document between `«««` and `»»»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,description:"Split adjacent blockquote blocks",type:"boolean"}};if(!1===e)return JSON.parse(JSON.stringify(t));var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n].defaultValue);return r}var r={},n={},a={},i=t(!0),o="vanilla",s={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:t(!0),allOn:function(){var e=t(!0),r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=!0);return r}()};function l(e,t){var n=t?"Error in "+t+" extension->":"Error in unnamed extension",a={valid:!0,error:""};r.helper.isArray(e)||(e=[e]);for(var i=0;i<e.length;++i){var o=n+" sub-extension "+i+": ",s=e[i];if("object"!=typeof s)return a.valid=!1,a.error=o+"must be an object, but "+typeof s+" given",a;if(!r.helper.isString(s.type))return a.valid=!1,a.error=o+'property "type" must be a string, but '+typeof s.type+" given",a;var l=s.type=s.type.toLowerCase();if("language"===l&&(l=s.type="lang"),"html"===l&&(l=s.type="output"),"lang"!==l&&"output"!==l&&"listener"!==l)return a.valid=!1,a.error=o+"type "+l+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',a;if("listener"===l){if(r.helper.isUndefined(s.listeners))return a.valid=!1,a.error=o+'. Extensions of type "listener" must have a property called "listeners"',a}else if(r.helper.isUndefined(s.filter)&&r.helper.isUndefined(s.regex))return a.valid=!1,a.error=o+l+' extensions must define either a "regex" property or a "filter" method',a;if(s.listeners){if("object"!=typeof s.listeners)return a.valid=!1,a.error=o+'"listeners" property must be an object but '+typeof s.listeners+" given",a;for(var p in s.listeners)if(s.listeners.hasOwnProperty(p)&&"function"!=typeof s.listeners[p])return a.valid=!1,a.error=o+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+p+" must be a function but "+typeof s.listeners[p]+" given",a}if(s.filter){if("function"!=typeof s.filter)return a.valid=!1,a.error=o+'"filter" must be a function, but '+typeof s.filter+" given",a}else if(s.regex){if(r.helper.isString(s.regex)&&(s.regex=new RegExp(s.regex,"g")),!(s.regex instanceof RegExp))return a.valid=!1,a.error=o+'"regex" property must either be a string or a RegExp object, but '+typeof s.regex+" given",a;if(r.helper.isUndefined(s.replace))return a.valid=!1,a.error=o+'"regex" extensions must implement a replace string or function',a}}return a}function p(e,t){return"¨E"+t.charCodeAt(0)+"E"}r.helper={},r.extensions={},r.setOption=function(e,t){return i[e]=t,this},r.getOption=function(e){return i[e]},r.getOptions=function(){return i},r.resetOptions=function(){i=t(!0)},r.setFlavor=function(e){if(!s.hasOwnProperty(e))throw Error(e+" flavor was not found");r.resetOptions();var t=s[e];for(var n in o=e,t)t.hasOwnProperty(n)&&(i[n]=t[n])},r.getFlavor=function(){return o},r.getFlavorOptions=function(e){if(s.hasOwnProperty(e))return s[e]},r.getDefaultOptions=function(e){return t(e)},r.subParser=function(e,t){if(r.helper.isString(e)){if(void 0===t){if(n.hasOwnProperty(e))return n[e];throw Error("SubParser named "+e+" not registered!")}n[e]=t}},r.extension=function(e,t){if(!r.helper.isString(e))throw Error("Extension 'name' must be a string");if(e=r.helper.stdExtName(e),r.helper.isUndefined(t)){if(!a.hasOwnProperty(e))throw Error("Extension named "+e+" is not registered!");return a[e]}"function"==typeof t&&(t=t()),r.helper.isArray(t)||(t=[t]);var n=l(t,e);if(!n.valid)throw Error(n.error);a[e]=t},r.getAllExtensions=function(){return a},r.removeExtension=function(e){delete a[e]},r.resetExtensions=function(){a={}},r.validateExtension=function(e){var t=l(e,null);return!!t.valid||(console.warn(t.error),!1)},r.hasOwnProperty("helper")||(r.helper={}),r.helper.isString=function(e){return"string"==typeof e||e instanceof String},r.helper.isFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},r.helper.isArray=function(e){return Array.isArray(e)},r.helper.isUndefined=function(e){return void 0===e},r.helper.forEach=function(e,t){if(r.helper.isUndefined(e))throw new Error("obj param is required");if(r.helper.isUndefined(t))throw new Error("callback param is required");if(!r.helper.isFunction(t))throw new Error("callback param must be a function/closure");if("function"==typeof e.forEach)e.forEach(t);else if(r.helper.isArray(e))for(var n=0;n<e.length;n++)t(e[n],n,e);else{if("object"!=typeof e)throw new Error("obj does not seem to be an array or an iterable object");for(var a in e)e.hasOwnProperty(a)&&t(e[a],a,e)}},r.helper.stdExtName=function(e){return e.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()},r.helper.escapeCharactersCallback=p,r.helper.escapeCharacters=function(e,t,r){var n="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";r&&(n="\\\\"+n);var a=new RegExp(n,"g");return e=e.replace(a,p)},r.helper.unescapeHTMLEntities=function(e){return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var c=function(e,t,r,n){var a,i,o,s,l,p=n||"",c=p.indexOf("g")>-1,d=new RegExp(t+"|"+r,"g"+p.replace(/g/g,"")),u=new RegExp(t,p.replace(/g/g,"")),f=[];do{for(a=0;o=d.exec(e);)if(u.test(o[0]))a++||(s=(i=d.lastIndex)-o[0].length);else if(a&&!--a){l=o.index+o[0].length;var _={left:{start:s,end:i},match:{start:i,end:o.index},right:{start:o.index,end:l},wholeMatch:{start:s,end:l}};if(f.push(_),!c)return f}}while(a&&(d.lastIndex=i));return f};r.helper.matchRecursiveRegExp=function(e,t,r,n){for(var a=c(e,t,r,n),i=[],o=0;o<a.length;++o)i.push([e.slice(a[o].wholeMatch.start,a[o].wholeMatch.end),e.slice(a[o].match.start,a[o].match.end),e.slice(a[o].left.start,a[o].left.end),e.slice(a[o].right.start,a[o].right.end)]);return i},r.helper.replaceRecursiveRegExp=function(e,t,n,a,i){if(!r.helper.isFunction(t)){var o=t;t=function(){return o}}var s=c(e,n,a,i),l=e,p=s.length;if(p>0){var d=[];0!==s[0].wholeMatch.start&&d.push(e.slice(0,s[0].wholeMatch.start));for(var u=0;u<p;++u)d.push(t(e.slice(s[u].wholeMatch.start,s[u].wholeMatch.end),e.slice(s[u].match.start,s[u].match.end),e.slice(s[u].left.start,s[u].left.end),e.slice(s[u].right.start,s[u].right.end))),u<p-1&&d.push(e.slice(s[u].wholeMatch.end,s[u+1].wholeMatch.start));s[p-1].wholeMatch.end<e.length&&d.push(e.slice(s[p-1].wholeMatch.end)),l=d.join("")}return l},r.helper.regexIndexOf=function(e,t,n){if(!r.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(t instanceof RegExp==!1)throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var a=e.substring(n||0).search(t);return a>=0?a+(n||0):a},r.helper.splitAtIndex=function(e,t){if(!r.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[e.substring(0,t),e.substring(t)]},r.helper.encodeEmailAddress=function(e){var t=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+e.charCodeAt(0).toString(16)+";"},function(e){return e}];return e=e.replace(/./g,function(e){if("@"===e)e=t[Math.floor(2*Math.random())](e);else{var r=Math.random();e=r>.9?t[2](e):r>.45?t[1](e):t[0](e)}return e})},r.helper.padEnd=function(e,t,r){return t>>=0,r=String(r||" "),e.length>t?String(e):((t-=e.length)>r.length&&(r+=r.repeat(t/r.length)),String(e)+r.slice(0,t))},"undefined"==typeof console&&(console={warn:function(e){alert(e)},log:function(e){alert(e)},error:function(e){throw e}}),r.helper.regexes={asteriskDashAndColon:/([*_:~])/g},r.helper.emojis={"+1":"👍","-1":"👎",100:"💯",1234:"🔢","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉","8ball":"🎱",a:"🅰️",ab:"🆎",abc:"🔤",abcd:"🔡",accept:"🉑",aerial_tramway:"🚡",airplane:"✈️",alarm_clock:"⏰",alembic:"⚗️",alien:"👽",ambulance:"🚑",amphora:"🏺",anchor:"⚓️",angel:"👼",anger:"💢",angry:"😠",anguished:"😧",ant:"🐜",apple:"🍎",aquarius:"♒️",aries:"♈️",arrow_backward:"◀️",arrow_double_down:"⏬",arrow_double_up:"⏫",arrow_down:"⬇️",arrow_down_small:"🔽",arrow_forward:"▶️",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",arrow_left:"⬅️",arrow_lower_left:"↙️",arrow_lower_right:"↘️",arrow_right:"➡️",arrow_right_hook:"↪️",arrow_up:"⬆️",arrow_up_down:"↕️",arrow_up_small:"🔼",arrow_upper_left:"↖️",arrow_upper_right:"↗️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",art:"🎨",articulated_lorry:"🚛",artificial_satellite:"🛰",astonished:"😲",athletic_shoe:"👟",atm:"🏧",atom_symbol:"⚛️",avocado:"🥑",b:"🅱️",baby:"👶",baby_bottle:"🍼",baby_chick:"🐤",baby_symbol:"🚼",back:"🔙",bacon:"🥓",badminton:"🏸",baggage_claim:"🛄",baguette_bread:"🥖",balance_scale:"⚖️",balloon:"🎈",ballot_box:"🗳",ballot_box_with_check:"☑️",bamboo:"🎍",banana:"🍌",bangbang:"‼️",bank:"🏦",bar_chart:"📊",barber:"💈",baseball:"⚾️",basketball:"🏀",basketball_man:"⛹️",basketball_woman:"⛹️&zwj;♀️",bat:"🦇",bath:"🛀",bathtub:"🛁",battery:"🔋",beach_umbrella:"🏖",bear:"🐻",bed:"🛏",bee:"🐝",beer:"🍺",beers:"🍻",beetle:"🐞",beginner:"🔰",bell:"🔔",bellhop_bell:"🛎",bento:"🍱",biking_man:"🚴",bike:"🚲",biking_woman:"🚴&zwj;♀️",bikini:"👙",biohazard:"☣️",bird:"🐦",birthday:"🎂",black_circle:"⚫️",black_flag:"🏴",black_heart:"🖤",black_joker:"🃏",black_large_square:"⬛️",black_medium_small_square:"◾️",black_medium_square:"◼️",black_nib:"✒️",black_small_square:"▪️",black_square_button:"🔲",blonde_man:"👱",blonde_woman:"👱&zwj;♀️",blossom:"🌼",blowfish:"🐡",blue_book:"📘",blue_car:"🚙",blue_heart:"💙",blush:"😊",boar:"🐗",boat:"⛵️",bomb:"💣",book:"📖",bookmark:"🔖",bookmark_tabs:"📑",books:"📚",boom:"💥",boot:"👢",bouquet:"💐",bowing_man:"🙇",bow_and_arrow:"🏹",bowing_woman:"🙇&zwj;♀️",bowling:"🎳",boxing_glove:"🥊",boy:"👦",bread:"🍞",bride_with_veil:"👰",bridge_at_night:"🌉",briefcase:"💼",broken_heart:"💔",bug:"🐛",building_construction:"🏗",bulb:"💡",bullettrain_front:"🚅",bullettrain_side:"🚄",burrito:"🌯",bus:"🚌",business_suit_levitating:"🕴",busstop:"🚏",bust_in_silhouette:"👤",busts_in_silhouette:"👥",butterfly:"🦋",cactus:"🌵",cake:"🍰",calendar:"📆",call_me_hand:"🤙",calling:"📲",camel:"🐫",camera:"📷",camera_flash:"📸",camping:"🏕",cancer:"♋️",candle:"🕯",candy:"🍬",canoe:"🛶",capital_abcd:"🔠",capricorn:"♑️",car:"🚗",card_file_box:"🗃",card_index:"📇",card_index_dividers:"🗂",carousel_horse:"🎠",carrot:"🥕",cat:"🐱",cat2:"🐈",cd:"💿",chains:"⛓",champagne:"🍾",chart:"💹",chart_with_downwards_trend:"📉",chart_with_upwards_trend:"📈",checkered_flag:"🏁",cheese:"🧀",cherries:"🍒",cherry_blossom:"🌸",chestnut:"🌰",chicken:"🐔",children_crossing:"🚸",chipmunk:"🐿",chocolate_bar:"🍫",christmas_tree:"🎄",church:"⛪️",cinema:"🎦",circus_tent:"🎪",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",cl:"🆑",clamp:"🗜",clap:"👏",clapper:"🎬",classical_building:"🏛",clinking_glasses:"🥂",clipboard:"📋",clock1:"🕐",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",clock12:"🕛",clock1230:"🕧",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",closed_book:"📕",closed_lock_with_key:"🔐",closed_umbrella:"🌂",cloud:"☁️",cloud_with_lightning:"🌩",cloud_with_lightning_and_rain:"⛈",cloud_with_rain:"🌧",cloud_with_snow:"🌨",clown_face:"🤡",clubs:"♣️",cocktail:"🍸",coffee:"☕️",coffin:"⚰️",cold_sweat:"😰",comet:"☄️",computer:"💻",computer_mouse:"🖱",confetti_ball:"🎊",confounded:"😖",confused:"😕",congratulations:"㊗️",construction:"🚧",construction_worker_man:"👷",construction_worker_woman:"👷&zwj;♀️",control_knobs:"🎛",convenience_store:"🏪",cookie:"🍪",cool:"🆒",policeman:"👮",copyright:"©️",corn:"🌽",couch_and_lamp:"🛋",couple:"👫",couple_with_heart_woman_man:"💑",couple_with_heart_man_man:"👨&zwj;❤️&zwj;👨",couple_with_heart_woman_woman:"👩&zwj;❤️&zwj;👩",couplekiss_man_man:"👨&zwj;❤️&zwj;💋&zwj;👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩&zwj;❤️&zwj;💋&zwj;👩",cow:"🐮",cow2:"🐄",cowboy_hat_face:"🤠",crab:"🦀",crayon:"🖍",credit_card:"💳",crescent_moon:"🌙",cricket:"🏏",crocodile:"🐊",croissant:"🥐",crossed_fingers:"🤞",crossed_flags:"🎌",crossed_swords:"⚔️",crown:"👑",cry:"😢",crying_cat_face:"😿",crystal_ball:"🔮",cucumber:"🥒",cupid:"💘",curly_loop:"➰",currency_exchange:"💱",curry:"🍛",custard:"🍮",customs:"🛃",cyclone:"🌀",dagger:"🗡",dancer:"💃",dancing_women:"👯",dancing_men:"👯&zwj;♂️",dango:"🍡",dark_sunglasses:"🕶",dart:"🎯",dash:"💨",date:"📅",deciduous_tree:"🌳",deer:"🦌",department_store:"🏬",derelict_house:"🏚",desert:"🏜",desert_island:"🏝",desktop_computer:"🖥",male_detective:"🕵️",diamond_shape_with_a_dot_inside:"💠",diamonds:"♦️",disappointed:"😞",disappointed_relieved:"😥",dizzy:"💫",dizzy_face:"😵",do_not_litter:"🚯",dog:"🐶",dog2:"🐕",dollar:"💵",dolls:"🎎",dolphin:"🐬",door:"🚪",doughnut:"🍩",dove:"🕊",dragon:"🐉",dragon_face:"🐲",dress:"👗",dromedary_camel:"🐪",drooling_face:"🤤",droplet:"💧",drum:"🥁",duck:"🦆",dvd:"📀","e-mail":"📧",eagle:"🦅",ear:"👂",ear_of_rice:"🌾",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",egg:"🥚",eggplant:"🍆",eight_pointed_black_star:"✴️",eight_spoked_asterisk:"✳️",electric_plug:"🔌",elephant:"🐘",email:"✉️",end:"🔚",envelope_with_arrow:"📩",euro:"💶",european_castle:"🏰",european_post_office:"🏤",evergreen_tree:"🌲",exclamation:"❗️",expressionless:"😑",eye:"👁",eye_speech_bubble:"👁&zwj;🗨",eyeglasses:"👓",eyes:"👀",face_with_head_bandage:"🤕",face_with_thermometer:"🤒",fist_oncoming:"👊",factory:"🏭",fallen_leaf:"🍂",family_man_woman_boy:"👪",family_man_boy:"👨&zwj;👦",family_man_boy_boy:"👨&zwj;👦&zwj;👦",family_man_girl:"👨&zwj;👧",family_man_girl_boy:"👨&zwj;👧&zwj;👦",family_man_girl_girl:"👨&zwj;👧&zwj;👧",family_man_man_boy:"👨&zwj;👨&zwj;👦",family_man_man_boy_boy:"👨&zwj;👨&zwj;👦&zwj;👦",family_man_man_girl:"👨&zwj;👨&zwj;👧",family_man_man_girl_boy:"👨&zwj;👨&zwj;👧&zwj;👦",family_man_man_girl_girl:"👨&zwj;👨&zwj;👧&zwj;👧",family_man_woman_boy_boy:"👨&zwj;👩&zwj;👦&zwj;👦",family_man_woman_girl:"👨&zwj;👩&zwj;👧",family_man_woman_girl_boy:"👨&zwj;👩&zwj;👧&zwj;👦",family_man_woman_girl_girl:"👨&zwj;👩&zwj;👧&zwj;👧",family_woman_boy:"👩&zwj;👦",family_woman_boy_boy:"👩&zwj;👦&zwj;👦",family_woman_girl:"👩&zwj;👧",family_woman_girl_boy:"👩&zwj;👧&zwj;👦",family_woman_girl_girl:"👩&zwj;👧&zwj;👧",family_woman_woman_boy:"👩&zwj;👩&zwj;👦",family_woman_woman_boy_boy:"👩&zwj;👩&zwj;👦&zwj;👦",family_woman_woman_girl:"👩&zwj;👩&zwj;👧",family_woman_woman_girl_boy:"👩&zwj;👩&zwj;👧&zwj;👦",family_woman_woman_girl_girl:"👩&zwj;👩&zwj;👧&zwj;👧",fast_forward:"⏩",fax:"📠",fearful:"😨",feet:"🐾",female_detective:"🕵️&zwj;♀️",ferris_wheel:"🎡",ferry:"⛴",field_hockey:"🏑",file_cabinet:"🗄",file_folder:"📁",film_projector:"📽",film_strip:"🎞",fire:"🔥",fire_engine:"🚒",fireworks:"🎆",first_quarter_moon:"🌓",first_quarter_moon_with_face:"🌛",fish:"🐟",fish_cake:"🍥",fishing_pole_and_fish:"🎣",fist_raised:"✊",fist_left:"🤛",fist_right:"🤜",flags:"🎏",flashlight:"🔦",fleur_de_lis:"⚜️",flight_arrival:"🛬",flight_departure:"🛫",floppy_disk:"💾",flower_playing_cards:"🎴",flushed:"😳",fog:"🌫",foggy:"🌁",football:"🏈",footprints:"👣",fork_and_knife:"🍴",fountain:"⛲️",fountain_pen:"🖋",four_leaf_clover:"🍀",fox_face:"🦊",framed_picture:"🖼",free:"🆓",fried_egg:"🍳",fried_shrimp:"🍤",fries:"🍟",frog:"🐸",frowning:"😦",frowning_face:"☹️",frowning_man:"🙍&zwj;♂️",frowning_woman:"🙍",middle_finger:"🖕",fuelpump:"⛽️",full_moon:"🌕",full_moon_with_face:"🌝",funeral_urn:"⚱️",game_die:"🎲",gear:"⚙️",gem:"💎",gemini:"♊️",ghost:"👻",gift:"🎁",gift_heart:"💝",girl:"👧",globe_with_meridians:"🌐",goal_net:"🥅",goat:"🐐",golf:"⛳️",golfing_man:"🏌️",golfing_woman:"🏌️&zwj;♀️",gorilla:"🦍",grapes:"🍇",green_apple:"🍏",green_book:"📗",green_heart:"💚",green_salad:"🥗",grey_exclamation:"❕",grey_question:"❔",grimacing:"😬",grin:"😁",grinning:"😀",guardsman:"💂",guardswoman:"💂&zwj;♀️",guitar:"🎸",gun:"🔫",haircut_woman:"💇",haircut_man:"💇&zwj;♂️",hamburger:"🍔",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",hamster:"🐹",hand:"✋",handbag:"👜",handshake:"🤝",hankey:"💩",hatched_chick:"🐥",hatching_chick:"🐣",headphones:"🎧",hear_no_evil:"🙉",heart:"❤️",heart_decoration:"💟",heart_eyes:"😍",heart_eyes_cat:"😻",heartbeat:"💓",heartpulse:"💗",hearts:"♥️",heavy_check_mark:"✔️",heavy_division_sign:"➗",heavy_dollar_sign:"💲",heavy_heart_exclamation:"❣️",heavy_minus_sign:"➖",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",helicopter:"🚁",herb:"🌿",hibiscus:"🌺",high_brightness:"🔆",high_heel:"👠",hocho:"🔪",hole:"🕳",honey_pot:"🍯",horse:"🐴",horse_racing:"🏇",hospital:"🏥",hot_pepper:"🌶",hotdog:"🌭",hotel:"🏨",hotsprings:"♨️",hourglass:"⌛️",hourglass_flowing_sand:"⏳",house:"🏠",house_with_garden:"🏡",houses:"🏘",hugs:"🤗",hushed:"😯",ice_cream:"🍨",ice_hockey:"🏒",ice_skate:"⛸",icecream:"🍦",id:"🆔",ideograph_advantage:"🉐",imp:"👿",inbox_tray:"📥",incoming_envelope:"📨",tipping_hand_woman:"💁",information_source:"ℹ️",innocent:"😇",interrobang:"⁉️",iphone:"📱",izakaya_lantern:"🏮",jack_o_lantern:"🎃",japan:"🗾",japanese_castle:"🏯",japanese_goblin:"👺",japanese_ogre:"👹",jeans:"👖",joy:"😂",joy_cat:"😹",joystick:"🕹",kaaba:"🕋",key:"🔑",keyboard:"⌨️",keycap_ten:"🔟",kick_scooter:"🛴",kimono:"👘",kiss:"💋",kissing:"😗",kissing_cat:"😽",kissing_closed_eyes:"😚",kissing_heart:"😘",kissing_smiling_eyes:"😙",kiwi_fruit:"🥝",koala:"🐨",koko:"🈁",label:"🏷",large_blue_circle:"🔵",large_blue_diamond:"🔷",large_orange_diamond:"🔶",last_quarter_moon:"🌗",last_quarter_moon_with_face:"🌜",latin_cross:"✝️",laughing:"😆",leaves:"🍃",ledger:"📒",left_luggage:"🛅",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",lemon:"🍋",leo:"♌️",leopard:"🐆",level_slider:"🎚",libra:"♎️",light_rail:"🚈",link:"🔗",lion:"🦁",lips:"👄",lipstick:"💄",lizard:"🦎",lock:"🔒",lock_with_ink_pen:"🔏",lollipop:"🍭",loop:"➿",loud_sound:"🔊",loudspeaker:"📢",love_hotel:"🏩",love_letter:"💌",low_brightness:"🔅",lying_face:"🤥",m:"Ⓜ️",mag:"🔍",mag_right:"🔎",mahjong:"🀄️",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",man:"👨",man_artist:"👨&zwj;🎨",man_astronaut:"👨&zwj;🚀",man_cartwheeling:"🤸&zwj;♂️",man_cook:"👨&zwj;🍳",man_dancing:"🕺",man_facepalming:"🤦&zwj;♂️",man_factory_worker:"👨&zwj;🏭",man_farmer:"👨&zwj;🌾",man_firefighter:"👨&zwj;🚒",man_health_worker:"👨&zwj;⚕️",man_in_tuxedo:"🤵",man_judge:"👨&zwj;⚖️",man_juggling:"🤹&zwj;♂️",man_mechanic:"👨&zwj;🔧",man_office_worker:"👨&zwj;💼",man_pilot:"👨&zwj;✈️",man_playing_handball:"🤾&zwj;♂️",man_playing_water_polo:"🤽&zwj;♂️",man_scientist:"👨&zwj;🔬",man_shrugging:"🤷&zwj;♂️",man_singer:"👨&zwj;🎤",man_student:"👨&zwj;🎓",man_teacher:"👨&zwj;🏫",man_technologist:"👨&zwj;💻",man_with_gua_pi_mao:"👲",man_with_turban:"👳",tangerine:"🍊",mans_shoe:"👞",mantelpiece_clock:"🕰",maple_leaf:"🍁",martial_arts_uniform:"🥋",mask:"😷",massage_woman:"💆",massage_man:"💆&zwj;♂️",meat_on_bone:"🍖",medal_military:"🎖",medal_sports:"🏅",mega:"📣",melon:"🍈",memo:"📝",men_wrestling:"🤼&zwj;♂️",menorah:"🕎",mens:"🚹",metal:"🤘",metro:"🚇",microphone:"🎤",microscope:"🔬",milk_glass:"🥛",milky_way:"🌌",minibus:"🚐",minidisc:"💽",mobile_phone_off:"📴",money_mouth_face:"🤑",money_with_wings:"💸",moneybag:"💰",monkey:"🐒",monkey_face:"🐵",monorail:"🚝",moon:"🌔",mortar_board:"🎓",mosque:"🕌",motor_boat:"🛥",motor_scooter:"🛵",motorcycle:"🏍",motorway:"🛣",mount_fuji:"🗻",mountain:"⛰",mountain_biking_man:"🚵",mountain_biking_woman:"🚵&zwj;♀️",mountain_cableway:"🚠",mountain_railway:"🚞",mountain_snow:"🏔",mouse:"🐭",mouse2:"🐁",movie_camera:"🎥",moyai:"🗿",mrs_claus:"🤶",muscle:"💪",mushroom:"🍄",musical_keyboard:"🎹",musical_note:"🎵",musical_score:"🎼",mute:"🔇",nail_care:"💅",name_badge:"📛",national_park:"🏞",nauseated_face:"🤢",necktie:"👔",negative_squared_cross_mark:"❎",nerd_face:"🤓",neutral_face:"😐",new:"🆕",new_moon:"🌑",new_moon_with_face:"🌚",newspaper:"📰",newspaper_roll:"🗞",next_track_button:"⏭",ng:"🆖",no_good_man:"🙅&zwj;♂️",no_good_woman:"🙅",night_with_stars:"🌃",no_bell:"🔕",no_bicycles:"🚳",no_entry:"⛔️",no_entry_sign:"🚫",no_mobile_phones:"📵",no_mouth:"😶",no_pedestrians:"🚷",no_smoking:"🚭","non-potable_water":"🚱",nose:"👃",notebook:"📓",notebook_with_decorative_cover:"📔",notes:"🎶",nut_and_bolt:"🔩",o:"⭕️",o2:"🅾️",ocean:"🌊",octopus:"🐙",oden:"🍢",office:"🏢",oil_drum:"🛢",ok:"🆗",ok_hand:"👌",ok_man:"🙆&zwj;♂️",ok_woman:"🙆",old_key:"🗝",older_man:"👴",older_woman:"👵",om:"🕉",on:"🔛",oncoming_automobile:"🚘",oncoming_bus:"🚍",oncoming_police_car:"🚔",oncoming_taxi:"🚖",open_file_folder:"📂",open_hands:"👐",open_mouth:"😮",open_umbrella:"☂️",ophiuchus:"⛎",orange_book:"📙",orthodox_cross:"☦️",outbox_tray:"📤",owl:"🦉",ox:"🐂",package:"📦",page_facing_up:"📄",page_with_curl:"📃",pager:"📟",paintbrush:"🖌",palm_tree:"🌴",pancakes:"🥞",panda_face:"🐼",paperclip:"📎",paperclips:"🖇",parasol_on_ground:"⛱",parking:"🅿️",part_alternation_mark:"〽️",partly_sunny:"⛅️",passenger_ship:"🛳",passport_control:"🛂",pause_button:"⏸",peace_symbol:"☮️",peach:"🍑",peanuts:"🥜",pear:"🍐",pen:"🖊",pencil2:"✏️",penguin:"🐧",pensive:"😔",performing_arts:"🎭",persevere:"😣",person_fencing:"🤺",pouting_woman:"🙎",phone:"☎️",pick:"⛏",pig:"🐷",pig2:"🐖",pig_nose:"🐽",pill:"💊",pineapple:"🍍",ping_pong:"🏓",pisces:"♓️",pizza:"🍕",place_of_worship:"🛐",plate_with_cutlery:"🍽",play_or_pause_button:"⏯",point_down:"👇",point_left:"👈",point_right:"👉",point_up:"☝️",point_up_2:"👆",police_car:"🚓",policewoman:"👮&zwj;♀️",poodle:"🐩",popcorn:"🍿",post_office:"🏣",postal_horn:"📯",postbox:"📮",potable_water:"🚰",potato:"🥔",pouch:"👝",poultry_leg:"🍗",pound:"💷",rage:"😡",pouting_cat:"😾",pouting_man:"🙎&zwj;♂️",pray:"🙏",prayer_beads:"📿",pregnant_woman:"🤰",previous_track_button:"⏮",prince:"🤴",princess:"👸",printer:"🖨",purple_heart:"💜",purse:"👛",pushpin:"📌",put_litter_in_its_place:"🚮",question:"❓",rabbit:"🐰",rabbit2:"🐇",racehorse:"🐎",racing_car:"🏎",radio:"📻",radio_button:"🔘",radioactive:"☢️",railway_car:"🚃",railway_track:"🛤",rainbow:"🌈",rainbow_flag:"🏳️&zwj;🌈",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",raised_hands:"🙌",raising_hand_woman:"🙋",raising_hand_man:"🙋&zwj;♂️",ram:"🐏",ramen:"🍜",rat:"🐀",record_button:"⏺",recycle:"♻️",red_circle:"🔴",registered:"®️",relaxed:"☺️",relieved:"😌",reminder_ribbon:"🎗",repeat:"🔁",repeat_one:"🔂",rescue_worker_helmet:"⛑",restroom:"🚻",revolving_hearts:"💞",rewind:"⏪",rhinoceros:"🦏",ribbon:"🎀",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",rice_scene:"🎑",right_anger_bubble:"🗯",ring:"💍",robot:"🤖",rocket:"🚀",rofl:"🤣",roll_eyes:"🙄",roller_coaster:"🎢",rooster:"🐓",rose:"🌹",rosette:"🏵",rotating_light:"🚨",round_pushpin:"📍",rowing_man:"🚣",rowing_woman:"🚣&zwj;♀️",rugby_football:"🏉",running_man:"🏃",running_shirt_with_sash:"🎽",running_woman:"🏃&zwj;♀️",sa:"🈂️",sagittarius:"♐️",sake:"🍶",sandal:"👡",santa:"🎅",satellite:"📡",saxophone:"🎷",school:"🏫",school_satchel:"🎒",scissors:"✂️",scorpion:"🦂",scorpius:"♏️",scream:"😱",scream_cat:"🙀",scroll:"📜",seat:"💺",secret:"㊙️",see_no_evil:"🙈",seedling:"🌱",selfie:"🤳",shallow_pan_of_food:"🥘",shamrock:"☘️",shark:"🦈",shaved_ice:"🍧",sheep:"🐑",shell:"🐚",shield:"🛡",shinto_shrine:"⛩",ship:"🚢",shirt:"👕",shopping:"🛍",shopping_cart:"🛒",shower:"🚿",shrimp:"🦐",signal_strength:"📶",six_pointed_star:"🔯",ski:"🎿",skier:"⛷",skull:"💀",skull_and_crossbones:"☠️",sleeping:"😴",sleeping_bed:"🛌",sleepy:"😪",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",slot_machine:"🎰",small_airplane:"🛩",small_blue_diamond:"🔹",small_orange_diamond:"🔸",small_red_triangle:"🔺",small_red_triangle_down:"🔻",smile:"😄",smile_cat:"😸",smiley:"😃",smiley_cat:"😺",smiling_imp:"😈",smirk:"😏",smirk_cat:"😼",smoking:"🚬",snail:"🐌",snake:"🐍",sneezing_face:"🤧",snowboarder:"🏂",snowflake:"❄️",snowman:"⛄️",snowman_with_snow:"☃️",sob:"😭",soccer:"⚽️",soon:"🔜",sos:"🆘",sound:"🔉",space_invader:"👾",spades:"♠️",spaghetti:"🍝",sparkle:"❇️",sparkler:"🎇",sparkles:"✨",sparkling_heart:"💖",speak_no_evil:"🙊",speaker:"🔈",speaking_head:"🗣",speech_balloon:"💬",speedboat:"🚤",spider:"🕷",spider_web:"🕸",spiral_calendar:"🗓",spiral_notepad:"🗒",spoon:"🥄",squid:"🦑",stadium:"🏟",star:"⭐️",star2:"🌟",star_and_crescent:"☪️",star_of_david:"✡️",stars:"🌠",station:"🚉",statue_of_liberty:"🗽",steam_locomotive:"🚂",stew:"🍲",stop_button:"⏹",stop_sign:"🛑",stopwatch:"⏱",straight_ruler:"📏",strawberry:"🍓",stuck_out_tongue:"😛",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue_winking_eye:"😜",studio_microphone:"🎙",stuffed_flatbread:"🥙",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",sun_behind_small_cloud:"🌤",sun_with_face:"🌞",sunflower:"🌻",sunglasses:"😎",sunny:"☀️",sunrise:"🌅",sunrise_over_mountains:"🌄",surfing_man:"🏄",surfing_woman:"🏄&zwj;♀️",sushi:"🍣",suspension_railway:"🚟",sweat:"😓",sweat_drops:"💦",sweat_smile:"😅",sweet_potato:"🍠",swimming_man:"🏊",swimming_woman:"🏊&zwj;♀️",symbols:"🔣",synagogue:"🕍",syringe:"💉",taco:"🌮",tada:"🎉",tanabata_tree:"🎋",taurus:"♉️",taxi:"🚕",tea:"🍵",telephone_receiver:"📞",telescope:"🔭",tennis:"🎾",tent:"⛺️",thermometer:"🌡",thinking:"🤔",thought_balloon:"💭",ticket:"🎫",tickets:"🎟",tiger:"🐯",tiger2:"🐅",timer_clock:"⏲",tipping_hand_man:"💁&zwj;♂️",tired_face:"😫",tm:"™️",toilet:"🚽",tokyo_tower:"🗼",tomato:"🍅",tongue:"👅",top:"🔝",tophat:"🎩",tornado:"🌪",trackball:"🖲",tractor:"🚜",traffic_light:"🚥",train:"🚋",train2:"🚆",tram:"🚊",triangular_flag_on_post:"🚩",triangular_ruler:"📐",trident:"🔱",triumph:"😤",trolleybus:"🚎",trophy:"🏆",tropical_drink:"🍹",tropical_fish:"🐠",truck:"🚚",trumpet:"🎺",tulip:"🌷",tumbler_glass:"🥃",turkey:"🦃",turtle:"🐢",tv:"📺",twisted_rightwards_arrows:"🔀",two_hearts:"💕",two_men_holding_hands:"👬",two_women_holding_hands:"👭",u5272:"🈹",u5408:"🈴",u55b6:"🈺",u6307:"🈯️",u6708:"🈷️",u6709:"🈶",u6e80:"🈵",u7121:"🈚️",u7533:"🈸",u7981:"🈲",u7a7a:"🈳",umbrella:"☔️",unamused:"😒",underage:"🔞",unicorn:"🦄",unlock:"🔓",up:"🆙",upside_down_face:"🙃",v:"✌️",vertical_traffic_light:"🚦",vhs:"📼",vibration_mode:"📳",video_camera:"📹",video_game:"🎮",violin:"🎻",virgo:"♍️",volcano:"🌋",volleyball:"🏐",vs:"🆚",vulcan_salute:"🖖",walking_man:"🚶",walking_woman:"🚶&zwj;♀️",waning_crescent_moon:"🌘",waning_gibbous_moon:"🌖",warning:"⚠️",wastebasket:"🗑",watch:"⌚️",water_buffalo:"🐃",watermelon:"🍉",wave:"👋",wavy_dash:"〰️",waxing_crescent_moon:"🌒",wc:"🚾",weary:"😩",wedding:"💒",weight_lifting_man:"🏋️",weight_lifting_woman:"🏋️&zwj;♀️",whale:"🐳",whale2:"🐋",wheel_of_dharma:"☸️",wheelchair:"♿️",white_check_mark:"✅",white_circle:"⚪️",white_flag:"🏳️",white_flower:"💮",white_large_square:"⬜️",white_medium_small_square:"◽️",white_medium_square:"◻️",white_small_square:"▫️",white_square_button:"🔳",wilted_flower:"🥀",wind_chime:"🎐",wind_face:"🌬",wine_glass:"🍷",wink:"😉",wolf:"🐺",woman:"👩",woman_artist:"👩&zwj;🎨",woman_astronaut:"👩&zwj;🚀",woman_cartwheeling:"🤸&zwj;♀️",woman_cook:"👩&zwj;🍳",woman_facepalming:"🤦&zwj;♀️",woman_factory_worker:"👩&zwj;🏭",woman_farmer:"👩&zwj;🌾",woman_firefighter:"👩&zwj;🚒",woman_health_worker:"👩&zwj;⚕️",woman_judge:"👩&zwj;⚖️",woman_juggling:"🤹&zwj;♀️",woman_mechanic:"👩&zwj;🔧",woman_office_worker:"👩&zwj;💼",woman_pilot:"👩&zwj;✈️",woman_playing_handball:"🤾&zwj;♀️",woman_playing_water_polo:"🤽&zwj;♀️",woman_scientist:"👩&zwj;🔬",woman_shrugging:"🤷&zwj;♀️",woman_singer:"👩&zwj;🎤",woman_student:"👩&zwj;🎓",woman_teacher:"👩&zwj;🏫",woman_technologist:"👩&zwj;💻",woman_with_turban:"👳&zwj;♀️",womans_clothes:"👚",womans_hat:"👒",women_wrestling:"🤼&zwj;♀️",womens:"🚺",world_map:"🗺",worried:"😟",wrench:"🔧",writing_hand:"✍️",x:"❌",yellow_heart:"💛",yen:"💴",yin_yang:"☯️",yum:"😋",zap:"⚡️",zipper_mouth_face:"🤐",zzz:"💤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:"<span style=\"font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;\">S</span>"},r.Converter=function(e){var t={},n=[],p=[],c={},d=o,u={parsed:{},raw:"",format:""};function f(e,t){if(t=t||null,r.helper.isString(e)){if(t=e=r.helper.stdExtName(e),r.extensions[e])return console.warn("DEPRECATION WARNING: "+e+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),void function(e,t){"function"==typeof e&&(e=e(new r.Converter));r.helper.isArray(e)||(e=[e]);var a=l(e,t);if(!a.valid)throw Error(a.error);for(var i=0;i<e.length;++i)switch(e[i].type){case"lang":n.push(e[i]);break;case"output":p.push(e[i]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}(r.extensions[e],e);if(r.helper.isUndefined(a[e]))throw Error('Extension "'+e+'" could not be loaded. It was either not found or is not a valid extension.');e=a[e]}"function"==typeof e&&(e=e()),r.helper.isArray(e)||(e=[e]);var i=l(e,t);if(!i.valid)throw Error(i.error);for(var o=0;o<e.length;++o){switch(e[o].type){case"lang":n.push(e[o]);break;case"output":p.push(e[o])}if(e[o].hasOwnProperty("listeners"))for(var s in e[o].listeners)e[o].listeners.hasOwnProperty(s)&&_(s,e[o].listeners[s])}}function _(e,t){if(!r.helper.isString(e))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof e+" given");if("function"!=typeof t)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof t+" given");c.hasOwnProperty(e)||(c[e]=[]),c[e].push(t)}!function(){for(var n in e=e||{},i)i.hasOwnProperty(n)&&(t[n]=i[n]);if("object"!=typeof e)throw Error("Converter expects the passed parameter to be an object, but "+typeof e+" was passed instead.");for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.extensions&&r.helper.forEach(t.extensions,f)}(),this._dispatch=function(e,t,r,n){if(c.hasOwnProperty(e))for(var a=0;a<c[e].length;++a){var i=c[e][a](e,t,this,r,n);i&&void 0!==i&&(t=i)}return t},this.listen=function(e,t){return _(e,t),this},this.makeHtml=function(e){if(!e)return e;var a={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:n,outputModifiers:p,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return e=(e=(e=(e=(e=e.replace(/¨/g,"¨T")).replace(/\$/g,"¨D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/\u00A0/g,"&nbsp;"),t.smartIndentationFix&&(e=function(e){var t=e.match(/^\s*/)[0].length,r=new RegExp("^\\s{0,"+t+"}","gm");return e.replace(r,"")}(e)),e="\n\n"+e+"\n\n",e=(e=r.subParser("detab")(e,t,a)).replace(/^[ \t]+$/gm,""),r.helper.forEach(n,function(n){e=r.subParser("runExtension")(n,e,t,a)}),e=r.subParser("metadata")(e,t,a),e=r.subParser("hashPreCodeTags")(e,t,a),e=r.subParser("githubCodeBlocks")(e,t,a),e=r.subParser("hashHTMLBlocks")(e,t,a),e=r.subParser("hashCodeTags")(e,t,a),e=r.subParser("stripLinkDefinitions")(e,t,a),e=r.subParser("blockGamut")(e,t,a),e=r.subParser("unhashHTMLSpans")(e,t,a),e=(e=(e=r.subParser("unescapeSpecialChars")(e,t,a)).replace(/¨D/g,"$$")).replace(/¨T/g,"¨"),e=r.subParser("completeHTMLDocument")(e,t,a),r.helper.forEach(p,function(n){e=r.subParser("runExtension")(n,e,t,a)}),u=a.metadata,e},this.makeMarkdown=this.makeMd=function(e,t){if(e=(e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/>[ \t]+</,">¨NBSP;<"),!t){if(!window||!window.document)throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");t=window.document}var n=t.createElement("div");n.innerHTML=e;var a={preList:function(e){for(var t=e.querySelectorAll("pre"),n=[],a=0;a<t.length;++a)if(1===t[a].childElementCount&&"code"===t[a].firstChild.tagName.toLowerCase()){var i=t[a].firstChild.innerHTML.trim(),o=t[a].firstChild.getAttribute("data-language")||"";if(""===o)for(var s=t[a].firstChild.className.split(" "),l=0;l<s.length;++l){var p=s[l].match(/^language-(.+)$/);if(null!==p){o=p[1];break}}i=r.helper.unescapeHTMLEntities(i),n.push(i),t[a].outerHTML='<precode language="'+o+'" precodenum="'+a.toString()+'"></precode>'}else n.push(t[a].innerHTML),t[a].innerHTML="",t[a].setAttribute("prenum",a.toString());return n}(n)};!function e(t){for(var r=0;r<t.childNodes.length;++r){var n=t.childNodes[r];3===n.nodeType?/\S/.test(n.nodeValue)?(n.nodeValue=n.nodeValue.split("\n").join(" "),n.nodeValue=n.nodeValue.replace(/(\s)+/g,"$1")):(t.removeChild(n),--r):1===n.nodeType&&e(n)}}(n);for(var i=n.childNodes,o="",s=0;s<i.length;s++)o+=r.subParser("makeMarkdown.node")(i[s],a);return o},this.setOption=function(e,r){t[e]=r},this.getOption=function(e){return t[e]},this.getOptions=function(){return t},this.addExtension=function(e,t){f(e,t=t||null)},this.useExtension=function(e){f(e)},this.setFlavor=function(e){if(!s.hasOwnProperty(e))throw Error(e+" flavor was not found");var r=s[e];for(var n in d=e,r)r.hasOwnProperty(n)&&(t[n]=r[n])},this.getFlavor=function(){return d},this.removeExtension=function(e){r.helper.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t){for(var a=e[t],i=0;i<n.length;++i)n[i]===a&&n[i].splice(i,1);for(;0<p.length;++i)p[0]===a&&p[0].splice(i,1)}},this.getAllExtensions=function(){return{language:n,output:p}},this.getMetadata=function(e){return e?u.raw:u.parsed},this.getMetadataFormat=function(){return u.format},this._setMetadataPair=function(e,t){u.parsed[e]=t},this._setMetadataFormat=function(e){u.format=e},this._setMetadataRaw=function(e){u.raw=e}},r.subParser("anchors",function(e,t,n){var a=function(e,a,i,o,s,l,p){if(r.helper.isUndefined(p)&&(p=""),i=i.toLowerCase(),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)o="";else if(!o){if(i||(i=a.toLowerCase().replace(/ ?\n/g," ")),o="#"+i,r.helper.isUndefined(n.gUrls[i]))return e;o=n.gUrls[i],r.helper.isUndefined(n.gTitles[i])||(p=n.gTitles[i])}var c='<a href="'+(o=o.replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback))+'"';return""!==p&&null!==p&&(c+=' title="'+(p=(p=p.replace(/"/g,"&quot;")).replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback))+'"'),t.openLinksInNewWindow&&!/^#/.test(o)&&(c+=' rel="noopener noreferrer" target="¨E95Eblank"'),c+=">"+a+"</a>"};return e=(e=(e=(e=(e=n.converter._dispatch("anchors.before",e,t,n)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,a)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,a)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,a)).replace(/\[([^\[\]]+)]()()()()()/g,a),t.ghMentions&&(e=e.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gim,function(e,n,a,i,o){if("\\"===a)return n+i;if(!r.helper.isString(t.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var s=t.ghMentionsLink.replace(/\{u}/g,o),l="";return t.openLinksInNewWindow&&(l=' rel="noopener noreferrer" target="¨E95Eblank"'),n+'<a href="'+s+'"'+l+">"+i+"</a>"})),e=n.converter._dispatch("anchors.after",e,t,n)});var d=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,u=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,f=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,_=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gim,h=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,m=function(e){return function(t,n,a,i,o,s,l){var p=a=a.replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback),c="",d="",u=n||"",f=l||"";return/^www\./i.test(a)&&(a=a.replace(/^www\./i,"http://www.")),e.excludeTrailingPunctuationFromURLs&&s&&(c=s),e.openLinksInNewWindow&&(d=' rel="noopener noreferrer" target="¨E95Eblank"'),u+'<a href="'+a+'"'+d+">"+p+"</a>"+c+f}},g=function(e,t){return function(n,a,i){var o="mailto:";return a=a||"",i=r.subParser("unescapeSpecialChars")(i,e,t),e.encodeEmails?(o=r.helper.encodeEmailAddress(o+i),i=r.helper.encodeEmailAddress(i)):o+=i,a+'<a href="'+o+'">'+i+"</a>"}};r.subParser("autoLinks",function(e,t,r){return e=(e=(e=r.converter._dispatch("autoLinks.before",e,t,r)).replace(f,m(t))).replace(h,g(t,r)),e=r.converter._dispatch("autoLinks.after",e,t,r)}),r.subParser("simplifiedAutoLinks",function(e,t,r){return t.simplifiedAutoLink?(e=r.converter._dispatch("simplifiedAutoLinks.before",e,t,r),e=(e=t.excludeTrailingPunctuationFromURLs?e.replace(u,m(t)):e.replace(d,m(t))).replace(_,g(t,r)),e=r.converter._dispatch("simplifiedAutoLinks.after",e,t,r)):e}),r.subParser("blockGamut",function(e,t,n){return e=n.converter._dispatch("blockGamut.before",e,t,n),e=r.subParser("blockQuotes")(e,t,n),e=r.subParser("headers")(e,t,n),e=r.subParser("horizontalRule")(e,t,n),e=r.subParser("lists")(e,t,n),e=r.subParser("codeBlocks")(e,t,n),e=r.subParser("tables")(e,t,n),e=r.subParser("hashHTMLBlocks")(e,t,n),e=r.subParser("paragraphs")(e,t,n),e=n.converter._dispatch("blockGamut.after",e,t,n)}),r.subParser("blockQuotes",function(e,t,n){e=n.converter._dispatch("blockQuotes.before",e,t,n),e+="\n\n";var a=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return t.splitAdjacentBlockquotes&&(a=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),e=e.replace(a,function(e){return e=(e=(e=e.replace(/^[ \t]*>[ \t]?/gm,"")).replace(/¨0/g,"")).replace(/^[ \t]+$/gm,""),e=r.subParser("githubCodeBlocks")(e,t,n),e=(e=(e=r.subParser("blockGamut")(e,t,n)).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var r=t;return r=(r=r.replace(/^  /gm,"¨0")).replace(/¨0/g,"")}),r.subParser("hashBlock")("<blockquote>\n"+e+"\n</blockquote>",t,n)}),e=n.converter._dispatch("blockQuotes.after",e,t,n)}),r.subParser("codeBlocks",function(e,t,n){e=n.converter._dispatch("codeBlocks.before",e,t,n);return e=(e=(e+="¨0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g,function(e,a,i){var o=a,s=i,l="\n";return o=r.subParser("outdent")(o,t,n),o=r.subParser("encodeCode")(o,t,n),o=(o=(o=r.subParser("detab")(o,t,n)).replace(/^\n+/g,"")).replace(/\n+$/g,""),t.omitExtraWLInCodeBlocks&&(l=""),o="<pre><code>"+o+l+"</code></pre>",r.subParser("hashBlock")(o,t,n)+s})).replace(/¨0/,""),e=n.converter._dispatch("codeBlocks.after",e,t,n)}),r.subParser("codeSpans",function(e,t,n){return void 0===(e=n.converter._dispatch("codeSpans.before",e,t,n))&&(e=""),e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,a,i,o){var s=o;return s=(s=s.replace(/^([ \t]*)/g,"")).replace(/[ \t]*$/g,""),s=a+"<code>"+(s=r.subParser("encodeCode")(s,t,n))+"</code>",s=r.subParser("hashHTMLSpans")(s,t,n)}),e=n.converter._dispatch("codeSpans.after",e,t,n)}),r.subParser("completeHTMLDocument",function(e,t,r){if(!t.completeHTMLDocument)return e;e=r.converter._dispatch("completeHTMLDocument.before",e,t,r);var n="html",a="<!DOCTYPE HTML>\n",i="",o='<meta charset="utf-8">\n',s="",l="";for(var p in void 0!==r.metadata.parsed.doctype&&(a="<!DOCTYPE "+r.metadata.parsed.doctype+">\n","html"!==(n=r.metadata.parsed.doctype.toString().toLowerCase())&&"html5"!==n||(o='<meta charset="utf-8">')),r.metadata.parsed)if(r.metadata.parsed.hasOwnProperty(p))switch(p.toLowerCase()){case"doctype":break;case"title":i="<title>"+r.metadata.parsed.title+"</title>\n";break;case"charset":o="html"===n||"html5"===n?'<meta charset="'+r.metadata.parsed.charset+'">\n':'<meta name="charset" content="'+r.metadata.parsed.charset+'">\n';break;case"language":case"lang":s=' lang="'+r.metadata.parsed[p]+'"',l+='<meta name="'+p+'" content="'+r.metadata.parsed[p]+'">\n';break;default:l+='<meta name="'+p+'" content="'+r.metadata.parsed[p]+'">\n'}return e=a+"<html"+s+">\n<head>\n"+i+o+l+"</head>\n<body>\n"+e.trim()+"\n</body>\n</html>",e=r.converter._dispatch("completeHTMLDocument.after",e,t,r)}),r.subParser("detab",function(e,t,r){return e=(e=(e=(e=(e=(e=r.converter._dispatch("detab.before",e,t,r)).replace(/\t(?=\t)/g,"    ")).replace(/\t/g,"¨A¨B")).replace(/¨B(.+?)¨A/g,function(e,t){for(var r=t,n=4-r.length%4,a=0;a<n;a++)r+=" ";return r})).replace(/¨A/g,"    ")).replace(/¨B/g,""),e=r.converter._dispatch("detab.after",e,t,r)}),r.subParser("ellipsis",function(e,t,r){return e=(e=r.converter._dispatch("ellipsis.before",e,t,r)).replace(/\.\.\./g,"…"),e=r.converter._dispatch("ellipsis.after",e,t,r)}),r.subParser("emoji",function(e,t,n){if(!t.emoji)return e;return e=(e=n.converter._dispatch("emoji.before",e,t,n)).replace(/:([\S]+?):/g,function(e,t){return r.helper.emojis.hasOwnProperty(t)?r.helper.emojis[t]:e}),e=n.converter._dispatch("emoji.after",e,t,n)}),r.subParser("encodeAmpsAndAngles",function(e,t,r){return e=(e=(e=(e=(e=r.converter._dispatch("encodeAmpsAndAngles.before",e,t,r)).replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?$!])/gi,"&lt;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e=r.converter._dispatch("encodeAmpsAndAngles.after",e,t,r)}),r.subParser("encodeBackslashEscapes",function(e,t,n){return e=(e=(e=n.converter._dispatch("encodeBackslashEscapes.before",e,t,n)).replace(/\\(\\)/g,r.helper.escapeCharactersCallback)).replace(/\\([`*_{}\[\]()>#+.!~=|-])/g,r.helper.escapeCharactersCallback),e=n.converter._dispatch("encodeBackslashEscapes.after",e,t,n)}),r.subParser("encodeCode",function(e,t,n){return e=(e=n.converter._dispatch("encodeCode.before",e,t,n)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,r.helper.escapeCharactersCallback),e=n.converter._dispatch("encodeCode.after",e,t,n)}),r.subParser("escapeSpecialCharsWithinTagAttributes",function(e,t,n){return e=(e=(e=n.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",e,t,n)).replace(/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,function(e){return e.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,r.helper.escapeCharactersCallback)})).replace(/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi,function(e){return e.replace(/([\\`*_~=|])/g,r.helper.escapeCharactersCallback)}),e=n.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",e,t,n)}),r.subParser("githubCodeBlocks",function(e,t,n){return t.ghCodeBlocks?(e=n.converter._dispatch("githubCodeBlocks.before",e,t,n),e=(e=(e+="¨0").replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(e,a,i,o){var s=t.omitExtraWLInCodeBlocks?"":"\n";return o=r.subParser("encodeCode")(o,t,n),o="<pre><code"+(i?' class="'+i+" language-"+i+'"':"")+">"+(o=(o=(o=r.subParser("detab")(o,t,n)).replace(/^\n+/g,"")).replace(/\n+$/g,""))+s+"</code></pre>",o=r.subParser("hashBlock")(o,t,n),"\n\n¨G"+(n.ghCodeBlocks.push({text:e,codeblock:o})-1)+"G\n\n"})).replace(/¨0/,""),n.converter._dispatch("githubCodeBlocks.after",e,t,n)):e}),r.subParser("hashBlock",function(e,t,r){return e=(e=r.converter._dispatch("hashBlock.before",e,t,r)).replace(/(^\n+|\n+$)/g,""),e="\n\n¨K"+(r.gHtmlBlocks.push(e)-1)+"K\n\n",e=r.converter._dispatch("hashBlock.after",e,t,r)}),r.subParser("hashCodeTags",function(e,t,n){e=n.converter._dispatch("hashCodeTags.before",e,t,n);return e=r.helper.replaceRecursiveRegExp(e,function(e,a,i,o){var s=i+r.subParser("encodeCode")(a,t,n)+o;return"¨C"+(n.gHtmlSpans.push(s)-1)+"C"},"<code\\b[^>]*>","</code>","gim"),e=n.converter._dispatch("hashCodeTags.after",e,t,n)}),r.subParser("hashElement",function(e,t,r){return function(e,t){var n=t;return n=(n=(n=n.replace(/\n\n/g,"\n")).replace(/^\n/,"")).replace(/\n+$/g,""),n="\n\n¨K"+(r.gHtmlBlocks.push(n)-1)+"K\n\n"}}),r.subParser("hashHTMLBlocks",function(e,t,n){e=n.converter._dispatch("hashHTMLBlocks.before",e,t,n);var a=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],i=function(e,t,r,a){var i=e;return-1!==r.search(/\bmarkdown\b/)&&(i=r+n.converter.makeHtml(t)+a),"\n\n¨K"+(n.gHtmlBlocks.push(i)-1)+"K\n\n"};t.backslashEscapesHTMLTags&&(e=e.replace(/\\<(\/?[^>]+?)>/g,function(e,t){return"&lt;"+t+"&gt;"}));for(var o=0;o<a.length;++o)for(var s,l=new RegExp("^ {0,3}(<"+a[o]+"\\b[^>]*>)","im"),p="<"+a[o]+"\\b[^>]*>",c="</"+a[o]+">";-1!==(s=r.helper.regexIndexOf(e,l));){var d=r.helper.splitAtIndex(e,s),u=r.helper.replaceRecursiveRegExp(d[1],i,p,c,"im");if(u===d[1])break;e=d[0].concat(u)}return e=e.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,r.subParser("hashElement")(e,t,n)),e=(e=r.helper.replaceRecursiveRegExp(e,function(e){return"\n\n¨K"+(n.gHtmlBlocks.push(e)-1)+"K\n\n"},"^ {0,3}\x3c!--","--\x3e","gm")).replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,r.subParser("hashElement")(e,t,n)),e=n.converter._dispatch("hashHTMLBlocks.after",e,t,n)}),r.subParser("hashHTMLSpans",function(e,t,r){function n(e){return"¨C"+(r.gHtmlSpans.push(e)-1)+"C"}return e=(e=(e=(e=(e=r.converter._dispatch("hashHTMLSpans.before",e,t,r)).replace(/<[^>]+?\/>/gi,function(e){return n(e)})).replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(e){return n(e)})).replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(e){return n(e)})).replace(/<[^>]+?>/gi,function(e){return n(e)}),e=r.converter._dispatch("hashHTMLSpans.after",e,t,r)}),r.subParser("unhashHTMLSpans",function(e,t,r){e=r.converter._dispatch("unhashHTMLSpans.before",e,t,r);for(var n=0;n<r.gHtmlSpans.length;++n){for(var a=r.gHtmlSpans[n],i=0;/¨C(\d+)C/.test(a);){var o=RegExp.$1;if(a=a.replace("¨C"+o+"C",r.gHtmlSpans[o]),10===i){console.error("maximum nesting of 10 spans reached!!!");break}++i}e=e.replace("¨C"+n+"C",a)}return e=r.converter._dispatch("unhashHTMLSpans.after",e,t,r)}),r.subParser("hashPreCodeTags",function(e,t,n){e=n.converter._dispatch("hashPreCodeTags.before",e,t,n);return e=r.helper.replaceRecursiveRegExp(e,function(e,a,i,o){var s=i+r.subParser("encodeCode")(a,t,n)+o;return"\n\n¨G"+(n.ghCodeBlocks.push({text:e,codeblock:s})-1)+"G\n\n"},"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),e=n.converter._dispatch("hashPreCodeTags.after",e,t,n)}),r.subParser("headers",function(e,t,n){e=n.converter._dispatch("headers.before",e,t,n);var a=isNaN(parseInt(t.headerLevelStart))?1:parseInt(t.headerLevelStart),i=t.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,o=t.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;e=(e=e.replace(i,function(e,i){var o=r.subParser("spanGamut")(i,t,n),s=t.noHeaderId?"":' id="'+l(i)+'"',p="<h"+a+s+">"+o+"</h"+a+">";return r.subParser("hashBlock")(p,t,n)})).replace(o,function(e,i){var o=r.subParser("spanGamut")(i,t,n),s=t.noHeaderId?"":' id="'+l(i)+'"',p=a+1,c="<h"+p+s+">"+o+"</h"+p+">";return r.subParser("hashBlock")(c,t,n)});var s=t.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;function l(e){var a,i;if(t.customizedHeaderId){var o=e.match(/\{([^{]+?)}\s*$/);o&&o[1]&&(e=o[1])}return a=e,i=r.helper.isString(t.prefixHeaderId)?t.prefixHeaderId:!0===t.prefixHeaderId?"section-":"",t.rawPrefixHeaderId||(a=i+a),a=t.ghCompatibleHeaderId?a.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():t.rawHeaderId?a.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"¨").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():a.replace(/[^\w]/g,"").toLowerCase(),t.rawPrefixHeaderId&&(a=i+a),n.hashLinkCounts[a]?a=a+"-"+n.hashLinkCounts[a]++:n.hashLinkCounts[a]=1,a}return e=e.replace(s,function(e,i,o){var s=o;t.customizedHeaderId&&(s=o.replace(/\s?\{([^{]+?)}\s*$/,""));var p=r.subParser("spanGamut")(s,t,n),c=t.noHeaderId?"":' id="'+l(o)+'"',d=a-1+i.length,u="<h"+d+c+">"+p+"</h"+d+">";return r.subParser("hashBlock")(u,t,n)}),e=n.converter._dispatch("headers.after",e,t,n)}),r.subParser("horizontalRule",function(e,t,n){e=n.converter._dispatch("horizontalRule.before",e,t,n);var a=r.subParser("hashBlock")("<hr />",t,n);return e=(e=(e=e.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,a)).replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,a)).replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,a),e=n.converter._dispatch("horizontalRule.after",e,t,n)}),r.subParser("images",function(e,t,n){function a(e,t,a,i,o,s,l,p){var c=n.gUrls,d=n.gTitles,u=n.gDimensions;if(a=a.toLowerCase(),p||(p=""),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)i="";else if(""===i||null===i){if(""!==a&&null!==a||(a=t.toLowerCase().replace(/ ?\n/g," ")),i="#"+a,r.helper.isUndefined(c[a]))return e;i=c[a],r.helper.isUndefined(d[a])||(p=d[a]),r.helper.isUndefined(u[a])||(o=u[a].width,s=u[a].height)}t=t.replace(/"/g,"&quot;").replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback);var f='<img src="'+(i=i.replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback))+'" alt="'+t+'"';return p&&r.helper.isString(p)&&(f+=' title="'+(p=p.replace(/"/g,"&quot;").replace(r.helper.regexes.asteriskDashAndColon,r.helper.escapeCharactersCallback))+'"'),o&&s&&(f+=' width="'+(o="*"===o?"auto":o)+'"',f+=' height="'+(s="*"===s?"auto":s)+'"'),f+=" />"}return e=(e=(e=(e=(e=(e=n.converter._dispatch("images.before",e,t,n)).replace(/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,a)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,function(e,t,r,n,i,o,s,l){return a(e,t,r,n=n.replace(/\s/g,""),i,o,0,l)})).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,a)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,a)).replace(/!\[([^\[\]]+)]()()()()()/g,a),e=n.converter._dispatch("images.after",e,t,n)}),r.subParser("italicsAndBold",function(e,t,r){function n(e,t,r){return t+e+r}return e=r.converter._dispatch("italicsAndBold.before",e,t,r),e=t.literalMidWordUnderscores?(e=(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,function(e,t){return n(t,"<strong><em>","</em></strong>")})).replace(/\b__(\S[\s\S]*?)__\b/g,function(e,t){return n(t,"<strong>","</strong>")})).replace(/\b_(\S[\s\S]*?)_\b/g,function(e,t){return n(t,"<em>","</em>")}):(e=(e=e.replace(/___(\S[\s\S]*?)___/g,function(e,t){return/\S$/.test(t)?n(t,"<strong><em>","</em></strong>"):e})).replace(/__(\S[\s\S]*?)__/g,function(e,t){return/\S$/.test(t)?n(t,"<strong>","</strong>"):e})).replace(/_([^\s_][\s\S]*?)_/g,function(e,t){return/\S$/.test(t)?n(t,"<em>","</em>"):e}),e=t.literalMidWordAsterisks?(e=(e=e.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(e,t,r){return n(r,t+"<strong><em>","</em></strong>")})).replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(e,t,r){return n(r,t+"<strong>","</strong>")})).replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(e,t,r){return n(r,t+"<em>","</em>")}):(e=(e=e.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(e,t){return/\S$/.test(t)?n(t,"<strong><em>","</em></strong>"):e})).replace(/\*\*(\S[\s\S]*?)\*\*/g,function(e,t){return/\S$/.test(t)?n(t,"<strong>","</strong>"):e})).replace(/\*([^\s*][\s\S]*?)\*/g,function(e,t){return/\S$/.test(t)?n(t,"<em>","</em>"):e}),e=r.converter._dispatch("italicsAndBold.after",e,t,r)}),r.subParser("lists",function(e,t,n){function a(e,a){n.gListLevel++,e=e.replace(/\n{2,}$/,"\n");var i=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,o=/\n[ \t]*\n(?!¨0)/.test(e+="¨0");return t.disableForced4SpacesIndentedSublists&&(i=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),e=(e=e.replace(i,function(e,a,i,s,l,p,c){c=c&&""!==c.trim();var d=r.subParser("outdent")(l,t,n),u="";return p&&t.tasklists&&(u=' class="task-list-item" style="list-style-type: none;"',d=d.replace(/^[ \t]*\[(x|X| )?]/m,function(){var e='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return c&&(e+=" checked"),e+=">"})),d=d.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(e){return"¨A"+e}),a||d.search(/\n{2,}/)>-1?(d=r.subParser("githubCodeBlocks")(d,t,n),d=r.subParser("blockGamut")(d,t,n)):(d=(d=r.subParser("lists")(d,t,n)).replace(/\n$/,""),d=(d=r.subParser("hashHTMLBlocks")(d,t,n)).replace(/\n\n+/g,"\n\n"),d=o?r.subParser("paragraphs")(d,t,n):r.subParser("spanGamut")(d,t,n)),d="<li"+u+">"+(d=d.replace("¨A",""))+"</li>\n"})).replace(/¨0/g,""),n.gListLevel--,a&&(e=e.replace(/\s+$/,"")),e}function i(e,t){if("ol"===t){var r=e.match(/^ *(\d+)\./);if(r&&"1"!==r[1])return' start="'+r[1]+'"'}return""}function o(e,r,n){var o=t.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,s=t.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,l="ul"===r?o:s,p="";if(-1!==e.search(l))!function t(c){var d=c.search(l),u=i(e,r);-1!==d?(p+="\n\n<"+r+u+">\n"+a(c.slice(0,d),!!n)+"</"+r+">\n",l="ul"===(r="ul"===r?"ol":"ul")?o:s,t(c.slice(d))):p+="\n\n<"+r+u+">\n"+a(c,!!n)+"</"+r+">\n"}(e);else{var c=i(e,r);p="\n\n<"+r+c+">\n"+a(e,!!n)+"</"+r+">\n"}return p}return e=n.converter._dispatch("lists.before",e,t,n),e+="¨0",e=(e=n.gListLevel?e.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(e,t,r){return o(t,r.search(/[*+-]/g)>-1?"ul":"ol",!0)}):e.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(e,t,r,n){return o(r,n.search(/[*+-]/g)>-1?"ul":"ol",!1)})).replace(/¨0/,""),e=n.converter._dispatch("lists.after",e,t,n)}),r.subParser("metadata",function(e,t,r){if(!t.metadata)return e;function n(e){r.metadata.raw=e,(e=(e=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;")).replace(/\n {4}/g," ")).replace(/^([\S ]+): +([\s\S]+?)$/gm,function(e,t,n){return r.metadata.parsed[t]=n,""})}return e=(e=(e=(e=r.converter._dispatch("metadata.before",e,t,r)).replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,function(e,t,r){return n(r),"¨M"})).replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(e,t,a){return t&&(r.metadata.format=t),n(a),"¨M"})).replace(/¨M/g,""),e=r.converter._dispatch("metadata.after",e,t,r)}),r.subParser("outdent",function(e,t,r){return e=(e=(e=r.converter._dispatch("outdent.before",e,t,r)).replace(/^(\t|[ ]{1,4})/gm,"¨0")).replace(/¨0/g,""),e=r.converter._dispatch("outdent.after",e,t,r)}),r.subParser("paragraphs",function(e,t,n){for(var a=(e=(e=(e=n.converter._dispatch("paragraphs.before",e,t,n)).replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{2,}/g),i=[],o=a.length,s=0;s<o;s++){var l=a[s];l.search(/¨(K|G)(\d+)\1/g)>=0?i.push(l):l.search(/\S/)>=0&&(l=(l=r.subParser("spanGamut")(l,t,n)).replace(/^([ \t]*)/g,"<p>"),l+="</p>",i.push(l))}for(o=i.length,s=0;s<o;s++){for(var p="",c=i[s],d=!1;/¨(K|G)(\d+)\1/.test(c);){var u=RegExp.$1,f=RegExp.$2;p=(p="K"===u?n.gHtmlBlocks[f]:d?r.subParser("encodeCode")(n.ghCodeBlocks[f].text,t,n):n.ghCodeBlocks[f].codeblock).replace(/\$/g,"$$$$"),c=c.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,p),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(c)&&(d=!0)}i[s]=c}return e=(e=(e=i.join("\n")).replace(/^\n+/g,"")).replace(/\n+$/g,""),n.converter._dispatch("paragraphs.after",e,t,n)}),r.subParser("runExtension",function(e,t,r,n){if(e.filter)t=e.filter(t,n.converter,r);else if(e.regex){var a=e.regex;a instanceof RegExp||(a=new RegExp(a,"g")),t=t.replace(a,e.replace)}return t}),r.subParser("spanGamut",function(e,t,n){return e=n.converter._dispatch("spanGamut.before",e,t,n),e=r.subParser("codeSpans")(e,t,n),e=r.subParser("escapeSpecialCharsWithinTagAttributes")(e,t,n),e=r.subParser("encodeBackslashEscapes")(e,t,n),e=r.subParser("images")(e,t,n),e=r.subParser("anchors")(e,t,n),e=r.subParser("autoLinks")(e,t,n),e=r.subParser("simplifiedAutoLinks")(e,t,n),e=r.subParser("emoji")(e,t,n),e=r.subParser("underline")(e,t,n),e=r.subParser("italicsAndBold")(e,t,n),e=r.subParser("strikethrough")(e,t,n),e=r.subParser("ellipsis")(e,t,n),e=r.subParser("hashHTMLSpans")(e,t,n),e=r.subParser("encodeAmpsAndAngles")(e,t,n),t.simpleLineBreaks?/\n\n¨K/.test(e)||(e=e.replace(/\n+/g,"<br />\n")):e=e.replace(/  +\n/g,"<br />\n"),e=n.converter._dispatch("spanGamut.after",e,t,n)}),r.subParser("strikethrough",function(e,t,n){return t.strikethrough&&(e=(e=n.converter._dispatch("strikethrough.before",e,t,n)).replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(e,a){return function(e){return t.simplifiedAutoLink&&(e=r.subParser("simplifiedAutoLinks")(e,t,n)),"<del>"+e+"</del>"}(a)}),e=n.converter._dispatch("strikethrough.after",e,t,n)),e}),r.subParser("stripLinkDefinitions",function(e,t,n){var a=function(e,a,i,o,s,l,p){return a=a.toLowerCase(),i.match(/^data:.+?\/.+?;base64,/)?n.gUrls[a]=i.replace(/\s/g,""):n.gUrls[a]=r.subParser("encodeAmpsAndAngles")(i,t,n),l?l+p:(p&&(n.gTitles[a]=p.replace(/"|'/g,"&quot;")),t.parseImgDimensions&&o&&s&&(n.gDimensions[a]={width:o,height:s}),"")};return e=(e=(e=(e+="¨0").replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm,a)).replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,a)).replace(/¨0/,"")}),r.subParser("tables",function(e,t,n){if(!t.tables)return e;function a(e,a){return"<td"+a+">"+r.subParser("spanGamut")(e,t,n)+"</td>\n"}function i(e){var i,o=e.split("\n");for(i=0;i<o.length;++i)/^ {0,3}\|/.test(o[i])&&(o[i]=o[i].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(o[i])&&(o[i]=o[i].replace(/\|[ \t]*$/,"")),o[i]=r.subParser("codeSpans")(o[i],t,n);var s,l,p,c,d=o[0].split("|").map(function(e){return e.trim()}),u=o[1].split("|").map(function(e){return e.trim()}),f=[],_=[],h=[],m=[];for(o.shift(),o.shift(),i=0;i<o.length;++i)""!==o[i].trim()&&f.push(o[i].split("|").map(function(e){return e.trim()}));if(d.length<u.length)return e;for(i=0;i<u.length;++i)h.push((s=u[i],/^:[ \t]*--*$/.test(s)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(s)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(s)?' style="text-align:center;"':""));for(i=0;i<d.length;++i)r.helper.isUndefined(h[i])&&(h[i]=""),_.push((l=d[i],p=h[i],c=void 0,c="",l=l.trim(),(t.tablesHeaderId||t.tableHeaderId)&&(c=' id="'+l.replace(/ /g,"_").toLowerCase()+'"'),"<th"+c+p+">"+(l=r.subParser("spanGamut")(l,t,n))+"</th>\n"));for(i=0;i<f.length;++i){for(var g=[],v=0;v<_.length;++v)r.helper.isUndefined(f[i][v]),g.push(a(f[i][v],h[v]));m.push(g)}return function(e,t){for(var r="<table>\n<thead>\n<tr>\n",n=e.length,a=0;a<n;++a)r+=e[a];for(r+="</tr>\n</thead>\n<tbody>\n",a=0;a<t.length;++a){r+="<tr>\n";for(var i=0;i<n;++i)r+=t[a][i];r+="</tr>\n"}return r+="</tbody>\n</table>\n"}(_,m)}return e=(e=(e=(e=n.converter._dispatch("tables.before",e,t,n)).replace(/\\(\|)/g,r.helper.escapeCharactersCallback)).replace(/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,i)).replace(/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm,i),e=n.converter._dispatch("tables.after",e,t,n)}),r.subParser("underline",function(e,t,n){return t.underline?(e=n.converter._dispatch("underline.before",e,t,n),e=(e=t.literalMidWordUnderscores?(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,function(e,t){return"<u>"+t+"</u>"})).replace(/\b__(\S[\s\S]*?)__\b/g,function(e,t){return"<u>"+t+"</u>"}):(e=e.replace(/___(\S[\s\S]*?)___/g,function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e})).replace(/__(\S[\s\S]*?)__/g,function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e})).replace(/(_)/g,r.helper.escapeCharactersCallback),e=n.converter._dispatch("underline.after",e,t,n)):e}),r.subParser("unescapeSpecialChars",function(e,t,r){return e=(e=r.converter._dispatch("unescapeSpecialChars.before",e,t,r)).replace(/¨E(\d+)E/g,function(e,t){var r=parseInt(t);return String.fromCharCode(r)}),e=r.converter._dispatch("unescapeSpecialChars.after",e,t,r)}),r.subParser("makeMarkdown.blockquote",function(e,t){var n="";if(e.hasChildNodes())for(var a=e.childNodes,i=a.length,o=0;o<i;++o){var s=r.subParser("makeMarkdown.node")(a[o],t);""!==s&&(n+=s)}return n="> "+(n=n.trim()).split("\n").join("\n> ")}),r.subParser("makeMarkdown.codeBlock",function(e,t){var r=e.getAttribute("language"),n=e.getAttribute("precodenum");return"```"+r+"\n"+t.preList[n]+"\n```"}),r.subParser("makeMarkdown.codeSpan",function(e){return"`"+e.innerHTML+"`"}),r.subParser("makeMarkdown.emphasis",function(e,t){var n="";if(e.hasChildNodes()){n+="*";for(var a=e.childNodes,i=a.length,o=0;o<i;++o)n+=r.subParser("makeMarkdown.node")(a[o],t);n+="*"}return n}),r.subParser("makeMarkdown.header",function(e,t,n){var a=new Array(n+1).join("#"),i="";if(e.hasChildNodes()){i=a+" ";for(var o=e.childNodes,s=o.length,l=0;l<s;++l)i+=r.subParser("makeMarkdown.node")(o[l],t)}return i}),r.subParser("makeMarkdown.hr",function(){return"---"}),r.subParser("makeMarkdown.image",function(e){var t="";return e.hasAttribute("src")&&(t+="!["+e.getAttribute("alt")+"](",t+="<"+e.getAttribute("src")+">",e.hasAttribute("width")&&e.hasAttribute("height")&&(t+=" ="+e.getAttribute("width")+"x"+e.getAttribute("height")),e.hasAttribute("title")&&(t+=' "'+e.getAttribute("title")+'"'),t+=")"),t}),r.subParser("makeMarkdown.links",function(e,t){var n="";if(e.hasChildNodes()&&e.hasAttribute("href")){var a=e.childNodes,i=a.length;n="[";for(var o=0;o<i;++o)n+=r.subParser("makeMarkdown.node")(a[o],t);n+="](",n+="<"+e.getAttribute("href")+">",e.hasAttribute("title")&&(n+=' "'+e.getAttribute("title")+'"'),n+=")"}return n}),r.subParser("makeMarkdown.list",function(e,t,n){var a="";if(!e.hasChildNodes())return"";for(var i=e.childNodes,o=i.length,s=e.getAttribute("start")||1,l=0;l<o;++l)if(void 0!==i[l].tagName&&"li"===i[l].tagName.toLowerCase()){a+=("ol"===n?s.toString()+". ":"- ")+r.subParser("makeMarkdown.listItem")(i[l],t),++s}return(a+="\n\x3c!-- --\x3e\n").trim()}),r.subParser("makeMarkdown.listItem",function(e,t){for(var n="",a=e.childNodes,i=a.length,o=0;o<i;++o)n+=r.subParser("makeMarkdown.node")(a[o],t);return/\n$/.test(n)?n=n.split("\n").join("\n    ").replace(/^ {4}$/gm,"").replace(/\n\n+/g,"\n\n"):n+="\n",n}),r.subParser("makeMarkdown.node",function(e,t,n){n=n||!1;var a="";if(3===e.nodeType)return r.subParser("makeMarkdown.txt")(e,t);if(8===e.nodeType)return"\x3c!--"+e.data+"--\x3e\n\n";if(1!==e.nodeType)return"";switch(e.tagName.toLowerCase()){case"h1":n||(a=r.subParser("makeMarkdown.header")(e,t,1)+"\n\n");break;case"h2":n||(a=r.subParser("makeMarkdown.header")(e,t,2)+"\n\n");break;case"h3":n||(a=r.subParser("makeMarkdown.header")(e,t,3)+"\n\n");break;case"h4":n||(a=r.subParser("makeMarkdown.header")(e,t,4)+"\n\n");break;case"h5":n||(a=r.subParser("makeMarkdown.header")(e,t,5)+"\n\n");break;case"h6":n||(a=r.subParser("makeMarkdown.header")(e,t,6)+"\n\n");break;case"p":n||(a=r.subParser("makeMarkdown.paragraph")(e,t)+"\n\n");break;case"blockquote":n||(a=r.subParser("makeMarkdown.blockquote")(e,t)+"\n\n");break;case"hr":n||(a=r.subParser("makeMarkdown.hr")(e,t)+"\n\n");break;case"ol":n||(a=r.subParser("makeMarkdown.list")(e,t,"ol")+"\n\n");break;case"ul":n||(a=r.subParser("makeMarkdown.list")(e,t,"ul")+"\n\n");break;case"precode":n||(a=r.subParser("makeMarkdown.codeBlock")(e,t)+"\n\n");break;case"pre":n||(a=r.subParser("makeMarkdown.pre")(e,t)+"\n\n");break;case"table":n||(a=r.subParser("makeMarkdown.table")(e,t)+"\n\n");break;case"code":a=r.subParser("makeMarkdown.codeSpan")(e,t);break;case"em":case"i":a=r.subParser("makeMarkdown.emphasis")(e,t);break;case"strong":case"b":a=r.subParser("makeMarkdown.strong")(e,t);break;case"del":a=r.subParser("makeMarkdown.strikethrough")(e,t);break;case"a":a=r.subParser("makeMarkdown.links")(e,t);break;case"img":a=r.subParser("makeMarkdown.image")(e,t);break;default:a=e.outerHTML+"\n\n"}return a}),r.subParser("makeMarkdown.paragraph",function(e,t){var n="";if(e.hasChildNodes())for(var a=e.childNodes,i=a.length,o=0;o<i;++o)n+=r.subParser("makeMarkdown.node")(a[o],t);return n=n.trim()}),r.subParser("makeMarkdown.pre",function(e,t){var r=e.getAttribute("prenum");return"<pre>"+t.preList[r]+"</pre>"}),r.subParser("makeMarkdown.strikethrough",function(e,t){var n="";if(e.hasChildNodes()){n+="~~";for(var a=e.childNodes,i=a.length,o=0;o<i;++o)n+=r.subParser("makeMarkdown.node")(a[o],t);n+="~~"}return n}),r.subParser("makeMarkdown.strong",function(e,t){var n="";if(e.hasChildNodes()){n+="**";for(var a=e.childNodes,i=a.length,o=0;o<i;++o)n+=r.subParser("makeMarkdown.node")(a[o],t);n+="**"}return n}),r.subParser("makeMarkdown.table",function(e,t){var n,a,i="",o=[[],[]],s=e.querySelectorAll("thead>tr>th"),l=e.querySelectorAll("tbody>tr");for(n=0;n<s.length;++n){var p=r.subParser("makeMarkdown.tableCell")(s[n],t),c="---";if(s[n].hasAttribute("style"))switch(s[n].getAttribute("style").toLowerCase().replace(/\s/g,"")){case"text-align:left;":c=":---";break;case"text-align:right;":c="---:";break;case"text-align:center;":c=":---:"}o[0][n]=p.trim(),o[1][n]=c}for(n=0;n<l.length;++n){var d=o.push([])-1,u=l[n].getElementsByTagName("td");for(a=0;a<s.length;++a){var f=" ";void 0!==u[a]&&(f=r.subParser("makeMarkdown.tableCell")(u[a],t)),o[d].push(f)}}var _=3;for(n=0;n<o.length;++n)for(a=0;a<o[n].length;++a){var h=o[n][a].length;h>_&&(_=h)}for(n=0;n<o.length;++n){for(a=0;a<o[n].length;++a)1===n?":"===o[n][a].slice(-1)?o[n][a]=r.helper.padEnd(o[n][a].slice(-1),_-1,"-")+":":o[n][a]=r.helper.padEnd(o[n][a],_,"-"):o[n][a]=r.helper.padEnd(o[n][a],_);i+="| "+o[n].join(" | ")+" |\n"}return i.trim()}),r.subParser("makeMarkdown.tableCell",function(e,t){var n="";if(!e.hasChildNodes())return"";for(var a=e.childNodes,i=a.length,o=0;o<i;++o)n+=r.subParser("makeMarkdown.node")(a[o],t,!0);return n.trim()}),r.subParser("makeMarkdown.txt",function(e){var t=e.nodeValue;return t=(t=t.replace(/ +/g," ")).replace(/¨NBSP;/g," "),t=(t=(t=(t=(t=(t=(t=(t=(t=r.helper.unescapeHTMLEntities(t)).replace(/([*_~|`])/g,"\\$1")).replace(/^(\s*)>/g,"\\$1>")).replace(/^#/gm,"\\#")).replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3")).replace(/^( {0,3}\d+)\./gm,"$1\\.")).replace(/^( {0,3})([+-])/gm,"$1\\$2")).replace(/]([\s]*)\(/g,"\\]$1\\(")).replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:")});e.exports?e.exports=r:this.showdown=r}).call(commonjsGlobal)});function flt$1(e,t,r){if(null==e||""==e)return 0;if("number"!=typeof e){if(-1!=(e+="").indexOf(" ")){var n=e.split(" ");e=isNaN(parseFloat(n[0]))?n.slice(n.length-1).join(" "):e}e=strip_number_groups(e,r),e=parseFloat(e),isNaN(e)&&(e=0)}return null!=t?_round(e,t):e}function strip_number_groups(e,t){t||(t=get_number_format$1());var r=get_number_format_info$1(t),n=new RegExp("."===r.group_sep?"\\.":r.group_sep,"g");if(e=e.replace(n,""),"."!==r.decimal_str&&""!==r.decimal_str){var a=new RegExp(r.decimal_str,"g");e=e.replace(a,".")}return e}function format_currency$1(e,t,r){var n=get_number_format$1(t),a=get_currency_symbol(t);return void 0===r&&(r=frappe.boot.sysdefaults.currency_precision||null),a?a+" "+format_number(e,n,r):format_number(e,n,r)}function get_currency_symbol(e){return frappe.boot?frappe.boot.sysdefaults&&"Yes"==frappe.boot.sysdefaults.hide_currency_symbol?null:(e||(e=frappe.boot.sysdefaults.currency),frappe.model.get_value(":Currency",e,"symbol")||e):frappe.currency_symbols[e]}function get_number_format$1(e){return frappe.boot&&frappe.boot.sysdefaults&&frappe.boot.sysdefaults.number_format||"#,###.##"}function get_number_format_info$1(e){var t=frappe.number_format_info[e];return t||(t={decimal_str:".",group_sep:","}),t.precision=e.split(t.decimal_str).slice(1)[0].length,t}function _round(e,t){var r=e<0,n=cint(t),a=Math.pow(10,n),i=+(n?Math.abs(e)*a:Math.abs(e)).toFixed(8),o=Math.floor(i),s=t||.5!=i-o?Math.round(i):o%2==0?o:o+1;return s=n?s/a:s,r?-s:s}function roundNumber(e,t){return _round(e,t)}function precision$1(e,t){if(cur_frm){t||(t=cur_frm.doc);var r=frappe.meta.get_docfield(t.doctype,e,t.parent||t.name);return r||console.log(e+": could not find docfield in method precision()"),frappe.meta.get_field_precision(r,t)}return frappe.boot.sysdefaults.float_precision}function in_list$1(e,t){return e.includes(t)}function remainder(e,t,r){r=cint(r);var n=Math.pow(10,r);if(r)var a=e*n%(t*n)/n;else a=e%t;return flt$1(a,r)}function round_based_on_smallest_currency_fraction(e,t,r){var n=flt$1(frappe.model.get_value(":Currency",t,"smallest_currency_fraction_value"));if(n){var a=remainder(e,n,r);a>n/2?e+=n-a:e-=a}else e=_round(e);return e}function fmt_money(e,t){return format_currency$1(e,t)}frappe.provide("frappe.tools"),frappe.tools.downloadify=function(e,t,r){if(t&&t.length&&!has_common(t,t))frappe.msgprint(__("Export not allowed. You need {0} role to export.",[frappe.utils.comma_or(t)]));else{var n=r+".csv",a=frappe.tools.to_csv(e),i=document.createElement("a");if("download"in i){var o=new Blob([a],{type:"text/csv;charset=UTF-8"});i.href=URL.createObjectURL(o),i.download=n}else i.href="data:attachment/csv,"+encodeURIComponent(a),i.download=n,i.target="_blank";document.body.appendChild(i),i.click(),document.body.removeChild(i)}},frappe.markdown=function(e){for(frappe.md2html||(frappe.md2html=new showdown.Converter);"\n"===e.substr(0,1);)e=e.substr(1);for(var t=0,r=e.split("\n")[0];-1!==["\n","\t"].indexOf(r.substr(0,1));)t++,r=r.substr(1);if(t&&t!=r.length){var n=[];$.each(e.split("\n"),function(e,r){n.push(r.substr(t))}),e=n.join("\n")}return frappe.md2html.makeHtml(e)},frappe.tools.to_csv=function(e){var t=[];return $.each(e,function(e,r){r=$.map(r,function(e){return null==e&&(e=""),"string"==typeof e?'"'+$("<i>").html(e.replace(/"/g,'""')).text()+'"':e}),t.push(r.join(","))}),t.join("\n")},frappe.provide("frappe.datetime"),frappe.defaultDateFormat="YYYY-MM-DD",frappe.defaultTimeFormat="HH:mm:ss",frappe.defaultDatetimeFormat=frappe.defaultDateFormat+" "+frappe.defaultTimeFormat,moment.defaultFormat=frappe.defaultDateFormat,frappe.provide("frappe.datetime"),$.extend(frappe.datetime,{convert_to_user_tz:function(e,t){if(frappe.sys_defaults.time_zone)var r=moment.tz(e,frappe.sys_defaults.time_zone).local();else r=moment(e);return!1===t?r:r.format(frappe.defaultDatetimeFormat)},convert_to_system_tz:function(e,t){if(frappe.sys_defaults.time_zone)var r=moment(e).tz(frappe.sys_defaults.time_zone);else r=moment(e);return!1===t?r:r.format(frappe.defaultDatetimeFormat)},is_timezone_same:function(){return!frappe.sys_defaults.time_zone||moment().tz(frappe.sys_defaults.time_zone).utcOffset()===moment().utcOffset()},str_to_obj:function(e){return moment(e,frappe.defaultDatetimeFormat)._d},obj_to_str:function(e){return moment(e).locale("en").format()},obj_to_user:function(e){return moment(e).format(frappe.datetime.get_user_date_fmt().toUpperCase())},get_diff:function(e,t){return moment(e).diff(t,"days")},get_hour_diff:function(e,t){return moment(e).diff(t,"hours")},get_day_diff:function(e,t){return moment(e).diff(t,"days")},add_days:function(e,t){return moment(e).add(t,"days").format()},add_months:function(e,t){return moment(e).add(t,"months").format()},week_start:function(){return moment().startOf("week").format()},week_end:function(){return moment().endOf("week").format()},month_start:function(){return moment().startOf("month").format()},month_end:function(){return moment().endOf("month").format()},quarter_start:function(){return moment().startOf("quarter").format()},quarter_end:function(){return moment().endOf("quarter").format()},year_start:function(){return moment().startOf("year").format()},year_end:function(){return moment().endOf("year").format()},get_user_time_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.time_format||"HH:mm:ss"},get_user_date_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.date_format||"yyyy-mm-dd"},get_user_fmt:function(){return frappe.sys_defaults&&frappe.sys_defaults.date_format||"yyyy-mm-dd"},str_to_user:function(e,t){if(void 0===t&&(t=!1),!e)return"";var r=frappe.datetime.get_user_time_fmt();if(t)return moment(e,frappe.defaultTimeFormat).format(r);var n=frappe.datetime.get_user_date_fmt().toUpperCase();return"string"!=typeof e||-1===e.indexOf(" ")?moment(e).format(n):moment(e,"YYYY-MM-DD HH:mm:ss").format(n+" "+r)},get_datetime_as_string:function(e){return moment(e).format("YYYY-MM-DD HH:mm:ss")},user_to_str:function(e,t){void 0===t&&(t=!1);var r=frappe.datetime.get_user_time_fmt();if(t)return moment(e,r).format(frappe.defaultTimeFormat);var n=frappe.datetime.get_user_date_fmt().toUpperCase(),a="YYYY-MM-DD";return-1!==e.indexOf(" ")&&(n+=" "+r,a+=" HH:mm:ss"),moment(e,[n.replace("YYYY","YY"),n]).locale("en").format(a)},user_to_obj:function(e){return frappe.datetime.str_to_obj(frappe.datetime.user_to_str(e))},global_date_format:function(e){var t=moment(e);return t._f&&-1!==t._f.indexOf("HH")?t.format("Do MMMM YYYY, h:mma"):t.format("Do MMMM YYYY")},now_date:function(e){return void 0===e&&(e=!1),frappe.datetime._date(frappe.defaultDateFormat,e)},now_time:function(e){return void 0===e&&(e=!1),frappe.datetime._date(frappe.defaultTimeFormat,e)},now_datetime:function(e){return void 0===e&&(e=!1),frappe.datetime._date(frappe.defaultDatetimeFormat,e)},_date:function(e,t){void 0===t&&(t=!1);var r,n=frappe.sys_defaults&&frappe.sys_defaults.time_zone;return r=n?moment.tz(n):moment(),t?frappe.datetime.moment_to_date_obj(r):r.format(e)},moment_to_date_obj:function(e){var t=new Date,r=e.toArray();return t.setFullYear(r[0]),t.setMonth(r[1]),t.setDate(r[2]),t.setHours(r[3]),t.setMinutes(r[4]),t.setSeconds(r[5]),t.setMilliseconds(r[6]),t},nowdate:function(){return frappe.datetime.now_date()},get_today:function(){return frappe.datetime.now_date()},get_time:function(e){return moment(e).format("hh:mm A")},validate:function(e){return moment(e,[frappe.defaultDateFormat,frappe.defaultDatetimeFormat,frappe.defaultTimeFormat],!0).isValid()}}),Object.defineProperties(window,{dateutil:{get:function(){return console.warn("Please use `frappe.datetime` instead of `dateutil`. It will be deprecated soon."),frappe.datetime}},date:{get:function(){return console.warn("Please use `frappe.datetime` instead of `date`. It will be deprecated soon."),frappe.datetime}},get_today:{get:function(){return console.warn("Please use `frappe.datetime.get_today` instead of `get_today`. It will be deprecated soon."),frappe.datetime.get_today}}}),window.cstr=function(e){return null==e?"":e+""},window.cint=function(e,t){return!0===e?1:!1===e?0:("0"!==(e+="")&&(e=lstrip(e,["0"])),e=parseInt(e),isNaN(e)&&(e=void 0===t?0:t),e)},window.toTitle=function(e){var t=e.split(" "),r=[];for(var n in t)r[n]=t[n].charAt(0).toUpperCase()+t[n].slice(1);return r.join(" ")},window.is_null=function(e){if(null==e||""===cstr(e).trim())return!0},window.copy_dict=function(e){var t={};for(var r in e)t[r]=e[r];return t},window.validate_email=function(e){return frappe.utils.validate_type(e,"email")},window.validate_phone=function(e){return frappe.utils.validate_type(e,"phone")},window.validate_name=function(e){return frappe.utils.validate_type(e,"name")},window.nth=function(e){var t="th";return"1"==((e=cint(e))+"").substr(-1)&&(t="st"),"2"==(e+"").substr(-1)&&(t="nd"),"3"==(e+"").substr(-1)&&(t="rd"),e+t},window.has_words=function(e,t){if(!t)return!0;if(!e)return!1;for(var r=0,n=e.length;r<n;r++)if(-1!=t.indexOf(e[r]))return!0;return!1},window.has_common=function(e,t){if(!e||!t)return!1;for(var r=0,n=e.length;r<n;r++)if(in_list(t,e[r]))return!0;return!1},window.frappe||(window.frappe={}),frappe.number_format_info={"#,###.##":{decimal_str:".",group_sep:","},"#.###,##":{decimal_str:",",group_sep:"."},"# ###.##":{decimal_str:".",group_sep:" "},"# ###,##":{decimal_str:",",group_sep:" "},"#'###.##":{decimal_str:".",group_sep:"'"},"#, ###.##":{decimal_str:".",group_sep:", "},"#,##,###.##":{decimal_str:".",group_sep:","},"#,###.###":{decimal_str:".",group_sep:","},"#.###":{decimal_str:"",group_sep:"."},"#,###":{decimal_str:"",group_sep:","}},window.format_number=function(e,t,r){t||(t=get_number_format$1(),null==r&&(r=cint(frappe.defaults.get_default("float_precision"))||3));var n=get_number_format_info$1(t);null==r&&(r=n.precision);var a=!1;(e=flt$1(e,r,t))<0&&(a=!0);var i=(e=(e=Math.abs(e)).toFixed(r)).split("."),o=n.group_sep?3:0;if(o){for(var s=i[0],l="",p=(s.length,s.length);p>=0;p--){var c=replace_all(l,n.group_sep,"").length;"#,##,###.##"==t&&-1!=l.indexOf(",")&&(o=2,c+=1),l+=s.charAt(p),!c||(c+1)%o||0==p||(l+=n.group_sep)}i[0]=l.split("").reverse().join("")}return i[0]+""==""&&(i[0]="0"),i[1]=i[1]&&n.decimal_str?n.decimal_str+i[1]:"",(a?"-":"")+i[0]+i[1]},Object.assign(window,{flt:flt$1,cint:cint,strip_number_groups:strip_number_groups,format_currency:format_currency$1,fmt_money:fmt_money,get_currency_symbol:get_currency_symbol,get_number_format:get_number_format$1,get_number_format_info:get_number_format_info$1,_round:_round,roundNumber:roundNumber,precision:precision$1,remainder:remainder,round_based_on_smallest_currency_fraction:round_based_on_smallest_currency_fraction,in_list:in_list$1}),frappe.provide("frappe.help"),frappe.help.youtube_id={},frappe.help.has_help=function(e){return frappe.help.youtube_id[e]},frappe.help.show=function(e){frappe.help.youtube_id[e]&&frappe.help.show_video(frappe.help.youtube_id[e])},frappe.help.show_video=function(e,t){if(frappe.utils.is_url(e)){e=e.match('(?:youtube.com/(?:[^/]+/.+/|(?:v|e(?:mbed)?)/|.*[?&]v=)|youtu.be/)([^"&?/s]{11})')[1]}if($("body").width()>768)var r=[670,377];else r=[560,315];frappe.msgprint({message:'<iframe width="'+r[0]+'" height="'+r[1]+'"\n\t\t\tsrc="https://www.youtube.com/embed/'+e+'"\n\t\t\tframeborder="0" allowfullscreen></iframe>'+(frappe.help_feedback_link||""),title:t||__("Help"),wide:!0}).$wrapper.addClass("video-modal")},$("body").on("click","a.help-link",function(){var e=$(this).attr("data-doctype");e&&frappe.help.show(e)}),frappe.provide("frappe.help.help_links"),frappe.help.help_links["data-import-tool"]=[{label:"Importing and Exporting Data",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/data/data-import-tool.html"}],frappe.help.help_links["modules/Setup"]=[{label:"Users and Permissions",url:"http://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/"},{label:"Settings",url:"http://frappe.github.io/erpnext/user/manual/en/setting-up/settings/"},{label:"Data Management",url:"http://frappe.github.io/erpnext/user/manual/en/setting-up/data/"},{label:"Email",url:"http://frappe.github.io/erpnext/user/manual/en/setting-up/email/"},{label:"Printing",url:"http://frappe.github.io/erpnext/user/manual/en/setting-up/print/"}],frappe.help.help_links["List/User"]=[{label:"Adding Users",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/adding-users"},{label:"Rename User",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/articles/rename-user"}],frappe.help.help_links["permission-manager"]=[{label:"Role Permissions Manager",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/role-based-permissions"}],frappe.help.help_links["user-permissions"]=[{label:"User Permissions",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/users-and-permissions/user-permissions"}],frappe.help.help_links["Form/System Settings"]=[{label:"System Settings",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/settings/system-settings"}],frappe.help.help_links["List/Email Account"]=[{label:"Email Account",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/email/email-account"}],frappe.help.help_links["List/Notification"]=[{label:"Notification",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/email/email-alerts"}],frappe.help.help_links["Form/Print Settings"]=[{label:"Print Settings",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/print/print-settings"}],frappe.help.help_links["print-format-builder"]=[{label:"Print Format Builder",url:"https://frappe.github.io/erpnext/user/manual/en/setting-up/print/print-format-builder"}],frappe.provide("frappe.contacts"),$.extend(frappe.contacts,{clear_address_and_contact:function(e){$(e.fields_dict.address_html.wrapper).html(""),e.fields_dict.contact_html&&$(e.fields_dict.contact_html.wrapper).html("")},render_address_and_contact:function(e){e.fields_dict.address_html&&"addr_list"in e.doc.__onload&&$(e.fields_dict.address_html.wrapper).html(frappe.render_template("address_list",e.doc.__onload)).find(".btn-address").on("click",function(){frappe.new_doc("Address")}),e.fields_dict.contact_html&&"contact_list"in e.doc.__onload&&$(e.fields_dict.contact_html.wrapper).html(frappe.render_template("contact_list",e.doc.__onload)).find(".btn-contact").on("click",function(){frappe.new_doc("Contact")})},get_last_doc:function(e){var t=frappe.route_history.reverse().find(function(t){return"Form"===t[0]&&t[1]!==e.doctype}),r=t&&t[1],n=t&&t[2];return t&&t.length>3&&(n=t.slice(2).join("/")),{doctype:r,docname:n}}}),frappe.preview_email=function(e,t,r){frappe.call({method:"frappe.email.email_body.get_email_html",args:{subject:"Test",template:e,args:t,header:r}}).then(function(e){var t=e.message;t=t.replace(/embed=/,"src=");var r=frappe.msgprint({message:'<iframe width="100%" height="600px" style="border: none;"></iframe>',wide:!0});setTimeout(function(){r.$wrapper.find("iframe").contents().find("html").html(t),r.$wrapper.find(".modal-dialog").css("width","70%")},1e3)})},frappe.provide("frappe.file_manager"),frappe.file_manager=function(){var e=[],t=null,r=null;function n(){e=[],t=null,r=null}return{cut:function(r,n){e=r,t=n},paste:function(a){return new Promise(function(i,o){if(0===e.length||!t)return n(),void i();r=a,frappe.call({method:"frappe.core.doctype.file.file.move_file",args:{file_list:e,new_parent:r,old_parent:t},callback:function(e){n(),i(e)}}).fail(o)})},get can_paste(){return Boolean(e.length>0&&t)},get old_folder(){return t},get files_to_move(){return e}}}(),frappe.templates.upload='<div class="file-upload">  <div class="input-upload">   <input class="input-upload-file hidden" type="file" {{ opts.allow_multiple ? "multiple" : "" }} name="filedata" />   <button class="btn btn-primary btn-sm btn-browse">{%= __("Browse") %}</button>  </div>  <div class="uploaded-filename hidden" style="width: 100%; margin-top: 12px;"></div>  <div class="web-link-wrapper" style="width: calc(100% - 80px);">   <span class="text-muted file-upload-or">{%= __("or") %}</span>   <div class="input-link" style="width: calc(100% - 30px);">    <div class="input-group">     <div class="input-group-addon">      <span class="hidden-xs">{%= __("Web Link") %}</span>      <i class="fa fa-link visible-xs"></i>     </div>     <input class="form-control" type="text" name="file_url"      placeholder="{%= (opts.sample_url || "e.g. http://example.com/somefile.png") %}"/>    </div>   </div>  </div>  <div class="private-file hidden">   <div class="checkbox">       <label>         <input type="checkbox" checked> {{ __("Private") }}       </label>     </div>  </div> </div> ';var script={name:"FilePreview",props:["file"],data:function(){return{src:null}},mounted:function(){var e=this;if(this.is_image&&window.FileReader){var t=new FileReader;t.onload=function(){return e.src=t.result},t.readAsDataURL(this.file.file_obj)}},filters:{file_size:function(e){return frappe.form.formatters.FileSize(e)},file_name:function(e){return frappe.utils.file_name_ellipsis(e,9)}},computed:{uploaded:function(){return this.file.total&&this.file.total===this.file.progress&&!this.file.failed},is_image:function(){return this.file.file_obj.type.startsWith("image")}}},__vue_script__=script,__vue_render__=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"file-preview"},[r("div",{staticClass:"file-icon border rounded"},[e.is_image?r("img",{staticStyle:{"object-fit":"cover",height:"100%"},attrs:{src:e.src,alt:e.file.name}}):r("div",{staticClass:"flex align-center justify-center",staticStyle:{height:"100%"}},[r("i",{staticClass:"octicon octicon-file-text text-extra-muted",staticStyle:{"font-size":"5rem"}})])]),e._v(" "),r("div",{staticClass:"file-info"},[r("div",{staticClass:"text-medium flex justify-between"},[r("span",{attrs:{title:e.file.name}},[e.file.doc?r("a",{attrs:{href:e.file.doc.file_url,target:"_blank"}},[e.file.doc.is_private?r("i",{staticClass:"fa fa-lock fa-fw text-warning"}):r("i",{staticClass:"fa fa-unlock-alt fa-fw text-warning"}),e._v("\n\t\t\t\t\t"+e._s(e._f("file_name")(e.file.name))+"\n\t\t\t\t")]):r("span",[r("span",{staticClass:"cursor-pointer",attrs:{title:e.__("Toggle Public/Private")},on:{click:function(t){return e.$emit("toggle_private")}}},[e.file.private?r("i",{staticClass:"fa fa-lock fa-fw text-warning"}):r("i",{staticClass:"fa fa-unlock-alt fa-fw text-warning"})]),e._v("\n\t\t\t\t\t"+e._s(e._f("file_name")(e.file.name))+"\n\t\t\t\t")])]),e._v(" "),e.uploaded?r("i",{staticClass:"octicon octicon-check text-success",attrs:{title:e.__("Uploaded successfully")}}):e._e(),e._v(" "),e.file.failed?r("i",{staticClass:"octicon octicon-x text-danger",attrs:{title:e.__("Upload failed")}}):e._e()]),e._v(" "),r("div",[r("span",{staticClass:"text-small text-muted"},[e._v("\n\t\t\t\t"+e._s(e._f("file_size")(e.file.file_obj.size))+"\n\t\t\t")])])]),e._v(" "),e.uploaded?e._e():r("div",{staticClass:"file-remove",on:{click:function(t){return e.$emit("remove")}}},[r("svg",{staticClass:"feather feather-x",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}},[r("line",{attrs:{x1:"18",y1:"6",x2:"6",y2:"18"}}),r("line",{attrs:{x1:"6",y1:"6",x2:"18",y2:"18"}})])])])},__vue_staticRenderFns__=[];__vue_render__._withStripped=!0;var __vue_inject_styles__=function(e){e&&e("data-v-217e62ce_0",{source:"/* palette colors*/\n.file-preview {\n  width: 25%;\n  padding-right: 15px;\n  padding-bottom: 15px;\n  position: relative;\n}\n.file-icon {\n  height: 10rem;\n  overflow: hidden;\n}\n.file-info {\n  margin-top: 5px;\n}\n.file-remove {\n  position: absolute;\n  top: -7px;\n  right: 7px;\n  background: #2e3338;\n  color: white;\n  padding: 3px;\n  border-radius: 50%;\n  display: flex;\n  cursor: pointer;\n}\n",map:{version:3,sources:["FilePreview.vue"],names:[],mappings:"AAAA,kBAAkB;AAClB;EACE,UAAU;EACV,mBAAmB;EACnB,oBAAoB;EACpB,kBAAkB;AACpB;AACA;EACE,aAAa;EACb,gBAAgB;AAClB;AACA;EACE,eAAe;AACjB;AACA;EACE,kBAAkB;EAClB,SAAS;EACT,UAAU;EACV,mBAAmB;EACnB,YAAY;EACZ,YAAY;EACZ,kBAAkB;EAClB,aAAa;EACb,eAAe;AACjB",file:"FilePreview.vue",sourcesContent:["/* palette colors*/\n.file-preview {\n  width: 25%;\n  padding-right: 15px;\n  padding-bottom: 15px;\n  position: relative;\n}\n.file-icon {\n  height: 10rem;\n  overflow: hidden;\n}\n.file-info {\n  margin-top: 5px;\n}\n.file-remove {\n  position: absolute;\n  top: -7px;\n  right: 7px;\n  background: #2e3338;\n  color: white;\n  padding: 3px;\n  border-radius: 50%;\n  display: flex;\n  cursor: pointer;\n}\n"]},media:void 0})},__vue_scope_id__=void 0,__vue_module_identifier__=void 0,__vue_is_functional_template__=!1;function __vue_normalize__(e,t,r,n,a,i,o,s){var l,p=("function"==typeof r?r.options:r)||{};if(p.__file="/home/frappe/frappe-bench/apps/frappe/frappe/public/js/frappe/file_uploader/FilePreview.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,a&&(p.functional=!0)),p._scopeId=n,t&&(l=function(e){t.call(this,o(e))}),void 0!==l)if(p.functional){var c=p.render;p.render=function(e,t){return l.call(t),c(e,t)}}else{var d=p.beforeCreate;p.beforeCreate=d?[].concat(d,l):[l]}return p}function __vue_create_injector__(){var e=document.head||document.getElementsByTagName("head")[0],t=__vue_create_injector__.styles||(__vue_create_injector__.styles={}),r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(n,a){if(!document.querySelector('style[data-vue-ssr-id~="'+n+'"]')){var i=r?a.media||"default":n,o=t[i]||(t[i]={ids:[],parts:[],element:void 0});if(!o.ids.includes(n)){var s=a.source,l=o.ids.length;if(o.ids.push(n),r&&(o.element=o.element||document.querySelector("style[data-group="+i+"]")),!o.element){var p=o.element=document.createElement("style");p.type="text/css",a.media&&p.setAttribute("media",a.media),r&&(p.setAttribute("data-group",i),p.setAttribute("data-next-index","0")),e.appendChild(p)}if(r&&(l=parseInt(o.element.getAttribute("data-next-index")),o.element.setAttribute("data-next-index",l+1)),o.element.styleSheet)o.parts.push(s),o.element.styleSheet.cssText=o.parts.filter(Boolean).join("\n");else{var c=document.createTextNode(s),d=o.element.childNodes;d[l]&&o.element.removeChild(d[l]),d.length?o.element.insertBefore(c,d[l]):o.element.appendChild(c)}}}}}var FilePreview=__vue_normalize__({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,__vue_create_injector__,void 0),script$1={name:"TreeNode",props:["node","selected_node"],components:{TreeNode:function(){return frappe.ui.components.TreeNode}}},__vue_script__$1=script$1,__vue_render__$1=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:e.node.filtered,expression:"node.filtered"}],staticClass:"tree-node",class:{opened:e.node.open}},[r("span",{staticClass:"tree-link",class:{active:e.node.value===e.selected_node.value},attrs:{disabled:e.node.fetching},on:{click:function(t){return e.$emit("node-click",e.node)}}},[e.node.is_leaf?r("i",{staticClass:"octicon octicon-primitive-dot node-leaf"}):r("i",{staticClass:"fa fa-fw node-parent",class:[e.node.open?"fa-folder-open":"fa-folder"]}),e._v(" "),r("a",{staticClass:"tree-label grey h6"},[e._v(e._s(e.node.label))])]),e._v(" "),r("ul",{directives:[{name:"show",rawName:"v-show",value:e.node.open,expression:"node.open"}],staticClass:"tree-children"},e._l(e.node.children,function(t){return r("TreeNode",{key:t.value,attrs:{node:t,selected_node:e.selected_node},on:{"node-click":function(t){return e.$emit("node-click",t)}}})}),1)])},__vue_staticRenderFns__$1=[];__vue_render__$1._withStripped=!0;var __vue_inject_styles__$1=void 0,__vue_scope_id__$1=void 0,__vue_module_identifier__$1=void 0,__vue_is_functional_template__$1=!1;function __vue_normalize__$1(e,t,r,n,a,i,o,s){var l=("function"==typeof r?r.options:r)||{};return l.__file="/home/frappe/frappe-bench/apps/frappe/frappe/public/js/frappe/file_uploader/TreeNode.vue",l.render||(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,a&&(l.functional=!0)),l._scopeId=n,l}var TreeNode=__vue_normalize__$1({render:__vue_render__$1,staticRenderFns:__vue_staticRenderFns__$1},__vue_inject_styles__$1,__vue_script__$1,__vue_scope_id__$1,__vue_is_functional_template__$1,__vue_module_identifier__$1,void 0,void 0),script$2={name:"FileBrowser",components:{TreeNode:TreeNode},data:function(){return{node:{label:__("Home"),value:"Home",children:[],is_leaf:!1,fetching:!1,fetched:!1,open:!1,filtered:!0},selected_node:{},filter_text:""}},mounted:function(){this.toggle_node(this.node)},methods:{toggle_node:function(e){e.fetched||e.is_leaf?(e.open=!e.open,this.select_node(e)):(e.fetching=!0,this.get_files_in_folder(e.value).then(function(t){e.open=!0,e.children=t,e.fetched=!0,e.fetching=!1}))},select_node:function(e){e.is_leaf&&(this.selected_node=e)},get_files_in_folder:function(e){return frappe.call("frappe.core.doctype.file.file.get_files_in_folder",{folder:e}).then(function(e){var t=e.message||[];return t.sort(function(e,t){return e.is_folder&&t.is_folder?e.modified<t.modified?-1:1:e.is_folder?-1:t.is_folder?1:0}),t.map(function(e){var t=e.file_name||e.name;return{label:frappe.utils.file_name_ellipsis(t,40),filename:t,file_url:e.file_url,value:e.name,is_leaf:!e.is_folder,fetched:!e.is_folder,children:[],open:!1,fetching:!1,filtered:!0}})})},apply_filter:frappe.utils.debounce(function(){var e=this.filter_text.toLowerCase(),t=function(r){var n=r.filename.toLowerCase();r.is_leaf?r.filtered=n.includes(e):r.children.forEach(t)};this.node.children.forEach(t)},300)}},__vue_script__$2=script$2,__vue_render__$2=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"file-browser"},[r("div",[r("a",{staticClass:"text-muted text-medium",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.$emit("hide-browser")}}},[e._v(e._s(e.__("← Back to upload files")))])]),e._v(" "),r("div",{staticClass:"file-browser-list border rounded"},[r("div",{staticClass:"file-filter"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.filter_text,expression:"filter_text"}],staticClass:"form-control input-xs",attrs:{type:"text",placeholder:e.__("Search by filename or extension")},domProps:{value:e.filter_text},on:{input:[function(t){t.target.composing||(e.filter_text=t.target.value)},e.apply_filter]}})]),e._v(" "),r("TreeNode",{staticClass:"tree with-skeleton",attrs:{node:e.node,selected_node:e.selected_node},on:{"node-click":function(t){return e.toggle_node(t)}}})],1)])},__vue_staticRenderFns__$2=[];__vue_render__$2._withStripped=!0;var __vue_inject_styles__$2=function(e){e&&e("data-v-7e670395_0",{source:"\n.file-browser-list {\n\theight: 300px;\n\toverflow: auto;\n\tmargin-top: 10px;\n}\n.file-filter {\n\tpadding: 15px 15px 0;\n}\n",map:{version:3,sources:["/home/frappe/frappe-bench/apps/frappe/frappe/public/js/frappe/file_uploader/FileBrowser.vue"],names:[],mappings:";AA8HA;CACA,aAAA;CACA,cAAA;CACA,gBAAA;AACA;AAEA;CACA,oBAAA;AACA",file:"FileBrowser.vue",sourcesContent:['<template>\n\t<div class="file-browser">\n\t\t<div>\n\t\t\t<a\n\t\t\t\thref=""\n\t\t\t\tclass="text-muted text-medium"\n\t\t\t\t@click.prevent="$emit(\'hide-browser\')"\n\t\t\t>{{ __(\'← Back to upload files\') }}</a>\n\t\t</div>\n\t\t<div class="file-browser-list border rounded">\n\t\t\t<div class="file-filter">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="form-control input-xs"\n\t\t\t\t\t:placeholder="__(\'Search by filename or extension\')"\n\t\t\t\t\tv-model="filter_text"\n\t\t\t\t\t@input="apply_filter"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<TreeNode\n\t\t\t\tclass="tree with-skeleton"\n\t\t\t\t:node="node"\n\t\t\t\t:selected_node="selected_node"\n\t\t\t\t@node-click="n => toggle_node(n)"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</template>\n<script>\nimport TreeNode from "./TreeNode.vue";\n\nexport default {\n\tname: \'FileBrowser\',\n\tcomponents: {\n\t\tTreeNode\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tnode: {\n\t\t\t\tlabel: __(\'Home\'),\n\t\t\t\tvalue: \'Home\',\n\t\t\t\tchildren: [],\n\t\t\t\tis_leaf: false,\n\t\t\t\tfetching: false,\n\t\t\t\tfetched: false,\n\t\t\t\topen: false,\n\t\t\t\tfiltered: true\n\t\t\t},\n\t\t\tselected_node: {},\n\t\t\tfilter_text: \'\'\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.toggle_node(this.node);\n\t},\n\tmethods: {\n\t\ttoggle_node(node) {\n\t\t\tif (!node.fetched && !node.is_leaf) {\n\t\t\t\tnode.fetching = true;\n\t\t\t\tthis.get_files_in_folder(node.value)\n\t\t\t\t\t.then(files => {\n\t\t\t\t\t\tnode.open = true;\n\t\t\t\t\t\tnode.children = files;\n\t\t\t\t\t\tnode.fetched = true;\n\t\t\t\t\t\tnode.fetching = false;\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnode.open = !node.open;\n\t\t\t\tthis.select_node(node);\n\t\t\t}\n\t\t},\n\t\tselect_node(node) {\n\t\t\tif (node.is_leaf) {\n\t\t\t\tthis.selected_node = node;\n\t\t\t}\n\t\t},\n\t\tget_files_in_folder(folder) {\n\t\t\treturn frappe.call(\'frappe.core.doctype.file.file.get_files_in_folder\', { folder })\n\t\t\t\t.then(r => {\n\t\t\t\t\tlet files = r.message || [];\n\t\t\t\t\tfiles.sort((a, b) => {\n\t\t\t\t\t\tif (a.is_folder && b.is_folder) {\n\t\t\t\t\t\t\treturn a.modified < b.modified ? -1 : 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (a.is_folder) {\n\t\t\t\t\t\t\treturn -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (b.is_folder) {\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t});\n\t\t\t\t\treturn files.map(file => {\n\t\t\t\t\t\tlet filename = file.file_name || file.name;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: frappe.utils.file_name_ellipsis(filename, 40),\n\t\t\t\t\t\t\tfilename: filename,\n\t\t\t\t\t\t\tfile_url: file.file_url,\n\t\t\t\t\t\t\tvalue: file.name,\n\t\t\t\t\t\t\tis_leaf: !file.is_folder,\n\t\t\t\t\t\t\tfetched: !file.is_folder, // fetched if node is leaf\n\t\t\t\t\t\t\tchildren: [],\n\t\t\t\t\t\t\topen: false,\n\t\t\t\t\t\t\tfetching: false,\n\t\t\t\t\t\t\tfiltered: true\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tapply_filter: frappe.utils.debounce(function() {\n\t\t\tlet filter_text = this.filter_text.toLowerCase();\n\t\t\tlet apply_filter = (node) => {\n\t\t\t\tlet search_string = node.filename.toLowerCase();\n\t\t\t\tif (node.is_leaf) {\n\t\t\t\t\tnode.filtered = search_string.includes(filter_text);\n\t\t\t\t} else {\n\t\t\t\t\tnode.children.forEach(apply_filter);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.node.children.forEach(apply_filter);\n\t\t}, 300)\n\t}\n}\n<\/script>\n\n<style>\n.file-browser-list {\n\theight: 300px;\n\toverflow: auto;\n\tmargin-top: 10px;\n}\n\n.file-filter {\n\tpadding: 15px 15px 0;\n}\n</style>\n']},media:void 0})},__vue_scope_id__$2=void 0,__vue_module_identifier__$2=void 0,__vue_is_functional_template__$2=!1;function __vue_normalize__$2(e,t,r,n,a,i,o,s){var l,p=("function"==typeof r?r.options:r)||{};if(p.__file="/home/frappe/frappe-bench/apps/frappe/frappe/public/js/frappe/file_uploader/FileBrowser.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,a&&(p.functional=!0)),p._scopeId=n,t&&(l=function(e){t.call(this,o(e))}),void 0!==l)if(p.functional){var c=p.render;p.render=function(e,t){return l.call(t),c(e,t)}}else{var d=p.beforeCreate;p.beforeCreate=d?[].concat(d,l):[l]}return p}function __vue_create_injector__$1(){var e=document.head||document.getElementsByTagName("head")[0],t=__vue_create_injector__$1.styles||(__vue_create_injector__$1.styles={}),r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(n,a){if(!document.querySelector('style[data-vue-ssr-id~="'+n+'"]')){var i=r?a.media||"default":n,o=t[i]||(t[i]={ids:[],parts:[],element:void 0});if(!o.ids.includes(n)){var s=a.source,l=o.ids.length;if(o.ids.push(n),r&&(o.element=o.element||document.querySelector("style[data-group="+i+"]")),!o.element){var p=o.element=document.createElement("style");p.type="text/css",a.media&&p.setAttribute("media",a.media),r&&(p.setAttribute("data-group",i),p.setAttribute("data-next-index","0")),e.appendChild(p)}if(r&&(l=parseInt(o.element.getAttribute("data-next-index")),o.element.setAttribute("data-next-index",l+1)),o.element.styleSheet)o.parts.push(s),o.element.styleSheet.cssText=o.parts.filter(Boolean).join("\n");else{var c=document.createTextNode(s),d=o.element.childNodes;d[l]&&o.element.removeChild(d[l]),d.length?o.element.insertBefore(c,d[l]):o.element.appendChild(c)}}}}}var FileBrowser=__vue_normalize__$2({render:__vue_render__$2,staticRenderFns:__vue_staticRenderFns__$2},__vue_inject_styles__$2,__vue_script__$2,__vue_scope_id__$2,__vue_is_functional_template__$2,__vue_module_identifier__$2,__vue_create_injector__$1,void 0),script$3={name:"WebLink",data:function(){return{url:""}}},__vue_script__$3=script$3,__vue_render__$3=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"file-web-link margin-bottom"},[r("a",{staticClass:"text-muted text-medium",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.$emit("hide-web-link")}}},[e._v("\n\t\t"+e._s(e.__("← Back to upload files"))+"\n\t")]),e._v(" "),r("div",{staticClass:"input-group"},[r("div",{staticClass:"input-group-addon"},[r("span",{staticClass:"text-muted text-medium"},[e._v(e._s(e.__("Web Link")))])]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],staticClass:"form-control",attrs:{type:"text",placeholder:e.__("Attach a web link")},domProps:{value:e.url},on:{input:function(t){t.target.composing||(e.url=t.target.value)}}})])])},__vue_staticRenderFns__$3=[];__vue_render__$3._withStripped=!0;var __vue_inject_styles__$3=function(e){e&&e("data-v-39de550b_0",{source:"\n.file-web-link .input-group {\n\tmargin-top: 10px;\n}\n",map:{version:3,sources:["/home/frappe/frappe-bench/apps/frappe/frappe/public/js/frappe/file_uploader/WebLink.vue"],names:[],mappings:";AAgCA;CACA,gBAAA;AACA",file:"WebLink.vue",sourcesContent:['<template>\n\t<div class="file-web-link margin-bottom">\n\t\t<a href class="text-muted text-medium"\n\t\t\t@click.prevent="$emit(\'hide-web-link\')"\n\t\t>\n\t\t\t{{ __(\'← Back to upload files\') }}\n\t\t</a>\n\t\t<div class="input-group">\n\t\t\t<div class="input-group-addon">\n\t\t\t\t<span class="text-muted text-medium">{{ __(\'Web Link\') }}</span>\n\t\t\t</div>\n\t\t\t<input\n\t\t\t\ttype="text"\n\t\t\t\tclass="form-control"\n\t\t\t\t:placeholder="__(\'Attach a web link\')"\n\t\t\t\tv-model="url"\n\t\t\t>\n\t\t</div>\n\t</div>\n</template>\n<script>\nexport default {\n\tname: \'WebLink\',\n\tdata() {\n\t\treturn {\n\t\t\turl: \'\',\n\t\t}\n\t}\n}\n<\/script>\n\n<style>\n.file-web-link .input-group {\n\tmargin-top: 10px;\n}\n</style>\n']},media:void 0})},__vue_scope_id__$3=void 0,__vue_module_identifier__$3=void 0,__vue_is_functional_template__$3=!1;function __vue_normalize__$3(e,t,r,n,a,i,o,s){var l,p=("function"==typeof r?r.options:r)||{};if(p.__file="/home/frappe/frappe-bench/apps/frappe/frappe/public/js/frappe/file_uploader/WebLink.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,a&&(p.functional=!0)),p._scopeId=n,t&&(l=function(e){t.call(this,o(e))}),void 0!==l)if(p.functional){var c=p.render;p.render=function(e,t){return l.call(t),c(e,t)}}else{var d=p.beforeCreate;p.beforeCreate=d?[].concat(d,l):[l]}return p}function __vue_create_injector__$2(){var e=document.head||document.getElementsByTagName("head")[0],t=__vue_create_injector__$2.styles||(__vue_create_injector__$2.styles={}),r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(n,a){if(!document.querySelector('style[data-vue-ssr-id~="'+n+'"]')){var i=r?a.media||"default":n,o=t[i]||(t[i]={ids:[],parts:[],element:void 0});if(!o.ids.includes(n)){var s=a.source,l=o.ids.length;if(o.ids.push(n),r&&(o.element=o.element||document.querySelector("style[data-group="+i+"]")),!o.element){var p=o.element=document.createElement("style");p.type="text/css",a.media&&p.setAttribute("media",a.media),r&&(p.setAttribute("data-group",i),p.setAttribute("data-next-index","0")),e.appendChild(p)}if(r&&(l=parseInt(o.element.getAttribute("data-next-index")),o.element.setAttribute("data-next-index",l+1)),o.element.styleSheet)o.parts.push(s),o.element.styleSheet.cssText=o.parts.filter(Boolean).join("\n");else{var c=document.createTextNode(s),d=o.element.childNodes;d[l]&&o.element.removeChild(d[l]),d.length?o.element.insertBefore(c,d[l]):o.element.appendChild(c)}}}}}var WebLink=__vue_normalize__$3({render:__vue_render__$3,staticRenderFns:__vue_staticRenderFns__$3},__vue_inject_styles__$3,__vue_script__$3,__vue_scope_id__$3,__vue_is_functional_template__$3,__vue_module_identifier__$3,__vue_create_injector__$2,void 0),script$4={name:"FileUploader",props:{show_upload_button:{default:!0},disable_file_browser:{default:!1},allow_multiple:{default:!0},as_dataurl:{default:!1},doctype:{default:null},docname:{default:null},folder:{default:"Home"},method:{default:null},on_success:{default:null},restrictions:{default:function(){return{max_file_size:null,max_number_of_files:null,allowed_file_types:[]}}},upload_notes:{default:null}},components:{FilePreview:FilePreview,FileBrowser:FileBrowser,WebLink:WebLink},data:function(){return{files:[],is_dragging:!1,currently_uploading:-1,show_file_browser:!1,show_web_link:!1}},watch:{files:function(e,t){!this.allow_multiple&&e.length>1&&(this.files=[e[e.length-1]])}},computed:{upload_complete:function(){return this.files.length>0&&this.files.every(function(e){return 0!==e.total&&e.progress===e.total})}},methods:{dragover:function(){this.is_dragging=!0},dragleave:function(){this.is_dragging=!1},dropfiles:function(e){this.is_dragging=!1,this.add_files(e.dataTransfer.files)},browse_files:function(){this.$refs.file_input.click()},on_file_input:function(e){this.add_files(this.$refs.file_input.files)},remove_file:function(e){this.files=this.files.filter(function(t,r){return e!==r})},toggle_private:function(e){this.files[e].private=!this.files[e].private},toggle_all_private:function(e){this.files=this.files.map(function(t){return t.private=e,t})},add_files:function(e){var t=Array.from(e).filter(this.check_restrictions).map(function(e){var t=e.type.startsWith("image");return{file_obj:e,name:e.name,doc:null,progress:0,total:0,failed:!1,uploading:!1,private:!t}});this.files=this.files.concat(t)},check_restrictions:function(e){var t=this.restrictions,r=t.max_file_size,n=t.allowed_file_types,a=(e.type,e.name.split(".").pop(),!0),i=!0;return n.length&&(a=n.some(function(t){return t.includes("/")?!!e.type&&e.type.match(t):"."===t[0]&&e.name.endsWith(t)})),r&&null!=e.size&&(i=e.size<r),a||console.warn("File skipped because of invalid file type",e),i||console.warn("File skipped because of invalid file size",e.size,e),a&&i},upload_files:function(){var e=this;return this.show_file_browser?this.upload_via_file_browser():this.show_web_link?this.upload_via_web_link():this.as_dataurl?this.return_as_dataurl():frappe.run_serially(this.files.map(function(t,r){return function(){return e.upload_file(t,r)}}))},upload_via_file_browser:function(){var e=this.$refs.file_browser.selected_node;return e.value?this.upload_file({file_url:e.file_url}):(frappe.msgprint(__("Click on a file to select it.")),Promise.reject())},upload_via_web_link:function(){var e=this.$refs.web_link.url;return e?this.upload_file({file_url:e}):(frappe.msgprint(__("Invalid URL")),Promise.reject())},return_as_dataurl:function(){var e=this,t=this.files.map(function(t){return frappe.dom.file_to_base64(t.file_obj).then(function(r){t.dataurl=r,e.on_success&&e.on_success(t)})});return Promise.all(t)},upload_file:function(e,t){var r=this;return this.currently_uploading=t,new Promise(function(t,n){var a=new XMLHttpRequest;a.upload.addEventListener("loadstart",function(t){e.uploading=!0}),a.upload.addEventListener("progress",function(t){t.lengthComputable&&(e.progress=t.loaded,e.total=t.total)}),a.upload.addEventListener("load",function(r){e.uploading=!1,t()}),a.addEventListener("error",function(t){e.failed=!0,n()}),a.onreadystatechange=function(){if(a.readyState==XMLHttpRequest.DONE)if(200===a.status){var t=null,n=null;try{"File"===(t=JSON.parse(a.responseText)).message.doctype&&(n=t.message)}catch(e){t=a.responseText}e.doc=n,r.on_success&&r.on_success(n,t)}else if(403===a.status){var i=JSON.parse(a.responseText);frappe.msgprint({title:__("Not permitted"),indicator:"red",message:i._error_message})}else{e.failed=!0;var o=null;try{o=JSON.parse(a.responseText)}catch(e){}frappe.request.cleanup({},o)}},a.open("POST","/api/method/upload_file",!0),a.setRequestHeader("Accept","application/json"),a.setRequestHeader("X-Frappe-CSRF-Token",frappe.csrf_token);var i=new FormData;e.file_obj&&i.append("file",e.file_obj,e.name),i.append("is_private",+e.private),i.append("folder",r.folder),e.file_url&&i.append("file_url",e.file_url),r.doctype&&r.docname&&(i.append("doctype",r.doctype),i.append("docname",r.docname)),r.method&&i.append("method",r.method),a.send(i)})}}},__vue_script__$4=script$4,__vue_render__$4=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"file-uploader",on:{dragover:function(t){return t.preventDefault(),e.dragover(t)},dragleave:function(t){return t.preventDefault(),e.dragleave(t)},drop:function(t){return t.preventDefault(),e.dropfiles(t)}}},[r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.files.length&&!e.show_file_browser&&!e.show_web_link,expression:"files.length === 0 && !show_file_browser && !show_web_link"}],staticClass:"file-upload-area padding border rounded text-center cursor-pointer flex align-center justify-center",on:{click:e.browse_files}},[e.is_dragging?r("div",[e._v("\n\t\t\t"+e._s(e.__("Drop files here"))+"\n\t\t")]):r("div",[r("div",[e._v("\n\t\t\t\t"+e._s(e.__("Drag and drop files, "))+"\n\t\t\t\t"),r("label",{staticStyle:{margin:"0"}},[r("a",{staticClass:"text-primary",attrs:{href:"#"},on:{click:function(e){e.preventDefault()}}},[e._v(e._s(e.__("browse,")))]),e._v(" "),r("input",{ref:"file_input",staticClass:"hidden",attrs:{type:"file",multiple:e.allow_multiple,accept:e.restrictions.allowed_file_types.join(", ")},on:{change:e.on_file_input}})]),e._v(" "),e.disable_file_browser?e._e():r("span",[e._v("\n\t\t\t\t\t"+e._s(e.__("choose an"))+"\n\t\t\t\t\t"),r("a",{staticClass:"text-primary bold",attrs:{href:"#"},on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.show_file_browser=!0}}},[e._v("\n\t\t\t\t\t\t"+e._s(e.__("uploaded file"))+"\n\t\t\t\t\t")])]),e._v("\n\t\t\t\t"+e._s(e.__("or attach a"))+"\n\t\t\t\t"),r("a",{staticClass:"text-primary bold",attrs:{href:""},on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.show_web_link=!0}}},[e._v("\n\t\t\t\t\t"+e._s(e.__("web link"))+"\n\t\t\t\t")])]),e._v(" "),r("div",{staticClass:"text-muted text-medium"},[e._v("\n\t\t\t\t"+e._s(e.upload_notes)+"\n\t\t\t")])])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.files.length&&!e.show_file_browser&&!e.show_web_link,expression:"files.length && !show_file_browser && !show_web_link"}],staticClass:"file-preview-area"},[e.upload_complete?e._e():r("div",{staticClass:"margin-bottom"},[r("label",[r("input",{staticClass:"input-with-feedback",attrs:{type:"checkbox"},on:{change:function(t){return e.toggle_all_private(t.target.checked)}}}),e._v(" "),r("span",{staticClass:"text-medium",staticStyle:{"font-weight":"normal"}},[e._v("\n\t\t\t\t\t"+e._s(e.__("Make all attachments private"))+"\n\t\t\t\t")])])]),e._v(" "),r("div",{staticClass:"flex flex-wrap"},e._l(e.files,function(t,n){return r("FilePreview",{key:t.name,attrs:{file:t},on:{remove:function(t){return e.remove_file(n)},toggle_private:function(t){return e.toggle_private(n)}}})}),1),e._v(" "),e.show_upload_button&&-1===e.currently_uploading?r("div",{staticClass:"flex align-center"},[r("button",{staticClass:"btn btn-primary btn-sm margin-right",on:{click:e.upload_files}},[1===e.files.length?r("span",[e._v("\n\t\t\t\t\t"+e._s(e.__("Upload file"))+"\n\t\t\t\t")]):r("span",[e._v("\n\t\t\t\t\t"+e._s(e.__("Upload {0} files",[e.files.length]))+"\n\t\t\t\t")])]),e._v(" "),r("div",{staticClass:"text-muted text-medium"},[e._v("\n\t\t\t\t"+e._s(e.__("Click on the lock icon to toggle public/private"))+"\n\t\t\t")])]):e._e()]),e._v(" "),-1===e.currently_uploading||e.upload_complete||e.show_file_browser||e.show_web_link?e._e():r("div",{staticClass:"upload-progress"},[r("span",{staticClass:"text-medium",domProps:{innerHTML:e._s(e.__("Uploading {0} of {1}",[String(e.currently_uploading+1).bold(),String(e.files.length).bold()]))}}),e._v(" "),e._l(e.files,function(t,n){return r("div",{directives:[{name:"show",rawName:"v-show",value:e.currently_uploading===n,expression:"currently_uploading===i"}],key:n,staticClass:"progress"},[r("div",{staticClass:"progress-bar",class:[t.total-t.progress<20?"progress-bar-success":"progress-bar-warning"],style:{width:100*t.progress/t.total+"%"},attrs:{role:"progressbar","aria-valuenow":100*t.progress/t.total,"aria-valuemin":"0","aria-valuemax":"100"}})])})],2),e._v(" "),e.show_file_browser&&!e.disable_file_browser?r("FileBrowser",{ref:"file_browser",on:{"hide-browser":function(t){e.show_file_browser=!1}}}):e._e(),e._v(" "),e.show_web_link?r("WebLink",{ref:"web_link",on:{"hide-web-link":function(t){e.show_web_link=!1}}}):e._e()],1)},__vue_staticRenderFns__$4=[];__vue_render__$4._withStripped=!0;var __vue_inject_styles__$4=function(e){e&&e("data-v-49812244_0",{source:"\n.file-upload-area {\n\tmin-height: 100px;\n}\n",map:{version:3,sources:["/home/frappe/frappe-bench/apps/frappe/frappe/public/js/frappe/file_uploader/FileUploader.vue"],names:[],mappings:";AAmaA;CACA,iBAAA;AACA",file:"FileUploader.vue",sourcesContent:['<template>\n\t<div class="file-uploader"\n\t\t@dragover.prevent="dragover"\n\t\t@dragleave.prevent="dragleave"\n\t\t@drop.prevent="dropfiles"\n\t>\n\t\t<div\n\t\t\tclass="file-upload-area padding border rounded text-center cursor-pointer flex align-center justify-center"\n\t\t\t@click="browse_files"\n\t\t\tv-show="files.length === 0 && !show_file_browser && !show_web_link"\n\t\t>\n\t\t\t<div v-if="!is_dragging">\n\t\t\t\t<div>\n\t\t\t\t\t{{ __(\'Drag and drop files, \') }}\n\t\t\t\t\t<label style="margin: 0">\n\t\t\t\t\t\t<a href="#" class="text-primary" @click.prevent>{{ __(\'browse,\') }}</a>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="file"\n\t\t\t\t\t\t\tclass="hidden"\n\t\t\t\t\t\t\tref="file_input"\n\t\t\t\t\t\t\t@change="on_file_input"\n\t\t\t\t\t\t\t:multiple="allow_multiple"\n\t\t\t\t\t\t\t:accept="restrictions.allowed_file_types.join(\', \')"\n\t\t\t\t\t\t>\n\t\t\t\t\t</label>\n\t\t\t\t\t<span v-if="!disable_file_browser">\n\t\t\t\t\t\t{{ __(\'choose an\') }}\n\t\t\t\t\t\t<a href="#" class="text-primary bold"\n\t\t\t\t\t\t\t@click.stop.prevent="show_file_browser = true"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ __(\'uploaded file\') }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t\t{{ __(\'or attach a\') }}\n\t\t\t\t\t<a class="text-primary bold" href\n\t\t\t\t\t\t@click.stop.prevent="show_web_link = true"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ __(\'web link\') }}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="text-muted text-medium">\n\t\t\t\t\t{{ upload_notes }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t{{ __(\'Drop files here\') }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="file-preview-area" v-show="files.length && !show_file_browser && !show_web_link">\n\t\t\t<div class="margin-bottom" v-if="!upload_complete">\n\t\t\t\t<label>\n\t\t\t\t\t<input type="checkbox" class="input-with-feedback" @change="e => toggle_all_private(e.target.checked)">\n\t\t\t\t\t<span class="text-medium" style="font-weight: normal;">\n\t\t\t\t\t\t{{ __(\'Make all attachments private\') }}\n\t\t\t\t\t</span>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div class="flex flex-wrap">\n\t\t\t\t<FilePreview\n\t\t\t\t\tv-for="(file, i) in files"\n\t\t\t\t\t:key="file.name"\n\t\t\t\t\t:file="file"\n\t\t\t\t\t@remove="remove_file(i)"\n\t\t\t\t\t@toggle_private="toggle_private(i)"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="flex align-center" v-if="show_upload_button && currently_uploading === -1">\n\t\t\t\t<button\n\t\t\t\t\tclass="btn btn-primary btn-sm margin-right"\n\t\t\t\t\t@click="upload_files"\n\t\t\t\t>\n\t\t\t\t\t<span v-if="files.length === 1">\n\t\t\t\t\t\t{{ __(\'Upload file\') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span v-else>\n\t\t\t\t\t\t{{ __(\'Upload {0} files\', [files.length]) }}\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t\t<div class="text-muted text-medium">\n\t\t\t\t\t{{ __(\'Click on the lock icon to toggle public/private\') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="upload-progress" v-if="currently_uploading !== -1 && !upload_complete && !show_file_browser && !show_web_link">\n\t\t\t<span\n\t\t\t\tclass="text-medium"\n\t\t\t\tv-html="__(\'Uploading {0} of {1}\', [String(currently_uploading + 1).bold(), String(files.length).bold()])"\n\t\t\t>\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\tclass="progress"\n\t\t\t\t:key="i"\n\t\t\t\tv-for="(file, i) in files"\n\t\t\t\tv-show="currently_uploading===i"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass="progress-bar"\n\t\t\t\t\t:class="[file.total - file.progress < 20 ? \'progress-bar-success\' : \'progress-bar-warning\']"\n\t\t\t\t\trole="progressbar"\n\t\t\t\t\t:aria-valuenow="(file.progress * 100 / file.total)"\n\t\t\t\t\taria-valuemin="0"\n\t\t\t\t\taria-valuemax="100"\n\t\t\t\t\t:style="{\'width\': (file.progress * 100 / file.total) + \'%\' }"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<FileBrowser\n\t\t\tref="file_browser"\n\t\t\tv-if="show_file_browser && !disable_file_browser"\n\t\t\t@hide-browser="show_file_browser = false"\n\t\t/>\n\t\t<WebLink\n\t\t\tref="web_link"\n\t\t\tv-if="show_web_link"\n\t\t\t@hide-web-link="show_web_link = false"\n\t\t/>\n\t</div>\n</template>\n\n<script>\nimport FilePreview from \'./FilePreview.vue\';\nimport FileBrowser from \'./FileBrowser.vue\';\nimport WebLink from \'./WebLink.vue\';\n\nexport default {\n\tname: \'FileUploader\',\n\tprops: {\n\t\tshow_upload_button: {\n\t\t\tdefault: true\n\t\t},\n\t\tdisable_file_browser: {\n\t\t\tdefault: false\n\t\t},\n\t\tallow_multiple: {\n\t\t\tdefault: true\n\t\t},\n\t\tas_dataurl: {\n\t\t\tdefault: false\n\t\t},\n\t\tdoctype: {\n\t\t\tdefault: null\n\t\t},\n\t\tdocname: {\n\t\t\tdefault: null\n\t\t},\n\t\tfolder: {\n\t\t\tdefault: \'Home\'\n\t\t},\n\t\tmethod: {\n\t\t\tdefault: null\n\t\t},\n\t\ton_success: {\n\t\t\tdefault: null\n\t\t},\n\t\trestrictions: {\n\t\t\tdefault: () => ({\n\t\t\t\tmax_file_size: null, // 2048 -> 2KB\n\t\t\t\tmax_number_of_files: null,\n\t\t\t\tallowed_file_types: [] // [\'image/*\', \'video/*\', \'.jpg\', \'.gif\', \'.pdf\']\n\t\t\t})\n\t\t},\n\t\tupload_notes: {\n\t\t\tdefault: null // "Images or video, upto 2MB"\n\t\t}\n\t},\n\tcomponents: {\n\t\tFilePreview,\n\t\tFileBrowser,\n\t\tWebLink\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tfiles: [],\n\t\t\tis_dragging: false,\n\t\t\tcurrently_uploading: -1,\n\t\t\tshow_file_browser: false,\n\t\t\tshow_web_link: false,\n\t\t}\n\t},\n\twatch: {\n\t\tfiles(newvalue, oldvalue) {\n\t\t\tif (!this.allow_multiple && newvalue.length > 1) {\n\t\t\t\tthis.files = [newvalue[newvalue.length - 1]];\n\t\t\t}\n\t\t}\n\t},\n\tcomputed: {\n\t\tupload_complete() {\n\t\t\treturn this.files.length > 0\n\t\t\t\t&& this.files.every(\n\t\t\t\t\tfile => file.total !== 0 && file.progress === file.total);\n\t\t}\n\t},\n\tmethods: {\n\t\tdragover() {\n\t\t\tthis.is_dragging = true;\n\t\t},\n\t\tdragleave() {\n\t\t\tthis.is_dragging = false;\n\t\t},\n\t\tdropfiles(e) {\n\t\t\tthis.is_dragging = false;\n\t\t\tthis.add_files(e.dataTransfer.files);\n\t\t},\n\t\tbrowse_files() {\n\t\t\tthis.$refs.file_input.click();\n\t\t},\n\t\ton_file_input(e) {\n\t\t\tthis.add_files(this.$refs.file_input.files);\n\t\t},\n\t\tremove_file(i) {\n\t\t\tthis.files = this.files.filter((file, j) => i !== j);\n\t\t},\n\t\ttoggle_private(i) {\n\t\t\tthis.files[i].private = !this.files[i].private;\n\t\t},\n\t\ttoggle_all_private(flag) {\n\t\t\tthis.files = this.files.map(file => {\n\t\t\t\tfile.private = flag;\n\t\t\t\treturn file;\n\t\t\t});\n\t\t},\n\t\tadd_files(file_array) {\n\t\t\tlet files = Array.from(file_array)\n\t\t\t\t.filter(this.check_restrictions)\n\t\t\t\t.map(file => {\n\t\t\t\t\tlet is_image = file.type.startsWith(\'image\');\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfile_obj: file,\n\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\tdoc: null,\n\t\t\t\t\t\tprogress: 0,\n\t\t\t\t\t\ttotal: 0,\n\t\t\t\t\t\tfailed: false,\n\t\t\t\t\t\tuploading: false,\n\t\t\t\t\t\tprivate: !is_image\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\tthis.files = this.files.concat(files);\n\t\t},\n\t\tcheck_restrictions(file) {\n\t\t\tlet { max_file_size, allowed_file_types } = this.restrictions;\n\n\t\t\tlet mime_type = file.type;\n\t\t\tlet extension = \'.\' + file.name.split(\'.\').pop();\n\n\t\t\tlet is_correct_type = true;\n\t\t\tlet valid_file_size = true;\n\n\t\t\tif (allowed_file_types.length) {\n\t\t\t\tis_correct_type = allowed_file_types.some((type) => {\n\t\t\t\t\t// is this is a mime-type\n\t\t\t\t\tif (type.includes(\'/\')) {\n\t\t\t\t\t\tif (!file.type) return false;\n\t\t\t\t\t\treturn file.type.match(type);\n\t\t\t\t\t}\n\n\t\t\t\t\t// otherwise this is likely an extension\n\t\t\t\t\tif (type[0] === \'.\') {\n\t\t\t\t\t\treturn file.name.endsWith(type);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (max_file_size && file.size != null) {\n\t\t\t\tvalid_file_size = file.size < max_file_size;\n\t\t\t}\n\n\t\t\tif (!is_correct_type) {\n\t\t\t\tconsole.warn(\'File skipped because of invalid file type\', file);\n\t\t\t}\n\t\t\tif (!valid_file_size) {\n\t\t\t\tconsole.warn(\'File skipped because of invalid file size\', file.size, file);\n\t\t\t}\n\n\t\t\treturn is_correct_type && valid_file_size;\n\t\t},\n\t\tupload_files() {\n\t\t\tif (this.show_file_browser) {\n\t\t\t\treturn this.upload_via_file_browser();\n\t\t\t}\n\t\t\tif (this.show_web_link) {\n\t\t\t\treturn this.upload_via_web_link();\n\t\t\t}\n\t\t\tif (this.as_dataurl) {\n\t\t\t\treturn this.return_as_dataurl();\n\t\t\t}\n\t\t\treturn frappe.run_serially(\n\t\t\t\tthis.files.map(\n\t\t\t\t\t(file, i) =>\n\t\t\t\t\t\t() => this.upload_file(file, i)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tupload_via_file_browser() {\n\t\t\tlet selected_file = this.$refs.file_browser.selected_node;\n\t\t\tif (!selected_file.value) {\n\t\t\t\tfrappe.msgprint(__(\'Click on a file to select it.\'));\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn this.upload_file({\n\t\t\t\tfile_url: selected_file.file_url\n\t\t\t});\n\t\t},\n\t\tupload_via_web_link() {\n\t\t\tlet file_url = this.$refs.web_link.url;\n\t\t\tif (!file_url) {\n\t\t\t\tfrappe.msgprint(__(\'Invalid URL\'));\n\t\t\t\treturn Promise.reject();\n\t\t\t}\n\n\t\t\treturn this.upload_file({\n\t\t\t\tfile_url\n\t\t\t});\n\t\t},\n\t\treturn_as_dataurl() {\n\t\t\tlet promises = this.files.map(file =>\n\t\t\t\tfrappe.dom.file_to_base64(file.file_obj)\n\t\t\t\t\t.then(dataurl => {\n\t\t\t\t\t\tfile.dataurl = dataurl;\n\t\t\t\t\t\tthis.on_success && this.on_success(file);\n\t\t\t\t\t})\n\t\t\t);\n\t\t\treturn Promise.all(promises);\n\t\t},\n\t\tupload_file(file, i) {\n\t\t\tthis.currently_uploading = i;\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tlet xhr = new XMLHttpRequest();\n\t\t\t\txhr.upload.addEventListener(\'loadstart\', (e) => {\n\t\t\t\t\tfile.uploading = true;\n\t\t\t\t})\n\t\t\t\txhr.upload.addEventListener(\'progress\', (e) => {\n\t\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\t\tfile.progress = e.loaded;\n\t\t\t\t\t\tfile.total = e.total;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\txhr.upload.addEventListener(\'load\', (e) => {\n\t\t\t\t\tfile.uploading = false;\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\txhr.addEventListener(\'error\', (e) => {\n\t\t\t\t\tfile.failed = true;\n\t\t\t\t\treject();\n\t\t\t\t})\n\t\t\t\txhr.onreadystatechange = () => {\n\t\t\t\t\tif (xhr.readyState == XMLHttpRequest.DONE) {\n\t\t\t\t\t\tif (xhr.status === 200) {\n\t\t\t\t\t\t\tlet r = null;\n\t\t\t\t\t\t\tlet file_doc = null;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tr = JSON.parse(xhr.responseText);\n\t\t\t\t\t\t\t\tif (r.message.doctype === \'File\') {\n\t\t\t\t\t\t\t\t\tfile_doc = r.message;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tr = xhr.responseText;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfile.doc = file_doc;\n\n\t\t\t\t\t\t\tif (this.on_success) {\n\t\t\t\t\t\t\t\tthis.on_success(file_doc, r);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (xhr.status === 403) {\n\t\t\t\t\t\t\tlet response = JSON.parse(xhr.responseText);\n\t\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\t\ttitle: __(\'Not permitted\'),\n\t\t\t\t\t\t\t\tindicator: \'red\',\n\t\t\t\t\t\t\t\tmessage: response._error_message\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfile.failed = true;\n\t\t\t\t\t\t\tlet error = null;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\terror = JSON.parse(xhr.responseText);\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t// pass\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfrappe.request.cleanup({}, error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\txhr.open(\'POST\', \'/api/method/upload_file\', true);\n\t\t\t\txhr.setRequestHeader(\'Accept\', \'application/json\');\n\t\t\t\txhr.setRequestHeader(\'X-Frappe-CSRF-Token\', frappe.csrf_token);\n\n\t\t\t\tlet form_data = new FormData();\n\t\t\t\tif (file.file_obj) {\n\t\t\t\t\tform_data.append(\'file\', file.file_obj, file.name);\n\t\t\t\t}\n\t\t\t\tform_data.append(\'is_private\', +file.private);\n\t\t\t\tform_data.append(\'folder\', this.folder);\n\n\t\t\t\tif (file.file_url) {\n\t\t\t\t\tform_data.append(\'file_url\', file.file_url);\n\t\t\t\t}\n\n\t\t\t\tif (this.doctype && this.docname) {\n\t\t\t\t\tform_data.append(\'doctype\', this.doctype);\n\t\t\t\t\tform_data.append(\'docname\', this.docname);\n\t\t\t\t}\n\n\t\t\t\tif (this.method) {\n\t\t\t\t\tform_data.append(\'method\', this.method);\n\t\t\t\t}\n\n\t\t\t\txhr.send(form_data);\n\t\t\t});\n\t\t}\n\t}\n}\n<\/script>\n<style>\n.file-upload-area {\n\tmin-height: 100px;\n}\n</style>\n']},media:void 0})},__vue_scope_id__$4=void 0,__vue_module_identifier__$4=void 0,__vue_is_functional_template__$4=!1;function __vue_normalize__$4(e,t,r,n,a,i,o,s){var l,p=("function"==typeof r?r.options:r)||{};if(p.__file="/home/frappe/frappe-bench/apps/frappe/frappe/public/js/frappe/file_uploader/FileUploader.vue",p.render||(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,a&&(p.functional=!0)),p._scopeId=n,t&&(l=function(e){t.call(this,o(e))}),void 0!==l)if(p.functional){var c=p.render;p.render=function(e,t){return l.call(t),c(e,t)}}else{var d=p.beforeCreate;p.beforeCreate=d?[].concat(d,l):[l]}return p}function __vue_create_injector__$3(){var e=document.head||document.getElementsByTagName("head")[0],t=__vue_create_injector__$3.styles||(__vue_create_injector__$3.styles={}),r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(n,a){if(!document.querySelector('style[data-vue-ssr-id~="'+n+'"]')){var i=r?a.media||"default":n,o=t[i]||(t[i]={ids:[],parts:[],element:void 0});if(!o.ids.includes(n)){var s=a.source,l=o.ids.length;if(o.ids.push(n),r&&(o.element=o.element||document.querySelector("style[data-group="+i+"]")),!o.element){var p=o.element=document.createElement("style");p.type="text/css",a.media&&p.setAttribute("media",a.media),r&&(p.setAttribute("data-group",i),p.setAttribute("data-next-index","0")),e.appendChild(p)}if(r&&(l=parseInt(o.element.getAttribute("data-next-index")),o.element.setAttribute("data-next-index",l+1)),o.element.styleSheet)o.parts.push(s),o.element.styleSheet.cssText=o.parts.filter(Boolean).join("\n");else{var c=document.createTextNode(s),d=o.element.childNodes;d[l]&&o.element.removeChild(d[l]),d.length?o.element.insertBefore(c,d[l]):o.element.appendChild(c)}}}}}var FileUploaderComponent=__vue_normalize__$4({render:__vue_render__$4,staticRenderFns:__vue_staticRenderFns__$4},__vue_inject_styles__$4,__vue_script__$4,__vue_scope_id__$4,__vue_is_functional_template__$4,__vue_module_identifier__$4,__vue_create_injector__$3,void 0);class FileUploader{constructor(e){var t=this;void 0===e&&(e={});var r=e.wrapper,n=e.method,a=e.on_success,i=e.doctype,o=e.docname,s=e.files,l=e.folder,p=e.restrictions,c=e.upload_notes,d=e.allow_multiple,u=e.as_dataurl,f=e.disable_file_browser;r?this.wrapper=r.get?r.get(0):r:this.make_dialog(),this.$fileuploader=new Vue({el:this.wrapper,render:function(e){return e(FileUploaderComponent,{props:{show_upload_button:!Boolean(t.dialog),doctype:i,docname:o,method:n,folder:l,on_success:a,restrictions:p,upload_notes:c,allow_multiple:d,as_dataurl:u,disable_file_browser:f}})}}),this.uploader=this.$fileuploader.$children[0],s&&s.length&&this.uploader.add_files(s)}upload_files(){var e=this;return this.dialog&&this.dialog.get_primary_btn().prop("disabled",!0),this.uploader.upload_files().then(function(){e.dialog&&e.dialog.hide()})}make_dialog(){var e=this;this.dialog=new frappe.ui.Dialog({title:"Upload",fields:[{fieldtype:"HTML",fieldname:"upload_area"}],primary_action_label:__("Upload"),primary_action:function(){return e.upload_files()}}),this.wrapper=this.dialog.fields_dict.upload_area.$wrapper[0],this.dialog.show(),this.dialog.$wrapper.on("hidden.bs.modal",function(){$(this).data("bs.modal",null),$(this).remove()})}}frappe.provide("frappe.ui"),frappe.ui.FileUploader=FileUploader,frappe.provide("frappe.ui"),frappe.ui.Tree=class{constructor(e){e.parent,e.label;var t=e.icon_set,r=(e.toolbar,e.expandable,e.with_skeleton);void 0===r&&(r=1);e.args,e.method,e.get_label,e.on_render,e.on_click;$.extend(this,arguments[0]),this.setup_treenode_class(),this.nodes={},this.wrapper=$('<div class="tree">').appendTo(this.parent),r&&this.wrapper.addClass("with-skeleton"),t||(this.icon_set={open:"fa fa-fw fa-folder-open",closed:"fa fa-fw fa-folder",leaf:"octicon octicon-primitive-dot"}),this.setup_root_node()}get_nodes(e,t){var r=this,n=Object.assign({},this.args);return n.parent=e,n.is_root=t,new Promise(function(e){frappe.call({method:r.method,args:n,callback:function(t){e(t.message)}})})}get_all_nodes(e,t){var r=Object.assign({},this.args);return r.parent=e,r.is_root=t,r.tree_method=this.method,new Promise(function(e){frappe.call({method:"frappe.desk.treeview.get_all_nodes",args:r,callback:function(t){e(t.message)}})})}setup_treenode_class(){var e=this;this.TreeNode=class{constructor(t){t.parent,t.label,t.parent_label,t.expandable,t.is_root,t.data;$.extend(this,arguments[0]),this.loaded=0,this.expanded=0,this.parent_label&&(this.parent_node=e.nodes[this.parent_label]),e.nodes[this.label]=this,e.make_node_element(this),e.on_render&&e.on_render(this)}}}setup_root_node(){this.root_node=new this.TreeNode({parent:this.wrapper,label:this.label,parent_label:null,expandable:!0,is_root:!0,data:{value:this.label}}),this.expand_node(this.root_node,!1)}refresh(){this.selected_node.parent_node&&this.load_children(this.selected_node.parent_node,!0)}make_node_element(e){e.$tree_link=$('<span class="tree-link">').attr("data-label",e.label).data("node",e).appendTo(e.parent),e.$ul=$('<ul class="tree-children">').hide().appendTo(e.parent),this.make_icon_and_label(e),this.toolbar&&(e.$toolbar=this.get_toolbar(e).insertAfter(e.$tree_link))}add_node(e,t){var r=$('<li class="tree-node">');return new this.TreeNode({parent:r.appendTo(e.$ul),parent_label:e.label,label:t.value,title:t.title,expandable:t.expandable,data:t})}reload_node(e){this.load_children(e)}toggle(){this.get_selected_node().toggle()}get_selected_node(){return this.selected_node}set_selected_node(e){this.selected_node=e}load_children(e,t){var r=this;void 0===t&&(t=!1);var n=e.data.value,a=e.is_root;t?frappe.run_serially([function(){return r.get_all_nodes(n,a)},function(e){r.render_children_of_all_nodes(e)},function(){r.set_selected_node(e)}]):frappe.run_serially([function(){return r.get_nodes(n,a)},function(t){r.render_node_children(e,t)},function(){r.set_selected_node(e)}])}render_children_of_all_nodes(e){var t=this;e.map(function(e){t.render_node_children(t.nodes[e.parent],e.data)})}render_node_children(e,t){var r=this;e.$ul.empty(),t&&$.each(t,function(t,n){var a=r.add_node(e,n);a.$tree_link.data("node-data",n).data("node",a)}),e.expanded=!1,e.loaded=!0,this.expand_node(e)}on_node_click(e){this.expand_node(e),frappe.dom.activate(this.wrapper,e.$tree_link,"tree-link"),e.$toolbar&&this.show_toolbar(e)}expand_node(e,t){void 0===t&&(t=!0),this.set_selected_node(e),t&&this.on_click&&this.on_click(e),e.expandable&&this.toggle_node(e),this.select_link(e),e.expanded=!e.expanded,e.parent.toggleClass("opened",e.expanded)}toggle_node(e){if(e.expandable&&this.get_nodes&&!e.loaded)return this.load_children(e);e.$ul&&(e.$ul.children().length&&e.$ul.toggle(!e.expanded),this.icon_set&&(e.$tree_link.find("i").removeClass(),e.expanded?e.$tree_link.find("i").addClass(this.icon_set.closed+" node-parent"):e.$tree_link.find("i").addClass(this.icon_set.open+" node-parent")))}select_link(e){this.wrapper.find(".selected").removeClass("selected"),e.$tree_link.toggleClass("selected")}show_toolbar(e){this.cur_toolbar&&$(this.cur_toolbar).hide(),this.cur_toolbar=e.$toolbar,e.$toolbar.show()}get_node_label(e){return this.get_label?this.get_label(e):e.title&&e.title!=e.label?__(e.title)+" <span class='text-muted'>("+e.label+")</span>":__(e.title||e.label)}make_icon_and_label(e){var t=this,r="";this.icon_set&&(r=e.expandable?'<i class="'+this.icon_set.closed+' node-parent"></i>':'<i class="'+this.icon_set.leaf+' node-leaf"></i>'),$(r).appendTo(e.$tree_link),$('<a class="tree-label grey h6"> '+this.get_node_label(e)+"</a>").appendTo(e.$tree_link),e.$tree_link.on("click",function(){setTimeout(function(){t.on_node_click(e)},100)})}get_toolbar(e){var t=this,r=$('<span class="tree-node-toolbar btn-group"></span>').hide();return Object.keys(this.toolbar).map(function(n){var a=t.toolbar[n];if(a.label&&(!a.condition||a.condition(e))){var i=a.get_label?a.get_label():a.label;$("<button class='btn btn-default btn-xs'></button>").html(i).addClass("tree-toolbar-button "+(a.btnClass||"")).appendTo(r).on("click",function(){a.click(e),t.refresh()})}}),r}},frappe.provide("frappe.pages"),frappe.provide("frappe.views"),window.cur_page=null,frappe.views.Container=Class.extend({_intro:"Container contains pages inside `#container` and manages \t\t\tpage creation, switching",init:function(){this.container=$("#body_div").get(0),this.page=null,this.pagewidth=$(this.container).width(),this.pagemargin=50;var e=this;$(document).on("page-change",function(){var t=frappe.get_route_str();$("body").attr("data-route",t),$("body").attr("data-sidebar",e.has_sidebar()?1:0)}),$(document).bind("rename",function(e,t,r,n){frappe.breadcrumbs.rename(t,r,n)})},add_page:function(e){var t=$('<div class="content page-container"></div>').attr("id","page-"+e).attr("data-page-route",e).hide().appendTo(this.container).get(0);return t.label=e,frappe.pages[e]=t,t},change_to:function(e){if(cur_page=this,this.page&&this.page.label===e)$(this.page).trigger("show");else{if(e.tagName)var t=e;else t=frappe.pages[e];if(t)return window.cur_dialog&&cur_dialog.display&&!cur_dialog.keep_open&&(cur_dialog.minimizable?cur_dialog.is_minimized||cur_dialog.toggle_minimize():cur_dialog.hide()),this.page&&this.page!=t&&($(this.page).hide(),$(this.page).trigger("hide")),this.page&&this.page==t||(this.page=t,$(this.page).show()),$(document).trigger("page-change"),this.page._route=window.location.hash,$(this.page).trigger("show"),!this.page.disable_scroll_to_top&&frappe.utils.scroll_to(0),frappe.breadcrumbs.update(),this.page;console.log(__("Page not found")+": "+e)}},has_sidebar:function(){var e=0,t=frappe.get_route_str();if(!(e=frappe.ui.pages[t]&&!frappe.ui.pages[t].single_column)){var r=t.split("/").slice(0,2).join("/");e=$('.page-container[data-page-route="'+r+'"] .layout-side-section').length?1:0}return e}}),frappe.breadcrumbs={all:{},preferred:{File:"",Video:"",Dashboard:"Customization","Dashboard Chart":"Customization","Dashboard Chart Source":"Customization"},module_map:{Core:"Settings",Email:"Settings",Custom:"Settings",Workflow:"Settings",Printing:"Settings",Setup:"Settings","Event Streaming":"Tools",Automation:"Tools"},set_doctype_module:function(e,t){localStorage["preferred_breadcrumbs:"+e]=t},get_doctype_module:function(e){return localStorage["preferred_breadcrumbs:"+e]},add:function(e,t,r){var n;n="object"==typeof e?e:{module:e,doctype:t,type:r},frappe.breadcrumbs.all[frappe.breadcrumbs.current_page()]=n,frappe.breadcrumbs.update()},current_page:function(){return frappe.get_route_str()},update:function(){var e=frappe.breadcrumbs.all[frappe.breadcrumbs.current_page()];frappe.visible_modules||(frappe.visible_modules=$.map(frappe.boot.allowed_modules,function(e){return e.module_name}));var t=$("#navbar-breadcrumbs").empty();if(e){if("Custom"===e.type){var r='<li><a href="'+e.route+'">'+e.label+"</a></li>";return t.append(r),void $("body").removeClass("no-breadcrumbs")}var n=frappe.breadcrumbs.get_doctype_module(e.doctype);if(n?e.module=n:void 0!==frappe.breadcrumbs.preferred[e.doctype]&&(e.module=frappe.breadcrumbs.preferred[e.doctype]),e.module){frappe.breadcrumbs.module_map[e.module]&&(e.module=frappe.breadcrumbs.module_map[e.module]);var a=e.module;if(frappe.boot.module_page_map[e.module]&&(e.module=frappe.boot.module_page_map[e.module]),frappe.get_module(a)){var i=frappe.get_module(a);i&&i.icon,i?i.label:e.module;i&&!i.blocked&&frappe.visible_modules.includes(i.module_name)&&$(repl('<li><a href="#workspace/%(module)s">%(label)s</a></li>',{module:e.module,label:__(e.module)})).appendTo(t)}}if(e.doctype&&"Form"===frappe.get_route()[0])if("User"===e.doctype||frappe.get_doc("DocType",e.doctype).issingle);else{var o;if(-1!==frappe.boot.treeviews.indexOf(e.doctype))o=(frappe.model.user_settings[e.doctype].last_view||"Tree")+"/"+e.doctype;else o="List/"+e.doctype;$(repl('<li><a href="#%(route)s">%(label)s</a></li>',{route:o,label:__(e.doctype)})).appendTo(t)}$("body").removeClass("no-breadcrumbs")}else $("body").addClass("no-breadcrumbs")},rename:function(e,t,r){var n=["Form",e,t].join("/"),a=["Form",e,r].join("/");frappe.breadcrumbs.all[a]=frappe.breadcrumbs.all[n],delete frappe.breadcrumbs.all[n]}},frappe.provide("frappe.pages"),frappe.provide("frappe.views"),frappe.views.Factory=class{constructor(e){$.extend(this,e)}show(){var e=frappe.get_route_str();if(frappe.pages[e]&&!e.includes("Form/"))frappe.container.change_to(e),this.on_show&&this.on_show();else{var t=frappe.get_route();t[1]?this.make(t):frappe.show_not_found(t)}}make_page(e,t){return frappe.make_page(e,t)}},frappe.make_page=function(e,t){if(!t)t=frappe.get_route_str();var r=frappe.container.add_page(t);return frappe.ui.make_app_page({parent:r,single_column:!e}),frappe.container.change_to(t),r};class Desktop{constructor(e){var t=e.wrapper;this.wrapper=t,this.pages={},this.sidebar_items={},this.mobile_sidebar_items={},this.sidebar_categories=["Modules","Domains","Places","Administration"],this.make()}make(){var e=this;this.make_container(),this.fetch_desktop_settings().then(function(){e.route(),e.make_sidebar()})}route(){var e=this.get_page_to_show();this.show_page(e)}make_container(){this.container=$('\n\t\t\t<div class="desk-container row">\n\t\t\t\t<div class="desk-sidebar"></div>\n\t\t\t\t<div class="desk-body">\n\t\t\t\t\t<div class="page-switcher">\n\t\t\t\t\t\t<div class="current-title"></div>\n\t\t\t\t\t\t<i class="fa fa-chevron-down text-muted"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mobile-list">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>'),this.container.appendTo(this.wrapper),this.sidebar=this.container.find(".desk-sidebar"),this.body=this.container.find(".desk-body"),this.current_title=this.container.find(".current-title"),this.mobile_list=this.container.find(".mobile-list"),this.page_switcher=this.container.find(".page-switcher")}fetch_desktop_settings(){var e=this;return frappe.call("frappe.desk.desktop.get_desk_sidebar_items").then(function(t){t.message?e.sidebar_configuration=t.message:frappe.throw({title:__("Couldn't Load Desk"),message:__("Something went wrong while loading Desk. <b>Please relaod the page</b>. If the problem persists, contact the Administrator"),indicator:"red",primary_action:{label:__("Reload"),action:function(){return location.reload()}}})})}make_sidebar(){var e=this,t=function(t){t.name==e.get_page_to_show()&&(t.selected=!0,e.current_page=t.name);var r=function(e){return $('<a href="desk#workspace/'+e.name+'"\n\t\t\t\t\tclass="sidebar-item \n\t\t\t\t\t\t'+(e.selected?" selected":"")+"\n\t\t\t\t\t\t"+(e.hidden?"hidden":"")+'\n\t\t\t\t\t">\n\t\t\t\t\t<span>'+(e.label||e.name)+"</span>\n\t\t\t\t</div>")}(t),n=r.clone();r.appendTo(e.sidebar),e.sidebar_items[t.name]=r,n.appendTo(e.mobile_list),e.mobile_sidebar_items[t.name]=n};this.sidebar_categories.forEach(function(r){var n;e.sidebar_configuration.hasOwnProperty(r)&&((n=$('<div class="sidebar-group-title h6 uppercase">'+__(r)+"</div>")).appendTo(e.sidebar),n.clone().appendTo(e.mobile_list),e.sidebar_configuration[r].forEach(function(e){t(e)}))}),frappe.is_mobile&&this.page_switcher.on("click",function(){e.mobile_list.toggle()})}show_page(e){this.current_page&&this.pages[this.current_page]&&this.pages[this.current_page].hide(),this.sidebar_items&&this.sidebar_items[this.current_page]&&(this.sidebar_items[this.current_page].removeClass("selected"),this.mobile_sidebar_items[this.current_page].removeClass("selected"),this.sidebar_items[e].addClass("selected"),this.mobile_sidebar_items[e].addClass("selected")),this.current_page=e,this.mobile_list.hide(),this.current_title.empty().append(this.current_page),localStorage.current_desk_page=e,this.pages[e]?this.pages[e].show():this.make_page(e)}get_page_to_show(){var e=this.sidebar_configuration?this.sidebar_configuration.Modules[0].name:frappe.boot.allowed_workspaces[0].name;return frappe.get_route()[1]||localStorage.current_desk_page||e}make_page(e){var t=new DesktopPage({container:this.body,page_name:e});return this.pages[e]=t,t}}class DesktopPage{constructor(e){var t=e.container,r=e.page_name;frappe.desk_page=this,this.container=t,this.page_name=r,this.sections={},this.allow_customization=!1,this.reload()}show(){frappe.desk_page=this,this.page.show(),this.sections.shortcuts&&this.sections.shortcuts.widgets_list.forEach(function(e){e.set_actions()})}hide(){this.page.hide()}reload(){this.in_customize_mode=!1,this.page&&this.page.remove(),this.make(),this.setup_events()}make_customization_link(){var e=this;this.customize_link=$('<div class="small customize-options" style="cursor: pointer;">'+__("Customize Workspace")+"</div>"),this.customize_link.appendTo(this.page),this.customize_link.on("click",function(){e.customize()}),this.save_or_discard_link=$('<div class="small customize-options small-bounce">\n\t\t\t<span class="save-customization">'+__("Save")+'</span> / <span class="discard-customization">'+__("Discard")+"</span>\n\t\t\t</div>").hide(),this.save_or_discard_link.appendTo(this.page),this.save_or_discard_link.find(".save-customization").on("click",function(){return e.save_customization()}),this.save_or_discard_link.find(".discard-customization").on("click",function(){return e.reload()}),this.page.addClass("allow-customization")}make(){var e=this;this.page=$('<div class="desk-page" data-page-name='+this.page_name+"></div>"),this.page.appendTo(this.container),this.get_data().then(function(t){if(e.data=t.message,!e.data)return delete localStorage.current_desk_page,void frappe.set_route("workspace");e.refresh()})}refresh(){var e=this;this.page.empty(),this.allow_customization=this.data.allow_customization||!1,frappe.is_mobile()&&(this.allow_customization=!1),this.allow_customization&&this.make_customization_link(),this.data.onboarding&&this.data.onboarding.items.length&&this.make_onboarding(),this.make_charts().then(function(){e.make_shortcuts(),e.make_cards(),e.allow_customization&&$(".desk-page .widget-group:visible:first").css("margin-top","-25px")})}get_data(){return frappe.call("frappe.desk.desktop.get_desktop_page",{page:this.page_name})}setup_events(){var e=this;$(document.body).on("toggleFullWidth",function(){return e.refresh()})}customize(){var e=this;this.in_customize_mode||($(".widget.onboarding-widget-box").hide(),$(".desk-page .widget-group:visible:first").css("margin-top","0px"),this.customize_link.hide(),this.save_or_discard_link.show(),Object.keys(this.sections).forEach(function(t){e.sections[t].customize()}),this.in_customize_mode=!0,$(".desk-page .widget-group:visible:first").css("margin-top","-25px"))}save_customization(){var e=this,t={};this.sections.charts&&(t.charts=this.sections.charts.get_widget_config()),this.sections.shortcuts&&(t.shortcuts=this.sections.shortcuts.get_widget_config()),this.sections.cards&&(t.cards=this.sections.cards.get_widget_config()),frappe.call("frappe.desk.desktop.save_customization",{page:this.page_name,config:t}).then(function(t){t.message?(frappe.msgprint({message:__("Customizations Saved Successfully"),title:__("Success")}),e.reload()):(frappe.throw({message:__("Something went wrong while saving customizations"),title:__("Failed")}),e.reload())})}make_onboarding(){this.onboarding_widget=frappe.widget.make_widget({label:this.data.onboarding.label||__("Let's Get Started"),subtitle:this.data.onboarding.subtitle,steps:this.data.onboarding.items,success:this.data.onboarding.success,docs_url:this.data.onboarding.docs_url,widget_type:"onboarding",container:this.page,options:{allow_sorting:!1,allow_create:!1,allow_delete:!1,allow_hiding:!1,allow_edit:!1,max_widget_count:2}})}make_charts(){var e=this;return frappe.dashboard_utils.get_dashboard_settings().then(function(t){var r=t.chart_config?JSON.parse(t.chart_config):{};e.data.charts.items&&e.data.charts.items.map(function(e){e.chart_settings=r[e.chart_name]||{}}),e.sections.charts=new frappe.widget.WidgetGroup({title:e.data.charts.label||__("{} Dashboard",[__(e.page_name)]),container:e.page,type:"chart",columns:1,hidden:Boolean(e.onboarding_widget),options:{allow_sorting:e.allow_customization,allow_create:e.allow_customization,allow_delete:e.allow_customization,allow_hiding:!1,allow_edit:!0,max_widget_count:2},widgets:e.data.charts.items})})}make_shortcuts(){this.sections.shortcuts=new frappe.widget.WidgetGroup({title:this.data.shortcuts.label||__("Your Shortcuts"),container:this.page,type:"shortcut",columns:3,options:{allow_sorting:this.allow_customization,allow_create:this.allow_customization,allow_delete:this.allow_customization,allow_hiding:!1,allow_edit:!0},widgets:this.data.shortcuts.items})}make_cards(){var e=new frappe.widget.WidgetGroup({title:this.data.cards.label||__("Reports & Masters"),container:this.page,type:"links",columns:3,options:{allow_sorting:this.allow_customization,allow_create:!1,allow_delete:!1,allow_hiding:this.allow_customization,allow_edit:!1},widgets:this.data.cards.items});this.sections.cards=e;var t=[{color:"blue",description:__("Important")},{color:"orange",description:__("No Records Created")}].map(function(e){return'<div class="legend-item small text-muted justify-flex-start">\n\t\t\t\t<span class="indicator '+e.color+'"></span>\n\t\t\t\t<span class="link-content ellipsis" draggable="false">'+e.description+"</span>\n\t\t\t</div>"});$('<div class="legend">\n\t\t\t'+t.join("\n")+"\n\t\t</div>").insertAfter(e.body)}}frappe.provide("frappe.views.pageview"),frappe.provide("frappe.standard_pages"),frappe.views.pageview={with_page:function(e,t){if(in_list(Object.keys(frappe.standard_pages),e))return frappe.pages[e]||frappe.standard_pages[e](),void t();if(locals.Page&&locals.Page[e]&&locals.Page[e].script||e==window.page_name)t();else{if(!localStorage["_page:"+e]||1==frappe.boot.developer_mode)return frappe.call({method:"frappe.desk.desk_page.getpage",args:{name:e},callback:function(r){r.docs._dynamic_page||(localStorage["_page:"+e]=JSON.stringify(r.docs)),t()},freeze:!0});frappe.model.sync(JSON.parse(localStorage["_page:"+e])),t()}},show:function(e){if(!e&&"workspace"===(e=frappe.boot?frappe.boot.home_page:window.page_name)){if(!frappe.workspace){var t=frappe.container.add_page("workspace"),r=$('<div class="container"></div>').appendTo(t);r=$("<div></div>").appendTo(r),frappe.workspace=new Desktop({wrapper:r})}return frappe.container.change_to("workspace"),frappe.workspace.route(),void frappe.utils.set_title(__("Desk"))}frappe.model.with_doctype("Page",function(){frappe.views.pageview.with_page(e,function(t){t&&t.exc?t[403]||frappe.show_not_found(e):frappe.pages[e]||new frappe.views.Page(e),frappe.container.change_to(e)})})}},frappe.views.Page=Class.extend({init:function(e){this.name=e;var t=this;if(e==window.page_name)this.wrapper=document.getElementById("page-"+e),this.wrapper.label=document.title||window.page_name,this.wrapper.page_name=window.page_name,frappe.pages[window.page_name]=this.wrapper;else{if(this.pagedoc=locals.Page[this.name],!this.pagedoc)return void frappe.show_not_found(e);this.wrapper=frappe.container.add_page(this.name),this.wrapper.label=this.pagedoc.title||this.pagedoc.name,this.wrapper.page_name=this.pagedoc.name,this.pagedoc.content&&(this.wrapper.innerHTML=this.pagedoc.content),frappe.dom.eval(this.pagedoc.__script||this.pagedoc.script||""),frappe.dom.set_style(this.pagedoc.style||""),frappe.breadcrumbs.add(this.pagedoc.module||null)}this.trigger_page_event("on_page_load"),$(this.wrapper).on("show",function(){window.cur_frm=null,t.trigger_page_event("on_page_show"),t.trigger_page_event("refresh")})},trigger_page_event:function(e){this.wrapper[e]&&this.wrapper[e](this.wrapper)}}),frappe.show_not_found=function(e){frappe.show_message_page({page_name:e,message:__("Sorry! I could not find what you were looking for."),img:"/assets/frappe/images/ui/bubble-tea-sorry.svg"})},frappe.show_not_permitted=function(e){frappe.show_message_page({page_name:e,message:__("Sorry! You are not permitted to view this page."),img:"/assets/frappe/images/ui/bubble-tea-sorry.svg"})},frappe.show_message_page=function(e){e.page_name||(e.page_name=frappe.get_route_str()),e.icon?e.img=repl('<span class="%(icon)s message-page-icon"></span> ',e):e.img&&(e.img=repl('<img src="%(img)s" class="message-page-image">',e));var t=frappe.pages[e.page_name]||frappe.container.add_page(e.page_name);$(t).html(repl('<div class="page message-page">\t\t\t<div class="text-center message-page-content">\t\t\t\t%(img)s\t\t\t\t<p class="lead">%(message)s</p>\t\t\t\t<a class="btn btn-default btn-sm btn-home" href="#">%(home)s</a>\t\t\t</div>\t\t</div>',{img:e.img||"",message:e.message||"",home:__("Home")})),frappe.container.change_to(e.page_name)},frappe.provide("frappe.search"),frappe.provide("frappe.tags"),frappe.search.AwesomeBar=Class.extend({setup:function(e){var t=this,r=$(e),n=r.get(0);this.options=[],this.global_results=[];var a=new Awesomplete(n,{minChars:0,maxItems:99,autoFirst:!0,list:[],filter:function(e,t){return!0},data:function(e,t){return{label:e.index||"",value:e.value}},item:function(e,t){var r=this.get_item(e.value),n="<span>"+__(r.label||r.value)+"</span>";return r.description&&r.value!==r.description&&(n+='<br><span class="text-muted ellipsis">'+__(r.description)+"</span>"),$("<li></li>").data("item.autocomplete",r).html('<a style="font-weight:normal"><p>'+n+"</p></a>").get(0)},sort:function(e,t){return t.label-e.label}});n.awesomplete=a,r.on("input",function(e){var r=e.target.value.trim().replace(/\s\s+/g," "),n=r.lastIndexOf(" ");t.global_results=[];var i=$(this);clearTimeout(i.data("timeout")),i.data("timeout",setTimeout(function(){t.options=[],r&&r.length>1?(-1!==n&&t.set_specifics(r.slice(0,n),r.slice(n+1)),t.add_defaults(r),t.options=t.options.concat(t.build_options(r)),t.options=t.options.concat(t.global_results)):(t.options=t.options.concat(t.deduplicate(frappe.search.utils.get_recent_pages(r||""))),t.options=t.options.concat(frappe.search.utils.get_frequent_links())),t.add_help(),a.list=t.deduplicate(t.options)},100))});r.on("focus",function(){this.autocomplete_open||$(this).trigger("input")}),r.on("awesomplete-open",function(e){t.autocomplete_open=e.target}),r.on("awesomplete-close",function(e){t.autocomplete_open=!1}),r.on("awesomplete-select",function(e){var t=e.originalEvent.text.value,n=a.get_item(t);if(n.route_options&&(frappe.route_options=n.route_options),n.onclick)n.onclick(n.match);else{var i=window.location.hash;frappe.set_route(n.route),window.location.hash==i&&frappe.route()}r.val("")}),r.on("awesomplete-selectcomplete",function(e){r.val("")}),r.on("keydown",null,"esc",function(){r.blur()}),frappe.search.utils.setup_recent()},add_help:function(){this.options.push({value:__("Help on Search"),index:-10,default:"Help",onclick:function(){var e='<table class="table table-bordered">\t\t\t\t\t<tr><td style="width: 50%">'+__("Create a new record")+"</td><td>"+__("new type of document")+"</td></tr>\t\t\t\t\t<tr><td>"+__("List a document type")+"</td><td>"+__("document type..., e.g. customer")+"</td></tr>\t\t\t\t\t<tr><td>"+__("Search in a document type")+"</td><td>"+__("text in document type")+"</td></tr>\t\t\t\t\t<tr><td>"+__("Tags")+"</td><td>"+__("tag name..., e.g. #tag")+"</td></tr>\t\t\t\t\t<tr><td>"+__("Open a module or tool")+"</td><td>"+__("module name...")+"</td></tr>\t\t\t\t\t<tr><td>"+__("Calculate")+"</td><td>"+__("e.g. (55 + 434) / 4 or =Math.sin(Math.PI/2)...")+"</td></tr>\t\t\t\t</table>";frappe.msgprint(e,__("Search Help"))}})},set_specifics:function(e,t){var r=this;this.build_options(e).forEach(function(e){e.type&&0===e.type.toLowerCase().indexOf(t.toLowerCase())&&r.options.push(e)})},add_defaults:function(e){this.make_global_search(e),this.make_search_in_current(e),this.make_calculator(e),this.make_random(e)},build_options:function(e){var t=frappe.search.utils.get_creatables(e).concat(frappe.search.utils.get_search_in_list(e),frappe.search.utils.get_doctypes(e),frappe.search.utils.get_reports(e),frappe.search.utils.get_pages(e),frappe.search.utils.get_workspaces(e),frappe.search.utils.get_dashboards(e),frappe.search.utils.get_recent_pages(e||""),frappe.search.utils.get_executables(e));return"#"===e.charAt(0)&&(t=frappe.tags.utils.get_tags(e)),this.deduplicate(t).sort(function(e,t){return t.index-e.index})},deduplicate:function(e){var t=[],r=[];return e.forEach(function(e){if(e.route){"List"===e.route[0]&&"Report"!==e.route[2]&&e.route.splice(2);var n="string"==typeof e.route?e.route:e.route.join("/");if(-1===r.indexOf(n))t.push(e),r.push(n);else{var a=r.indexOf(n);t[a].index<e.index&&!e.recent&&(t[a]=e)}}else t.push(e),r.push("")}),t},set_global_results:function(e,t){this.global_results=this.global_results.concat(e)},make_global_search:function(e){"#"!==e.charAt(0)&&this.options.push({label:__("Search for '{0}'",[frappe.utils.xss_sanitise(e).bold()]),value:__("Search for '{0}'",[e]),match:e,index:100,default:"Search",onclick:function(){frappe.searchdialog.search.init_search(e,"global_search")}})},make_search_in_current:function(e){var t=frappe.get_route();if("List"===t[0]&&-1===e.indexOf(" in")){var r={};r[frappe.get_meta(frappe.container.page.list_view.doctype).title_field||"name"]=["like","%"+e+"%"],this.options.push({label:__("Find {0} in {1}",[e.bold(),__(t[1]).bold()]),value:__("Find {0} in {1}",[e,__(t[1])]),route_options:r,onclick:function(){cur_list.show()},index:90,default:"Current",match:e})}},make_calculator:function(txt){var first=txt.substr(0,1);if(first==parseInt(first)||"("===first||"="===first){"="===first&&(txt=txt.substr(1));try{var val=eval(txt),formatted_value=__("{0} = {1}",[txt,(val+"").bold()]);this.options.push({label:formatted_value,value:__("{0} = {1}",[txt,val]),match:val,index:80,default:"Calculator",onclick:function(){frappe.msgprint(formatted_value,"Result")}})}catch(e){}}},make_random:function(e){e.toLowerCase().includes("random")&&this.options.push({label:"Generate Random Password",value:frappe.utils.get_random(16),onclick:function(){frappe.msgprint(frappe.utils.get_random(16),"Result")}})}}),frappe.provide("frappe.search"),frappe.ui.Notifications=class{constructor(){var e=this;frappe.model.with_doc("Notification Settings",frappe.session.user).then(function(t){e.notifications_settings=t,e.make()})}make(){this.$dropdown=$(".navbar").find(".dropdown-notifications"),this.$dropdown_list=this.$dropdown.find(".notifications-list"),this.$notification_indicator=this.$dropdown.find(".notifications-indicator"),this.user=frappe.session.user,this.max_length=20,this.render_dropdown_headers(),this.$notifications=this.$dropdown_list.find('.category-list[data-category="Notifications"]'),this.$open_docs=this.$dropdown_list.find('.category-list[data-category="Open Documents"]'),this.$today_events=this.$dropdown_list.find('.category-list[data-category="Todays Events"]'),frappe.utils.bind_actions_with_object(this.$dropdown_list,this);frappe.search.utils.make_function_searchable(this.route_to_settings,__("Notification Settings")),this.setup_notifications(),this.bind_events()}route_to_settings(){frappe.set_route("#Form/Notification Settings/"+frappe.session.user)}setup_notifications(){var e=this;this.get_notifications_list(this.max_length).then(function(t){e.dropdown_items=t,e.render_notifications_dropdown(),0==e.notifications_settings.seen&&e.$notification_indicator.show()})}render_todays_events(e,t){var r=this;if(!t.next().hasClass("in")){var n=frappe.datetime.get_today();frappe.xcall("frappe.desk.doctype.event.event.get_events",{start:n,end:n}).then(function(e){r.render_events_html(e)})}}render_events_html(e){var t="";if(e.length){t=e.map(function(e){var t=frappe.datetime.get_time(e.starts_on);return'<a class="recent-item event" href="#Form/Event/'+e.name+'">\n\t\t\t\t\t<span class="event-time bold">'+t+'</span>\n\t\t\t\t\t<span class="event-subject">'+e.subject+"</span>\n\t\t\t\t</a>"}).join("")}else t='<li class="recent-item text-center">\n\t\t\t\t\t<span class="text-muted">'+__("No Events Today")+"</span>\n\t\t\t\t</li>";this.$today_events.html(t)}get_open_document_config(e){var t=this;this.open_docs_config={ToDo:{label:__("To Do")},Event:{label:__("Calendar"),route:"List/Event/Calendar"}},$(e.currentTarget).next().hasClass("in")||frappe.ui.notifications.get_notification_config().then(function(e){t.open_document_list=e,t.render_open_document_count()})}render_open_document_count(){this.$open_docs.html("");var e=["ToDo"];this.get_counts(this.open_document_list.open_count_doctype,1,e);var t={doctypes:{}},r=this.open_document_list.targets;Object.keys(r).map(function(e){Object.keys(r[e]).map(function(n){t[n]=r[e][n],t.doctypes[n]=e})}),this.get_counts(t,1,null,["doctypes"],!0),this.get_counts(this.open_document_list.open_count_doctype,0,null,e)}get_counts(e,t,r,n,a){var i=this;void 0===n&&(n=[]),void 0===a&&(a=!1);var o=1;(r=r||Object.keys(e).sort().filter(function(e){return!n.includes(e)})).map(function(t){var r=e.doctypes?e.doctypes[t]:void 0;(e[t]>0||a)&&(i.add_open_document_html(t,e[t],r,a),o=0)}),t&&!o&&this.$open_docs.append($('<li class="divider"></li>'))}add_open_document_html(e,t,r,n){void 0===n&&(n=!1);var a=this.open_docs_config[e]?this.open_docs_config[e].label:e,i=n?'title="'+__("Your Target")+'"':"",o=n?$('<li><a class="progress-small" data-action="route_to_document_type" '+i+'\n\t\t\t\tdata-doctype="'+r+'" data-docname="'+e+'">\n\t\t\t\t\t<span class="dropdown-item-label">'+__(a)+'<span>\n\t\t\t\t\t<div class="progress-chart">\n\t\t\t\t\t\t<div class="progress">\n\t\t\t\t\t\t\t<div class="progress-bar" style="width: '+t+'%"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t</a></li>'):$('<li><a class="badge-hover" data-action="route_to_document_type" data-doctype="'+e+'" '+i+">\n\t\t\t\t"+__(a)+'\n\t\t\t\t<span class="badge pull-right">'+t+"</span>\n\t\t\t</a></li>");this.$open_docs.append(o),n||(this.total+=t)}route_to_document_type(e){this.$dropdown.removeClass("open"),this.$dropdown.trigger("hide.bs.dropdown");var t=$(e.currentTarget).attr("data-doctype"),r=$(e.currentTarget).attr("data-docname");if(r)frappe.set_route("Form",t,r);else{var n=this.open_docs_config[t]||{};n.route?frappe.set_route(n.route):n.click?n.click():frappe.ui.notifications.show_open_count_list(t)}}update_dropdown(){var e=this;this.get_notifications_list(1).then(function(t){var r=t[0];e.dropdown_items.unshift(r),e.dropdown_items.length>e.max_length&&(e.$dropdown_list.find(".recent-notification").last().remove(),e.dropdown_items.pop()),e.insert_into_dropdown()})}insert_into_dropdown(){var e=this.dropdown_items[0],t=this.get_dropdown_item_html(e);$(t).prependTo(this.$dropdown_list.find(this.$notifications)),this.change_activity_status()}change_activity_status(){this.$dropdown_list.find(".activity-status")&&this.$dropdown_list.find(".activity-status").replaceWith('<a class="recent-item text-center text-muted"\n\t\t\t\t\thref="#List/Notification Log">\n\t\t\t\t\t<div class="full-log-btn">'+__("View Full Log")+"</div>\n\t\t\t\t</a>")}set_field_as_read(e,t){frappe.call("frappe.desk.doctype.notification_log.notification_log.mark_as_read",{docname:e}).then(function(){t.removeClass("unread")})}explicitly_mark_as_read(e,t){e.preventDefault(),e.stopImmediatePropagation();var r=t.parents(".unread").attr("data-name");this.set_field_as_read(r,t.parents(".unread"))}mark_as_read(e,t){var r=t.attr("data-name"),n=this.dropdown_items.filter(function(e){return r.includes(e.name)})[0];this.set_field_as_read(n.name,t)}mark_all_as_read(e){e.stopImmediatePropagation(),this.$dropdown_list.find(".unread").removeClass("unread"),frappe.call("frappe.desk.doctype.notification_log.notification_log.mark_all_as_read")}toggle_seen(e){frappe.call("frappe.desk.doctype.notification_settings.notification_settings.set_seen_value",{value:cint(e),user:frappe.session.user})}get_notifications_list(e){return frappe.db.get_list("Notification Log",{fields:["*"],limit:e,order_by:"creation desc"})}render_notifications_dropdown(){var e,t=this,r="",n="";this.notifications_settings&&!this.notifications_settings.enabled?e='<li class="recent-item text-center">\n\t\t\t\t<span class="text-muted">\n\t\t\t\t\t'+__("Notifications Disabled")+"\n\t\t\t\t</span></li>":(this.dropdown_items.length?(this.dropdown_items.forEach(function(e){var n=t.get_dropdown_item_html(e);n&&(r+=n)}),n='<a class="recent-item text-center text-muted"\n\t\t\t\t\thref="#List/Notification Log">\n\t\t\t\t\t\t<div class="full-log-btn">'+__("View Full Log")+"</div>\n\t\t\t\t\t</a>"):r+='<li class="recent-item text-center activity-status">\n\t\t\t\t\t<span class="text-muted">\n\t\t\t\t\t\t'+__("No activity")+"\n\t\t\t\t\t</span></li>",e=r+n),this.$notifications.html(e)}get_dropdown_item_html(e){var t=this.get_item_link(e),r=e.read?"":"unread",n=e.read?"":'data-action="mark_as_read"',a=e.subject,i=a.match(/<b class="subject-title">(.*?)<\/b>/),o='<div class="message">'+(a=i?a.replace(i[1],frappe.ellipsis(strip_html(i[1]),100)):a)+"</div>",s=e.from_user,l=frappe.avatar(s,"avatar-small user-avatar"),p=frappe.datetime.comment_when(e.creation,!0);return'<a class="recent-item '+r+'"\n\t\t\t\thref="'+t+'"\n\t\t\t\tdata-name="'+e.name+'"\n\t\t\t\t'+n+"\n\t\t\t>\n\t\t\t\t"+l+"\n\t\t\t\t"+o+'\n\t\t\t\t<div class="notification-timestamp text-muted">\n\t\t\t\t\t'+p+'\n\t\t\t\t</div>\n\t\t\t\t<span class="mark-read text-muted hidden-xs" data-action="explicitly_mark_as_read">\n\t\t\t\t\t'+__("Mark as Read")+"\n\t\t\t\t</span>\n\t\t\t</a>"}get_item_link(e){var t="Alert"==e.type?"Notification Log":e.document_type,r="Alert"==e.type?e.name:e.document_name;return frappe.utils.get_form_link(t,r)}render_dropdown_headers(){this.categories=[{label:__("Notifications"),value:"Notifications"},{label:__("Today's Events"),value:"Todays Events",action:"render_todays_events"},{label:__("Open Documents"),value:"Open Documents",action:"get_open_document_config"}];var e=this.categories.map(function(e){var t=frappe.dom.get_unique_id(),r="Notifications"===e.value?'<span class="notification-settings pull-right" data-action="go_to_settings">\n\t\t\t\t\t\t'+__("Settings")+"\n\t\t\t\t\t</span>":"",n="Notifications"===e.value?'<span class="mark-all-read pull-right" data-action="mark_all_as_read">\n\t\t\t\t\t\t'+__("Mark all as Read")+"\n\t\t\t\t\t</span>":"";return'<li class="notifications-category">\n\t\t\t\t\t<li class="text-muted header"\n\t\t\t\t\t\tdata-action="'+e.action+'"\n\t\t\t\t\t\thref="#'+t+'"\n\t\t\t\t\t\tdata-toggle="collapse">\n\t\t\t\t\t\t'+e.label+'\n\t\t\t\t\t\t<span class="octicon octicon-chevron-down collapse-indicator"></span>\n\t\t\t\t\t\t'+r+"\n\t\t\t\t\t\t"+n+'\n\t\t\t\t\t</li>\n\t\t\t\t\t<div id="'+t+'" class="collapse category-list" data-category="'+e.value+'">\n\t\t\t\t\t\t<div class="text-center text-muted notifications-loading">\n\t\t\t\t\t\t\t'+__("Loading...")+"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</li>"}).join('<li class="divider"></li>');this.$dropdown_list.append(e),this.$dropdown_list.find('.category-list[data-category="Notifications"]').collapse("show"),this.toggle_collapse_indicator(this.$dropdown_list.find('.category-list[data-category="Notifications"]'))}go_to_settings(e){e.stopImmediatePropagation(),this.$dropdown.removeClass("open"),this.$dropdown.trigger("hide.bs.dropdown"),this.route_to_settings()}bind_events(){var e=this;this.setup_dropdown_events(),this.setup_notification_listeners(),this.$dropdown_list.on("click",".recent-item",function(){e.$dropdown.removeClass("open")}),$(".category-list").on("hide.bs.collapse",function(t){e.toggle_collapse_indicator($(t.currentTarget))}),$(".category-list").on("show.bs.collapse",function(t){e.toggle_collapse_indicator($(t.currentTarget))})}setup_notification_listeners(){var e=this;frappe.realtime.on("notification",function(){e.$dropdown.find(".notifications-indicator").show(),e.update_dropdown()}),frappe.realtime.on("indicator_hide",function(){e.$dropdown.find(".notifications-indicator").hide()})}setup_dropdown_events(){var e=this;this.$dropdown_list.find('[data-category="Notifications"], [data-category="Todays Events"], [data-category="Open Documents"]').collapse({toggle:!1}),this.$dropdown.on("hide.bs.dropdown",function(e){var t=$(e.currentTarget).data("closable");return $(e.currentTarget).data("closable",!0),t}),this.$dropdown.on("show.bs.dropdown",function(){e.toggle_seen(!0),e.$notification_indicator.is(":visible")&&(e.$notification_indicator.hide(),frappe.call("frappe.desk.doctype.notification_log.notification_log.trigger_indicator_hide"))}),this.$dropdown.on("click",function(e){$(e.target).closest(".dropdown-toggle").length?$(e.currentTarget).data("closable",!0):$(e.currentTarget).data("closable",!1)})}toggle_collapse_indicator(e){e.prev().find(".collapse-indicator").toggleClass("octicon-chevron-down"),e.prev().find(".collapse-indicator").toggleClass("octicon-chevron-up")}},frappe.ui.notifications={get_notification_config:function(){return frappe.xcall("frappe.desk.notifications.get_notification_info").then(function(e){return frappe.ui.notifications.config=e,e})},show_open_count_list:function(e){var t=this;frappe.ui.notifications.config?this.route_to_list_with_filters(e):this.get_notification_config().then(function(){t.route_to_list_with_filters(e)})},route_to_list_with_filters:function(e){var t=frappe.ui.notifications.config.conditions[e];t&&$.isPlainObject(t)&&(frappe.route_options||(frappe.route_options={}),$.extend(frappe.route_options,t)),frappe.set_route("List",e)}},frappe.provide("frappe.search"),frappe.search.SearchDialog=Class.extend({init:function(e){$.extend(this,e),this.make()},make:function(){var e=new frappe.ui.Dialog;$(e.header).html($(frappe.render_template("search_header"))),this.search_dialog=e,this.$search_modal=$(e.$wrapper).addClass("search-dialog"),this.$modal_body=$(e.body),this.$input=this.$search_modal.find(".search-input"),this.setup()},setup:function(){this.modal_state=0,this.current_keyword="",this.more_count=20,this.full_lists={},this.nav_lists={},this.bind_input(),this.bind_events()},update:function(e){this.$search_modal.find(".loading-state").addClass("hide"),this.$modal_body.append(e),this.$modal_body.find(".search-results").length>1?(this.$modal_body.find(".search-results").first().addClass("hide"),e.removeClass("hide"),this.$modal_body.find(".search-results").first().remove()):e.removeClass("hide")},put_placeholder:function(e){var t=$('<div class="row search-results hide"><div class="empty-state"><span style="margin-top: -100px"><i class="mega-octicon octicon-telescope status-icon"><i class="fa fa-square cover twinkle-one hide" style="left:0px;"></i><i class="fa fa-square cover twinkle-two hide" style="left:8px; top:5px;"></i><i class="fa fa-square cover twinkle-three hide" style="left:13px; top:-3px;"></i></i><p>'+e+"</p></span></div></div>");this.update(t)},bind_input:function(){var e=this;this.$input.on("input",function(){var t=$(this);clearTimeout(t.data("timeout")),t.data("timeout",setTimeout(function(){if(e.$input.val()!==e.current_keyword){var t=e.$input.val();t.length>1?e.get_results(t):(e.current_keyword="",e.put_placeholder(e.search.empty_state_text))}},300))})},bind_events:function(){var e=this,t=this;this.$modal_body.on("click",".list-link",function(){var e=$(this);t.$modal_body.find(".search-sidebar").find(".list-link").removeClass("active select"),e.addClass("active select");var r=e.attr("data-category");t.$modal_body.find(".results-area").empty().html(t.full_lists[r]),t.$modal_body.find(".module-section-link").first().focus(),t.current_type=r}),this.$modal_body.on("click",".section-more",function(){var e=$(this).attr("data-category");t.$modal_body.find(".search-sidebar").find('*[data-category="'+e+'"]').trigger("click")}),this.$modal_body.on("click",".all-results-link",function(){t.$modal_body.find(".search-sidebar").find('*[data-category="All Results"]').trigger("click")}),this.$modal_body.on("click",".list-more",function(){var e=$(this).attr("data-category"),r=$(this).attr("data-search"),n=t.$modal_body.find(".result").length;if("Global"===r)frappe.search.utils.get_global_results(t.current_keyword,n,t.more_count,e).then(function(e){t.add_more_results(e)},function(e){console.error(e)});else{var a=t.nav_lists[e].slice(0,t.more_count);t.nav_lists[e].splice(0,t.more_count),t.add_more_results([{title:e,results:a}])}}),this.$modal_body.on("click",".switch-to-global-search",function(){t.search=t.searches.global_search,t.$input.attr("placeholder",t.search.input_placeholder),t.put_placeholder(t.search.empty_state_text),t.get_results(t.current_keyword)}),this.bind_keyboard_events(),this.search_dialog.minimizable=!0,this.search_dialog.is_minimized=!1,this.search_dialog.$wrapper.find(".btn-modal-minimize").click(function(){return e.toggle_minimize()})},bind_keyboard_events:function(){var e=this;this.$search_modal.on("keydown",function(t){if(e.$modal_body.find(".list-link").length>1&&0===e.modal_state){var r=frappe.ui.keyCode,n=r.UP_ARROW,a=r.DOWN_ARROW,i=r.TAB;if(t.which===a||t.which===i)t.preventDefault(),(o=e.$modal_body.find(".list-link.select").next()).length>0&&o.trigger("click");else if(t.which===n){var o;t.preventDefault(),(o=e.$modal_body.find(".list-link.select").prev()).length>0&&o.trigger("click")}}e.$input.is(":focus")||e.$input.focus()})},init_search:function(e,t){var r=this;this.search=this.searches[t],this.$input.attr("placeholder",this.search.input_placeholder),this.put_placeholder(this.search.empty_state_text),this.get_results(e),this.search_dialog.show(),this.$input.val(e),setTimeout(function(){r.$input.select()},500)},get_results:function(e){this.current_keyword=e,this.$modal_body.find(".empty-state").length>0?(this.put_placeholder(__("Searching ...")),this.$modal_body.find(".cover").removeClass("hide")):this.$search_modal.find(".loading-state").removeClass("hide"),"#"===this.current_keyword.charAt(0)?this.search=this.searches.tags:this.search=this.searches.global_search,this.search.get_results(e,this.parse_results.bind(this)),this.search_dialog.is_minimized&&this.toggle_minimize()},parse_results:function(e,t){(e=e.filter(function(e){return e.results.length>0})).length>0?this.render_data(e):this.put_placeholder(this.search.no_results_status(t))},render_data:function(e){var t=this,r=$(frappe.render_template("search")).addClass("hide"),n=r.find(".search-sidebar").empty(),a='<li class="module-sidebar-item list-link" data-category="{0}"><a><span class="ellipsis">{0}</span><i class="octicon octicon-chevron-right"></a></li>';this.modal_state=0,this.full_lists={"All Results":$('<div class="module-body results-summary"></div>')},this.nav_lists={},e.forEach(function(e){n.append($(__(a,[e.title]))),t.add_section_to_summary(e.title,e.results),t.full_lists[e.title]=t.render_full_list(e.title,e.results,e.fetch_type)}),e.length>1&&n.prepend($(__(a,["All Results"]))),this.update(r.clone()),this.$modal_body.find(".list-link").first().trigger("click")},render_full_list:function(e,t,r){for(var n=$(' <div class="module-body"><div class="row module-section full-list '+e+'-section"><div class="col-sm-12 module-section-column"><div class="back-link"><a class="all-results-link small"> All Results</a></div><div class="h4 section-head">'+e+'</div><div class="section-body"></div></div></div></div>'),a=n.find(".module-section-column"),i=0;i<20&&t.length>0;i++)a.append(this.render_result(e,t.shift()));return t.length>0&&("Nav"===r&&(this.nav_lists[e]=t),a.append('<a class="list-more small" data-search="'+r+'" data-category="'+e+'" data-count="20" style="margin-top:10px">'+__("More...")+"</a>")),n},add_section_to_summary:function(e,t){for(var r=this,n=!1,a="10px",i=0;i<t.length;i++)if(t[i].description){n=!0;break}t[0].image&&(a="20px");var o=n?[3,"12"]:[4,"6"],s=o[0],l=o[1];(1!==this.full_lists["All Results"].find(".module-section").last().find(".col-sm-6").length||n)&&this.full_lists["All Results"].append($('<div class="row module-section"></div>'));var p=$('<div class="col-sm-'+l+' module-section-column" data-type="'+e+'">\n\t\t\t<div class="h4 section-head">'+e+'</div>\n\t\t\t<div class="section-body"></div>\n\t\t\t</div>');t.slice(0,s).forEach(function(t){p.append(r.render_result(e,t))}),t.length>s&&p.append('<div style="margin-top:'+a+'"><a class="section-more small"\n\t\t\t\tdata-category="'+e+'">'+__("More...")+"</a></div>"),this.full_lists["All Results"].find(".module-section").last().append(p)},render_result:function(e,t){var r=this,n=$('<div class="result '+e+'-result"></div>');function a(e){return e.route?'href="#'+e.route.join("/")+'" ':e.data_path?'data-path="'+e.data_path+'"':""}t.image?n.append("<a "+a(t)+'>\n\t\t\t\t<div class="result-image">\n\t\t\t\t\t<img\n\t\t\t\t\t\tdata-name="'+t.label+'"\n\t\t\t\t\t\tsrc="'+t.image+'"\n\t\t\t\t\t\talt="'+t.label+'"\n\t\t\t\t\t\tonerror="this.src=\'/assets/frappe/images/fallback-thumbnail.jpg\'">\n\t\t\t\t</div>\n\t\t\t</a>'):null===t.image&&n.append("<a "+a(t)+'><div class="result-image"><div class="flex-text"><span>'+frappe.get_abbr(t.label)+"</span></div></div></a>");var i="<a "+a(t)+' class="module-section-link small">'+t.label+"</a>",o=$('<div style="display: inline-block;"></div>');return t.description?(o.append($("<b>"+i+"</b>")),o.append('<p class="small">'+t.description+"</p>")):(o.append($(i)),t.route_options&&(frappe.route_options=t.route_options),n.on("click",function(e){if(r.toggle_minimize(),t.onclick)t.onclick(t.match);else{var n=window.location.hash;frappe.set_route(t.route),window.location.hash==n&&frappe.route()}})),n.append(o),t.subtypes&&t.subtypes.forEach(function(e){n.append(e)}),n},add_more_results:function(e){var t=this,r=$('<div class="more-results last"></div>');if(e[0].results.forEach(function(n){r.append(t.render_result(e[0].title,n))}),this.$modal_body.find(".list-more").before(r),e[0].results.length<this.more_count){this.$modal_body.find(".list-more").hide();var n=this.$modal_body.find(".result").length,a=$('<p class="results-status text-muted small">'+n+" results found</p>");this.$modal_body.find(".more-results:last").append(a)}this.$modal_body.find(".more-results.last").slideDown(200,function(){})},get_minimize_btn:function(){return this.search_dialog.$wrapper.find(".modal-header .btn-modal-minimize")},toggle_minimize:function(){var e=this.search_dialog.$wrapper.closest(".modal").toggleClass("modal-minimize");e.attr("tabindex")?e.removeAttr("tabindex"):e.attr("tabindex",-1),this.get_minimize_btn().find("i").toggleClass("octicon-chevron-down").toggleClass("octicon-chevron-up"),this.search_dialog.is_minimized=!this.search_dialog.is_minimized,this.on_minimize_toggle&&this.on_minimize_toggle(this.search_dialog.is_minimized),this.search_dialog.header.find(".modal-title").toggleClass("cursor-pointer")},searches:{global_search:{input_placeholder:__("Search"),empty_state_text:__("Search for anything"),no_results_status:function(e){return"<p>"+__("No results found for {0} in Global Search",[e])+"</p>"},get_results:function(e,t){var r=frappe.search.utils.get_nav_results(e);frappe.search.utils.get_global_results(e,0,1e3).then(function(n){r=r.concat(n),t(r,e)},function(e){console.error(e)})}},tags:{input_placeholder:__("Search"),empty_state_text:__("Search for anything"),no_results_status:function(e){return"<p>"+__("No documents found tagged with {0}",[e])+"</p>"},get_results:function(e,t){var r=frappe.search.utils.get_nav_results(e);frappe.tags.utils.get_tag_results(e).then(function(n){r=r.concat(n),t(r,e)},function(e){console.error(e)})}}}}),frappe.provide("frappe.tags"),frappe.tags.utils={get_tags:function(e){e=e.slice(1);var t=[],r=function(r){var n=frappe.tags.tags[r],a=frappe.search.utils.fuzzy_search(e,n);a&&t.push({type:"Tag",label:__("#{0}",[frappe.search.utils.bolden_match_part(__(n),e)]),value:__("#{0}",[__(n)]),index:1+a,match:n,onclick:function(){frappe.searchdialog.search.init_search("#".concat(n),"tags")}})};for(var n in frappe.tags.tags)r(n);return t},fetch_tags:function(){frappe.call({method:"frappe.desk.doctype.tag.tag.get_tags_list_for_awesomebar",callback:function(e){e&&e.message&&(frappe.tags.tags=$.extend([],e.message))}})},get_tag_results:function(e){function t(e){var t,r,n=[];return e.forEach(function(e){var a,i="";e.content&&(i=function(e){var t=null;if(e.length>110)t=e.slice(0,110)+"...";else{var r=e.length;t=e.slice(0,r)+"..."}return t}(e.content)),t={label:e.name,value:e.name,description:i,route:["Form",e.doctype,e.name]},a=e.doctype,(r=n.find(function(e){return e.title===a}))?r.results.push(t):(r={title:e.doctype,results:[t],fetch_type:"Global"},n.push(r))}),n}return new Promise(function(r){frappe.call({method:"frappe.desk.doctype.tag.tag.get_documents_for_tag",args:{tag:e},callback:function(e){e.message?r(t(e.message)):r([])}})})}},frappe.templates.search='<div class="row search-results">     <div class="col-md-2 col-sm-2 hidden-xs layout-side-section">         <ul class="module-sidebar-nav overlay-sidebar nav nav-pills nav-stacked search-sidebar"></ul>     </div>     <div class="col-md-10 col-sm-10 layout-main-section results-area"></div> </div>',frappe.templates.search_header='<div class="search-header">  <i class="octicon octicon-search"></i>  <input type="text" class="form-control search-input" style="padding-left: 15px">  <p class="loading-state hide" style="margin: 0px 20px; color:#d4d9dd">{%= __("Searching")%}&nbsp...</p>  <a type="button" class="btn btn-default btn-sm btn-modal-minimize" style="margin-right: 2px;">   <i class="octicon octicon-chevron-down" style="padding: 1px 0px;"></i>  </a>  <a type="button" class="btn btn-default btn-sm btn-modal-close" data-dismiss="modal" aria-hidden="true">   <i class="octicon octicon-x visible-xs" style="padding: 1px 0px;"></i>   <span class="hidden-xs">Close</span>  </a> </div>',frappe.provide("frappe.search"),frappe.search.utils={setup_recent:function(){this.recent=JSON.parse(frappe.boot.user.recent||"[]")||[]},get_recent_pages:function(e){null===e&&(e="");var t=[],r=[];return this.recent.forEach(function(e,r){t.push([e[1],["Form",e[0],e[1]]])}),t=t.reverse(),frappe.route_history.forEach(function(e,r){"Form"===e[0]?t.push([e[2],e]):["List","Tree","modules","query-report"].includes(e[0])||"Report"===e[2]?e[1]&&t.push([e[1],e]):e[0]&&t.push([frappe.route_titles[e.join("/")]||e[0],e])}),function(e,t,n){e.forEach(function(e,a){var i=$.isArray(e)?e[0]:e;if(i=__(i||"").toLowerCase().replace(/-/g," "),t===i||-1!==i.indexOf(t)){var o=n(e);o&&($.isPlainObject(o)&&(o=[o]),o.forEach(function(t){t.match=e,t.recent=!0}),r=o.concat(r))}})}(t,e,function(e){var t={route:e[1]};if("Form"===e[1][0])e[1].length>2&&e[1][1]!==e[1][2]?(t.label=__(e[1][1])+" "+e[1][2].bold(),t.value=__(e[1][1])+" "+e[1][2]):(t.label=__(e[1][1]).bold(),t.value=__(e[1][1]));else if(["List","Tree","modules","query-report"].includes(e[1][0])&&e[1].length>1){var r=e[1][0],n=r;"modules"===r?n="Module":"query-report"!==r&&"Report"!==e[1][2]||(n="Report"),t.label=__(e[1][1]).bold()+" "+__(n),t.value=__(e[1][1])+" "+__(n)}else e[0]?(t.label=e[0].bold(),t.value=e[0]):console.log("Illegal match",e);return t.index=80,t}),r},get_frequent_links:function(){var e=[];return frappe.boot.frequently_visited_links.forEach(function(t){var r=frappe.utils.get_route_label(t.route);e.push({route:t.route,label:r,value:r,index:t.count})}),e.length?e:this.get_recent_pages("")},get_search_in_list:function(e){var t=this,r=[];if(in_list(e.split(" "),"in")&&"in"!==e.slice(-2)){var n=e.split(" in ");frappe.boot.user.can_read.forEach(function(e){if(frappe.boot.user.can_search.includes(e)){var a=t.fuzzy_search(n[1],e);a&&r.push({type:"In List",label:__("Find {0} in {1}",[__(n[0]),t.bolden_match_part(__(e),n[1])]),value:__("Find {0} in {1}",[__(n[0]),__(e)]),route_options:{name:["like","%"+n[0]+"%"]},index:1+a,route:["List",e]})}})}return r},get_creatables:function(e){var t=this,r=[];return e.split(" ")[0].toLowerCase()===__("new")&&frappe.boot.user.can_create.forEach(function(n){var a=t.fuzzy_search(e.substr(4),n);a&&r.push({type:"New",label:__("New {0}",[t.bolden_match_part(__(n),e.substr(4))]),value:__("New {0}",[__(n)]),index:1+a,match:n,onclick:function(){frappe.new_doc(n,!0)}})}),r},get_doctypes:function(e){var t,r,n=this,a=[],i=function(a,i,o){var s="List"===a&&r.endsWith("List"),l=n.bolden_match_part(__(r),e);return{type:a,label:l+=s?"":" "+__(a),value:__(r+" "+a),index:t+o,match:r,route:i}};return frappe.boot.user.can_read.forEach(function(o){if(t=n.fuzzy_search(e,o))if(r=o,in_list(frappe.boot.single_types,o))a.push(i("",["Form",o,o],.05));else if(frappe.boot.user.can_search.includes(o)){if(in_list(frappe.boot.user.can_create,o)){var s=o;a.push({type:"New",label:__("New {0}",[n.bolden_match_part(__(o),e)]),value:__("New {0}",[__(o)]),index:t+.015,match:o,onclick:function(){frappe.new_doc(s,!0)}})}in_list(frappe.boot.treeviews,o)?a.push(i("Tree",["Tree",o],.05)):(a.push(i("List",["List",o],.05)),frappe.model.can_get_report(o)&&a.push(i("Report",["List",o,"Report"],.04)))}}),a},get_reports:function(e){var t,r=this,n=[];return Object.keys(frappe.boot.user.all_reports).forEach(function(a){var i=r.fuzzy_search(e,a);if(i>0){var o=frappe.boot.user.all_reports[a];t="Report Builder"==o.report_type?["List",o.ref_doctype,"Report",a]:["query-report",a],n.push({type:"Report",label:__("Report {0}",[r.bolden_match_part(__(a),e)]),value:__("Report {0}",[__(a)]),index:i,route:t})}}),n},get_pages:function(e){var t=this,r=[];this.pages={},$.each(frappe.boot.page_info,function(e,r){t.pages[r.title]=r,r.name=e}),Object.keys(this.pages).forEach(function(n){if("Hub"!=n&&"hub"!=n){var a=t.fuzzy_search(e,n);if(a){var i=t.pages[n];r.push({type:"Page",label:__("Open {0}",[t.bolden_match_part(__(n),e)]),value:__("Open {0}",[__(n)]),match:n,index:a,route:[i.route||i.name]})}}});var n="Calendar";return 0===__("calendar").indexOf(e.toLowerCase())&&r.push({type:"Calendar",value:__("Open {0}",[__(n)]),index:t.fuzzy_search(e,"Calendar"),match:n,route:["List","Event",n]}),n="Hub",0===__("hub").indexOf(e.toLowerCase())&&r.push({type:"Hub",value:__("Open {0}",[__(n)]),index:t.fuzzy_search(e,"Hub"),match:n,route:[n,"Item"]}),0===__("email inbox").indexOf(e.toLowerCase())&&r.push({type:"Inbox",value:__("Open {0}",[__("Email Inbox")]),index:t.fuzzy_search(e,"email inbox"),match:n,route:["List","Communication","Inbox"]}),r},get_workspaces:function(e){var t=this,r=[];return frappe.boot.allowed_workspaces.forEach(function(n){var a=t.fuzzy_search(e,n.name);if(a>0){var i={type:"Workspace",label:__("Open {0}",[t.bolden_match_part(__(n.name),e)]),value:__("Open {0}",[__(n.name)]),index:a,route:["workspace",n.name]};r.push(i)}}),r},get_dashboards:function(e){var t=this,r=[];return frappe.boot.dashboards.forEach(function(n){var a=t.fuzzy_search(e,n.name);if(a>0){var i={type:"Dashboard",label:__("{0} Dashboard",[t.bolden_match_part(__(n.name),e)]),value:__("{0} Dashboard",[__(n.name)]),index:a,route:["dashboard",n.name]};r.push(i)}}),r},get_global_results:function(e,t,r,n){void 0===n&&(n="");var a=this;function i(t){var r,n,i=[];function o(t,r){for(var n=t.split(" ||| "),i=[],o=0,s="",l=0;l<n.length;l++){var p=n[l];if(-1!==p.toLowerCase().indexOf(e)){if(-1!==p.indexOf(" &&& "))var c=p.indexOf(" &&& "),d=p.slice(c+5);else c=p.indexOf(" : "),d=p.slice(c+3);if(d.length>120){var u="",f=d.indexOf(e);u+=f<60?d.slice(0,f):"..."+d.slice(f-60,f),u+=d.slice(f,f+60),d=u+=f+60<d.length?"...":""}var _=p.slice(0,c),h=300-o;if(!((o+=_.length+d.length+2)<300)){_.length<h?(h-=_.length,s='<span class="field-name text-muted">'+a.bolden_match_part(_,e)+": </span> ",d=(d=d.slice(0,h)).slice(0,d.lastIndexOf(" "))+" ...",s+=a.bolden_match_part(d,e),i.push(s)):i.push("...");break}s='<span class="field-name text-muted">'+a.bolden_match_part(_,e)+": </span> "+a.bolden_match_part(d,e),-1===i.indexOf(s)&&r!==d&&i.push(s)}}return i.join(", ")}return t.forEach(function(e){var t;r={label:e.name,value:e.name,description:o(e.content,e.name),route:["Form",e.doctype,e.name]},(e.image||null===e.image)&&(r.image=e.image),t=e.doctype,(n=i.find(function(e){return e.title===t}))?n.results.push(r):(n={title:e.doctype,results:[r],fetch_type:"Global"},i.push(n))}),i}return new Promise(function(a,o){frappe.call({method:"frappe.utils.global_search.search",args:{text:e,start:t,limit:r,doctype:n},callback:function(e){e.message?a(i(e.message)):a([])}})})},get_nav_results:function(e){function t(e){var t=[],r=[];return e.forEach(function(e){if(e.route){"List"===e.route[0]&&e.route[2]&&e.route.splice(2);var n=e.route.join("/");if(-1===t.indexOf(n))t.push(n),r.push(e);else{var a=t.indexOf(n);r[a].index>e.index&&(r[a]=e)}}else r.push(e)}),r.sort(function(e,t){return t.index-e.index})}var r=[],n=[];t(this.get_doctypes(e)).forEach(function(e){""===e.type?n.push(e):r.push(e)});var a=e.split(" in ")[0];return[{title:"Recents",fetch_type:"Nav",results:t(this.get_recent_pages(e))},{title:"Create a new ...",fetch_type:"Nav",results:t(this.get_creatables(e))},{title:"Lists",fetch_type:"Nav",results:r},{title:"Reports",fetch_type:"Nav",results:t(this.get_reports(e))},{title:"Administration",fetch_type:"Nav",results:t(this.get_pages(e))},{title:"Workspace",fetch_type:"Nav",results:t(this.get_workspaces(e))},{title:"Dashboard",fetch_type:"Nav",results:t(this.get_dashboards(e))},{title:"Setup",fetch_type:"Nav",results:n},{title:"Find '"+a+"' in ... ",fetch_type:"Nav",results:t(this.get_search_in_list(e))}]},fuzzy_search:function(e,t){e=e||"";var r=__(t||""),n=r.replace(/-/g," "),a=r.length,i=e.length,o=i/a;if(i>a)return 0;if([r,n].includes(e)||[r,n].some(function(t){return 0===t.toLowerCase().indexOf(e)}))return 10+o;if(-1!==r.indexOf(e)&&e!==e.toLowerCase())return 9+o;if(r=r.toLowerCase(),e=e.toLowerCase(),-1!==r.indexOf(e))return 8+o;var s=0,l=0;e:for(var p=0,c=0;p<i;p++){if(0!==l&&s++,s>3)return 0;var d=e.charCodeAt(p);for(l=0;c<a;){if(r.charCodeAt(c++)===d)continue e;if(++l>2)return 0}return 0}return s+l>0?(5+o)/(s+l):0},bolden_match_part:function(e,t){var r="";if(0===this.fuzzy_search(t,e))return e;if(this.fuzzy_search(t,e)>6){var n=new RegExp("("+t+")","ig");return e.replace(n,"<b>$1</b>")}var a=e,i=(e=e.toLowerCase()).length;t=t.toLowerCase();e:for(var o=0,s=0;o<t.length;o++){for(var l=t.charCodeAt(o);s<i;){if(e.charCodeAt(s)===l){var p=a.charAt(s);p===p.toLowerCase()?r+="<b>"+t.charAt(o)+"</b>":r+="<b>"+t.charAt(o).toUpperCase()+"</b>",s++;continue e}r+=a.charAt(s),s++}return a}return r+=a.slice(s)},get_executables:function(e){var t=this,r=[];return this.searchable_functions.forEach(function(n){var a=n.label.toLowerCase(),i=e.toLowerCase();i!==a&&0!==a.indexOf(i)||r.push({type:"Executable",value:t.bolden_match_part(__(n.label),i),index:t.fuzzy_search(i,a),match:n.label,onclick:function(){return n.action.apply(t,n.args)}})}),r},make_function_searchable:function(e,t,r){if(void 0===t&&(t=null),void 0===r&&(r=null),"function"!=typeof e)throw new Error("First argument should be a function");this.searchable_functions.push({label:t||e.name,action:e,args:r})},searchable_functions:[]},frappe.provide("frappe.ui.misc"),frappe.ui.misc.about=function(){if(!frappe.ui.misc.about_dialog){var e=new frappe.ui.Dialog({title:__("Frappe Framework")});$(e.body).html(repl("<div>\t\t<p>"+__("Open Source Applications for the Web")+"</p>  \t\t<p><i class='fa fa-globe fa-fw'></i>\t\t\tWebsite: <a href='https://frappe.io' target='_blank'>https://frappe.io</a></p>\t\t<p><i class='fa fa-github fa-fw'></i>\t\t\tSource: <a href='https://github.com/frappe' target='_blank'>https://github.com/frappe</a></p>\t\t<p><i class='fa fa-linkedin fa-fw'></i>\t\t\tLinkedin: <a href='https://linkedin.com/company/frappe-tech' target='_blank'>https://linkedin.com/company/frappe-tech</a></p>\t\t<p><i class='fa fa-facebook fa-fw'></i>\t\t\tFacebook: <a href='https://facebook.com/erpnext' target='_blank'>https://facebook.com/erpnext</a></p>\t\t<p><i class='fa fa-twitter fa-fw'></i>\t\t\tTwitter: <a href='https://twitter.com/erpnext' target='_blank'>https://twitter.com/erpnext</a></p>\t\t<hr>\t\t<h4>Installed Apps</h4>\t\t<div id='about-app-versions'>Loading versions...</div>\t\t<hr>\t\t<p class='text-muted'>&copy; Frappe Technologies Pvt. Ltd and contributors </p> \t\t</div>",frappe.app)),frappe.ui.misc.about_dialog=e,frappe.ui.misc.about_dialog.on_page_show=function(){frappe.versions?t(frappe.versions):frappe.call({method:"frappe.utils.change_log.get_versions",callback:function(e){t(e.message)}})};var t=function(e){var t=$("#about-app-versions").empty();$.each(Object.keys(e).sort(),function(r,n){var a=e[n];if(a.branch)var i=$.format("<p><b>{0}:</b> v{1} ({2})<br></p>",[a.title,a.branch_version||a.version,a.branch]);else i=$.format("<p><b>{0}:</b> v{1}<br></p>",[a.title,a.version]);$(i).appendTo(t)}),frappe.versions=e}}frappe.ui.misc.about_dialog.show()},frappe.templates.navbar='<div class="navbar navbar-default navbar-fixed-top" role="navigation">  <div class="container">   <div class="navbar-header navbar-desk">    <a class="navbar-brand toggle-sidebar visible-xs visible-sm">     <i class="octicon octicon-three-bars"></i>    </a>    <a class="navbar-brand navbar-home hidden-xs hidden-sm" href="#">     <img class="app-logo" src="{{ frappe.app.logo_url }}">    </a>    <ul class="nav navbar-nav" id="navbar-breadcrumbs">    </ul>   </div>   <div class="navbar-center ellipsis" style="display: none;"></div>    <ul class="nav navbar-nav navbar-right">    <li class="visible-xs">     <a class="navbar-search-button" href="#" data-toggle="modal" data-target="#search-modal"><i class="octicon octicon-search"></i></a>    </li>    <li class="dropdown dropdown-navbar-user dropdown-mobile">     <a class="dropdown-toggle" data-toggle="dropdown" href="#"      onclick="return false;">     {{ avatar }}     <span class="ellipsis toolbar-user-fullname hidden-xs hidden-sm">      {%= __("Settings") %}</span>     <b class="caret hidden-xs hidden-sm"></b></a>     <ul class="dropdown-menu" id="toolbar-user" role="menu">      <li><a href="#user-profile">       {%= __("My Profile") %}</a></li>      <li><a href="#Form/User/{%= encodeURIComponent(frappe.session.user) %}">       {%= __("My Settings") %}</a></li>      <li><a href="#" onclick="return frappe.ui.toolbar.setup_session_defaults();">        {%= __("Session Defaults") %}</a></li>      <li class="navbar-reload">       <a href="" onclick="return frappe.ui.toolbar.clear_cache();">       {%= __("Reload") %}</a></li>      <li><a href="/index" target="_blank" rel="noopener noreferrer">       {%= __("View Website") %}</a></li>      <li class="navbar-toggle-full-width">       <a href="#" onclick="return false">{%= __("Toggle Full Width") %}</a>      </li>      <li><a href="#background_jobs">       {%= __("Background Jobs") %}</a></li>      <li class="divider"></li>      <li><a href="#" onclick="return frappe.app.logout();">       {%= __("Logout") %}</a></li>     </ul>    </li>     <li class="dropdown dropdown-help dropdown-mobile">     <a class="dropdown-toggle" data-toggle="dropdown" href="#"      onclick="return false;"  style="height: 40px;">      <span class="hidden-xs hidden-sm" style="line-height: 24px;">{{ __("Help") }} <b class="caret"></b></span>      <span class="visible-xs visible-sm standard-image help-icon">?</span>     </a>     <ul class="dropdown-menu" id="toolbar-help" role="menu">      <li id="help-links"></li>      <li class="divider"></li>      <li class="divider documentation-links"></li>      <li><a href="#" onclick="return frappe.ui.toolbar.show_about();">       {%= __("About") %}</a></li>      <li><a href="#" onclick="return frappe.ui.toolbar.show_shortcuts(event);">       {%= __("Keyboard Shortcuts") %}</a></li>     </ul>    </li>             <li class="frappe-chat-dropdown"></li>         <li class="dropdown dropdown-notifications dropdown-mobile">     <span class="notifications-indicator"><i class="fa fa-circle"></i></span>     <a      class="dropdown-toggle notifications-icon"      data-toggle="dropdown"      aria-haspopup="true"      aria-expanded="true"      href="#"      onclick="return false;">      <span><i class="fa fa-bell" aria-hidden="true"></i></span>     </a>     <ul      class="dropdown-menu notifications-list"      role="menu">     </ul>    </li>   </ul>    <div id="search-modal" class="modal fade" role="dialog">    <div class="modal-dialog" style="height: 50px;">     <div class="modal-content">      <div class="modal-header">       <form role="search" onsubmit="return false;">        <div class="input-group" style="width: 100%">         <input id="modal-search" type="text" class="form-control"         placeholder="{%= __("Search or type a command") %}" aria-haspopup="true">         <button type="reset" class="close" data-dismiss="modal"><i class="octicon octicon-x"></i></button>        </div>       </form>      </div>     </div>    </div>   </div>    <div class="hidden-xs">    <form class="navbar-form navbar-right" role="search" onsubmit="return false;">      <div class="form-group form-group-sm ui-front">     <input id="navbar-search" type="text" class="form-control"      placeholder="{%= __("Search or type a command") %} {%= __("(Ctrl + G)") %}" aria-haspopup="true">     <span class="octicon octicon-search navbar-search-icon"></span>      </div>    </form>   </div>  </div> </div> ',frappe.provide("frappe.ui.toolbar"),frappe.provide("frappe.search"),frappe.ui.toolbar.Toolbar=Class.extend({init:function(){$("header").append(frappe.render_template("navbar",{avatar:frappe.avatar(frappe.session.user)})),$(".dropdown-toggle").dropdown();var e=new frappe.search.AwesomeBar;e.setup("#navbar-search"),e.setup("#modal-search"),this.setup_notifications(),this.make()},make:function(){this.setup_sidebar(),this.setup_help(),this.bind_events(),$(document).trigger("toolbar_setup")},bind_events:function(){$(document).on("page-change",function(){$("header .navbar .custom-menu").remove()}),$("#search-modal").on("shown.bs.modal",function(){var e=$(this);setTimeout(function(){e.find("#modal-search").focus()},300)}),$(".navbar-toggle-full-width").click(function(){frappe.ui.toolbar.toggle_full_width()})},setup_sidebar:function(){$("header").find(".toggle-sidebar").on("click",function(){var e=$(".layout-side-section"),t=e.find(".overlay-sidebar");t.addClass("opened"),t.find(".reports-dropdown").removeClass("dropdown-menu").addClass("list-unstyled"),t.find(".dropdown-toggle").addClass("text-muted").find(".caret").addClass("hidden-xs hidden-sm"),$('<div class="close-sidebar">').hide().appendTo(e).fadeIn();var r=$("html");function n(n){r.css("overflow-y",""),e.find("div.close-sidebar").fadeOut(function(){t.removeClass("opened").find(".dropdown-toggle").removeClass("text-muted"),t.find(".reports-dropdown").addClass("dropdown-menu")})}r.css("overflow-y","hidden"),e.find(".close-sidebar").on("click",n),e.on("click","a:not(.dropdown-toggle)",n)})},setup_help:function(){function e(e){var t=e.target.href;t.indexOf("blob")>0&&window.open(t,"_blank"),$(e.target).attr("data-path")&&e.preventDefault()}frappe.provide("frappe.help"),frappe.help.show_results=e,this.search=new frappe.search.SearchDialog,frappe.provide("frappe.searchdialog"),frappe.searchdialog.search=this.search,$(".dropdown-help .dropdown-toggle").on("click",function(){$(".dropdown-help input").focus()}),$(".dropdown-help .dropdown-menu").on("click","input, button",function(e){e.stopPropagation()}),$("#input-help").on("keydown",function(e){13==e.which&&$(this).val("")}),$(document).on("page-change",function(){var t=$(".dropdown-help #help-links");t.html("");for(var r=frappe.get_route_str(),n=r.split("/"),a=[],i=0;i<n.length;i++){var o=r.split("/",i+1).join("/"),s=frappe.help.help_links[o]||[];a=$.merge(a,s)}0===a.length?t.next().hide():t.next().show();for(i=0;i<a.length;i++){var l=a[i];l.url;$("<a>",{href:l.url,text:l.label,target:"_blank"}).appendTo(t)}$(".dropdown-help .dropdown-menu").on("click","a",e)}),frappe.get_modal("","").addClass("help-modal"),$(document).on("click",".help-modal a",e)},setup_notifications:function(){this.notifications=new frappe.ui.Notifications}}),$.extend(frappe.ui.toolbar,{add_dropdown_button:function(e,t,r,n){var a=frappe.ui.toolbar.get_menu(e);return a.find("li:not(.custom-menu)").length&&!a.find(".divider").length&&frappe.ui.toolbar.add_menu_divider(a),$('<li class="custom-menu"><a><i class="fa-fw '+n+'"></i> '+t+"</a></li>").insertBefore(a.find(".divider")).find("a").click(function(){r.apply(this)})},get_menu:function(e){return $("#navbar-"+e.toLowerCase())},add_menu_divider:function(e){e="string"==typeof e?frappe.ui.toolbar.get_menu(e):e,$('<li class="divider custom-menu"></li>').prependTo(e)},add_icon_link:function(e,t,r,n){var a=$(".navbar-right").get(0),i=$('<li class="'+n+'">\n\t\t\t<a class="btn" href="'+e+'" title="'+frappe.utils.to_title_case(n,!0)+'" aria-haspopup="true" aria-expanded="true">\n\t\t\t\t<div>\n\t\t\t\t\t<i class="octicon '+t+'"></i>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</li>').get(0);a.insertBefore(i,a.children[r])},toggle_full_width:function(){var e=JSON.parse(localStorage.container_fullwidth||"false");e=!e,localStorage.container_fullwidth=e,frappe.ui.toolbar.set_fullwidth_if_enabled(),$(document.body).trigger("toggleFullWidth")},set_fullwidth_if_enabled:function(){var e=JSON.parse(localStorage.container_fullwidth||"false");$(document.body).toggleClass("full-width",e)},show_shortcuts:function(e){return e.preventDefault(),frappe.ui.keys.show_keyboard_shortcut_dialog(),!1}}),frappe.ui.toolbar.clear_cache=frappe.utils.throttle(function(){frappe.assets.clear_local_storage(),frappe.xcall("frappe.sessions.clear").then(function(e){frappe.show_alert({message:e,indicator:"green"}),location.reload(!0)})},1e4),frappe.ui.toolbar.show_about=function(){try{frappe.ui.misc.about()}catch(e){console.log(e)}return!1},frappe.ui.toolbar.setup_session_defaults=function(){var e=[];frappe.call({method:"frappe.core.doctype.session_default_settings.session_default_settings.get_session_default_values",callback:function(t){e=JSON.parse(t.message);var r=frappe.perm.get_perm("Session Default Settings");(in_list(frappe.user_roles,"System Manager")||1==r[0].read)&&(e[e.length]={fieldname:"settings",fieldtype:"Button",label:__("Settings"),click:function(){frappe.set_route("Form","Session Default Settings","Session Default Settings")}}),frappe.prompt(e,function(t){e.forEach(function(e){t[e.fieldname]||(t[e.fieldname]="")}),frappe.call({method:"frappe.core.doctype.session_default_settings.session_default_settings.set_session_default_values",args:{default_values:t},callback:function(e){"success"==e.message?(frappe.show_alert({message:__("Session Defaults Saved"),indicator:"green"}),frappe.ui.toolbar.clear_cache()):frappe.show_alert({message:__("An error occurred while setting Session Defaults"),indicator:"red"})}})},__("Session Defaults"),__("Save"))}})},frappe.last_edited_communication={},frappe.standard_replies={},frappe.views.CommunicationComposer=Class.extend({init:function(e){$.extend(this,e),this.make()},make:function(){var e=this,t=this;this.dialog=new frappe.ui.Dialog({title:this.title||this.subject||__("New Email"),no_submit_on_enter:!0,fields:this.get_fields(),primary_action_label:__("Send"),primary_action:function(){t.delete_saved_draft(),t.send_action()},minimizable:!0}),["recipients","cc","bcc"].forEach(function(r){e.dialog.fields_dict[r].get_data=function(){var e=t.dialog.fields_dict[r].get_value().match(/[^,\s*]*$/)[0]||"",n=[];return frappe.call({method:"frappe.email.get_contact_list",args:{txt:e},callback:function(e){n=e.message,t.dialog.fields_dict[r].set_data(n)}}),n}}),this.prepare(),this.dialog.show(),this.frm&&$(document).trigger("form-typing",[this.frm])},get_fields:function(){var e=[],t=[{label:__("To"),fieldtype:"MultiSelect",reqd:0,fieldname:"recipients",options:e},{fieldtype:"Section Break",collapsible:1,label:__("CC, BCC & Email Template")},{label:__("CC"),fieldtype:"MultiSelect",fieldname:"cc",options:e},{label:__("BCC"),fieldtype:"MultiSelect",fieldname:"bcc",options:e},{label:__("Email Template"),fieldtype:"Link",options:"Email Template",fieldname:"email_template"},{fieldtype:"Section Break"},{label:__("Subject"),fieldtype:"Data",reqd:1,fieldname:"subject",length:524288},{fieldtype:"Section Break"},{label:__("Message"),fieldtype:"Text Editor",reqd:1,fieldname:"content",onchange:frappe.utils.debounce(this.save_as_draft.bind(this),300)},{fieldtype:"Section Break"},{fieldtype:"Column Break"},{label:__("Send me a copy"),fieldtype:"Check",fieldname:"send_me_a_copy",default:frappe.boot.user.send_me_a_copy},{label:__("Send Read Receipt"),fieldtype:"Check",fieldname:"send_read_receipt"},{label:__("Attach Document Print"),fieldtype:"Check",fieldname:"attach_document_print"},{label:__("Select Print Format"),fieldtype:"Select",fieldname:"select_print_format"},{label:__("Select Languages"),fieldtype:"Select",fieldname:"language_sel"},{fieldtype:"Column Break"},{label:__("Select Attachments"),fieldtype:"HTML",fieldname:"select_attachments"}],r=frappe.boot.email_accounts.filter(function(e,t){return!in_list(["All Accounts","Sent","Spam","Trash"],e.email_account)&&e.enable_outgoing});return frappe.boot.email_accounts&&r.length>1&&(t=[{label:__("From"),fieldtype:"Select",reqd:1,fieldname:"sender",options:r.map(function(e){return e.email_id})}].concat(t)),t},prepare:function(){this.setup_subject_and_recipients(),this.setup_print_language(),this.setup_print(),this.setup_attach(),this.setup_email(),this.setup_last_edited_communication(),this.setup_email_template(),this.dialog.set_value("recipients",this.recipients||""),this.dialog.set_value("cc",this.cc||""),this.dialog.set_value("bcc",this.bcc||""),this.dialog.fields_dict.sender&&this.dialog.fields_dict.sender.set_value(this.sender||""),this.dialog.fields_dict.subject.set_value(this.subject||""),this.setup_earlier_reply()},setup_subject_and_recipients:function(){if(this.subject=this.subject||"",this.forward||this.recipients||!this.last_email||(this.recipients=this.last_email.sender,this.cc=this.last_email.cc,this.bcc=this.last_email.bcc),this.forward||this.recipients||(this.recipients=this.frm&&this.frm.timeline.get_recipient()),!this.subject&&this.frm){var e=this.frm.timeline.get_last_email();e&&(this.subject=e.subject,this.recipients||(this.recipients=e.sender),"re"!=strip(this.subject.toLowerCase().split(":")[0])&&(this.subject=__("Re: {0}",[this.subject]))),this.subject||(this.subject=this.frm.doc.name,this.frm.meta.subject_field&&this.frm.doc[this.frm.meta.subject_field]?this.subject=this.frm.doc[this.frm.meta.subject_field]:this.frm.meta.title_field&&this.frm.doc[this.frm.meta.title_field]&&(this.subject=this.frm.doc[this.frm.meta.title_field]));var t="#"+this.frm.doc.name;this.subject.includes(t)||(this.subject=this.subject+" ("+t+")")}this.frm&&!this.recipients&&(this.recipients=this.frm.doc[this.frm.email_field])},setup_email_template:function(){var e=this;this.dialog.fields_dict.email_template.df.onchange=function(){var t=e.dialog.fields_dict.email_template.get_value();frappe.call({method:"frappe.email.doctype.email_template.email_template.get_email_template",args:{template_name:t,doc:e.frm.doc,_lang:e.dialog.get_value("language_sel")},callback:function(r){!function(r){if(e.reply_added!==t){var n=e.dialog.fields_dict.content,a=e.dialog.fields_dict.subject,i=n.get_value()||"",o=(a.get_value(),i.split("\x3c!-- salutation-ends --\x3e"));i=2===o.length?[r.message,"<br>",o[1]]:[r.message,"<br>",i],n.set_value(i.join("")),a.set_value(r.subject),e.reply_added=t}}(r.message)}})}},setup_last_edited_communication:function(){var e=this;this.doc||(cur_frm?this.doc=cur_frm.doctype:this.doc="Inbox"),cur_frm&&cur_frm.docname?this.key=cur_frm.docname:this.key="Inbox",this.last_email&&(this.key=this.key+":"+this.last_email.name),this.subject&&(this.key=this.key+":"+this.subject),this.dialog.onhide=function(){var t=e.get_last_edited_communication();$.extend(t,{sender:e.dialog.get_value("sender"),recipients:e.dialog.get_value("recipients"),cc:e.dialog.get_value("cc"),bcc:e.dialog.get_value("bcc"),subject:e.dialog.get_value("subject"),content:e.dialog.get_value("content")}),e.frm&&$(document).trigger("form-stopped-typing",[e.frm])},this.dialog.on_page_show=function(){if(!e.txt){var t=e.get_last_edited_communication();t.content&&(e.dialog.set_value("sender",t.sender||""),e.dialog.set_value("subject",t.subject||""),e.dialog.set_value("recipients",t.recipients||""),e.dialog.set_value("cc",t.cc||""),e.dialog.set_value("bcc",t.bcc||""),e.dialog.set_value("content",t.content||""))}}},get_last_edited_communication:function(){return frappe.last_edited_communication[this.doc]||(frappe.last_edited_communication[this.doc]={}),frappe.last_edited_communication[this.doc][this.key]||(frappe.last_edited_communication[this.doc][this.key]={}),frappe.last_edited_communication[this.doc][this.key]},selected_format:function(){return this.dialog.fields_dict.select_print_format.input.value||this.frm&&this.frm.meta.default_print_format||"Standard"},get_print_format:function(e){return e||(e=this.selected_format()),locals["Print Format"]&&locals["Print Format"][e]?locals["Print Format"][e]:{}},setup_print_language:function(){var e=this,t=this.doc||cur_frm.doc,r=this.dialog.fields_dict;if(this.lang_code=t.language,this.get_print_format().default_print_language){var n=this.get_print_format().default_print_language;e.lang_code=n}else n=null;$(r.language_sel.input).change(function(){e.lang_code=this.value}),$(r.language_sel.input).empty().add_options(frappe.get_languages()),n?$(r.language_sel.input).val(n):$(r.language_sel.input).val(t.language)},setup_print:function(){var e=this.dialog.fields_dict;$(e.attach_document_print.input).click(function(){$(e.select_print_format.wrapper).toggle($(this).prop("checked"))}),$(e.select_print_format.wrapper).toggle(!1),cur_frm?$(e.select_print_format.input).empty().add_options(cur_frm.print_preview.print_formats).val(cur_frm.print_preview.print_formats[0]):$(e.attach_document_print.wrapper).toggle(!1)},setup_attach:function(){var e=this,t=this.dialog.fields_dict,r=$(t.select_attachments.wrapper);this.attachments||(this.attachments=[]);var n={folder:"Home/Attachments",on_success:function(t){e.attachments.push(t),e.render_attachment_rows(t)}};this.frm&&(n={doctype:this.frm.doctype,docname:this.frm.docname,folder:"Home/Attachments",on_success:function(t){e.frm.attachments.attachment_uploaded(t),e.render_attachment_rows(t)}}),$("\n\t\t\t<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>\n\t\t\t\t"+__("Select Attachments")+"\n\t\t\t</h6>\n\t\t\t<div class='attach-list'></div>\n\t\t\t<p class='add-more-attachments'>\n\t\t\t\t<a class='text-muted small'>\n\t\t\t\t\t<i class='octicon octicon-plus' style='font-size: 12px'></i>\n\t\t\t\t\t"+__("Add Attachment")+"\n\t\t\t\t</a>\n\t\t\t</p>\n\t\t").appendTo(r.empty()),r.find(".add-more-attachments a").on("click",function(){return new frappe.ui.FileUploader(n)}),this.render_attachment_rows()},render_attachment_rows:function(e){var t=this,r=this.dialog.fields_dict.select_attachments,n=$(r.wrapper).find(".attach-list");if(e)n.append(this.get_attachment_row(e,!0));else{var a=[];this.attachments&&this.attachments.length&&(a=a.concat(this.attachments)),this.frm&&(a=a.concat(this.frm.get_files())),a.length&&$.each(a,function(e,r){r.file_name&&(n.find('[data-file-name="'+r.name+'"]').length||(r.file_url=frappe.urllib.get_full_url(r.file_url),n.append(t.get_attachment_row(r))))})}},get_attachment_row:function(e,t){return $('<p class="checkbox">\n\t\t\t<label>\n\t\t\t\t<span>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\tdata-file-name="'+e.name+'"\n\t\t\t\t\t\t'+(t?"checked":"")+'>\n\t\t\t\t\t</input>\n\t\t\t\t</span>\n\t\t\t\t<span class="small">'+e.file_name+'</span>\n\t\t\t\t<a href="'+e.file_url+'" target="_blank" class="text-muted small">\n\t\t\t\t<i class="fa fa-share" style="vertical-align: middle; margin-left: 3px;"></i>\n\t\t\t</label>\n\t\t</p>')},setup_email:function(){var e=this.dialog.fields_dict;this.attach_document_print&&($(e.attach_document_print.input).click(),$(e.select_print_format.wrapper).toggle(!0)),$(e.send_me_a_copy.input).on("click",function(){var t=e.send_me_a_copy.get_value();frappe.db.set_value("User",frappe.session.user,"send_me_a_copy",t),frappe.boot.user.send_me_a_copy=t})},send_action:function(){var e=this.dialog.get_primary_btn(),t=this.get_values();if(t){var r=$.map($(this.dialog.wrapper).find("[data-file-name]:checked"),function(e){return $(e).attr("data-file-name")});t.attach_document_print?this.send_email(e,t,r,null,t.select_print_format||""):this.send_email(e,t,r)}},get_values:function(){for(var e=this.dialog.get_values(),t=0,r=this.dialog.fields.length;t<r;t++){var n=this.dialog.fields[t];n.is_cc_checkbox&&(e[n.fieldname]&&(e.cc=(e.cc?e.cc+", ":"")+n.fieldname,e.bcc=(e.bcc?e.bcc+", ":"")+n.fieldname),delete e[n.fieldname])}return e},save_as_draft:function(){if(this.dialog&&this.frm)try{var e=this.dialog.get_value("content");e=e.split(frappe.separator_element)[0],localStorage.setItem(this.frm.doctype+this.frm.docname,e)}catch(e){console.log(e),console.warn("[Communication] localStorage is full. Cannot save message as draft")}},delete_saved_draft:function(){if(this.dialog)try{localStorage.removeItem(this.frm.doctype+this.frm.docname)}catch(e){console.log(e),console.warn("[Communication] Cannot delete localStorage item")}},send_email:function(e,t,r,n,a){var i=this;if(i.dialog.hide(),t.recipients){if(t.attach_document_print||(n=null,a=null),!cur_frm||frappe.model.can_email(i.doc.doctype,cur_frm))return frappe.call({method:"frappe.core.doctype.communication.email.make",args:{recipients:t.recipients,cc:t.cc,bcc:t.bcc,subject:t.subject,content:t.content,doctype:i.doc.doctype,name:i.doc.name,send_email:1,print_html:n,send_me_a_copy:t.send_me_a_copy,print_format:a,sender:t.sender,sender_full_name:t.sender?frappe.user.full_name():void 0,email_template:t.email_template,attachments:r,_lang:i.lang_code,read_receipt:t.send_read_receipt,print_letterhead:i.is_print_letterhead_checked()},btn:e,callback:function(e){if(e.exc){if(frappe.msgprint(__("There were errors while sending email. Please try again.")),i.error)try{i.error(e)}catch(e){console.log(e)}}else if(frappe.utils.play_sound("email"),e.message.emails_not_sent_to&&frappe.msgprint(__("Email not sent to {0} (unsubscribed / disabled)",[frappe.utils.escape_html(e.message.emails_not_sent_to)])),(frappe.last_edited_communication[i.doc]||{})[i.key]&&delete frappe.last_edited_communication[i.doc][i.key],cur_frm&&(cur_frm.timeline.input&&cur_frm.timeline.input.val(""),cur_frm.reload_doc()),i.success)try{i.success(e)}catch(e){console.log(e)}}});frappe.msgprint(__("You are not allowed to send emails related to this document"))}else frappe.msgprint(__("Enter Email Recipient(s)"))},is_print_letterhead_checked:function(){return this.frm&&$(this.frm.wrapper).find(".form-print-wrapper").is(":visible")?$(this.frm.wrapper).find(".print-letterhead").prop("checked")?1:0:(frappe.model.get_doc(":Print Settings","Print Settings")||{with_letterhead:1}).with_letterhead?1:0},setup_earlier_reply:function(){var e=this.dialog.fields_dict,t=frappe.boot.user.email_signature||"";if(frappe.utils.is_html(t)||(t=t.replace(/\n/g,"<br>")),this.txt)this.message=this.txt+(this.message?"<br><br>"+this.message:"");else{var r=this.frm||{},n=r.doctype,a=r.docname;n&&a&&(this.message=localStorage.getItem(n+a)||"")}this.real_name&&(this.message="<p>"+__("Dear")+" "+this.real_name+",</p>\x3c!-- salutation-ends --\x3e<br>"+(this.message||"")),this.message&&t&&this.message.includes(t)&&(t="");var i=(this.message||"")+(t?"<br>"+t:""),o="";if("undefined"===this.is_a_reply&&(this.is_a_reply=!0),this.is_a_reply){var s=this.last_email;if(s||(s=this.frm&&this.frm.timeline.get_last_email(!0)),!s)return;var l=s.original_comment||s.content;(l=this.html2text(l).replace(/\n/g,"<br>")).length>20480&&(l=(l+="<div>"+__("Message clipped")+"</div>"+l).slice(0,20480));var p=s.communication_date||s.creation;o="\n\t\t\t\t<div><br></div>\n\t\t\t\t"+i+"\n\t\t\t\t"+frappe.separator_element+"\n\t\t\t\t<p>"+__("On {0}, {1} wrote:",[frappe.datetime.global_date_format(p),s.sender])+"</p>\n\t\t\t\t<blockquote>\n\t\t\t\t"+l+"\n\t\t\t\t</blockquote>\n\t\t\t"}else o="<div><br></div>"+i;e.content.set_value(o)},html2text:function(e){var t=document.createElement("div");return t.innerHTML=e.replace(/<\/div>/g,"<br></div>").replace(/<\/p>/g,"<br></p>").replace(/<br>/g,"\n"),t.textContent.replace(/\n{3,}/g,"\n\n")}}),frappe.views.TranslationManager=class{constructor(e){Object.assign(this,e),this.make()}make(){var e=this;this.data=[],this.dialog=new frappe.ui.Dialog({fields:this.get_fields(),title:__("Translate {0}",[this.df.label]),no_submit_on_enter:!0,primary_action_label:__("Update Translations"),primary_action:function(t){return e.update_translations(t).then(function(){e.dialog.hide(),e.data=[],frappe.msgprint({title:__("Success"),message:__("Successfully updated translations"),indicator:"green"})})}}),this.get_translations_data().then(function(t){var r;(r=e.data).push.apply(r,t||[]),e.dialog.refresh(),e.dialog.show()})}get_fields(){var e=this;return[{label:__("Source Text"),fieldname:"source",fieldtype:"Data",read_only:1,bold:1,default:this.source_text},{label:__("Translations"),fieldname:"translation_data",fieldtype:"Table",fields:[{label:"Language",fieldname:"language",fieldtype:"Link",options:"Language",in_list_view:1,columns:3},{label:"Translation",fieldname:"translation",fieldtype:"Text",in_list_view:1,columns:7}],data:this.data,get_data:function(){return e.data}}]}get_translations_data(){return frappe.db.get_list("Translation",{fields:["name","language","translated_text as translation"],filters:{source_text:strip_html(this.source_text)}})}update_translations(e){var t=e.source,r=e.translation_data;void 0===r&&(r=[]);var n={};return r.map(function(e){n[e.language]=e.translation}),frappe.call({method:"frappe.translate.update_translations_for_source",btn:this.dialog.get_primary_btn(),args:{source:t,translation_dict:n}}).fail(function(){frappe.msgprint({title:__("Something went wrong"),message:__("Please try again"),indicator:"red"})})}};class WidgetDialog{constructor(e){Object.assign(this,e),this.editing=Boolean(this.values&&Object.keys(this.values).length)}make(){this.make_dialog(),this.setup_dialog_events(),this.dialog.show(),this.editing&&this.set_default_values()}make_dialog(){var e=this;this.dialog=new frappe.ui.Dialog({title:this.get_title(),fields:this.get_fields(),primary_action:function(t){t=e.process_data(t),e.editing||t.name||(t.name=e.type+"-"+e.label+"-"+frappe.utils.get_random(20)),e.dialog.hide(),e.primary_action(t)},primary_action_label:this.primary_action_label||__("Add")})}get_title(){var e=this.editing?"Edit":"Add";return __(e+" "+frappe.model.unscrub(this.type))}get_fields(){}set_default_values(){return this.dialog.set_values(this.values)}process_data(e){return e}setup_dialog_events(){}hide_field(e){this.dialog.set_df_property(e,"hidden",!0)}show_field(e){this.dialog.set_df_property(e,"hidden",!1)}setup_filter(e){var t=this;this.filter_group&&(this.filter_group.wrapper.empty(),delete this.filter_group);var r=this.dialog.get_field("filter_area_loading").$wrapper;if($('<span class="text-muted">Loading Filters...</span>').appendTo(r),this.filters=[],this.values&&this.values.stats_filter){var n=new Function("return "+this.values.stats_filter)();this.filters=Object.keys(n).map(function(e){var r=n[e];return[t.values.link_to,e,r[0],r[1],!1]})}this.filter_group=new frappe.ui.FilterGroup({parent:this.dialog.get_field("filter_area").$wrapper,doctype:e,on_change:function(){}}),frappe.model.with_doctype(e,function(){t.filter_group.add_filters_to_filter_group(t.filters),t.hide_field("filter_area_loading"),t.show_field("filter_area")})}}class ChartDialog extends WidgetDialog{constructor(e){super(e)}get_fields(){return[{fieldtype:"Link",fieldname:"chart_name",label:"Chart Name",options:"Dashboard Chart",reqd:1},{fieldtype:"Data",fieldname:"label",label:"Label"}]}process_data(e){return e.label=e.label?e.label:e.chart_name,e}}class ShortcutDialog extends WidgetDialog{constructor(e){super(e)}hide_filters(){this.hide_field("count_section_break"),this.hide_field("filters_section_break")}show_filters(){this.show_field("count_section_break"),this.show_field("filters_section_break")}get_fields(){var e=this;return[{fieldtype:"Select",fieldname:"type",label:"Type",reqd:1,options:"DocType\nReport\nPage\nDashboard",onchange:function(){"DocType"==e.dialog.get_value("type")?e.dialog.fields_dict.link_to.get_query=function(){return{filters:{istable:!1}}}:e.dialog.fields_dict.link_to.get_query=null}},{fieldtype:"Data",fieldname:"label",label:"Label"},{fieldtype:"Column Break",fieldname:"column_break_4"},{fieldtype:"Dynamic Link",fieldname:"link_to",label:"Link To",reqd:1,options:"type",onchange:function(){if("DocType"==e.dialog.get_value("type")){var t=e.dialog.get_value("link_to");t&&frappe.db.get_value("DocType",t,"issingle").then(function(r){r.message&&r.message.issingle?e.hide_filters():(e.setup_filter(t),e.show_filters())})}else e.hide_filters()}},{fieldtype:"Section Break",fieldname:"filters_section_break",label:"Count Filter",hidden:1},{fieldtype:"HTML",fieldname:"filter_area_loading"},{fieldtype:"HTML",fieldname:"filter_area",hidden:1},{fieldtype:"Section Break",fieldname:"count_section_break",label:"Count Customizations",hidden:1},{fieldtype:"Color",fieldname:"color",label:"Color"},{fieldtype:"Column Break",fieldname:"column_break_3"},{fieldtype:"Data",fieldname:"format",label:"Format",description:"For Example: {} Open"}]}set_default_values(){var e=this;super.set_default_values().then(function(){e.dialog.fields_dict.link_to.df.onchange()})}process_data(e){var t={};if("DocType"==this.dialog.get_value("type")&&this.filter_group){var r=this.filter_group.get_filters();r.length&&(r.forEach(function(e){t[e[1]]=[e[2],e[3]]}),e.stats_filter=JSON.stringify(t))}return e.label=e.label?e.label:frappe.model.unscrub(e.link_to),e}}class NumberCardDialog extends WidgetDialog{constructor(e){super(e)}get_fields(){var e=this;return[{fieldtype:"Select",label:"Choose Existing Card or create New Card",fieldname:"new_or_existing",options:["New Card","Existing Card"]},{fieldtype:"Link",fieldname:"card",label:"Number Cards",options:"Number Card",get_query:function(){return{query:"frappe.desk.doctype.number_card.number_card.get_cards_for_user",filters:{document_type:e.document_type}}},depends_on:'eval: doc.new_or_existing == "Existing Card"'},{fieldtype:"Section Break",fieldname:"sb_1",depends_on:'eval: doc.new_or_existing == "New Card"'},{label:"Label",fieldname:"label",fieldtype:"Data",mandatory_depends_on:'eval: doc.new_or_existing == "New Card"'},{label:"Doctype",fieldname:"document_type",fieldtype:"Link",options:"DocType",onchange:function(){e.document_type=e.dialog.get_value("document_type"),e.set_aggregate_function_fields(e.dialog.get_values()),e.setup_filter(e.document_type)},hidden:1},{label:"Color",fieldname:"color",fieldtype:"Color"},{fieldtype:"Column Break",fieldname:"cb_1"},{label:"Function",fieldname:"function",fieldtype:"Select",options:["Count","Sum","Average","Minimum","Maximum"],mandatory_depends_on:'eval: doc.new_or_existing == "New Card"'},{label:"Function Based On",fieldname:"aggregate_function_based_on",fieldtype:"Select",depends_on:"eval: doc.function !== 'Count'",mandatory_depends_on:'eval: doc.function !== "Count" && doc.new_or_existing == "New Card"'},{fieldtype:"Section Break",fieldname:"sb_1",label:"Add Filters",depends_on:'eval: doc.new_or_existing == "New Card"'},{fieldtype:"HTML",fieldname:"filter_area_loading"},{fieldtype:"HTML",fieldname:"filter_area",hidden:1},{fieldtype:"Section Break",fieldname:"sb_1"}]}setup_dialog_events(){this.document_type||(this.default_values.doctype?(this.document_type=this.default_values.doctype,this.setup_filter(this.default_values.doctype),this.set_aggregate_function_fields()):this.show_field("document_type"))}set_aggregate_function_fields(){var e=[];this.document_type&&frappe.get_meta(this.document_type).fields.map(function(t){if(frappe.model.numeric_fieldtypes.includes(t.fieldtype)){if("Currency"==t.fieldtype&&(!t.options||"Company:company:default_currency"!==t.options))return;e.push({label:t.label,value:t.fieldname})}}),this.dialog.set_df_property("aggregate_function_based_on","options",e)}process_data(e){return"Existing Card"==e.new_or_existing&&(e.name=e.card),e.stats_filter=JSON.stringify(this.filter_group.get_filters()),e.document_type=this.document_type,e}}function get_dialog_constructor(e){return{chart:ChartDialog,shortcut:ShortcutDialog,number_card:NumberCardDialog}[e]||WidgetDialog}class Widget{constructor(e){Object.assign(this,e),this.make()}refresh(){this.set_title(),this.set_actions(),this.set_body(),this.setup_events()}get_config(){return{name:this.name,label:this.label}}customize(e){var t=this;if(this.in_customize_mode=!0,this.action_area.empty(),e.allow_delete&&this.add_custom_button('<i class="fa fa-trash" aria-hidden="true"></i>',function(){return t.delete()},"",""+__("Delete")),e.allow_sorting&&this.add_custom_button('<i class="fa fa-arrows" aria-hidden="true"></i>',null,"drag-handle"),e.allow_hiding){this.hidden&&(this.widget.removeClass("hidden"),this.body.css("opacity",.5),this.title_field.css("opacity",.5),this.footer.css("opacity",.5));var r=this.hidden?"fa fa-eye":"fa fa-eye-slash",n=this.hidden?""+__("Show"):""+__("Hide");this.add_custom_button('<i class="'+r+'" aria-hidden="true"></i>',function(){return t.hide_or_show()},"show-or-hide-button",n),this.show_or_hide_button=this.action_area.find(".show-or-hide-button")}if(e.allow_edit&&this.add_custom_button('<i class="fa fa-pencil" aria-hidden="true"></i>',function(){return t.edit()}),e.allow_resize){var a="Full"==this.width?""+__("Collapse"):""+__("Expand");this.add_custom_button('<i class="fa fa-expand" aria-hidden="true"></i>',function(){return t.toggle_width()},"resize-button",a),this.resize_button=this.action_area.find(".resize-button")}}make(){this.make_widget(),this.widget.appendTo(this.container)}make_widget(){this.widget=$('<div class="widget '+(this.hidden?"hidden":"")+'" data-widget-name="'+(this.name?this.name:"")+'">\n\t\t\t<div class="widget-head">\n\t\t\t\t<div class="widget-title ellipsis"></div>\n\t\t\t\t<div class="widget-control"></div>\n\t\t\t</div>\n\t\t\t<div class="widget-body">\n\t\t    </div>\n\t\t    <div class="widget-footer">\n\t\t    </div>\n\t\t</div>'),this.title_field=this.widget.find(".widget-title"),this.body=this.widget.find(".widget-body"),this.action_area=this.widget.find(".widget-control"),this.head=this.widget.find(".widget-head"),this.footer=this.widget.find(".widget-footer"),this.refresh()}set_title(e){this.title_field[0].innerHTML=e?frappe.ellipsis(this.label,e):this.label,e&&this.title_field[0].setAttribute("title",this.label)}add_custom_button(e,t,r,n){void 0===r&&(r=""),void 0===n&&(n="");var a=$('<button class="btn btn-default btn-xs '+r+'" title="'+n+'">'+e+"</button>");a.click(function(e){e.stopPropagation(),t&&t()}),a.appendTo(this.action_area)}delete(e){var t=this;void 0===e&&(e=!0);var r=function(e){t.widget.remove(),t.options.on_delete&&t.options.on_delete(t.name,e)};e?(this.widget.addClass("zoomOutDelete"),setTimeout(function(){r(!0)},300)):r(!1)}edit(){var e=this,t=get_dialog_constructor(this.widget_type);this.edit_dialog=new t({label:this.label,type:this.widget_type,values:this.get_config(),primary_action:function(t){Object.assign(e,t),t.name=e.name,e.refresh()},primary_action_label:__("Save")}),this.edit_dialog.make()}toggle_width(){"Full"==this.width?(this.widget.removeClass("full-width"),this.width=null,this.refresh()):(this.widget.addClass("full-width"),this.width="Full",this.refresh());var e="Full"==this.width?""+__("Collapse"):""+__("Expand");this.resize_button.attr("title",e)}hide_or_show(){this.hidden?(this.body.css("opacity",1),this.title_field.css("opacity",1),this.footer.css("opacity",1),this.hidden=!1):(this.body.css("opacity",.5),this.title_field.css("opacity",.5),this.footer.css("opacity",.5),this.hidden=!0),this.show_or_hide_button.empty();var e=this.hidden?"fa fa-eye":"fa fa-eye-slash",t=this.hidden?""+__("Show"):""+__("Hide");$('<i class="'+e+'" aria-hidden="true" title="'+t+'"></i>').appendTo(this.show_or_hide_button)}setup_events(){}set_actions(){}set_body(){}}function generate_route(e){var t=e.type.toLowerCase();"doctype"===t&&(e.doctype=e.name);var r="";return e.route?r=e.route:(e.link?r=strip(e.link,"#"):"doctype"===t?frappe.model.is_tree(e.doctype)?r="Tree/"+e.doctype:frappe.model.is_single(e.doctype)?r="Form/"+e.doctype:(e.filters&&(frappe.route_options=e.filters),r="List/"+e.doctype):"report"===t&&e.is_query_report?r="query-report/"+e.name:"report"===t?r="List/"+e.doctype+"/Report/"+e.name:"page"===t?r=e.name:"dashboard"===t&&(r="dashboard/"+e.name),r="#"+r),e.route_options&&(r+="?"+$.map(e.route_options,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")),r}var build_summary_item=function(e){var t={fieldtype:e.datatype},r=null;"Currency"==e.datatype&&(t.options="currency",r={currency:e.currency});var n=frappe.format(e.value,t,null,r),a=e.indicator?"indicator "+e.indicator.toLowerCase():"";return $('<div class="summary-item">\n\t\t<span class="summary-label small text-muted '+a+'">'+e.label+'</span>\n\t\t<h1 class="summary-value">'+n+"</h1>\n\t</div>")};function shorten_number(e,t){for(var r=get_number_system(t="India"==t?t:""),n=Math.abs(Math.round(e)),a=0,i=r;a<i.length;a+=1){var o=i[a];if(o.condition?o.condition(n):n>=o.divisor)return Math.round(e/o.divisor)+" "+o.symbol}return e.toFixed()}function get_number_system(e){return{India:[{divisor:1e7,symbol:"Cr"},{divisor:1e5,symbol:"Lakh"}],"":[{divisor:1e12,symbol:"T"},{divisor:1e9,symbol:"B"},{divisor:1e6,symbol:"M"},{divisor:1e3,symbol:"K",condition:function(e){return e.toFixed().length>5}}]}[e]}frappe.provide("frappe.dashboards"),frappe.provide("frappe.dashboards.chart_sources");class ChartWidget extends Widget{constructor(e){super(e),this.height=this.height||240}get_config(){return{name:this.name,chart_name:this.chart_name,label:this.label,hidden:this.hidden,width:this.width}}refresh(){delete this.dashboard_chart,this.set_body(),this.make_chart()}set_chart_title(){var e=this.widget.width()<500?20:60;this.set_title(e)}set_body(){this.widget.addClass("dashboard-widget-box"),"Full"==this.width&&this.widget.addClass("full-width")}setup_container(){this.body.empty(),"Heatmap"==this.chart_doc.type&&this.setup_heatmap_container(),this.loading=$('<div class="chart-loading-state text-muted" style="height: '+this.height+'px;">'+__("Loading...")+"</div>"),this.loading.appendTo(this.body),this.empty=$('<div class="chart-loading-state text-muted" style="height: '+this.height+'px;">'+__("No Data...")+"</div>"),this.empty.hide().appendTo(this.body),this.chart_wrapper=$("<div></div>"),this.chart_wrapper.appendTo(this.body),this.$heatmap_legend=null,this.set_chart_title()}setup_heatmap_container(){this.widget.addClass("heatmap-chart"),this.widget.removeClass("full-width").addClass("full-width"),this.width="Full"}set_summary(){var e=this;this.$summary?this.$summary.empty():(this.$summary=$('<div class="report-summary"></div>').hide(),this.head.after(this.$summary)),this.summary.forEach(function(t){build_summary_item(t).appendTo(e.$summary)}),this.summary.length&&this.$summary.show()}make_chart(){var e=this;this.get_settings().then(function(){if(!e.settings)return e.deleted=!0,void e.widget.remove();e.chart_settings||(e.chart_settings={}),e.setup_container(),e.in_customize_mode||(e.action_area.empty(),e.prepare_chart_actions(),e.setup_filter_button(),e.chart_doc.timeseries&&"Custom"!==e.chart_doc.chart_type&&e.render_time_series_filters()),frappe.run_serially([function(){return e.prepare_chart_object()},function(){return e.fetch_and_update_chart()}])})}render_time_series_filters(){var e=this.get_time_series_filters();frappe.dashboard_utils.render_chart_filters(e,"chart-actions",this.action_area,0)}get_time_series_filters(){var e=this;return"Heatmap"==this.chart_doc.type?[{label:this.chart_settings.heatmap_year||this.chart_doc.heatmap_year,options:frappe.dashboard_utils.get_years_since_creation(frappe.boot.user.creation),action:function(t){e.selected_heatmap_year=t,e.save_chart_config_for_user({heatmap_year:e.selected_heatmap_year}),e.fetch_and_update_chart()}}]:[{label:this.chart_settings.timespan||this.chart_doc.timespan,options:["Select Date Range","Last Year","Last Quarter","Last Month","Last Week"],action:function(t){e.selected_timespan=t,"Select Date Range"===e.selected_timespan?e.render_date_range_fields():(e.selected_from_date=null,e.selected_to_date=null,e.date_field_wrapper&&(e.date_field_wrapper.hide(),e.title_field.show(),e.head.css("flex-direction","row")),e.save_chart_config_for_user({timespan:e.selected_timespan,from_date:null,to_date:null}),e.fetch_and_update_chart())}},{label:this.chart_settings.time_interval||this.chart_doc.time_interval,options:["Yearly","Quarterly","Monthly","Weekly","Daily"],action:function(t){e.selected_time_interval=t,e.save_chart_config_for_user({time_interval:e.selected_time_interval}),e.fetch_and_update_chart()}}]}fetch_and_update_chart(){var e=this;this.args={timespan:this.selected_timespan||this.chart_settings.timespan,time_interval:this.selected_time_interval||this.chart_settings.time_interval,from_date:this.selected_from_date||this.chart_settings.from_date,to_date:this.selected_to_date||this.chart_settings.to_date,heatmap_year:this.selected_heatmap_year||this.chart_settings.heatmap_year},this.fetch(this.filters,!0,this.args).then(function(t){"Report"==e.chart_doc.chart_type&&(e.summary=t.report_summary,t=e.get_report_chart_data(t)),e.update_chart_object(),e.data=t,e.render()})}render_date_range_fields(){var e=this;this.date_field_wrapper&&this.date_field_wrapper.is(":visible")||(this.date_field_wrapper=$('<div class="dashboard-date-field pull-right"></div>').appendTo(this.action_area),"Full"!=this.width&&this.widget.width()<700&&(this.title_field.hide(),this.head.css("flex-direction","row-reverse")),this.date_range_field=frappe.ui.form.make_control({df:{fieldtype:"DateRange",fieldname:"from_date",placeholder:"Date Range",input_class:"input-xs",default:[this.chart_settings.from_date,this.chart_settings.to_date],reqd:1,change:function(){var t=e.date_range_field.get_value();e.selected_from_date=t[0],e.selected_to_date=t[1],t&&2==t.length&&(e.save_chart_config_for_user({timespan:e.selected_timespan,from_date:e.selected_from_date,to_date:e.selected_to_date}),e.fetch_and_update_chart())}},parent:this.date_field_wrapper,render_input:1}))}get_report_chart_data(e){if(e.chart&&this.chart_doc.use_report_chart)return e.chart.data;var t=[];this.chart_doc.y_axis.map(function(e){t.push(e.y_field)});var r={y_fields:t,x_field:this.chart_doc.x_field,chart_type:this.chart_doc.type,color:this.chart_doc.color},n=e.columns.map(function(e){return frappe.report_utils.prepare_field_from_column(e)});return frappe.report_utils.make_chart_options(n,e,r).data}prepare_chart_actions(){var e=this,t=[{label:__("Refresh"),action:"action-refresh",handler:function(){delete e.dashboard_chart,e.make_chart()}},{label:__("Edit"),action:"action-edit",handler:function(){frappe.set_route("Form","Dashboard Chart",e.chart_doc.name)}},{label:__("Reset Chart"),action:"action-reset",handler:function(){e.reset_chart(),delete e.dashboard_chart,e.make_chart()}}];this.chart_doc.document_type?t.push({label:__("{0} List",[this.chart_doc.document_type]),action:"action-list",handler:function(){frappe.set_route("List",e.chart_doc.document_type)}}):"Report"===this.chart_doc.chart_type&&t.push({label:__("{0} Report",[this.chart_doc.report_name]),action:"action-list",handler:function(){frappe.set_route("query-report",e.chart_doc.report_name)}}),this.set_chart_actions(t)}setup_filter_button(){var e=this;this.is_document_type="Report"!==this.chart_doc.chart_type&&"Custom"!==this.chart_doc.chart_type,this.filter_button=$('<div class="filter-chart btn btn-default btn-xs pull-right">'+__("Filter")+"</div>"),this.filter_button.appendTo(this.action_area),this.filter_button.on("click",function(){var t;frappe.dashboard_utils.get_filters_for_chart_type(e.chart_doc).then(function(r){t=e.is_document_type?[{fieldtype:"HTML",fieldname:"filter_area"}]:r?r.filter(function(e){return e.fieldname}).map(function(e){return Object.assign(e,e.dashboard_config||{}),e}):[{fieldtype:"HTML",options:__("No Filters Set")}],e.setup_filter_dialog(t)})})}setup_filter_dialog(e){var t=this,r=new frappe.ui.Dialog({title:__("Set Filters for "+this.chart_doc.chart_name),fields:e,primary_action:function(){var e=this.get_values();e&&(this.hide(),t.is_document_type?t.filters=t.filter_group.get_filters():t.filters=e,t.save_chart_config_for_user({filters:t.filters}),t.fetch_and_update_chart())},primary_action_label:"Set"});this.is_document_type&&this.create_filter_group_and_add_filters(r.get_field("filter_area").$wrapper),r.show(),"Report"==this.chart_doc.chart_type&&(frappe.query_report=new frappe.views.QueryReport({filters:r.fields_list}),frappe.query_reports[this.chart_doc.report_name].onload&&frappe.query_reports[this.chart_doc.report_name].onload(frappe.query_report)),r.set_values(this.filters)}reset_chart(){this.save_chart_config_for_user(null,1),this.chart_settings={},this.filters=null,this.selected_time_interval=null,this.selected_timespan=null,this.selected_heatmap_year=null}save_chart_config_for_user(e,t){void 0===t&&(t=0),Object.assign(this.chart_settings,e),frappe.xcall("frappe.desk.doctype.dashboard_settings.dashboard_settings.save_chart_config",{reset:t,config:this.chart_settings,chart_name:this.chart_doc.chart_name})}create_filter_group_and_add_filters(e){var t=this;this.filter_group=new frappe.ui.FilterGroup({parent:e,doctype:this.chart_doc.document_type,on_change:function(){}}),frappe.model.with_doctype(this.chart_doc.document_type,function(){t.filter_group.add_filters_to_filter_group(t.filters)})}set_chart_actions(e){this.chart_actions=$('<div class="chart-actions dropdown pull-right">\n\t\t\t<a class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t<button class="btn btn-default btn-xs"><span class="caret"></span></button>\n\t\t\t</a>\n\t\t\t<ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">\n\t\t\t\t'+e.map(function(e){return'<li><a data-action="'+e.action+'">'+e.label+"</a></li>"}).join("")+"\n\t\t\t</ul>\n\t\t</div>\n\t\t"),this.chart_actions.find("a[data-action]").each(function(t,r){var n=r.dataset.action;$(r).click(e.find(function(e){return e.action===n}))}),this.chart_actions.appendTo(this.action_area)}fetch(e,t,r){void 0===t&&(t=!1);var n=this.settings.method;return r="Report"==this.chart_doc.chart_type?{report_name:this.chart_doc.report_name,filters:e,ignore_prepared_report:1}:{chart_name:this.chart_doc.name,filters:e,refresh:t?1:0,time_interval:r&&r.time_interval?r.time_interval:null,timespan:r&&r.timespan?r.timespan:null,from_date:r&&r.from_date?r.from_date:null,to_date:r&&r.to_date?r.to_date:null,heatmap_year:r&&r.heatmap_year?r.heatmap_year:null},frappe.xcall(n,r)}render(){if(this.data&&this.data.labels&&Object.keys(this.data).length){this.loading.hide(),this.empty.hide(),this.chart_wrapper.show();var e=this.get_chart_args();this.dashboard_chart?this.dashboard_chart.update(this.data):this.dashboard_chart=new frappe.Chart(this.chart_wrapper[0],e),"Full"==this.width&&this.summary&&this.set_summary(),"Heatmap"==this.chart_doc.type&&this.render_heatmap_legend()}else this.chart_wrapper.hide(),this.loading.hide(),this.$summary&&this.$summary.hide(),this.empty.show()}get_chart_args(){var e=this.get_chart_colors(),t={data:this.data,type:{Line:"line",Bar:"bar",Percentage:"percentage",Pie:"pie",Donut:"donut",Heatmap:"heatmap"}[this.chart_doc.type],colors:e,height:this.height,axisOptions:{xIsSeries:this.chart_doc.timeseries,shortenYAxisNumbers:1}};if("Heatmap"==this.chart_doc.type){var r=parseInt(this.selected_heatmap_year||this.chart_settings.heatmap_year||this.chart_doc.heatmap_year);t.data.start=new Date(r+"-01-01"),t.data.end=new Date(r+1+"-01-01")}var n=function(e){var r=JSON.parse(e);for(var n in r)t[n]=r[n]};return this.custom_options&&n(this.custom_options),this.chart_doc.custom_options&&n(this.chart_doc.custom_options),t}get_chart_colors(){var e=[];return this.chart_doc.y_axis.length?this.chart_doc.y_axis.map(function(t){e.push(t.color)}):["Line","Bar"].includes(this.chart_doc.type)?e=[this.chart_doc.color||[]]:"Heatmap"==this.chart_doc.type&&(e=[]),e}render_heatmap_legend(){!this.$heatmap_legend&&this.widget.width()>991&&(this.$heatmap_legend=$('\n\t\t\t\t<div class="heatmap-legend">\n\t\t\t\t\t<ul class="legend-colors">\n\t\t\t\t\t\t<li style="background-color: #ebedf0"></li>\n\t\t\t\t\t\t<li style="background-color: #c6e48b"></li>\n\t\t\t\t\t\t<li style="background-color: #7bc96f"></li>\n\t\t\t\t\t\t<li style="background-color: #239a3b"></li>\n\t\t\t\t\t\t<li style="background-color: #196127"></li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<div class="legend-label">\n\t\t\t\t\t\t<div style="margin-bottom: 45px">'+__("Less")+"</div>\n\t\t\t\t\t\t<div>"+__("More")+"</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t"),this.body.append(this.$heatmap_legend))}update_last_synced(){var e=__("Last synced {0}",[comment_when(this.chart_doc.last_synced_on)]);this.footer.html(e)}update_chart_object(){var e=this;frappe.db.get_doc("Dashboard Chart",this.chart_doc.name).then(function(t){e.chart_doc=t,e.prepare_chart_object(),e.update_last_synced()})}prepare_chart_object(){return"Heatmap"!=this.chart_doc.type||this.chart_doc.heatmap_year||(this.chart_doc.heatmap_year=frappe.dashboard_utils.get_year(frappe.datetime.now_date())),this.set_chart_filters()}set_chart_filters(){var e=this,t=this.chart_settings.filters||null,r=frappe.dashboard_utils.get_all_filters(this.chart_doc);return"Report"==this.chart_doc.chart_type?frappe.dashboard_utils.get_filters_for_chart_type(this.chart_doc).then(function(n){r=e.update_default_date_filters(n,r),e.filters=t||e.filters||r}):(this.filters=t||this.filters||r,Promise.resolve())}update_default_date_filters(e,t){return e&&e.map(function(e){["Date","DateRange"].includes(e.fieldtype)&&e.default&&(e.reqd||t[e.fieldname])&&(t[e.fieldname]=e.default)}),t}get_settings(){var e=this;return frappe.model.with_doc("Dashboard Chart",this.chart_name).then(function(t){if(t){if(e.chart_doc=t,"Custom"==e.chart_doc.chart_type){if(frappe.dashboards.chart_sources[e.chart_doc.source])return e.settings=frappe.dashboards.chart_sources[e.chart_doc.source],Promise.resolve();return frappe.xcall("frappe.desk.doctype.dashboard_chart_source.dashboard_chart_source.get_config",{name:e.chart_doc.source}).then(function(t){frappe.dom.eval(t),e.settings=frappe.dashboards.chart_sources[e.chart_doc.source]})}return"Report"==e.chart_doc.chart_type?(e.settings={method:"frappe.desk.query_report.run"},Promise.resolve()):(e.settings={method:"frappe.desk.doctype.dashboard_chart.dashboard_chart.get"},Promise.resolve())}})}}class ShortcutWidget extends Widget{constructor(e){super(e)}get_config(){return{name:this.name,icon:this.icon,label:this.label,format:this.format,link_to:this.link_to,color:this.color,restrict_to_domain:this.restrict_to_domain,stats_filter:this.stats_filter,type:this.type}}setup_events(){var e=this;this.widget.click(function(){if(!e.in_customize_mode){var t=generate_route({route:e.route,name:e.link_to,type:e.type,is_query_report:e.is_query_report,doctype:e.ref_doctype}),r=e.get_doctype_filter();"DocType"==e.type&&r&&(frappe.route_options=r),frappe.set_route(t)}})}set_actions(){var e=this;if(!this.in_customize_mode){this.widget.addClass("shortcut-widget-box");var t=this.get_doctype_filter();"DocType"==this.type&&t&&frappe.db.count(this.link_to,{filters:t}).then(function(t){return e.set_count(t)})}}get_doctype_filter(){var e=new Function("return "+this.stats_filter)();return e||null}set_title(){this.icon?this.title_field[0].innerHTML='<div>\n\t\t\t\t<i class="'+this.icon+'" style=""></i>\n\t\t\t\t'+(this.label||this.name)+"\n\t\t\t\t</div>":super.set_title()}set_count(e){var t=this;this.action_area.empty();var r=t.format?t.format.replace(/{}/g,e):e,n=$('<div class="small pill">'+r+"</div>");this.color&&(n.css("background-color",this.color),n.css("color",frappe.ui.color.get_contrast_color(this.color))),n.appendTo(this.action_area)}}class LinksWidget extends Widget{constructor(e){super(e)}get_config(){return{name:this.name,links:JSON.stringify(this.links),label:this.label,hidden:this.hidden}}set_body(){var e=this;this.options={},this.options.links=this.links,this.widget.addClass("links-widget-box");var t=function(e){return e.dependencies&&e.incomplete_dependencies};this.link_list=this.links.map(function(e){return $('<div class="link-item flush-top small '+(e.onboard?"onboard-spotlight":"")+" "+function(e){return t(e)?"disabled-link":""}(e)+'" type="'+e.type+'">\n\t\t\t\t\t<span class="indicator '+function(e){return e.open_count?"red":e.onboard?e.count?"blue":"orange":"grey"}(e)+'"></span>\n\t\t\t\t\t'+function(e){return t(e)?'<span class="link-content ellipsis disabled-link">'+(e.label?e.label:e.name)+'</span>\n\t\t\t\t\t\t<div class="module-link-popover popover fade top in" role="tooltip" style="display: none;">\n\t\t\t\t\t\t\t<div class="arrow"></div>\n\t\t\t\t\t\t\t<h3 class="popover-title" style="display: none;"></h3>\n\t\t\t\t\t\t\t<div class="popover-content" style="padding: 12px;">\n\t\t\t\t\t\t\t\t<div class="small text-muted">'+__("You need to create these first: ")+'</div>\n\t\t \t\t\t\t\t\t<div class="small">'+e.incomplete_dependencies.join(", ")+"</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>":e.youtube_id?'<span class="link-content help-video-link ellipsis" data-youtubeid="'+e.youtube_id+'">\n\t\t\t\t\t\t'+(e.label?e.label:e.name)+"</span>":'<a data-route="'+generate_route(e)+'" class="link-content ellipsis">\n\t\t\t\t\t'+(e.label?e.label:e.name)+"</a>"}(e)+"\n\t\t\t</div>")}),this.link_list.forEach(function(t){return t.appendTo(e.body)})}setup_events(){var e=this;this.link_list.forEach(function(t){var r=t.find(".link-content");if(t.hasClass("disabled-link")){var n=t.find(".module-link-popover");r.mouseover(function(){e.in_customize_mode||n.show()}),r.mouseout(function(){return n.hide()})}else r.click(function(t){if(!e.in_customize_mode)if(r.hasClass("help-video-link")){var n=t.target.dataset.youtubeid;frappe.help.show_video(n)}else{var a=t.target.dataset.route;frappe.set_route(a)}})})}}class OnboardingWidget extends Widget{constructor(e){super(e)}make_body(){var e=this;this.steps.forEach(function(t){e.add_step(t)})}add_step(e){var t=this,r="",n="fa-circle-o";e.is_skipped&&(r="skipped",n="fa-check-circle-o"),e.is_complete&&(r="complete",n="fa-check-circle-o");var a=$('<div class="onboarding-step '+r+'">\n\t\t\t\t<i class="fa '+n+'" aria-hidden="true" title="'+r+'"></i>\n\t\t\t\t<span id="title">'+e.title+"</span>\n\t\t\t</div>");if(e.$step=a,!e.is_mandatory&&!e.is_complete){var i=$('<span class="ml-5 small text-muted step-skip">Skip</span>');i.appendTo(a),i.on("click",function(){t.skip_step(e),event.stopPropagation()})}var o={"Watch Video":function(){return t.show_video(e)},"Create Entry":function(){e.is_complete?frappe.set_route("#List/"+e.reference_document):e.show_full_form?t.create_entry(e):t.show_quick_entry(e)},"Show Form Tour":function(){return t.show_form_tour(e)},"Update Settings":function(){return t.update_settings(e)},"View Report":function(){return t.open_report(e)},"Go to Page":function(){return t.go_to_page(e)}};return a.find("#title").on("click",o[e.action]),a.appendTo(this.body),a}go_to_page(e){frappe.set_route(e.path).then(function(){if(e.callback_message)var t=frappe.msgprint({message:__(e.callback_message),title:__(e.callback_title),primary_action:{action:function(){t.hide()},label:function(){return __("Continue")}},wide:!0})})}open_report(e){var t=this,r=generate_route({name:e.reference_report,type:"report",is_query_report:["Query Report","Script Report"].includes(e.report_type),doctype:e.report_reference_doctype}),n=frappe.get_route();frappe.set_route(r).then(function(){var r=frappe.msgprint({message:__(e.report_description),title:__(e.reference_report),primary_action:{action:function(){frappe.set_route(n).then(function(){t.mark_complete(e)}),r.hide()},label:function(){return __("Continue")}},secondary_action:{action:function(){r.hide(),frappe.set_route(n).then(function(){t.mark_complete(e)})},label:__("Go Back")}});frappe.msg_dialog.custom_onhide=function(){return t.mark_complete(e)}})}show_form_tour(e){var t,r=this;t=e.is_single?"Form/"+e.reference_document:"Form/"+e.reference_document+"/"+__("New")+" "+__(e.reference_document)+" 1";var n=frappe.get_route();frappe.route_hooks={},frappe.route_hooks.after_load=function(t){t.show_tour(function(){var t=frappe.msgprint({message:__("Let's take you back to onboarding"),title:__("Great Job"),primary_action:{action:function(){frappe.set_route(n).then(function(){r.mark_complete(e)}),t.hide()},label:function(){return __("Continue")}}})})},frappe.set_route(t)}update_settings(e){var t=this,r=frappe.get_route();frappe.route_hooks={},frappe.route_hooks.after_load=function(t){t.scroll_to_field(e.field),t.doc.__unsaved=!0},frappe.route_hooks.after_save=function(n){var a=!1,i={},o=n.doc[e.field],s=null;o&&"%"==e.value_to_validate&&(a=!0),o==e.value_to_validate&&(a=!0),cstr(o)==cstr(e.value_to_validate)&&(a=!0),a?(i.message=__("Let's take you back to onboarding"),i.title=__("Looks Great"),i.primary_action={action:function(){frappe.set_route(r).then(function(){t.mark_complete(e)})},label:__("Continue")},s=function(){return i.primary_action.action()}):(i.message=__("Looks like you didn't change the value"),i.title=__("Oops"),i.secondary_action={action:function(){return frappe.set_route(r)},label:__("Go Back")},e.is_mandatory||(i.primary_action={action:function(){frappe.set_route(r).then(function(){setTimeout(function(){t.skip_step(e)},300)})},label:__("Skip Step")}),s=function(){return i.secondary_action.action()}),frappe.msgprint(i),frappe.msg_dialog.custom_onhide=function(){return s()}},frappe.set_route("Form",e.reference_document)}create_entry(e){var t=this,r=frappe.get_route();frappe.route_hooks={};var n=function(){frappe.msgprint({message:__("You're doing great, let's take you back to the onboarding page."),title:__("Good Work 🎉"),primary_action:{action:function(){frappe.set_route(r).then(function(){t.mark_complete(e)})},label:__("Continue")}}),frappe.msg_dialog.custom_onhide=function(){t.mark_complete(e)}};e.is_submittable?(frappe.route_hooks.after_save=function(){frappe.msgprint({message:__("Submit this document to complete this step."),title:__("Great")})},frappe.route_hooks.after_submit=n):frappe.route_hooks.after_save=n,frappe.set_route("Form/"+e.reference_document+"/"+__("New")+" "+__(e.reference_document)+" 1")}show_quick_entry(e){var t=this,r=frappe.get_route_str();frappe.ui.form.make_quick_entry(e.reference_document,function(){if(frappe.get_route_str()!=r){var n=frappe.msgprint({message:__("Let's take you back to onboarding"),title:__("Looks Great"),primary_action:{action:function(){n.hide(),frappe.set_route(r).then(function(){t.mark_complete(e)})},label:__("Continue")}});frappe.msg_dialog.custom_onhide=function(){frappe.set_route(r).then(function(){t.mark_complete(e)})}}else frappe.msgprint({message:__("You may continue with onboarding"),title:__("Looks Great")}),t.mark_complete(e)},null,null,!0)}show_video(e){frappe.help.show_video(e.video_url,e.title),this.mark_complete(e)}mark_complete(e){var t=e.$step;this.update_step_status(e,"is_complete",1,function(){e.is_complete=!0,t.removeClass("skipped"),t.addClass("complete")})}skip_step(e){var t=e.$step;this.update_step_status(e,"is_skipped",1,function(){e.is_skipped=!0,t.removeClass("complete"),t.addClass("skipped")})}update_step_status(e,t,r,n){var a=this,i={is_complete:"fa-check-circle-o",is_skipped:"fa-check-circle-o"};frappe.route_hooks={},frappe.call("frappe.desk.desktop.update_onboarding_step",{name:e.name,field:t,value:r}).then(function(){n();var r=e.$step.find("i.fa");r.removeClass(),r.addClass("fa"),r.addClass(i[t]),0==a.steps.filter(function(e){return!(e.is_complete||e.is_skipped)}).length&&a.show_success()})}show_success(){var e=this,t=this.success||__("You seem good to go!"),r=this.success_state_image||"/assets/frappe/images/ui-states/success-color.png",n="";this.docs_url&&(n=__('Congratulations on completing the module setup. If you want to learn more you can refer to the documentation <a href="{0}">here</a>.',[this.docs_url]));var a=$('<div class="text-center onboarding-success">\n\t\t\t\t\t<img src="'+r+'" alt="Success State" class="zoomIn success-state">\n\t\t\t\t\t<h3>'+t+'</h3>\n\t\t\t\t\t<div class="text-muted">'+n+"</div>\n\t\t\t</div>\n\t\t");this.success_dialog||(this.success_dialog=new frappe.ui.Dialog({primary_action:function(){e.success_dialog.hide(),setTimeout(function(){e.delete()},300)},primary_action_label:__("Continue")}),this.success_dialog.set_title(__("Onboarding Complete")),this.success_dialog.header.find(".indicator").removeClass("hidden").addClass("green"),a.appendTo(this.success_dialog.$body),this.success_dialog.show())}set_body(){this.widget.addClass("onboarding-widget-box"),this.is_dismissed()?this.widget.hide():this.make_body()}is_dismissed(){var e=JSON.parse(localStorage.getItem("dismissed-onboarding")||"{}");if(Object.keys(e).includes(this.label)){var t=new Date(e[this.label]),r=new Date;return frappe.datetime.get_hour_diff(r,t)<24}return!1}set_title(e){(super.set_title(e),this.subtitle)&&$('<div class="widget-subtitle">'+this.subtitle+"</div>").appendTo(this.title_field)}set_actions(){var e=this;this.action_area.empty();var t=$('<div class="small" style="cursor:pointer;">Dismiss</div>');t.on("click",function(){var t=JSON.parse(localStorage.getItem("dismissed-onboarding")||"{}");t[e.label]=frappe.datetime.now_datetime(),localStorage.setItem("dismissed-onboarding",JSON.stringify(t)),e.delete()}),t.appendTo(this.action_area)}}class NewWidget{constructor(e){Object.assign(this,e),this.make()}customize(){}make(){this.make_widget(),this.widget.appendTo(this.container),this.setup_events()}get_title(){return __("New "+frappe.model.unscrub(this.type))}make_widget(){var e="new-"+frappe.scrub(frappe.model.unscrub(this.type),"-")+"-widget";this.widget=$('<div class="widget new-widget '+e+'">\n\t\t\t\t+ '+this.get_title()+"\n\t\t\t</div>"),this.body=this.widget}setup_events(){var e=this;this.widget.on("click",function(){e.custom_dialog?e.custom_dialog():e.open_dialog()})}open_dialog(){var e=get_dialog_constructor(this.type);this.dialog=new e({label:this.label,type:this.type,values:!1,default_values:this.default_values,primary_action:this.on_create}),this.dialog.make()}delete(){this.widget.remove()}}class NumberCardWidget extends Widget{constructor(e){super(e)}get_config(){return{name:this.name,label:this.label,color:this.color,hidden:this.hidden}}refresh(){this.set_body()}set_body(){this.widget.addClass("number-widget-box"),this.make_card()}set_title(){$(this.title_field).html('<div class="number-label">'+this.card_doc.label+"</div>")}make_card(){var e=this;frappe.model.with_doc("Number Card",this.name).then(function(t){if(t)e.card_doc=t,e.render_card();else{if(!e.document_type)return void e.delete(!1);frappe.run_serially([function(){return e.create_number_card()},function(){return e.render_card()}])}e.set_events()})}create_number_card(){var e=this;return this.set_doc_args(),frappe.xcall("frappe.desk.doctype.number_card.number_card.create_number_card",{args:this.card_doc}).then(function(t){e.name=t.name,e.card_doc=t,e.widget.attr("data-widget-name",e.name)})}set_events(){var e=this;$(this.body).click(function(){e.in_customize_mode||"Custom"==e.card_doc.type||e.set_route()})}set_route(){var e="Report"!==this.card_doc.type,t=generate_route({name:e?this.card_doc.document_type:this.card_doc.report_name,type:e?"doctype":"report",is_query_report:!e});if(e){var r=JSON.parse(this.card_doc.filters_json);frappe.route_options=r.reduce(function(e,t){var r;return Object.assign(e,((r={})[t[0]+"."+t[1]]=[t[2],t[3]],r))},{})}frappe.set_route(t)}set_doc_args(){this.card_doc=Object.assign({},{document_type:this.document_type,label:this.label,function:this.function,aggregate_function_based_on:this.aggregate_function_based_on,color:this.color,filters_json:this.stats_filter})}get_settings(e){var t=this;return this.filters=this.get_filters(),{Custom:{method:this.card_doc.method,args:{filters:this.filters},get_number:function(e){return t.get_number_for_custom_card(e)}},Report:{method:"frappe.desk.query_report.run",args:{report_name:this.card_doc.report_name,filters:this.filters,ignore_prepared_report:1},get_number:function(e){return t.get_number_for_report_card(e)}},"Document Type":{method:"frappe.desk.doctype.number_card.number_card.get_result",args:{doc:this.card_doc,filters:this.filters},get_number:function(e){return t.get_number_for_doctype_card(e)}}}[e]}get_filters(){return frappe.dashboard_utils.get_all_filters(this.card_doc)}render_card(){var e=this;this.prepare_actions(),this.set_title(),this.set_loading_state(),this.card_doc.type||(this.card_doc.type="Document Type"),this.settings=this.get_settings(this.card_doc.type),frappe.run_serially([function(){return e.render_number()},function(){return e.render_stats()}])}set_loading_state(){$(this.body).html('<div class="number-card-loading text-muted">\n\t\t\t'+__("Loading...")+"\n\t\t</div>")}get_number(){var e=this;return frappe.xcall(this.settings.method,this.settings.args).then(function(t){return e.settings.get_number(t)})}get_number_for_custom_card(e){"object"==typeof e?(this.number=e.value,this.get_formatted_number(e)):this.formatted_number=e}get_number_for_doctype_card(e){var t=this;if(this.number=e,"Count"!==this.card_doc.function)return frappe.model.with_doctype(this.card_doc.document_type,function(){var e=frappe.meta.get_docfield(t.card_doc.document_type,t.card_doc.aggregate_function_based_on);t.get_formatted_number(e)});this.formatted_number=e}get_number_for_report_card(e){var t=this.card_doc.report_field,r=e.result.reduce(function(e,r){return r[t]&&e.push(r[t]),e},[]),n=e.columns.find(function(e){return e.fieldname==t});this.number=frappe.report_utils.get_result_of_fn(this.card_doc.report_function,r),this.get_formatted_number(n)}get_formatted_number(e){var t=frappe.sys_defaults.country,r=shorten_number(this.number,t).split(" "),n=r[1]||"",a=$(frappe.format(r[0],e)).text();this.formatted_number=a+" "+n}render_number(){var e=this;return this.get_number().then(function(){$(e.body).html('<div class="widget-content">\n\t\t\t\t<div class="number" style="color:'+e.card_doc.color+'">'+e.formatted_number+"</div>\n\t\t\t\t</div>")})}render_stats(){var e=this;if("Document Type"===this.card_doc.type){var t="",r="";return this.get_percentage_stats().then(function(){if(null!=e.percentage_stat){0==e.percentage_stat?r="grey-stat":e.percentage_stat>0?(t='<i class="fa fa-caret-up"></i>',r="green-stat"):(t='<i class="fa fa-caret-down"></i>',r="red-stat");var n={Daily:__("since yesterday"),Weekly:__("since last week"),Monthly:__("since last month"),Yearly:__("since last year")}[e.card_doc.stats_time_interval];$(e.body).find(".widget-content").append('<div class="card-stats '+r+'">\n\t\t\t\t<span class="percentage-stat">\n\t\t\t\t\t'+t+"\n\t\t\t\t\t"+Math.abs(e.percentage_stat)+' %\n\t\t\t\t</span>\n\t\t\t\t<span class="stat-period text-muted">\n\t\t\t\t\t'+n+"\n\t\t\t\t</span>\n\t\t\t</div>")}})}}get_percentage_stats(){var e=this;return frappe.xcall("frappe.desk.doctype.number_card.number_card.get_percentage_difference",{doc:this.card_doc,filters:this.filters,result:this.number}).then(function(t){void 0!==t&&(e.percentage_stat=+t.toFixed(2))})}prepare_actions(){var e=this,t=[{label:__("Refresh"),action:"action-refresh",handler:function(){e.render_card()}},{label:__("Edit"),action:"action-edit",handler:function(){frappe.set_route("Form","Number Card",e.name)}}];this.set_card_actions(t)}set_card_actions(e){this.card_actions=$('<div class="card-actions dropdown pull-right">\n\t\t\t\t<a class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t<button class="btn btn-default btn-xs"><span class="caret"></span></button>\n\t\t\t\t</a>\n\t\t\t\t<ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">\n\t\t\t\t\t'+e.map(function(e){return'<li>\n\t\t\t\t\t\t\t\t\t<a data-action="'+e.action+'">'+e.label+"</a>\n\t\t\t\t\t\t\t\t</li>"}).join("")+"\n\t\t\t\t</ul>\n\t\t\t</div>"),this.card_actions.find("a[data-action]").each(function(t,r){var n=r.dataset.action;$(r).click(e.find(function(e){return e.action===n}))}),this.action_area.html(this.card_actions)}}frappe.provide("frappe.widget"),frappe.widget.widget_factory={chart:ChartWidget,base:Widget,shortcut:ShortcutWidget,links:LinksWidget,onboarding:OnboardingWidget,number_card:NumberCardWidget},frappe.widget.make_widget=function(e){var t=frappe.widget.widget_factory[e.widget_type];if(t)return new t(e);console.warn("Invalid Widget Name: "+e.widget_type)};class WidgetGroup{constructor(e){Object.assign(this,e),this.widgets_list=[],this.widgets_dict={},this.widget_order=[],this.make()}make(){this.make_container(),this.title&&this.set_title(),this.widgets&&this.make_widgets()}make_container(){var e=$('<div class="widget-group">\n\t\t\t\t<div class="widget-group-head">\n\t\t\t\t\t<div class="widget-group-title h6 uppercase"></div>\n\t\t\t\t\t<div class="widget-group-control h6 text-muted"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="widget-group-body grid-col-'+this.columns+'">\n\t\t\t\t</div>\n\t\t\t</div>');this.widget_area=e,this.hidden&&this.widget_area.hide(),this.title_area=e.find(".widget-group-title"),this.control_area=e.find(".widget-group-control"),this.body=e.find(".widget-group-body"),!this.widgets.length&&this.widget_area.hide(),e.appendTo(this.container)}set_title(){this.title_area[0].innerText=this.title}make_widgets(){var e=this;this.body.empty(),this.widgets.forEach(function(t){e.add_widget(t)})}add_widget(e){var t=this,r=frappe.widget.make_widget(Object.assign({},e,{widget_type:this.type,container:this.body,options:Object.assign({},this.options,{on_delete:function(e){return t.on_delete(e)}})}));return this.widgets_list.push(r),this.widgets_dict[e.name]=r,r}remove_widget(e){e.widget.remove(),this.widgets_list.filter(function(t){if(t.name==e.name)return!1}),delete this.widgets_dict[e.name]}customize(){var e=this;this.hidden||this.widget_area.show(),this.widgets_list.forEach(function(t){t.customize(e.options)}),this.options.allow_create&&this.setup_new_widget(),this.options.allow_sorting&&this.setup_sortable()}setup_new_widget(){var e=this,t=this.options&&this.options.max_widget_count||Number.POSITIVE_INFINITY;this.widgets_list.length<t&&(this.new_widget=new NewWidget({container:this.body,type:this.type,custom_dialog:this.custom_dialog,default_values:this.default_values,on_create:function(r){e.new_widget.delete(),delete e.new_widget,r.in_customize_mode=1,e.add_widget(r).customize(e.options),e.widgets_list.length<t&&e.setup_new_widget()}}))}on_delete(e,t){this.widgets_list=this.widgets_list.filter(function(t){return e!=t.name}),delete this.widgets_dict[e],this.update_widget_order(),!this.new_widget&&t&&this.setup_new_widget()}update_widget_order(){var e=this;this.widget_order=[],this.body.children().each(function(t,r){var n=r.dataset.widgetName;n&&e.widget_order.push(n)})}setup_sortable(){var e=this,t=this.body[0];this.sortable=new Sortable(t,{animation:150,handle:".drag-handle",onEnd:function(){return e.update_widget_order()}})}get_widget_config(){this.update_widget_order();var e={};return this.widgets_list.forEach(function(t){var r=t.get_config(),n=r.docname?r.docname:r.name;e[n]=r}),{order:this.widget_order,widgets:e}}}function get_url_arg(e){return get_query_params()[e]||""}function get_query_string(e){return e.includes("?")?e.slice(e.indexOf("?")+1):""}function get_query_params(e){var t={};e||(e=location.search.substring(1));for(var r=e.split("&"),n=0,a=r.length;n<a;n++){var i=r[n].split(/=(.+)/),o=i[0];if(o){var s=i[1];if("string"==typeof s){s=s.replace(/\+/g,"%20");try{s=decodeURIComponent(s)}catch(e){}}o in t?(void 0===t[o]?t[o]=[]:"string"==typeof t[o]&&(t[o]=[t[o]]),t[o].push(s)):t[o]=s}}return t}function make_query_string(e,t){void 0===t&&(t=!0);var r=[];for(var n in e){var a=e[n];void 0!==a&&""!==a&&null!==a&&("object"==typeof a&&(a=JSON.stringify(a)),t&&(n=encodeURIComponent(n),a=encodeURIComponent(a)),r.push(n+"="+a))}return"?"+r.join("&")}frappe.widget.WidgetGroup=WidgetGroup,frappe.templates.sort_selector='<div class="sort-selector">  <div class="dropdown">   <a class="text-muted dropdown-toggle small"    data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">    <span class="dropdown-text">{{ __(sort_by_label) }}</span>   </a>   <ul class="dropdown-menu">    {% for value in options %}    <li>     <a class="option" data-value="{{ value.fieldname }}">      {{ __(value.label) }}     </a>    </li>    {% endfor %}   </ul>  </div>  <button class="btn btn-default btn-xs btn-order"   data-value="{{ sort_order }}">   <span class="octicon text-muted    octicon-arrow-{{ sort_order==="desc" ? "down " : "up " }}">   </span>  </button> </div>',frappe.ui.SortSelector=Class.extend({init:function(e){$.extend(this,e),this.labels={},this.make()},make:function(){this.prepare_args(),this.parent.find(".sort-selector").remove(),this.wrapper=$(frappe.render_template("sort_selector",this.args)).appendTo(this.parent),this.bind_events()},bind_events:function(){var e=this;this.wrapper.find(".btn-order").on("click",function(){var t=$(this),r="desc"===$(this).attr("data-value")?"asc":"desc";t.attr("data-value",r),e.sort_order=r,t.find(".octicon").removeClass("octicon-arrow-"+("asc"===r?"down":"up")).addClass("octicon-arrow-"+("desc"===r?"down":"up")),(e.onchange||e.change)(e.sort_by,e.sort_order)}),this.wrapper.find(".dropdown a.option").on("click",function(){e.sort_by=$(this).attr("data-value"),e.wrapper.find(".dropdown .dropdown-text").html($(this).html()),(e.onchange||e.change)(e.sort_by,e.sort_order)})},prepare_args:function(){var e=this;if(this.args||(this.args={}),this.args&&"string"==typeof this.args){var t=this.args;this.args={},t.includes("`.`")&&(t=t.split(".")[1]);var r=t.split(" ");if(2===r.length){var n=strip(r[0],"`");this.args.sort_by=n,this.args.sort_order=r[1]}}this.args.options&&this.args.options.forEach(function(t){e.labels[t.fieldname]=t.label}),this.setup_from_doctype(),this.args.sort_by&&!this.args.sort_by_label&&this.args.options.every(function(t){return t.fieldname!==e.args.sort_by||(e.args.sort_by_label=t.label,!1)})},setup_from_doctype:function(){var e=this,t=frappe.get_meta(this.doctype);if(t){var r=this.get_meta_sort_field(),n=r.meta_sort_field,a=r.meta_sort_order;if(this.args.sort_by||(n?(this.args.sort_by=n,this.args.sort_order=a):(this.args.sort_by="modified",this.args.sort_order="desc")),this.args.sort_by_label||(this.args.sort_by_label=this.get_label(this.args.sort_by)),!this.args.options){var i=[{fieldname:"modified"}];t.title_field&&i.push({fieldname:t.title_field}),t.fields.forEach(function(e){(e.mandatory||e.bold)&&i.push({fieldname:e.fieldname,label:e.label})}),n&&i.push({fieldname:n}),i.push({fieldname:"name"},{fieldname:"creation"},{fieldname:"idx"}),this.args.options=i.uniqBy(function(e){return e.fieldname}),this.args.options.forEach(function(t){t.label||(t.label=e.get_label(t.fieldname))})}this.sort_by=this.args.sort_by,this.sort_order=this.args.sort_order}},get_meta_sort_field:function(){var e=frappe.get_meta(this.doctype);if(!e)return{meta_sort_field:null,meta_sort_order:null};if(e.sort_field&&e.sort_field.includes(",")){var t=e.sort_field.split(",")[0].split(" ");return{meta_sort_field:t[0],meta_sort_order:t[1]}}return{meta_sort_field:e.sort_field||"modified",meta_sort_order:e.sort_order?e.sort_order.toLowerCase():""}},get_label:function(e){return"idx"===e?__("Most Used"):this.labels[e]||frappe.meta.get_label(this.doctype,e)},get_sql_string:function(){return"`tab"+this.doctype+"`.`"+this.sort_by+"` "+this.sort_order}}),frappe.templates.change_log='{% for (var i=0, l=change_log.length; i < l; i++) {     var app_info = change_log[i]; %}  {% if (i > 0) { %} <hr> {% } %}  <div class="text-left app-change-log">   <h2 style="margin-top: 10px;">             {{ app_info.title }}    <small>{{ __("updated to {0}", [app_info.version]) }}</small>   </h2>   <div class="app-change-log-body">   {% for (var x=0, y=app_info.change_log.length; x < y; x++) {             var version_info = app_info.change_log[x];             if(version_info) { %}        <p>{{ frappe.markdown(version_info[1]) }}</p>       {% }         } %}      </div>  </div> {% } %} ',frappe.start_app=function(){frappe.Application&&(frappe.assets.check(),frappe.provide("frappe.app"),frappe.provide("frappe.desk"),frappe.app=new frappe.Application)},$(document).ready(function(){frappe.utils.supportsES6||frappe.msgprint({indicator:"red",title:__("Browser not supported"),message:__("Some of the features might not work in your browser. Please update your browser to the latest version.")}),frappe.start_app()}),frappe.Application=Class.extend({init:function(){this.startup()},startup:function(){var e=this;if(frappe.socketio.init(),frappe.model.init(),"failed"===frappe.boot.status)throw frappe.msgprint({message:frappe.boot.error,title:__("Session Start Failed"),indicator:"red"}),"boot failed";if(this.setup_frappe_vue(),this.load_bootinfo(),this.load_user_permissions(),this.set_app_logo_url().then(function(){e.make_nav_bar()}),this.set_favicon(),this.setup_analytics(),this.set_fullwidth_if_enabled(),this.setup_energy_point_listeners(),frappe.ui.keys.setup(),this.set_rtl(),frappe.boot&&localStorage.getItem("session_last_route")&&(window.location.hash=localStorage.getItem("session_last_route"),localStorage.removeItem("session_last_route")),this.make_page_container(),frappe.route(),$(document).trigger("startup"),$(document).trigger("app_ready"),frappe.boot.messages&&frappe.msgprint(frappe.boot.messages),frappe.user_roles.includes("System Manager")&&(this.show_change_log(),this.show_update_available()),!frappe.boot.developer_mode){var t=__("Using this console may allow attackers to impersonate you and steal your information. Do not enter or paste code that you do not understand.");console.log("%c"+t,"font-size: large")}if(this.show_notes(),frappe.ui.startup_setup_dialog&&!frappe.boot.setup_complete&&(frappe.ui.startup_setup_dialog.pre_show(),frappe.ui.startup_setup_dialog.show()),frappe.realtime.on("version-update",function(){var e=frappe.msgprint({message:__("The application has been updated to a new version, please refresh this page"),indicator:"green",title:__("Version Updated")});e.set_primary_action(__("Refresh"),function(){location.reload(!0)}),e.get_close_btn().toggle(!1)}),this.setup_social_listeners(),this.setup_build_error_listener(),frappe.sys_defaults.email_user_password){var r=frappe.sys_defaults.email_user_password.split(",");for(var n in r)r[n]===frappe.user.name&&this.set_password(r[n])}this.link_preview=new frappe.ui.LinkPreview,frappe.boot.developer_mode||setInterval(function(){frappe.call({method:"frappe.core.page.background_jobs.background_jobs.get_scheduler_status",callback:function(e){e.message[0]==__("Inactive")&&frappe.call("frappe.utils.scheduler.activate_scheduler")}})},3e5),this.fetch_tags()},setup_frappe_vue:function(){Vue.prototype.__=window.__,Vue.prototype.frappe=window.frappe},set_password:function(e){var t=this;frappe.call({method:"frappe.core.doctype.user.user.get_email_awaiting",args:{user:e},callback:function(r){if(r=r.message){0<r.length&&t.email_password_prompt(r,e,0)}}})},email_password_prompt:function(e,t,r){var n=this,a=new frappe.ui.Dialog({title:__("Email Account setup please enter your password for: {0}",[e[r].email_id]),fields:[{fieldname:"password",fieldtype:"Password",label:"Email Account Password",reqd:1},{fieldtype:"Button",label:__("Submit")}]});a.get_input("submit").on("click",function(){a.hide();var i=new frappe.ui.Dialog({title:__("Checking one moment"),fields:[{fieldtype:"HTML",fieldname:"checking"}]});i.fields_dict.checking.$wrapper.html('<i class="fa fa-spinner fa-spin fa-4x"></i>'),i.show(),frappe.call({method:"frappe.core.doctype.user.user.set_email_password",args:{email_account:e[r].email_account,user:t,password:a.get_value("password")},callback:function(o){i.hide(),a.hide(),o.message?r+1<e.length&&(r+=1,n.email_password_prompt(e,t,r)):(frappe.show_alert("Login Failed please try again",5),n.email_password_prompt(e,t,r))}})}),a.show()},load_bootinfo:function(){frappe.boot?(frappe.modules={},frappe.boot.allowed_modules.forEach(function(e){frappe.modules[e.module_name]=e}),frappe.model.sync(frappe.boot.docs),$.extend(frappe._messages,frappe.boot.__messages),this.check_metadata_cache_status(),this.set_globals(),this.sync_pages(),moment.locale("en"),moment.user_utc_offset=moment().utcOffset(),frappe.boot.timezone_info&&moment.tz.add(frappe.boot.timezone_info),frappe.boot.print_css&&frappe.dom.set_style(frappe.boot.print_css,"print-style"),frappe.user.name=frappe.boot.user.name):this.set_as_guest()},load_user_permissions:function(){frappe.defaults.update_user_permissions(),frappe.realtime.on("update_user_permissions",frappe.utils.debounce(function(){frappe.defaults.update_user_permissions()},500))},check_metadata_cache_status:function(){frappe.boot.metadata_version!=localStorage.metadata_version&&(frappe.assets.clear_local_storage(),frappe.assets.init_local_storage())},set_globals:function(){frappe.session.user=frappe.boot.user.name,frappe.session.user_email=frappe.boot.user.email,frappe.session.user_fullname=frappe.user_info().fullname,frappe.user_defaults=frappe.boot.user.defaults,frappe.user_roles=frappe.boot.user.roles,frappe.sys_defaults=frappe.boot.sysdefaults,frappe.ui.py_date_format=frappe.boot.sysdefaults.date_format.replace("dd","%d").replace("mm","%m").replace("yyyy","%Y"),frappe.boot.user.last_selected_values={},Object.defineProperties(window,{user:{get:function(){return console.warn("Please use `frappe.session.user` instead of `user`. It will be deprecated soon."),frappe.session.user}},user_fullname:{get:function(){return console.warn("Please use `frappe.session.user_fullname` instead of `user_fullname`. It will be deprecated soon."),frappe.session.user}},user_email:{get:function(){return console.warn("Please use `frappe.session.user_email` instead of `user_email`. It will be deprecated soon."),frappe.session.user_email}},user_defaults:{get:function(){return console.warn("Please use `frappe.user_defaults` instead of `user_defaults`. It will be deprecated soon."),frappe.user_defaults}},roles:{get:function(){return console.warn("Please use `frappe.user_roles` instead of `roles`. It will be deprecated soon."),frappe.user_roles}},sys_defaults:{get:function(){return console.warn("Please use `frappe.sys_defaults` instead of `sys_defaults`. It will be deprecated soon."),frappe.user_roles}}})},sync_pages:function(){if(localStorage.page_info){frappe.boot.allowed_pages=[];var e=JSON.parse(localStorage.page_info);$.each(frappe.boot.page_info,function(t,r){e[t]&&e[t].modified==r.modified||delete localStorage["_page:"+t],frappe.boot.allowed_pages.push(t)})}else frappe.boot.allowed_pages=Object.keys(frappe.boot.page_info);localStorage.page_info=JSON.stringify(frappe.boot.page_info)},set_as_guest:function(){frappe.session.user="Guest",frappe.session.user_email="",frappe.session.user_fullname="Guest",frappe.user_defaults={},frappe.user_roles=["Guest"],frappe.sys_defaults={}},make_page_container:function(){$("#body_div").length&&($(".splash").remove(),frappe.temp_container=$("<div id='temp-container' style='display: none;'>").appendTo("body"),frappe.container=new frappe.views.Container)},make_nav_bar:function(){frappe.boot&&"setup-wizard"!==frappe.boot.home_page&&(frappe.frappe_toolbar=new frappe.ui.toolbar.Toolbar)},logout:function(){var e=this;return e.logged_out=!0,frappe.call({method:"logout",callback:function(t){t.exc||e.redirect_to_login()}})},handle_session_expired:function(){if(!frappe.app.session_expired_dialog){var e=new frappe.ui.Dialog({title:__("Session Expired"),keep_open:!0,fields:[{fieldtype:"Password",fieldname:"password",label:__("Please Enter Your Password to Continue")}],onhide:function(){e.logged_in||frappe.app.redirect_to_login()}});e.set_primary_action(__("Login"),function(){e.set_message(__("Authenticating...")),frappe.call({method:"login",args:{usr:frappe.session.user,pwd:e.get_values().password},callback:function(t){"Logged In"===t.message&&(e.logged_in=!0,$(".modal-backdrop").css({opacity:"","background-color":"#334143"})),e.hide()},statusCode:function(){e.hide()}})}),frappe.app.session_expired_dialog=e}frappe.app.session_expired_dialog.display||(frappe.app.session_expired_dialog.show(),$(".modal-backdrop").css({opacity:1,"background-color":"#4B4C9D"}))},redirect_to_login:function(){window.location.href="/"},set_favicon:function(){var e=$('link[type="image/x-icon"]').remove().attr("href");$('<link rel="shortcut icon" href="'+e+'" type="image/x-icon">').appendTo("head"),$('<link rel="icon" href="'+e+'" type="image/x-icon">').appendTo("head")},set_app_logo_url:function(){return frappe.call("frappe.client.get_hooks",{hook:"app_logo_url"}).then(function(e){if(frappe.app.logo_url=(e.message||[]).slice(-1)[0],window.cordova){var t=frappe.request.url;t=t.slice(0,t.length-1),frappe.app.logo_url=t+frappe.app.logo_url}})},trigger_primary_action:function(){window.cur_dialog&&cur_dialog.display?cur_dialog.get_primary_btn().trigger("click"):cur_frm&&cur_frm.page.btn_primary.is(":visible")?cur_frm.page.btn_primary.trigger("click"):frappe.container.page.save_action&&frappe.container.page.save_action()},set_rtl:function(){if(frappe.utils.is_rtl()){var e=document.createElement("link");e.rel="stylesheet",e.href="assets/css/frappe-rtl.css",document.getElementsByTagName("head")[0].appendChild(e),$("body").addClass("frappe-rtl")}},show_change_log:function(){var e=this,t=frappe.boot.change_log;if(Array.isArray(t)&&t.length&&!window.Cypress){var r=frappe.msgprint({message:frappe.render_template("change_log",{change_log:t}),title:__("Updated To A New Version 🎉"),wide:!0,scroll:!0});r.keep_open=!0,r.custom_onhide=function(){frappe.call({method:"frappe.utils.change_log.update_last_known_versions"}),e.show_notes()}}},show_update_available:function(){frappe.call({method:"frappe.utils.change_log.show_update_popup"})},setup_analytics:function(){window.mixpanel&&(window.mixpanel.identify(frappe.session.user),window.mixpanel.people.set({$first_name:frappe.boot.user.first_name,$last_name:frappe.boot.user.last_name,$created:frappe.boot.user.creation,$email:frappe.session.user}))},set_fullwidth_if_enabled:function(){frappe.ui.toolbar.set_fullwidth_if_enabled()},show_notes:function(){var e=this;frappe.boot.notes.length&&frappe.boot.notes.forEach(function(t){if(!t.seen||t.notify_on_every_login){var r=frappe.msgprint({message:t.content,title:t.title});r.keep_open=!0,r.custom_onhide=function(){t.seen=!0,t.notify_on_every_login||frappe.call({method:"frappe.desk.doctype.note.note.mark_as_seen",args:{note:t.name}}),e.show_notes()}}})},setup_build_error_listener:function(){frappe.boot.developer_mode&&frappe.realtime.on("build_error",function(e){console.log(e)})},setup_social_listeners:function(){frappe.realtime.on("mention",function(e){"social"!==frappe.get_route()[0]&&frappe.show_alert(e)})},setup_energy_point_listeners:function(){frappe.realtime.on("energy_point_alert",function(e){frappe.show_alert(e)})},fetch_tags:function(){frappe.tags.utils.fetch_tags()}}),frappe.get_module=function(e,t){var r=frappe.modules[e]||t;if(r)return r._setup?r:("module"!==r.type||r.link||(r.link="modules/"+r.module_name),"list"!==r.type||r.link||(r.link="List/"+r._doctype),r.link||(r.link=""),r._id||(r._id=r.module_name.toLowerCase()),r.label||(r.label=e),r._label||(r._label=__(r.label)),r._doctype||(r._doctype=""),r._setup=!0,r)},frappe.provide("frappe.utils"),Object.assign(frappe.utils,{get_url_arg:get_url_arg,get_query_string:get_query_string,get_query_params:get_query_params,make_query_string:make_query_string}),frappe.templates.rating_icons='{% if show_label %}  {{ __("Rating: ") }} {% endif %} {% for(var i=1, l=6; i<l; i++) { %}  <i class="fa fa-fw {{ i<=rating? "fa-star": "fa-star-o" }} star-icon" data-idx=1></i> {% } %}';var fuse=createCommonjsModule(function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=r(2),i=r(8),o=r(0),s=function(){function e(t,r){var n=r.location,a=void 0===n?0:n,o=r.distance,s=void 0===o?100:o,l=r.threshold,p=void 0===l?.6:l,c=r.maxPatternLength,d=void 0===c?32:c,u=r.caseSensitive,f=void 0!==u&&u,_=r.tokenSeparator,h=void 0===_?/ +/g:_,m=r.findAllMatches,g=void 0!==m&&m,v=r.minMatchCharLength,b=void 0===v?1:v,y=r.id,w=void 0===y?null:y,k=r.keys,x=void 0===k?[]:k,C=r.shouldSort,$=void 0===C||C,S=r.getFn,A=void 0===S?i:S,T=r.sortFn,E=void 0===T?function(e,t){return e.score-t.score}:T,O=r.tokenize,P=void 0!==O&&O,L=r.matchAllTokens,j=void 0!==L&&L,N=r.includeMatches,D=void 0!==N&&N,F=r.includeScore,M=void 0!==F&&F,z=r.verbose,I=void 0!==z&&z;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:a,distance:s,threshold:p,maxPatternLength:d,isCaseSensitive:f,tokenSeparator:h,findAllMatches:g,minMatchCharLength:b,id:w,keys:x,includeMatches:D,includeScore:M,shouldSort:$,getFn:A,sortFn:E,verbose:I,tokenize:P,matchAllTokens:j},this.setCollection(t)}var t,r;return t=e,(r=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var r=this._prepareSearchers(e),n=r.tokenSearchers,a=r.fullSearcher,i=this._search(n,a),o=i.weights,s=i.results;return this._computeScore(o,s),this.options.shouldSort&&this._sort(s),t.limit&&"number"==typeof t.limit&&(s=s.slice(0,t.limit)),this._format(s)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var r=e.split(this.options.tokenSeparator),n=0,i=r.length;n<i;n+=1)t.push(new a(r[n],this.options));return{tokenSearchers:t,fullSearcher:new a(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=this.list,n={},a=[];if("string"==typeof r[0]){for(var i=0,o=r.length;i<o;i+=1)this._analyze({key:"",value:r[i],record:i,index:i},{resultMap:n,results:a,tokenSearchers:e,fullSearcher:t});return{weights:null,results:a}}for(var s={},l=0,p=r.length;l<p;l+=1)for(var c=r[l],d=0,u=this.options.keys.length;d<u;d+=1){var f=this.options.keys[d];if("string"!=typeof f){if(s[f.name]={weight:1-f.weight||1},f.weight<=0||f.weight>1)throw new Error("Key weight has to be > 0 and <= 1");f=f.name}else s[f]={weight:1};this._analyze({key:f,value:this.options.getFn(c,f),record:c,index:l},{resultMap:n,results:a,tokenSearchers:e,fullSearcher:t})}return{weights:s,results:a}}},{key:"_analyze",value:function(e,t){var r=e.key,n=e.arrayIndex,a=void 0===n?-1:n,i=e.value,s=e.record,l=e.index,p=t.tokenSearchers,c=void 0===p?[]:p,d=t.fullSearcher,u=void 0===d?[]:d,f=t.resultMap,_=void 0===f?{}:f,h=t.results,m=void 0===h?[]:h;if(null!=i){var g=!1,v=-1,b=0;if("string"==typeof i){this._log("\nKey: ".concat(""===r?"-":r));var y=u.search(i);if(this._log('Full text: "'.concat(i,'", score: ').concat(y.score)),this.options.tokenize){for(var w=i.split(this.options.tokenSeparator),k=[],x=0;x<c.length;x+=1){var C=c[x];this._log('\nPattern: "'.concat(C.pattern,'"'));for(var $=!1,S=0;S<w.length;S+=1){var A=w[S],T=C.search(A),E={};T.isMatch?(E[A]=T.score,g=!0,$=!0,k.push(T.score)):(E[A]=1,this.options.matchAllTokens||k.push(1)),this._log('Token: "'.concat(A,'", score: ').concat(E[A]))}$&&(b+=1)}v=k[0];for(var O=k.length,P=1;P<O;P+=1)v+=k[P];v/=O,this._log("Token score average:",v)}var L=y.score;v>-1&&(L=(L+v)/2),this._log("Score average:",L);var j=!this.options.tokenize||!this.options.matchAllTokens||b>=c.length;if(this._log("\nCheck Matches: ".concat(j)),(g||y.isMatch)&&j){var N=_[l];N?N.output.push({key:r,arrayIndex:a,value:i,score:L,matchedIndices:y.matchedIndices}):(_[l]={item:s,output:[{key:r,arrayIndex:a,value:i,score:L,matchedIndices:y.matchedIndices}]},m.push(_[l]))}}else if(o(i))for(var D=0,F=i.length;D<F;D+=1)this._analyze({key:r,arrayIndex:D,value:i[D],record:s,index:l},{resultMap:_,results:m,tokenSearchers:c,fullSearcher:u})}}},{key:"_computeScore",value:function(e,t){this._log("\n\nComputing score:\n");for(var r=0,n=t.length;r<n;r+=1){for(var a=t[r].output,i=a.length,o=1,s=1,l=0;l<i;l+=1){var p=e?e[a[l].key].weight:1,c=(1===p?a[l].score:a[l].score||.001)*p;1!==p?s=Math.min(s,c):(a[l].nScore=c,o*=c)}t[r].score=1===s?o:s,this._log(t[r])}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var r=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,function(e,t){if("object"===n(t)&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t})),r=null}var a=[];this.options.includeMatches&&a.push(function(e,t){var r=e.output;t.matches=[];for(var n=0,a=r.length;n<a;n+=1){var i=r[n];if(0!==i.matchedIndices.length){var o={indices:i.matchedIndices,value:i.value};i.key&&(o.key=i.key),i.hasOwnProperty("arrayIndex")&&i.arrayIndex>-1&&(o.arrayIndex=i.arrayIndex),t.matches.push(o)}}}),this.options.includeScore&&a.push(function(e,t){t.score=e.score});for(var i=0,o=e.length;i<o;i+=1){var s=e[i];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),a.length){for(var l={item:s.item},p=0,c=a.length;p<c;p+=1)a[p](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),e}();e.exports=s},function(e,t,r){var n=r(3),a=r(4),i=r(7),o=function(){function e(t,r){var n=r.location,a=void 0===n?0:n,o=r.distance,s=void 0===o?100:o,l=r.threshold,p=void 0===l?.6:l,c=r.maxPatternLength,d=void 0===c?32:c,u=r.isCaseSensitive,f=void 0!==u&&u,_=r.tokenSeparator,h=void 0===_?/ +/g:_,m=r.findAllMatches,g=void 0!==m&&m,v=r.minMatchCharLength,b=void 0===v?1:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:a,distance:s,threshold:p,maxPatternLength:d,isCaseSensitive:f,tokenSeparator:h,findAllMatches:g,minMatchCharLength:b},this.pattern=this.options.isCaseSensitive?t:t.toLowerCase(),this.pattern.length<=d&&(this.patternAlphabet=i(this.pattern))}var t,r;return t=e,(r=[{key:"search",value:function(e){if(this.options.isCaseSensitive||(e=e.toLowerCase()),this.pattern===e)return{isMatch:!0,score:0,matchedIndices:[[0,e.length-1]]};var t=this.options,r=t.maxPatternLength,i=t.tokenSeparator;if(this.pattern.length>r)return n(e,this.pattern,i);var o=this.options,s=o.location,l=o.distance,p=o.threshold,c=o.findAllMatches,d=o.minMatchCharLength;return a(e,this.pattern,this.patternAlphabet,{location:s,distance:l,threshold:p,findAllMatches:c,minMatchCharLength:d})}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),e}();e.exports=o},function(e,t){var r=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,a=new RegExp(t.replace(r,"\\$&").replace(n,"|")),i=e.match(a),o=!!i,s=[];if(o)for(var l=0,p=i.length;l<p;l+=1){var c=i[l];s.push([e.indexOf(c),c.length-1])}return{score:o?.5:1,isMatch:o,matchedIndices:s}}},function(e,t,r){var n=r(5),a=r(6);e.exports=function(e,t,r,i){for(var o=i.location,s=void 0===o?0:o,l=i.distance,p=void 0===l?100:l,c=i.threshold,d=void 0===c?.6:c,u=i.findAllMatches,f=void 0!==u&&u,_=i.minMatchCharLength,h=void 0===_?1:_,m=s,g=e.length,v=d,b=e.indexOf(t,m),y=t.length,w=[],k=0;k<g;k+=1)w[k]=0;if(-1!==b){var x=n(t,{errors:0,currentLocation:b,expectedLocation:m,distance:p});if(v=Math.min(x,v),-1!==(b=e.lastIndexOf(t,m+y))){var C=n(t,{errors:0,currentLocation:b,expectedLocation:m,distance:p});v=Math.min(C,v)}}b=-1;for(var $=[],S=1,A=y+g,T=1<<(y<=31?y-1:30),E=0;E<y;E+=1){for(var O=0,P=A;O<P;)n(t,{errors:E,currentLocation:m+P,expectedLocation:m,distance:p})<=v?O=P:A=P,P=Math.floor((A-O)/2+O);A=P;var L=Math.max(1,m-P+1),j=f?g:Math.min(m+P,g)+y,N=Array(j+2);N[j+1]=(1<<E)-1;for(var D=j;D>=L;D-=1){var F=D-1,M=r[e.charAt(F)];if(M&&(w[F]=1),N[D]=(N[D+1]<<1|1)&M,0!==E&&(N[D]|=($[D+1]|$[D])<<1|1|$[D+1]),N[D]&T&&(S=n(t,{errors:E,currentLocation:F,expectedLocation:m,distance:p}))<=v){if(v=S,(b=F)<=m)break;L=Math.max(1,2*m-b)}}if(n(t,{errors:E+1,currentLocation:m,expectedLocation:m,distance:p})>v)break;$=N}return{isMatch:b>=0,score:0===S?.001:S,matchedIndices:a(w,h)}}},function(e,t){e.exports=function(e,t){var r=t.errors,n=void 0===r?0:r,a=t.currentLocation,i=void 0===a?0:a,o=t.expectedLocation,s=void 0===o?0:o,l=t.distance,p=void 0===l?100:l,c=n/e.length,d=Math.abs(s-i);return p?c+d/p:d?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[],n=-1,a=-1,i=0,o=e.length;i<o;i+=1){var s=e[i];s&&-1===n?n=i:s||-1===n||((a=i-1)-n+1>=t&&r.push([n,a]),n=-1)}return e[i-1]&&i-n>=t&&r.push([n,i-1]),r}},function(e,t){e.exports=function(e){for(var t={},r=e.length,n=0;n<r;n+=1)t[e.charAt(n)]=0;for(var a=0;a<r;a+=1)t[e.charAt(a)]|=1<<r-a-1;return t}},function(e,t,r){var n=r(0);e.exports=function(e,t){return function e(t,r,a){if(r){var i=r.indexOf("."),o=r,s=null;-1!==i&&(o=r.slice(0,i),s=r.slice(i+1));var l=t[o];if(null!=l)if(s||"string"!=typeof l&&"number"!=typeof l)if(n(l))for(var p=0,c=l.length;p<c;p+=1)e(l[p],s,a);else s&&e(l,s,a);else a.push(l.toString())}else a.push(t);return a}(e,t,[])}}])}),Fuse=unwrapExports(fuse),fuse_1=fuse.Fuse,hyper_min=createCommonjsModule(function(e){!function(){function t(){}function r(e,t){for(var r in t)e[r]=t[r];return e}function n(e){!e.__d&&(e.__d=!0)&&1==O.push(e)&&E(a)}function a(){var e,t=O;for(O=[];e=t.pop();)e.__d&&w(e)}function i(e,t,r){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&o(e,t.nodeName):r||e._componentConstructor===t.nodeName}function o(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function s(e){var t=r({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var a in n)void 0===t[a]&&(t[a]=n[a]);return t}function l(e){var t=e.parentNode;t&&t.removeChild(e)}function p(e,t,r,n,a){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)r&&r(null),n&&n(e);else if("class"!==t||a)if("style"===t){if(n&&"string"!=typeof n&&"string"!=typeof r||(e.style.cssText=n||""),n&&"object"==typeof n){if("string"!=typeof r)for(var i in r)i in n||(e.style[i]="");for(var i in n)e.style[i]="number"==typeof n[i]&&!1===T.test(i)?n[i]+"px":n[i]}}else if("html"===t)n&&(e.innerHTML=n);else if("o"==t[0]&&"n"==t[1]){var o=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),n?r||e.addEventListener(t,c,o):e.removeEventListener(t,c,o),(e.__l||(e.__l={}))[t]=n}else if("list"!==t&&"type"!==t&&!a&&t in e)(function(e,t,r){try{e[t]=r}catch(e){}})(e,t,null==n?"":n),null!=n&&!1!==n||e.removeAttribute(t);else{var s=a&&t!==(t=t.replace(/^xlink\:?/,""));null==n||!1===n?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof n&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):e.setAttribute(t,n))}else e.className=n||""}function c(e){return this.__l[e.type](e)}function d(){for(var e;e=P.pop();)e.on_mounted&&e.on_mounted()}function u(e,t,r,n,a,i){L++||(j=null!=a&&void 0!==a.ownerSVGElement,N=null!=e&&!("__hyperattr_"in e));var o=f(e,t,r,n,i);return a&&o.parentNode!==a&&a.appendChild(o),--L||(N=!1,i||d()),o}function f(e,t,r,n,a){var i=e,s=j;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||a)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),h(e,!0))),i.__hyperattr_=!0,i;var l=t.nodeName;if("function"==typeof l)return k(e,t,r,n);if(j="svg"===l||"foreignObject"!==l&&j,l+="",(!e||!o(e,l))&&(i=function(e,t){var r=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return r.__n=e,r}(l,j),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),h(e,!0)}var p=i.firstChild,c=i.__hyperattr_,d=t.children;if(null==c){c=i.__hyperattr_={};for(var u=i.attributes,f=u.length;f--;)c[u[f].name]=u[f].value}return!N&&d&&1===d.length&&"string"==typeof d[0]&&null!=p&&void 0!==p.splitText&&null==p.nextSibling?p.nodeValue!=d[0]&&(p.nodeValue=d[0]):(d&&d.length||null!=p)&&_(i,d,r,n,N||null!=c.html),g(i,t.attributes,c),j=s,i}function _(e,t,r,n,a){var o,s,p,c,d,u=e.childNodes,_=[],m={},g=0,v=0,b=u.length,y=0,w=t?t.length:0;if(0!==b)for(var k=0;k<b;k++){var x=u[k],C=x.__hyperattr_;null!=($=w&&C?x._component?x._component.__k:C.key:null)?(g++,m[$]=x):(C||(void 0!==x.splitText?!a||x.nodeValue.trim():a))&&(_[y++]=x)}if(0!==w)for(k=0;k<w;k++){var $;if(d=null,null!=($=(c=t[k]).key))g&&void 0!==m[$]&&(d=m[$],m[$]=void 0,g--);else if(!d&&v<y)for(o=v;o<y;o++)if(void 0!==_[o]&&i(s=_[o],c,a)){d=s,_[o]=void 0,o===y-1&&y--,o===v&&v++;break}d=f(d,c,r,n),p=u[k],d&&d!==e&&d!==p&&(null==p?e.appendChild(d):d===p.nextSibling?l(p):e.insertBefore(d,p))}if(g)for(var k in m)void 0!==m[k]&&h(m[k],!1);for(;v<=y;)void 0!==(d=_[y--])&&h(d,!1)}function h(e,t){var r=e._component;r?x(r):(null!=e.__hyperattr_&&e.__hyperattr_.ref&&e.__hyperattr_.ref(null),!1!==t&&null!=e.__hyperattr_||l(e),m(e))}function m(e){for(e=e.lastChild;e;){var t=e.previousSibling;h(e,!0),e=t}}function g(e,t,r){var n;for(n in r)t&&null!=t[n]||null==r[n]||p(e,n,r[n],r[n]=void 0,j);for(n in t)"children"===n||"innerHTML"===n||n in r&&t[n]===("value"===n||"checked"===n?e[n]:r[n])||p(e,n,r[n],r[n]=t[n],j)}function v(e,t,r){var n,a=D[e.name];if(e.prototype&&e.prototype.render?(n=new e(t,r),C.call(n,t,r)):((n=new C(t,r)).constructor=e,n.render=b),a)for(var i=a.length;i--;)if(a[i].constructor===e){n.__b=a[i].__b,a.splice(i,1);break}return n}function b(e,t,r){return this.constructor(e,r)}function y(e,t,r,a,i){e.__x||(e.__x=!0,(e.__r=t.ref)&&delete t.ref,(e.__k=t.key)&&delete t.key,!e.base||i?e.on_mount&&e.on_mount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,a),a&&a!==e.context&&(e.__c||(e.__c=e.context),e.context=a),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==r&&(1!==r&&!1===$.syncComponentUpdates&&e.base?n(e):w(e,1,i)),e.__r&&e.__r(e))}function w(e,t,n,a){if(!e.__x){var i,o,l,p=e.props,c=e.state,f=e.context,_=e.__p||p,m=e.__s||c,g=e.__c||f,b=e.base,k=e.__b,C=b||k,S=e._component,A=!1;if(b&&(e.props=_,e.state=m,e.context=g,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(p,c,f)?A=!0:e.componentWillUpdate&&e.componentWillUpdate(p,c,f),e.props=p,e.state=c,e.context=f),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!A){i=e.render(p,c,f),e.getChildContext&&(f=r(r({},f),e.getChildContext()));var T,E,O=i&&i.nodeName;if("function"==typeof O){var j=s(i);(o=S)&&o.constructor===O&&j.key==o.__k?y(o,j,1,f,!1):(T=o,e._component=o=v(O,j,f),o.__b=o.__b||k,o.__u=e,y(o,j,0,f,!1),w(o,1,n,!0)),E=o.base}else l=C,(T=S)&&(l=e._component=null),(C||1===t)&&(l&&(l._component=null),E=u(l,i,f,n||!b,C&&C.parentNode,!0));if(C&&E!==C&&o!==S){var N=C.parentNode;N&&E!==N&&(N.replaceChild(E,C),T||(C._component=null,h(C,!1)))}if(T&&x(T),e.base=E,E&&!a){for(var D=e,F=e;F=F.__u;)(D=F).base=E;E._component=D,E._componentConstructor=D.constructor}}if(!b||n?P.unshift(e):A||(e.on_updated&&e.on_updated(_,m,g),$.afterUpdate&&$.afterUpdate(e)),null!=e.__h)for(;e.__h.length;)e.__h.pop().call(e);L||a||d()}}function k(e,t,r,n){for(var a=e&&e._component,i=a,o=e,l=a&&e._componentConstructor===t.nodeName,p=l,c=s(t);a&&!p&&(a=a.__u);)p=a.constructor===t.nodeName;return a&&p&&(!n||a._component)?(y(a,c,3,r,n),e=a.base):(i&&!l&&(x(i),e=o=null),a=v(t.nodeName,c,r),e&&!a.__b&&(a.__b=e,o=null),y(a,c,1,r,n),e=a.base,o&&e!==o&&(o._component=null,h(o,!1))),e}function x(e){var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var r=e._component;r?x(r):t&&(t.__hyperattr_&&t.__hyperattr_.ref&&t.__hyperattr_.ref(null),e.__b=t,l(t),function(e){var t=e.constructor.name;(D[t]||(D[t]=[])).push(e)}(e),m(t)),e.__r&&e.__r(null)}function C(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{}}var $={},S=[],A=[],T=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,E="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,O=[],P=[],L=0,j=!1,N=!1,D={};r(C.prototype,{set_state:function(e,t){var a=this.state;this.__s||(this.__s=r({},a)),r(a,"function"==typeof e?e(a,this.props):e),t&&(this.__h=this.__h||[]).push(t),n(this)},forceUpdate:function(e){e&&(this.__h=this.__h||[]).push(e),w(this,2)},render:function(){}});var F={h:function(e,r){var n,a,i,o,s=arguments,l=A;for(o=arguments.length;o-- >2;)S.push(s[o]);for(r&&null!=r.children&&(S.length||S.push(r.children),delete r.children);S.length;)if((a=S.pop())&&void 0!==a.pop)for(o=a.length;o--;)S.push(a[o]);else"boolean"==typeof a&&(a=null),(i="function"!=typeof e)&&(null==a?a="":"number"==typeof a?a+="":"string"!=typeof a&&(i=!1)),i&&n?l[l.length-1]+=a:l===A?l=[a]:l.push(a),n=i;var p=new t;return p.nodeName=e,p.children=l,p.attributes=null==r?void 0:r,p.key=null==r?void 0:r.key,p},Component:C,render:function(e,t,r){return u(r,e,{},!1,t,!1)}};e.exports=F}()});frappe.Error=Error,frappe.TypeError=TypeError,frappe.ValueError=Error,frappe.ImportError=Error,frappe.provide("frappe.datetime"),frappe.datetime.datetime=class{constructor(e,t){if(void 0===t&&(t=null),"undefined"==typeof moment)throw new frappe.ImportError("Moment.js not installed.");this.moment=e?moment(e,t):moment()}format(e){return void 0===e&&(e=null),this.moment.format(e)}},frappe.datetime.range=class{constructor(e,t){if(void 0===typeof moment)throw new frappe.ImportError("Moment.js not installed.");this.start=e,this.end=t}contains(e){return e.moment.isBetween(this.start.moment,this.end.moment)}},frappe.datetime.now=function(){return new frappe.datetime.datetime},frappe.datetime.equal=function(e,t,r){return e=e.moment,t=t.moment,e.isSame(t,r)},frappe.datetime.compare=function(e,t){return e=e.moment,t=t.moment,e.isBefore(t)?1:t.isBefore(e)?-1:0},frappe.quick_edit=function(e,t,r){return new Promise(function(n){frappe.model.with_doctype(e,function(){frappe.db.get_doc(e,t).then(function(a){var i=frappe.get_meta(e).fields.filter(function(e){return e.reqd||e.bold&&!e.read_only});i.map(function(e){"content"==e.fieldname&&"File"==a.type&&(e.read_only=1)});var o=new frappe.ui.Dialog({title:__("Edit "+e+" ("+t+")"),fields:i,action:{primary:{label:__("Save"),onsubmit:function(i){frappe.call("frappe.client.save",{doc:Object.assign({},{doctype:e,docname:t},a,i)}).then(function(e){r&&r(e.message),n(e.message)}),o.hide()}},secondary:{label:__("Discard")}}});o.set_values(a);var s=$(o.body);s.append("\n\t\t\t\t\t<div class=\"qe-fp\" style=\"padding-top: '15px'; padding-bottom: '15px'; padding-left: '7px'\">\n\t\t\t\t\t\t<button class=\"btn btn-default btn-sm\">\n\t\t\t\t\t\t\t"+__("Edit in Full Page")+"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t"),s.find(".qe-fp").click(function(){o.hide(),frappe.set_route("Form/"+e+"/"+t)}),o.show()})})})},frappe.provide("frappe._"),frappe._.format=function(e,t){for(var r in t)e=e.replace("{"+r+"}",t[r]);return e},frappe._.fuzzy_search=function(e,t,r){return r=Object.assign({},{shouldSort:!0,threshold:.6,location:0,distance:100,minMatchCharLength:1,maxPatternLength:32},r),new Fuse(t,r).search(e)},frappe._.pluralize=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r="s"),""+e+(1===t?"":r)},frappe._.capitalize=function(e){return""+e.charAt(0).toUpperCase()+e.slice(1)},frappe._.head=function(e){return frappe._.is_empty(e)?void 0:e[0]},frappe._.copy_array=function(e){if(Array.isArray(e))return e.slice();throw frappe.TypeError("Expected Array, recieved "+typeof e+" instead.")},frappe._.is_empty=function(e){var t=!1;return null==e?t=!0:Array.isArray(e)||"string"==typeof e||e instanceof $?t=0===e.length:"object"==typeof e&&(t=0===Object.keys(e).length),t},frappe._.as_array=function(e){return Array.isArray(e)?e:[e]},frappe._.squash=function(e){return Array.isArray(e)&&1===e.length?e[0]:e},frappe._.is_mobile=function(){var e=new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini","i"),t=navigator.userAgent;return e.test(t)},frappe._.compact=function(e){return e.filter(Boolean)},frappe.utils=Object.assign({},frappe.utils,frappe._),frappe.provide("frappe.user"),frappe.user.first_name=function(e){return frappe._.head(frappe.user.full_name(e).split(" "))},frappe.provide("frappe.ui.keycode"),frappe.ui.keycode={RETURN:13},frappe.provide("frappe.stores"),frappe.stores=[],frappe.Store=class{constructor(e){if("string"!=typeof e)throw new frappe.TypeError("Expected string for name, got "+typeof e+" instead.");this.name=e}static get(e){return e in frappe.stores||(frappe.stores[e]=new frappe.Store(e)),frappe.stores[e]}set(e,t){localStorage.setItem(this.name+":"+e,t)}get(e,t){return localStorage.getItem(this.name+":"+e)}},frappe.provide("frappe.loggers"),frappe.Logger=class{constructor(e,t){if("string"!=typeof e)throw new frappe.TypeError("Expected string for name, got "+typeof e+" instead.");this.name=e,this.level=t,this.level||(frappe.boot.developer_mode?this.level=frappe.Logger.ERROR:this.level=frappe.Logger.NOTSET),this.format=frappe.Logger.FORMAT}static get(e,t){return e in frappe.loggers||(frappe.loggers[e]=new frappe.Logger(e,t)),frappe.loggers[e]}debug(e){this.log(e,frappe.Logger.DEBUG)}info(e){this.log(e,frappe.Logger.INFO)}warn(e){this.log(e,frappe.Logger.WARN)}error(e){this.log(e,frappe.Logger.ERROR)}log(e,t){var r=frappe.datetime.now();if(t.value<=this.level.value){var n=frappe._.format(this.format,{time:r.format("HH:mm:ss"),name:this.name});console.log("%c "+n+":","color: "+t.color,e)}}},frappe.Logger.DEBUG={value:10,color:"#616161",name:"DEBUG"},frappe.Logger.INFO={value:20,color:"#2196F3",name:"INFO"},frappe.Logger.WARN={value:30,color:"#FFC107",name:"WARN"},frappe.Logger.ERROR={value:40,color:"#F44336",name:"ERROR"},frappe.Logger.NOTSET={value:0,name:"NOTSET"},frappe.Logger.FORMAT="{time} {name}",frappe.provide("frappe.chat"),frappe.log=frappe.Logger.get("frappe.chat",frappe.Logger.NOTSET),frappe.provide("frappe.chat.profile"),frappe.chat.profile.create=function(e,t){return"function"==typeof e?(t=e,e=null):"string"==typeof e&&(e=frappe._.as_array(e)),new Promise(function(r){frappe.call("frappe.chat.doctype.chat_profile.chat_profile.create",{user:frappe.session.user,exists_ok:!0,fields:e},function(e){t&&t(e.message),r(e.message)})})},frappe.chat.profile.update=function(e,t,r){return new Promise(function(n){frappe.call("frappe.chat.doctype.chat_profile.chat_profile.update",{user:e||frappe.session.user,data:t},function(e){r&&r(e.message),n(e.message)})})},frappe.provide("frappe.chat.profile.on"),frappe.chat.profile.on.update=function(e){frappe.realtime.on("frappe.chat.profile:update",function(t){return e(t.user,t.data)})},frappe.chat.profile.STATUSES=[{name:"Online",color:"green"},{name:"Away",color:"yellow"},{name:"Busy",color:"red"},{name:"Offline",color:"darkgrey"}],frappe.provide("frappe.chat.room"),frappe.chat.room.create=function(e,t,r,n,a){return"function"==typeof n&&(a=n,n=null),r=frappe._.as_array(r),new Promise(function(i){frappe.call("frappe.chat.doctype.chat_room.chat_room.create",{kind:e,token:t||frappe.session.user,users:r,name:n},function(e){var t=e.message;t=Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}),a&&a(t),i(t)})})},frappe.chat.room.get=function(e,t,r){return"function"==typeof e?(r=e,e=null,t=null):"string"==typeof e&&(e=frappe._.as_array(e),"function"==typeof t?(r=t,t=null):"string"==typeof t&&(t=frappe._.as_array(t))),new Promise(function(n){frappe.call("frappe.chat.doctype.chat_room.chat_room.get",{user:frappe.session.user,rooms:e,fields:t},function(e){var t=e.message;t?(t=(t=frappe._.as_array(t)).map(function(e){return Object.assign({},e,{creation:new frappe.datetime.datetime(e.creation),last_message:e.last_message?Object.assign({},e.last_message,{creation:new frappe.datetime.datetime(e.last_message.creation)}):null})}),t=frappe._.squash(t)):t=[],r&&r(t),n(t)})})},frappe.chat.room.subscribe=function(e){frappe.realtime.publish("frappe.chat.room:subscribe",e)},frappe.chat.room.history=function(e,t){return new Promise(function(r){frappe.call("frappe.chat.doctype.chat_room.chat_room.history",{room:e,user:frappe.session.user},function(e){var n=e.message?frappe._.as_array(e.message):[];n=n.map(function(e){return Object.assign({},e,{creation:new frappe.datetime.datetime(e.creation)})}),t&&t(n),r(n)})})},frappe.chat.room.search=function(e,t){var r=t.map(function(e){return e.room_name?e.room_name:e.owner===frappe.session.user?frappe.user.full_name(frappe._.squash(e.users)):frappe.user.full_name(e.owner)}),n=frappe._.fuzzy_search(e,r);return t=n.map(function(e){return t[e]})},frappe.chat.room.sort=function(e,t){return void 0===t&&(t=null),t=t||function(e,t){return e.last_message&&t.last_message?frappe.datetime.compare(e.last_message.creation,t.last_message.creation):e.last_message?frappe.datetime.compare(e.last_message.creation,t.creation):t.last_message?frappe.datetime.compare(e.creation,t.last_message.creation):frappe.datetime.compare(e.creation,t.creation)},e.sort(t),e},frappe.provide("frappe.chat.room.on"),frappe.chat.room.on.update=function(e){frappe.realtime.on("frappe.chat.room:update",function(t){t.data.last_message&&(t.data=Object.assign({},t.data,{last_message:Object.assign({},t.data.last_message,{creation:new frappe.datetime.datetime(t.data.last_message.creation)})})),e(t.room,t.data)})},frappe.chat.room.on.create=function(e){frappe.realtime.on("frappe.chat.room:create",function(t){return e(Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}))})},frappe.chat.room.on.typing=function(e){frappe.realtime.on("frappe.chat.room:typing",function(t){return e(t.room,t.user)})},frappe.provide("frappe.chat.message"),frappe.chat.message.typing=function(e,t){frappe.realtime.publish("frappe.chat.message:typing",{user:t||frappe.session.user,room:e})},frappe.chat.message.send=function(e,t,r){void 0===r&&(r="Content"),frappe.call("frappe.chat.doctype.chat_message.chat_message.send",{user:frappe.session.user,room:e,content:t,type:r})},frappe.chat.message.update=function(e,t,r){return new Promise(function(n){frappe.call("frappe.chat.doctype.chat_message.chat_message.update",{user:frappe.session.user,message:e,update:t},function(e){r&&r(response.message),n(response.message)})})},frappe.chat.message.sort=function(e){return frappe._.is_empty(e)||e.sort(function(e,t){return frappe.datetime.compare(t.creation,e.creation)}),e},frappe.chat.message.seen=function(e,t){frappe.call("frappe.chat.doctype.chat_message.chat_message.seen",{message:e,user:t||frappe.session.user})},frappe.provide("frappe.chat.message.on"),frappe.chat.message.on.create=function(e){frappe.realtime.on("frappe.chat.message:create",function(t){return e(Object.assign({},t,{creation:new frappe.datetime.datetime(t.creation)}))})},frappe.chat.message.on.update=function(e){frappe.realtime.on("frappe.chat.message:update",function(t){return e(t.message,t.data)})},frappe.chat.pretty_datetime=function(e){var t=moment(),r=e.moment;return t.isSame(r,"d")?r.format("hh:mm A"):t.isSame(r,"week")?r.format("dddd"):r.format("DD/MM/YYYY")},frappe.provide("frappe.chat.sound"),frappe.chat.sound.play=function(e,t){void 0===t&&(t=.1);var r=$('<audio class="chat-audio"/>');r.attr("volume",t),frappe._.is_empty(r)&&$(document).append(r),r.paused||(frappe.log.info("Stopping sound playing."),r[0].pause(),r.attr("currentTime",0)),frappe.log.info("Playing sound."),r.attr("src",frappe.chat.sound.PATH+"/chat-"+e+".mp3"),r[0].play()},frappe.chat.sound.PATH="/assets/frappe/sounds",frappe.chat.emojis=[],frappe.chat.emoji=function(e){return new Promise(function(t){frappe._.is_empty(frappe.chat.emojis)?$.get("https://cdn.rawgit.com/frappe/emoji/master/emoji",function(r){frappe.chat.emojis=JSON.parse(r),e&&e(frappe.chat.emojis),t(frappe.chat.emojis)}):(e&&e(frappe.chat.emojis),t(frappe.chat.emojis))})},frappe.provide("frappe.chat.website.settings"),frappe.chat.website.settings=function(e,t){return"function"==typeof e?(t=e,e=null):"string"==typeof e&&(e=frappe._.as_array(e)),new Promise(function(r){frappe.call("frappe.chat.website.settings",{fields:e}).then(function(e){var n=e.message;n.enable_from&&(n=Object.assign({},n,{enable_from:new frappe.datetime.datetime(n.enable_from,"HH:mm:ss")})),n.enable_to&&(n=Object.assign({},n,{enable_to:new frappe.datetime.datetime(n.enable_to,"HH:mm:ss")})),t&&t(n),r(n)})})},frappe.chat.website.token=function(e){return new Promise(function(t){frappe.call("frappe.chat.website.token").then(function(r){e&&e(r.message),t(r.message)})})};var h=hyper_min.h,Component=hyper_min.Component;function styleInject(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===r&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}function $$1(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function getOffset(e){var t=e.getBoundingClientRect();return{top:t.top+(document.documentElement.scrollTop||document.body.scrollTop),left:t.left+(document.documentElement.scrollLeft||document.body.scrollLeft)}}function isHidden(e){return null===e.offsetParent}function isElementInViewport(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function getElementContentWidth(e){var t=window.getComputedStyle(e),r=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight);return e.clientWidth-r}function fire(e,t,r){var n=document.createEvent("HTMLEvents");for(var a in n.initEvent(t,!0,!0),r)n[a]=r[a];return e.dispatchEvent(n)}function getTopOffset(e){return e.titleHeight+e.margins.top+e.paddings.top}function getLeftOffset(e){return e.margins.left+e.paddings.left}function getExtraHeight(e){return e.margins.top+e.margins.bottom+e.paddings.top+e.paddings.bottom+e.titleHeight+e.legendHeight}function getExtraWidth(e){return e.margins.left+e.margins.right+e.paddings.left+e.paddings.right}function _classCallCheck$4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function floatTwo(e){return parseFloat(e.toFixed(2))}function fillArray(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r||(r=n?e[0]:e[e.length-1]);var a=new Array(Math.abs(t)).fill(r);return n?a.concat(e):e.concat(a)}function getStringWidth(e,t){return(e+"").length*t}function getPositionByAngle(e,t){return{x:Math.sin(e*ANGLE_RATIO)*t,y:Math.cos(e*ANGLE_RATIO)*t}}function getBarHeightAndYAttr(e,t){var r=void 0,n=void 0;return e<=t?(r=t-e,n=e):(r=e-t,n=t),[r,n]}function equilizeNoOfElements(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e.length;return r>0?e=fillArray(e,r):t=fillArray(t,r),[e,t]}function truncateString(e,t){if(e)return e.length>t?e.slice(0,t-3)+"...":e}function shortenLargeNumber(e){var t=void 0;if("number"==typeof e)t=e;else if("string"==typeof e&&(t=Number(e),Number.isNaN(t)))return e;var r=Math.floor(Math.log10(Math.abs(t)));if(r<=2)return t;var n=Math.floor(r/3),a=Math.pow(10,r-3*n)*+(t/Math.pow(10,r)).toFixed(1);return Math.round(100*a)/100+" "+["","K","M","B","T"][n]}function getSplineCurvePointsStr(e,t){for(var r=[],n=0;n<e.length;n++)r.push([e[n],t[n]]);var a=function(e,t,r,n){var a=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return{length:Math.sqrt(Math.pow(r,2)+Math.pow(n,2)),angle:Math.atan2(n,r)}}(t||e,r||e),i=a.angle+(n?Math.PI:0),o=.2*a.length;return[e[0]+Math.cos(i)*o,e[1]+Math.sin(i)*o]};return r.reduce(function(e,t,r,n){return 0===r?t[0]+","+t[1]:e+" "+function(e,t,r){var n=a(r[t-1],r[t-2],e),i=a(e,r[t-1],r[t+1],!0);return"C "+n[0]+","+n[1]+" "+i[0]+","+i[1]+" "+e[0]+","+e[1]}(t,r,n)},"")}function limitColor(e){return e>255?255:e<0?0:e}function lightenDarkenColor(e,t){var r=getColor(e),n=!1;"#"==r[0]&&(r=r.slice(1),n=!0);var a=parseInt(r,16),i=limitColor((a>>16)+t),o=limitColor((a>>8&255)+t);return(n?"#":"")+(limitColor((255&a)+t)|o<<8|i<<16).toString(16)}function isValidColor(e){return/(^\s*)(#)((?:[A-Fa-f0-9]{3}){1,2})$/i.test(e)||/(^\s*)(rgb|hsl)(a?)[(]\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*(?:,\s*([\d.]+)\s*)?[)]$/i.test(e)}function $$1$1(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function createSVG(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg",e);for(var n in t){var a=t[n];if("inside"===n)$$1$1(a).appendChild(r);else if("around"===n){var i=$$1$1(a);i.parentNode.insertBefore(r,i),r.appendChild(i)}else"styles"===n?"object"===(void 0===a?"undefined":_typeof$1(a))&&Object.keys(a).map(function(e){r.style[e]=a[e]}):("className"===n&&(n="class"),"innerHTML"===n?r.textContent=a:r.setAttribute(n,a))}return r}function renderVerticalGradient(e,t){return createSVG("linearGradient",{inside:e,id:t,x1:0,x2:0,y1:0,y2:1})}function setGradientStop(e,t,r,n){return createSVG("stop",{inside:e,style:"stop-color: "+r,offset:t,"stop-opacity":n})}function makeSVGContainer(e,t,r,n){return createSVG("svg",{className:t,inside:e,width:r,height:n})}function makeSVGDefs(e){return createSVG("defs",{inside:e})}function makeSVGGroup(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n={className:e,transform:t};return r&&(n.inside=r),createSVG("g",n)}function makePath(e){return createSVG("path",{className:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d:e,styles:{stroke:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",fill:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none","stroke-width":arguments.length>4&&void 0!==arguments[4]?arguments[4]:2}})}function makeArcPathStr(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=r.x+e.x,s=r.y+e.y,l=r.x+t.x,p=r.y+t.y;return"M"+r.x+" "+r.y+"\n\t\tL"+o+" "+s+"\n\t\tA "+n+" "+n+" 0 "+i+" "+(a?1:0)+"\n\t\t"+l+" "+p+" z"}function makeCircleStr(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=r.x+e.x,s=r.y+e.y,l=r.x+t.x,p=2*r.y,c=r.y+t.y;return"M"+r.x+" "+r.y+"\n\t\tL"+o+" "+s+"\n\t\tA "+n+" "+n+" 0 "+i+" "+(a?1:0)+"\n\t\t"+l+" "+p+" z\n\t\tL"+o+" "+p+"\n\t\tA "+n+" "+n+" 0 "+i+" "+(a?1:0)+"\n\t\t"+l+" "+c+" z"}function makeArcStrokePathStr(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return"M"+(r.x+e.x)+" "+(r.y+e.y)+"\n\t\tA "+n+" "+n+" 0 "+i+" "+(a?1:0)+"\n\t\t"+(r.x+t.x)+" "+(r.y+t.y)}function makeStrokeCircleStr(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=r.x+e.x,s=r.y+e.y,l=r.x+t.x,p=2*n+s;return"M"+o+" "+s+"\n\t\tA "+n+" "+n+" 0 "+i+" "+(a?1:0)+"\n\t\t"+l+" "+p+"\n\t\tM"+o+" "+p+"\n\t\tA "+n+" "+n+" 0 "+i+" "+(a?1:0)+"\n\t\t"+l+" "+(r.y+e.y)}function makeGradient(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n="path-fill-gradient-"+t+"-"+(r?"lighter":"default"),a=renderVerticalGradient(e,n),i=[1,.6,.2];return r&&(i=[.4,.2,0]),setGradientStop(a,"0%",t,i[0]),setGradientStop(a,"50%",t,i[1]),setGradientStop(a,"100%",t,i[2]),n}function percentageBar(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:PERCENTAGE_BAR_DEFAULT_DEPTH,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"none";return createSVG("rect",{className:"percentage-bar",x:e,y:t,width:r,height:n,fill:i,styles:{stroke:lightenDarkenColor(i,-25),"stroke-dasharray":"0, "+(n+r)+", "+r+", "+n,"stroke-width":a}})}function heatSquare(e,t,r,n,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"none",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s={className:e,x:t,y:r,width:n,height:n,rx:a,fill:i};return Object.keys(o).map(function(e){s[e]=o[e]}),createSVG("rect",s)}function legendBar(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",a=arguments[4];a=arguments.length>5&&void 0!==arguments[5]&&arguments[5]?truncateString(a,LABEL_MAX_CHARS):a;var i={className:"legend-bar",x:0,y:0,width:r,height:"2px",fill:n},o=createSVG("text",{className:"legend-dataset-text",x:0,y:0,dy:2*FONT_SIZE+"px","font-size":1.2*FONT_SIZE+"px","text-anchor":"start",fill:FONT_FILL,innerHTML:a}),s=createSVG("g",{transform:"translate("+e+", "+t+")"});return s.appendChild(createSVG("rect",i)),s.appendChild(o),s}function legendDot(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",a=arguments[4];a=arguments.length>5&&void 0!==arguments[5]&&arguments[5]?truncateString(a,LABEL_MAX_CHARS):a;var i={className:"legend-dot",cx:0,cy:0,r:r,fill:n},o=createSVG("text",{className:"legend-dataset-text",x:0,y:0,dx:FONT_SIZE+"px",dy:FONT_SIZE/3+"px","font-size":1.2*FONT_SIZE+"px","text-anchor":"start",fill:FONT_FILL,innerHTML:a}),s=createSVG("g",{transform:"translate("+e+", "+t+")"});return s.appendChild(createSVG("circle",i)),s.appendChild(o),s}function makeText(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=a.fontSize||FONT_SIZE;return createSVG("text",{className:e,x:t,y:r,dy:(void 0!==a.dy?a.dy:i/2)+"px","font-size":i+"px",fill:a.fill||FONT_FILL,"text-anchor":a.textAnchor||"start",innerHTML:n})}function makeVertLine(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};a.stroke||(a.stroke=BASE_LINE_COLOR);var i=createSVG("line",{className:"line-vertical "+a.className,x1:0,x2:0,y1:r,y2:n,styles:{stroke:a.stroke}}),o=createSVG("text",{x:0,y:r>n?r+LABEL_MARGIN:r-LABEL_MARGIN-FONT_SIZE,dy:FONT_SIZE+"px","font-size":FONT_SIZE+"px","text-anchor":"middle",innerHTML:t+""}),s=createSVG("g",{transform:"translate("+e+", 0)"});return s.appendChild(i),s.appendChild(o),s}function makeHoriLine(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};a.stroke||(a.stroke=BASE_LINE_COLOR),a.lineType||(a.lineType=""),a.shortenNumbers&&(t=shortenLargeNumber(t));var i=createSVG("line",{className:"line-horizontal "+a.className+("dashed"===a.lineType?"dashed":""),x1:r,x2:n,y1:0,y2:0,styles:{stroke:a.stroke}}),o=createSVG("text",{x:r<n?r-LABEL_MARGIN:r+LABEL_MARGIN,y:0,dy:FONT_SIZE/2-2+"px","font-size":FONT_SIZE+"px","text-anchor":r<n?"end":"start",innerHTML:t+""}),s=createSVG("g",{transform:"translate(0, "+e+")","stroke-opacity":1});return 0!==o&&"0"!==o||(s.style.stroke="rgba(27, 31, 35, 0.6)"),s.appendChild(i),s.appendChild(o),s}function yLine(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n.pos||(n.pos="left"),n.offset||(n.offset=0),n.mode||(n.mode="span"),n.stroke||(n.stroke=BASE_LINE_COLOR),n.className||(n.className="");var a=-1*AXIS_TICK_LENGTH,i="span"===n.mode?r+AXIS_TICK_LENGTH:0;return"tick"===n.mode&&"right"===n.pos&&(a=r+AXIS_TICK_LENGTH,i=r),makeHoriLine(e,t,a+=n.offset,i+=n.offset,{stroke:n.stroke,className:n.className,lineType:n.lineType,shortenNumbers:n.shortenNumbers})}function xLine(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n.pos||(n.pos="bottom"),n.offset||(n.offset=0),n.mode||(n.mode="span"),n.stroke||(n.stroke=BASE_LINE_COLOR),n.className||(n.className="");var a=r+AXIS_TICK_LENGTH,i="span"===n.mode?-1*AXIS_TICK_LENGTH:r;return"tick"===n.mode&&"top"===n.pos&&(a=-1*AXIS_TICK_LENGTH,i=0),makeVertLine(e,t,a,i,{stroke:n.stroke,className:n.className,lineType:n.lineType})}function yMarker(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n.labelPos||(n.labelPos="right");var a=createSVG("text",{className:"chart-label",x:"left"===n.labelPos?LABEL_MARGIN:r-getStringWidth(t,5)-LABEL_MARGIN,y:0,dy:FONT_SIZE/-2+"px","font-size":FONT_SIZE+"px","text-anchor":"start",innerHTML:t+""}),i=makeHoriLine(e,"",0,r,{stroke:n.stroke||BASE_LINE_COLOR,className:n.className||"",lineType:n.lineType});return i.appendChild(a),i}function yRegion(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=e-t,o=createSVG("rect",{className:"bar mini",styles:{fill:"rgba(228, 234, 239, 0.49)",stroke:BASE_LINE_COLOR,"stroke-dasharray":r+", "+i},x:0,y:0,width:r,height:i});a.labelPos||(a.labelPos="right");var s=createSVG("text",{className:"chart-label",x:"left"===a.labelPos?LABEL_MARGIN:r-getStringWidth(n+"",4.5)-LABEL_MARGIN,y:0,dy:FONT_SIZE/-2+"px","font-size":FONT_SIZE+"px","text-anchor":"start",innerHTML:n+""}),l=createSVG("g",{transform:"translate(0, "+t+")"});return l.appendChild(o),l.appendChild(s),l}function datasetBar(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},l=getBarHeightAndYAttr(t,s.zeroLine),p=_slicedToArray(l,2),c=p[0],d=p[1];d-=o,0===c&&(c=s.minHeight,d-=s.minHeight);var u=createSVG("rect",{className:"bar mini",style:"fill: "+n,"data-point-index":i,x:e,y:d,width:r,height:c});if((a+="")||a.length){u.setAttribute("y",0),u.setAttribute("x",0);var f=createSVG("text",{className:"data-point-value",x:r/2,y:0,dy:FONT_SIZE/2*-1+"px","font-size":FONT_SIZE+"px","text-anchor":"middle",innerHTML:a}),_=createSVG("g",{"data-point-index":i,transform:"translate("+e+", "+d+")"});return _.appendChild(u),_.appendChild(f),_}return u}function datasetDot(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=createSVG("circle",{style:"fill: "+n,"data-point-index":i,cx:e,cy:t,r:r});if((a+="")||a.length){o.setAttribute("cy",0),o.setAttribute("cx",0);var s=createSVG("text",{className:"data-point-value",x:0,y:0,dy:FONT_SIZE/2*-1-r+"px","font-size":FONT_SIZE+"px","text-anchor":"middle",innerHTML:a}),l=createSVG("g",{"data-point-index":i,transform:"translate("+e+", "+t+")"});return l.appendChild(o),l.appendChild(s),l}return o}function getPaths(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=t.map(function(t,r){return e[r]+","+t}).join("L");n.spline&&(i=getSplineCurvePointsStr(e,t));var o=makePath("M"+i,"line-graph-path",r);if(n.heatline){var s=makeGradient(a.svgDefs,r);o.style.stroke="url(#"+s+")"}var l={path:o};if(n.regionFill){var p=makeGradient(a.svgDefs,r,!0),c="M"+e[0]+","+a.zeroLine+"L"+i+"L"+e.slice(-1)[0]+","+a.zeroLine;l.region=makePath(c,"region-fill","none","url(#"+p+")")}return l}function translate(e,t,r,n){var a="string"==typeof t?t:t.join(", ");return[e,{transform:r.join(", ")},n,STD_EASING,"translate",{transform:a}]}function translateVertLine(e,t,r){return translate(e,[r,0],[t,0],MARKER_LINE_ANIM_DUR)}function translateHoriLine(e,t,r){return translate(e,[0,r],[0,t],MARKER_LINE_ANIM_DUR)}function animateRegion(e,t,r,n){var a=t-r,i=e.childNodes[0];return[[i,{height:a,"stroke-dasharray":i.getAttribute("width")+", "+a},MARKER_LINE_ANIM_DUR,STD_EASING],translate(e,[0,n],[0,r],MARKER_LINE_ANIM_DUR)]}function animateBar(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=getBarHeightAndYAttr(r,(arguments.length>5&&void 0!==arguments[5]?arguments[5]:{}).zeroLine),o=_slicedToArray$2(i,2),s=o[0],l=o[1];return l-=a,"rect"!==e.nodeName?[[e.childNodes[0],{width:n,height:s},UNIT_ANIM_DUR,STD_EASING],translate(e,e.getAttribute("transform").split("(")[1].slice(0,-1),[t,l],MARKER_LINE_ANIM_DUR)]:[[e,{width:n,height:s,x:t,y:l},UNIT_ANIM_DUR,STD_EASING]]}function animateDot(e,t,r){return"circle"!==e.nodeName?[translate(e,e.getAttribute("transform").split("(")[1].slice(0,-1),[t,r],MARKER_LINE_ANIM_DUR)]:[[e,{cx:t,cy:r},UNIT_ANIM_DUR,STD_EASING]]}function animatePath(e,t,r,n,a){var i=[],o=r.map(function(e,r){return t[r]+","+e}).join("L");a&&(o=getSplineCurvePointsStr(t,r));var s=[e.path,{d:"M"+o},PATH_ANIM_DUR,STD_EASING];if(i.push(s),e.region){var l=t[0]+","+n+"L",p="L"+t.slice(-1)[0]+", "+n,c=[e.region,{d:"M"+l+o+p},PATH_ANIM_DUR,STD_EASING];i.push(c)}return i}function animatePathStr(e,t){return[e,{d:t},UNIT_ANIM_DUR,STD_EASING]}function _toConsumableArray$1(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function animateSVGElement(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"linear",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.cloneNode(!0),s=e.cloneNode(!0);for(var l in t){var p=void 0;p="transform"===l?document.createElementNS("http://www.w3.org/2000/svg","animateTransform"):document.createElementNS("http://www.w3.org/2000/svg","animate");var c=i[l]||e.getAttribute(l),d=t[l],u={attributeName:l,from:c,to:d,begin:"0s",dur:r/1e3+"s",values:c+";"+d,keySplines:EASING[n],keyTimes:"0;1",calcMode:"spline",fill:"freeze"};for(var f in a&&(u.type=a),u)p.setAttribute(f,u[f]);o.appendChild(p),a?s.setAttribute(l,"translate("+d+")"):s.setAttribute(l,d)}return[o,s]}function transform(e,t){e.style.transform=t,e.style.webkitTransform=t,e.style.msTransform=t,e.style.mozTransform=t,e.style.oTransform=t}function animateSVG(e,t){var r=[],n=[];t.map(function(e){var t,a,i=e[0],o=i.parentNode;e[0]=i;var s=animateSVGElement.apply(void 0,_toConsumableArray$1(e)),l=_slicedToArray$1(s,2);t=l[0],a=l[1],r.push(a),n.push([t,o]),o.replaceChild(t,i)});var a=e.cloneNode(!0);return n.map(function(e,n){e[1].replaceChild(r[n],e[0]),t[n][0]=r[n]}),a}function runSMILAnimation(e,t,r){if(0!==r.length){var n=animateSVG(t,r);t.parentNode==e&&(e.removeChild(t),e.appendChild(n)),setTimeout(function(){n.parentNode==e&&(e.removeChild(n),e.appendChild(t))},REPLACE_ALL_NEW_DUR)}}function downloadFile(e,t){var r=document.createElement("a");r.style="display: none";var n=new Blob(t,{type:"image/svg+xml; charset=utf-8"}),a=window.URL.createObjectURL(n);r.href=a,r.download=e,document.body.appendChild(r),r.click(),setTimeout(function(){document.body.removeChild(r),window.URL.revokeObjectURL(a)},300)}function prepareForExport(e){var t=e.cloneNode(!0);t.classList.add("chart-container"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var r=$$1.create("style",{innerHTML:CSSTEXT});t.insertBefore(r,t.firstChild);var n=$$1.create("div");return n.appendChild(t),n.innerHTML}function _classCallCheck$3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$1(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits$1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function treatAsUtc(e){var t=new Date(e);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t}function getYyyyMmDd(e){var t=e.getDate(),r=e.getMonth()+1;return[e.getFullYear(),(r>9?"":"0")+r,(t>9?"":"0")+t].join("-")}function clone(e){return new Date(e.getTime())}function getWeeksBetween(e,t){var r=setDayToSunday(e);return Math.ceil(getDaysBetween(r,t)/NO_OF_DAYS_IN_WEEK)}function getDaysBetween(e,t){var r=SEC_IN_DAY*NO_OF_MILLIS;return(treatAsUtc(t)-treatAsUtc(e))/r}function areInSameMonth(e,t){return e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function getMonthName(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=MONTH_NAMES[e];return t?r.slice(0,3):r}function getLastDateInMonth(e,t){return new Date(t,e+1,0)}function setDayToSunday(e){var t=clone(e),r=t.getDay();return 0!==r&&addDays(t,-1*r),t}function addDays(e,t){e.setDate(e.getDate()+t)}function _classCallCheck$5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getComponent(e,t,r){var n=Object.keys(componentConfigs).filter(function(t){return e.includes(t)}),a=componentConfigs[n[0]];return Object.assign(a,{constants:t,getData:r}),new ChartComponent(a)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray$2(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck$6(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$2(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits$2(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray$4(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function normalize(e){if(0===e)return[0,0];if(isNaN(e))return{mantissa:-6755399441055744,exponent:972};var t=e>0?1:-1;if(!isFinite(e))return{mantissa:4503599627370496*t,exponent:972};e=Math.abs(e);var r=Math.floor(Math.log10(e));return[t*(e/Math.pow(10,r)),r]}function getChartRangeIntervals(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Math.ceil(e),n=Math.floor(t),a=r-n,i=a,o=1;a>5&&(a%2!=0&&(a=++r-n),i=a/2,o=2),a<=2&&(o=a/(i=4)),0===a&&(i=5,o=1);for(var s=[],l=0;l<=i;l++)s.push(n+o*l);return s}function getChartIntervals(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=normalize(e),n=_slicedToArray$4(r,2),a=n[0],i=n[1],o=t?t/Math.pow(10,i):0,s=getChartRangeIntervals(a=a.toFixed(6),o);return s.map(function(e){return e*Math.pow(10,i)})}function calcChartIntervals(e){function t(e,t){for(var r=getChartIntervals(e),n=r[1]-r[0],a=0,i=1;a<t;i++)a+=n,r.unshift(-1*a);return r}var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Math.max.apply(Math,_toConsumableArray$4(e)),a=Math.min.apply(Math,_toConsumableArray$4(e)),i=[];if(n>=0&&a>=0)normalize(n)[1],i=r?getChartIntervals(n,a):getChartIntervals(n);else if(n>0&&a<0){var o=Math.abs(a);n>=o?(normalize(n)[1],i=t(n,o)):(normalize(o)[1],i=t(o,n).map(function(e){return-1*e}))}else if(n<=0&&a<=0){var s=Math.abs(a),l=Math.abs(n);normalize(s)[1],i=(i=r?getChartIntervals(s,l):getChartIntervals(s)).reverse().map(function(e){return-1*e})}return i}function getZeroIndex(e){var t=getIntervalSize(e);return e.indexOf(0)>=0?e.indexOf(0):e[0]>0?-1*e[0]/t:-1*e[e.length-1]/t+(e.length-1)}function getIntervalSize(e){return e[1]-e[0]}function getValueRange(e){return e[e.length-1]-e[0]}function scale(e,t){return floatTwo(t.zeroLine-e*t.scaleMultiplier)}function getClosestInArray(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.reduce(function(t,r){return Math.abs(r-e)<Math.abs(t-e)?r:t},[]);return r?t.indexOf(n):n}function calcDistribution(e,t){for(var r=Math.max.apply(Math,_toConsumableArray$4(e)),n=1/(t-1),a=[],i=0;i<t;i++){var o=r*(n*i);a.push(o)}return a}function getMaxCheckpoint(e,t){return t.filter(function(t){return t<e}).length}function _toConsumableArray$3(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck$7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$3(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits$3(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray$6(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function dataPrep(e,t){e.labels=e.labels||[];var r=e.labels.length,n=e.datasets,a=new Array(r).fill(0);return n||(n=[{values:a}]),n.map(function(e){if(e.values){var n=e.values;n=(n=n.map(function(e){return isNaN(e)?0:e})).length>r?n.slice(0,r):fillArray(n,r-n.length,0)}else e.values=a;e.chartType||(e.chartType=t)}),e.yRegions&&e.yRegions.map(function(e){if(e.end<e.start){var t=[e.end,e.start];e.start=t[0],e.end=t[1]}}),e}function zeroDataPrep(e){var t=e.labels.length,r=new Array(t).fill(0),n={labels:e.labels.slice(0,-1),datasets:e.datasets.map(function(e){return{name:"",values:r.slice(0,-1),chartType:e.chartType}})};return e.yMarkers&&(n.yMarkers=[{value:0,label:""}]),e.yRegions&&(n.yRegions=[{start:0,end:0,label:""}]),n}function getShortenedLabels(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e/t.length;n<=0&&(n=1);var a=n/DEFAULT_CHAR_WIDTH,i=void 0;if(r){var o=Math.max.apply(Math,_toConsumableArray$6(t.map(function(e){return e.length})));i=Math.ceil(o/a)}return t.map(function(e,t){return(e+="").length>a&&(r?t%i!=0&&(e=""):e=a-3>0?e.slice(0,a-3)+" ...":e.slice(0,a)+".."),e})}function _toConsumableArray$5(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck$8(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$4(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits$4(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray$7(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck$9(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$5(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits$5(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getChartByType(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"line",t=arguments[1],r=arguments[2];return"axis-mixed"===e?(r.type="line",new AxisChart(t,r)):chartTypes[e]?new chartTypes[e](t,r):void console.error("Undefined chart type: "+e)}frappe.provide("frappe.components"),frappe.provide("frappe.chat.component"),frappe.components.Button=class extends Component{render(){var e=this.props,t=frappe.components.Button.SIZE[e.size];return h("button",Object.assign({},e,{class:"btn "+(t&&t.class)+" btn-"+e.type+" "+(e.block?"btn-block":"")+" "+(e.class?e.class:"")}),e.children)}},frappe.components.Button.SIZE={small:{class:"btn-sm"},large:{class:"btn-lg"}},frappe.components.Button.defaultProps={type:"default",block:!1},frappe.components.FAB=class extends frappe.components.Button{render(){var e=this.props,t=frappe.components.FAB.SIZE[e.size];return h(frappe.components.Button,Object.assign({},e,{class:e.class+" "+(t&&t.class)}),h("i",{class:e.icon}))}},frappe.components.FAB.defaultProps={icon:"octicon octicon-plus"},frappe.components.FAB.SIZE={small:{class:"frappe-fab-sm"},large:{class:"frappe-fab-lg"}},frappe.components.Indicator=class extends Component{render(){var e=this.props;return e.color?h("span",Object.assign({},e,{class:"indicator "+e.color})):null}},frappe.components.FontAwesome=class extends Component{render(){var e=this.props;return e.type?h("i",Object.assign({},e,{class:"fa "+(e.fixed?"fa-fw":"")+" fa-"+e.type+" "+e.class})):null}},frappe.components.FontAwesome.defaultProps={fixed:!1},frappe.components.Octicon=class extends Component{render(){var e=this.props;return e.type?h("i",Object.assign({},e,{class:"octicon octicon-"+e.type})):null}},frappe.components.Avatar=class extends Component{render(){var e=this.props,t=e.abbr||e.title.substr(0,1),r=frappe.components.Avatar.SIZE[e.size]||frappe.components.Avatar.SIZE.medium;return h("span",{class:"avatar "+r.class+" "+(e.class?e.class:"")},e.image?h("img",{class:"media-object",src:e.image}):h("div",{class:"standard-image"},t))}},frappe.components.Avatar.SIZE={small:{class:"avatar-small"},large:{class:"avatar-large"},medium:{class:"avatar-medium"}},frappe.Chat=class{constructor(e,t){"string"==typeof e||e instanceof $||e instanceof HTMLElement||(t=e,e=null),this.options=frappe.Chat.OPTIONS,this.set_wrapper(e||"body"),this.set_options(t),frappe.chat.emoji()}set_wrapper(e){return this.$wrapper=$(e),this}set_options(e){return this.options=Object.assign({},this.options,e),this}destroy(){return this.$wrapper.remove(".frappe-chat"),this}render(e){void 0===e&&(e={}),this.destroy();var t=this.$wrapper,r=this.options,n=h(frappe.Chat.Widget,Object.assign({},{layout:r.layout,target:r.target},e));return hyper_min.render(n,t[0]),this}},frappe.Chat.Layout={PAGE:"page",POPPER:"popper"},frappe.Chat.OPTIONS={layout:frappe.Chat.Layout.POPPER},frappe.Chat.Widget=class extends Component{constructor(e){super(e),this.setup(e),this.make()}setup(e){var t=this;this.room={},this.room.add=function(e){var r=(e=frappe._.as_array(e)).map(function(e){return e.name});frappe.log.info("Subscribing "+frappe.session.user+" to Chat Rooms "+r.join(", ")+"."),frappe.chat.room.subscribe(r);for(var n=[],a=0,i=e;a<i.length;a+=1){var o=i[a];(["Group","Visitor"].includes(o.type)||o.owner===frappe.session.user||o.last_message||o.users.includes(frappe.session.user))&&(frappe.log.info("Adding "+o.name+" to component."),n.push(o))}t.set_state({rooms:t.state.rooms.concat(n)})},this.room.update=function(e,r){var n=t.state,a=!1,i=n.rooms.map(function(t){if(t.name===e){if(a=!0,r.typing)if(frappe._.is_empty(t.typing))r.typing=frappe._.as_array(r.typing);else{var n=r.typing;t.typing.includes(n)||(r.typing=frappe._.copy_array(t.typing),r.typing.push(n))}return Object.assign({},t,r)}return t});if("Guest"!==frappe.session.user&&(a?t.set_state({rooms:i}):frappe.chat.room.get(e,function(e){return t.room.add(e)})),n.room.name===e){if(r.typing)if(frappe._.is_empty(n.room.typing))r.typing=frappe._.as_array(r.typing);else{var o=r.typing;n.room.typing.includes(o)||(r.typing=frappe._.copy_array(n.room.typing),r.typing.push(o))}var s=Object.assign({},n.room,r);t.set_state({room:s})}},this.room.select=function(e){frappe.chat.room.history(e,function(r){var n=t.state,a=n.rooms.find(function(t){return t.name===e});t.set_state({room:Object.assign({},n.room,a,{messages:r})})})},this.state=Object.assign({},frappe.Chat.Widget.defaultState,e)}make(){var e=this;"Guest"!==frappe.session.user?frappe.chat.profile.create(["status","message_preview","notification_tones","conversation_tones"]).then(function(t){e.set_state({profile:t}),frappe.chat.room.get(function(t){t=frappe._.as_array(t),frappe.log.info("User "+frappe.session.user+" is subscribed to "+t.length+" "+frappe._.pluralize("room",t.length)+"."),frappe._.is_empty(t)||e.room.add(t)}),e.bind()}):this.bind()}bind(){var e=this;frappe.chat.profile.on.update(function(t,r){if(frappe.log.warn("TRIGGER: Chat Profile update "+JSON.stringify(r)+" of User "+t+"."),"status"in r)if(t===frappe.session.user)e.set_state({profile:Object.assign({},e.state.profile,{status:r.status})});else{var n='<span class="indicator '+frappe.chat.profile.STATUSES.find(function(e){return e.name===r.status}).color+'"/> '+frappe.user.full_name(t)+" is currently <b>"+r.status+"</b>";frappe.show_alert(n,3)}}),frappe.chat.room.on.create(function(t){frappe.log.warn("TRIGGER: Chat Room "+t.name+" created."),e.room.add(t)}),frappe.chat.room.on.update(function(t,r){frappe.log.warn("TRIGGER: Chat Room "+t+" update "+JSON.stringify(r)+" recieved."),e.room.update(t,r)}),frappe.chat.room.on.typing(function(t,r){r!==frappe.session.user&&(frappe.log.warn("User "+r+" typing in Chat Room "+t+"."),e.room.update(t,{typing:r}),setTimeout(function(){return e.room.update(t,{typing:null})},5e3))}),frappe.chat.message.on.create(function(t){var r=e.state;if(r.room.name?r.profile.conversation_tones&&frappe.chat.sound.play("message"):r.profile.notification_tones&&frappe.chat.sound.play("notification"),t.user!==frappe.session.user&&r.profile.message_preview&&!r.toggle){$("body").find(".frappe-chat-alert").remove();var n='\n\t\t\t\t<span data-action="show-message" class="cursor-pointer">\n\t\t\t\t\t<span class="indicator yellow"/>\n\t\t\t\t\t\t<span class="avatar avatar-small">\n\t\t\t\t\t\t\t<span class="avatar-frame" style="background-image: url('+frappe.user.image(t.user)+')"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<b>'+frappe.user.first_name(t.user)+"</b>: "+t.content+"\n\t\t\t\t</span>\n\t\t\t\t";frappe.show_alert(n,15,{"show-message":function(e){this.room.select(e.room),this.base.firstChild._component.toggle()}.bind(e,t)}),frappe.notify(""+frappe.user.first_name(t.user),{body:t.content,icon:frappe.user.image(t.user),tag:t.user})}if(t.room===r.room.name){var a=frappe._.copy_array(r.room.messages);a.push(t),e.set_state({room:Object.assign({},r.room,{messages:a})})}}),frappe.chat.message.on.update(function(e,t){frappe.log.warn("TRIGGER: Chat Message "+e+" update "+JSON.stringify(t)+" recieved.")})}render(){var e=this,t=this.props,r=this.state,n=this,a=h(frappe.Chat.Widget.ActionBar,{placeholder:__("Search or Create a New Chat"),class:"level",layout:t.layout,actions:frappe._.compact([{label:__("New"),onclick:function(){var e=new frappe.ui.Dialog({title:__("New Chat"),fields:[{label:__("Chat Type"),fieldname:"type",fieldtype:"Select",options:["Group","Direct Chat"],default:"Group",onchange:function(){var t="Group"===e.get_value("type");e.set_df_property("group_name","reqd",t),e.set_df_property("user","reqd",!t)}},{label:__("Group Name"),fieldname:"group_name",fieldtype:"Data",reqd:!0,depends_on:"eval:doc.type == 'Group'"},{label:__("Users"),fieldname:"users",fieldtype:"MultiSelect",options:frappe.user.get_emails(),depends_on:"eval:doc.type == 'Group'"},{label:__("User"),fieldname:"user",fieldtype:"Link",options:"User",depends_on:"eval:doc.type == 'Direct Chat'"}],action:{primary:{label:__("Create"),onsubmit:function(t){if("Group"===t.type){if(!frappe._.is_empty(t.users)){var r=t.group_name,n=e.fields_dict.users.get_values();frappe.chat.room.create("Group",null,n,r)}}else{var a=t.user;frappe.chat.room.create("Direct",null,a)}e.hide()}}}});e.show()}},frappe._.is_mobile()&&{icon:"octicon octicon-x",class:"frappe-chat-close",onclick:function(){return e.set_state({toggle:!1})}}],Boolean),change:function(e){n.set_state({query:e})},span:function(e){n.set_state({span:e})}}),i=[];if("user_info"in frappe.boot)for(var o=0,s=frappe.user.get_emails();o<s.length;o+=1){for(var l=s[o],p=!1,c=0,d=r.rooms;c<d.length;c+=1){var u=d[c];"Direct"===u.type&&(u.owner!==l&&frappe._.squash(u.users)!==l||(p=!0))}p||i.push({owner:frappe.session.user,users:[l]})}var f=r.query?frappe.chat.room.search(r.query,r.rooms.concat(i)):frappe.chat.room.sort(r.rooms),_=r.span?frappe.Chat.Layout.PAGE:frappe.Chat.Layout.POPPER,m=frappe._.is_empty(f)&&!r.query?h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h("p","",__("You don't have any messages yet.")))):h(frappe.Chat.Widget.RoomList,{rooms:f,click:function(t){t.name?e.room.select(t.name):frappe.chat.room.create("Direct",t.owner,frappe._.squash(t.users),function(t){var r=t.name;return e.room.select(r)})}}),g=h(frappe.Chat.Widget.Room,Object.assign({},r.room,{layout:_,destroy:function(){e.set_state({room:{name:null,messages:[]}})}})),v=_===frappe.Chat.Layout.POPPER?h(frappe.Chat.Widget.Popper,{heading:a,page:r.room.name&&g,target:t.target,toggle:function(t){return e.set_state({toggle:t})}},m):h("div",{class:"frappe-chat-popper"},h("div",{class:"frappe-chat-popper-collapse"},h("div",{class:"panel panel-default panel-span",style:{width:"25%"}},h("div",{class:"panel-heading"},a),m),g));return h("div",{class:"frappe-chat"},v)}},frappe.Chat.Widget.defaultState={query:"",profile:{},rooms:[],room:{name:null,messages:[],typing:[]},toggle:!1,span:!1},frappe.Chat.Widget.defaultProps={layout:frappe.Chat.Layout.POPPER},frappe.Chat.Widget.Popper=class extends Component{constructor(e){super(e),this.setup(e)}setup(e){var t=this;this.toggle=this.toggle.bind(this),this.state=frappe.Chat.Widget.Popper.defaultState,e.target&&$(e.target).click(function(){return t.toggle()}),frappe.chat.widget=this}toggle(e){var t;t=1===arguments.length?e:!this.state.active,this.set_state({active:t}),this.props.toggle(t)}on_mounted(){var e=this;$(document.body).on("click",".page-container, .frappe-chat-close",function(t){t.currentTarget;e.toggle(!1)})}render(){var e=this,t=this.props,r=this.state;return r.destroy?null:h("div",{class:"frappe-chat-popper",style:t.target?null:{"margin-bottom":"80px"}},t.target?null:h(frappe.components.FAB,{class:"frappe-fab",icon:r.active?"fa fa-fw fa-times":"font-heavy octicon octicon-comment",size:frappe._.is_mobile()?null:"large",type:"primary",onclick:function(){return e.toggle()}}),r.active?h("div",{class:"frappe-chat-popper-collapse"},t.page?t.page:h("div",{class:"panel panel-default "+(frappe._.is_mobile()?"panel-span":"")},h("div",{class:"panel-heading"},t.heading),t.children)):null)}},frappe.Chat.Widget.Popper.defaultState={active:!1,destroy:!1},frappe.Chat.Widget.ActionBar=class extends Component{constructor(e){super(e),this.change=this.change.bind(this),this.submit=this.submit.bind(this),this.state=frappe.Chat.Widget.ActionBar.defaultState}change(e){var t,r=this.props,n=this.state;this.set_state(((t={})[e.target.name]=e.target.value,t)),r.change(n.query)}submit(e){var t=this.props,r=this.state;e.preventDefault(),t.submit(r.query)}render(){var e=this,t=this.props,r=this.state,n=t.actions;return h("div",{class:"frappe-chat-action-bar "+(t.class?t.class:"")},h("form",{oninput:this.change,onsubmit:this.submit},h("input",{autocomplete:"off",class:"form-control input-sm",name:"query",value:r.query,placeholder:t.placeholder||"Search"})),frappe._.is_empty(n)?null:n.map(function(e){return h(frappe.Chat.Widget.ActionBar.Action,Object.assign({},e))}),frappe._.is_mobile()?null:h(frappe.Chat.Widget.ActionBar.Action,{icon:"octicon octicon-screen-"+(r.span?"normal":"full"),onclick:function(){var n=!r.span;e.set_state({span:n}),t.span(n)}}))}},frappe.Chat.Widget.ActionBar.defaultState={query:null,span:!1},frappe.Chat.Widget.ActionBar.Action=class extends Component{render(){var e=this.props;return h(frappe.components.Button,Object.assign({},{size:"small",class:"btn-action"},e),e.icon?h("i",{class:e.icon}):null,(e.icon?" ":"")+(e.label?e.label:""))}},frappe.Chat.Widget.RoomList=class extends Component{render(){var e=this.props,t=e.rooms;return frappe._.is_empty(t)?null:h("ul",{class:"frappe-chat-room-list nav nav-pills nav-stacked"},t.map(function(t){return h(frappe.Chat.Widget.RoomList.Item,Object.assign({},t,{click:e.click}))}))}},frappe.Chat.Widget.RoomList.Item=class extends Component{render(){var e=this.props,t={};if("Group"===e.type)if(t.title=e.room_name,t.image=e.avatar,frappe._.is_empty(e.typing)){if(e.last_message){var r=e.last_message,n=r.content;"File"===r.type?t.subtitle="📁 "+n.name:t.subtitle=e.last_message.content}}else{e.typing=frappe._.as_array(e.typing);var a=e.typing.map(function(e){return frappe.user.first_name(e)});t.subtitle=a.join(", ")+" typing..."}else{var i=e.owner===frappe.session.user?frappe._.squash(e.users):e.owner;if(t.title=frappe.user.full_name(i),t.image=frappe.user.image(i),t.abbr=frappe.user.abbr(i),frappe._.is_empty(e.typing)){if(e.last_message){var o=e.last_message,s=o.content;"File"===o.type?t.subtitle="📁 "+s.name:t.subtitle=e.last_message.content}}else t.subtitle="typing..."}var l=!1;return e.last_message&&(t.timestamp=frappe.chat.pretty_datetime(e.last_message.creation),l=!e.last_message.seen.includes(frappe.session.user)),h("li",null,h("a",{class:e.active?"active":"",onclick:function(){e.last_message&&frappe.chat.message.seen(e.last_message.name),e.click(e)}},h("div",{class:"row"},h("div",{class:"col-xs-9"},h(frappe.Chat.Widget.MediaProfile,Object.assign({},t))),h("div",{class:"col-xs-3 text-right"},[h("div",{class:"text-muted",style:{"font-size":"9px"}},t.timestamp),l?h("span",{class:"indicator red"}):null]))))}},frappe.Chat.Widget.MediaProfile=class extends Component{render(){var e=this.props,t=frappe.Chat.Widget.MediaProfile.POSITION[e.position||"left"],r=h("div",{class:t.class+" media-middle"},h(frappe.components.Avatar,Object.assign({},e,{title:e.title,image:e.image,size:e.size,abbr:e.abbr})));return h("div",{class:"media",style:"media-right"===t.class?{"text-align":"right"}:null},"media-left"===t.class?r:null,h("div",{class:"media-body"},h("div",{class:"media-heading ellipsis small",style:"max-width: "+(e.width_title||"100%")+" display: inline-block"},e.title),e.content?h("div","",h("small","",e.content)):null,e.subtitle?h("div",{class:"media-subtitle small"},h("small",{class:"text-muted"},e.subtitle)):null),"media-right"===t.class?r:null)}},frappe.Chat.Widget.MediaProfile.POSITION={left:{class:"media-left"},right:{class:"media-right"}},frappe.Chat.Widget.Room=class extends Component{render(){var e=this.props,t=(this.state,[{match:/@(\w*)$/,search:function(t,r){if("Group"===e.type){var n=t.slice(1);r([].concat(frappe._.as_array(e.owner),e.users).filter(function(e){return e!==frappe.session.user&&0===e.indexOf(n)}))}},component:function(e){return h(frappe.Chat.Widget.MediaProfile,{title:frappe.user.full_name(e),image:frappe.user.image(e),size:"small"})}},{match:/:([a-z]*)$/,search:function(e,t){frappe.chat.emoji(function(r){for(var n=e.slice(1),a=[],i=0,o=r;i<o.length;i+=1)for(var s=o[i],l=0,p=s.aliases;l<p.length;l+=1){var c=p[l];0===c.indexOf(n)&&a.push({name:c,value:s.emoji})}t(a)})},content:function(e){return e.value},component:function(e){return h(frappe.Chat.Widget.MediaProfile,{title:e.name,abbr:e.value,size:"small"})}}]),r=frappe._.compact([!frappe._.is_mobile()&&{icon:"camera",label:"Camera",onclick:function(){var e=new frappe.ui.Capture({animate:!1,error:!0});e.show(),e.submit(function(e){})}},{icon:"file",label:"File",onclick:function(){new frappe.ui.FileUploader({doctype:"Chat Room",docname:e.name,on_success:function(t){var r=t.file_url,n=t.filename;frappe.chat.message.send(e.name,{path:r,name:n},"File")}})}}]);if("Guest"!==frappe.session.user&&e.messages){e.messages=frappe._.as_array(e.messages);for(var n=0,a=e.messages;n<a.length;n+=1){var i=a[n];if(i.seen.includes(frappe.session.user))break;frappe.chat.message.seen(i.name)}}return h("div",{class:"panel panel-default\n\t\t\t\t"+(e.name?"panel-bg":"")+"\n\t\t\t\t"+(e.layout===frappe.Chat.Layout.PAGE||frappe._.is_mobile()?"panel-span":""),style:e.layout===frappe.Chat.Layout.PAGE&&{width:"75%",left:"25%","box-shadow":"none"}},e.name&&h(frappe.Chat.Widget.Room.Header,Object.assign({},e,{on_back:e.destroy})),e.name?frappe._.is_empty(e.messages)?h("div",{class:"panel-body",style:{height:"100%"}},h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h(frappe.components.Octicon,{type:"comment-discussion",style:"font-size: 48px"}),h("p","",__("Start a conversation."))))):h(frappe.chat.component.ChatList,{messages:e.messages}):h("div",{class:"panel-body",style:{height:"100%"}},h("div",{class:"vcenter"},h("div",{class:"text-center text-extra-muted"},h(frappe.components.Octicon,{type:"comment-discussion",style:"font-size: 125px"}),h("p","",__("Select a chat to start messaging."))))),e.name?h("div",{class:"chat-room-footer"},h(frappe.chat.component.ChatForm,{actions:r,onchange:function(){frappe.chat.message.typing(e.name)},onsubmit:function(t){frappe.chat.message.send(e.name,t)},hint:t})):null)}},frappe.Chat.Widget.Room.Header=class extends Component{render(){var e=this.props,t={};if(["Group","Visitor"].includes(e.type))if(t.route="Form/Chat Room/"+e.name,t.title=e.room_name,t.image=e.avatar,frappe._.is_empty(e.typing))t.subtitle="Group"===e.type?__(e.users.length+" "+frappe._.pluralize("member",e.users.length)):"";else{e.typing=frappe._.as_array(e.typing);var r=e.typing.map(function(e){return frappe.user.first_name(e)});t.subtitle=r.join(", ")+" typing..."}else{var n=e.owner===frappe.session.user?frappe._.squash(e.users):e.owner;t.route="Form/User/"+n,t.title=frappe.user.full_name(n),t.image=frappe.user.image(n),frappe._.is_empty(e.typing)||(t.subtitle="typing...")}var a=e.layout===frappe.Chat.Layout.POPPER||frappe._.is_mobile();return h("div",{class:"panel-heading",style:{height:"50px"}},h("div",{class:"level"},a&&"Guest"!==frappe.session.user?h(frappe.components.Button,{class:"btn-back",onclick:e.on_back},h(frappe.components.Octicon,{type:"chevron-left"})):null,h("div","",h("div",{class:"panel-title"},h("div",{class:"cursor-pointer",onclick:function(){"Guest"!==frappe.session.user&&frappe.set_route(t.route)}},h(frappe.Chat.Widget.MediaProfile,Object.assign({},t))))),h("div",{class:a?"col-xs-2":"col-xs-3"},h("div",{class:"text-right"},frappe._.is_mobile()&&h(frappe.components.Button,{class:"frappe-chat-close",onclick:e.toggle},h(frappe.components.Octicon,{type:"x"}))))))}},frappe.chat.component.ChatList=class extends Component{on_mounted(){this.$element=$(".frappe-chat").find(".chat-list"),this.$element.scrollTop(this.$element[0].scrollHeight)}on_updated(){this.$element.scrollTop(this.$element[0].scrollHeight)}render(){for(var e=[],t=0;t<this.props.messages.length;++t){var r=this.props.messages[t];r.user,frappe.session.user;0!==t&&frappe.datetime.equal(r.creation,this.props.messages[t-1].creation,"day")||e.push({type:"Notification",content:r.creation.format("MMMM DD")}),e.push(r)}return h("div",{class:"chat-list list-group"},frappe._.is_empty(e)?null:e.map(function(e){return h(frappe.chat.component.ChatList.Item,Object.assign({},e))}))}},frappe.chat.component.ChatList.Item=class extends Component{render(){var e=this.props,t=e.user===frappe.session.user,r=e.content;return h("div",{class:"chat-list-item list-group-item"},"Notification"===e.type?h("div",{class:"chat-list-notification"},h("div",{class:"chat-list-notification-content"},r)):h("div",{class:t?"text-right":""},"Group"!==e.room_type||t?null:h(frappe.components.Avatar,{title:frappe.user.full_name(e.user),image:frappe.user.image(e.user)}),h(frappe.chat.component.ChatBubble,e)))}},frappe.chat.component.ChatBubble=class extends Component{constructor(e){super(e),this.onclick=this.onclick.bind(this)}onclick(){var e=this.props;e.user===frappe.session.user&&frappe.quick_edit("Chat Message",e.name,function(e){})}render(){var e=this.props,t=e.creation.format("hh:mm A"),r=e.user===frappe.session.user,n=!frappe._.is_empty(e.seen)&&!e.seen.includes(frappe.session.user),a=e.content;return h("div",{class:"chat-bubble "+(e.groupable?"chat-groupable":"")+" chat-bubble-"+(r?"r":"l"),onclick:this.onclick},"Group"!==e.room_type||r?null:h("div",{class:"chat-bubble-author"},h("a",{onclick:function(){frappe.set_route("Form/User/"+e.user)}},frappe.user.full_name(e.user))),h("div",{class:"chat-bubble-content"},h("small","","File"===e.type?h("a",{class:"no-decoration",href:a.path,target:"_blank"},h(frappe.components.FontAwesome,{type:"file",fixed:!0})," "+a.name):a)),h("div",{class:"chat-bubble-meta"},h("span",{class:"chat-bubble-creation"},t),r&&n?h("span",{class:"chat-bubble-check"},h(frappe.components.Octicon,{type:"check"})):null))}},frappe.chat.component.ChatForm=class extends Component{constructor(e){super(e),this.onchange=this.onchange.bind(this),this.onsubmit=this.onsubmit.bind(this),this.hint=this.hint.bind(this),this.state=frappe.chat.component.ChatForm.defaultState}onchange(e){var t,r=this.props,n=this.state,a=e.target.value;this.set_state(((t={})[e.target.name]=a,t)),r.onchange(n),this.hint(a)}hint(e){var t=this,r=this.props;this.state;if(r.hint){var n=e.split(" "),a=n.slice(0,n.length-1),i=n[n.length-1];if(i){r.hint=frappe._.as_array(r.hint);var o=r.hint.find(function(e){return e.match.test(i)});o?o.search(i,function(e){var r=e.map(function(e){var t=i.replace(o.match,o.content?o.content(e):e),r=(a.join(" ")+" "+t).trim();return e={component:o.component(e),content:r}}).slice(0,o.max||5);t.set_state({hints:r})}):this.set_state({hints:[]})}else this.set_state({hints:[]})}}onsubmit(e){e.preventDefault(),this.state.content&&(this.props.onsubmit(this.state.content),this.set_state({content:null}))}render(){var e=this,t=this.props,r=this.state;return h("div",{class:"chat-form"},r.hints.length?h("ul",{class:"hint-list list-group"},r.hints.map(function(t){return h("li",{class:"hint-list-item list-group-item"},h("a",{href:"javascript:void(0)",onclick:function(){e.set_state({content:t.content,hints:[]})}},t.component))})):null,h("form",{oninput:this.onchange,onsubmit:this.onsubmit},h("div",{class:"input-group input-group-lg"},frappe._.is_empty(t.actions)?null:h("div",{class:"input-group-btn dropup"},h(frappe.components.Button,{class:"Guest"===frappe.session.user?"disabled":"dropdown-toggle","data-toggle":"dropdown"},h(frappe.components.FontAwesome,{class:"text-muted",type:"paperclip",fixed:!0})),h("div",{class:"dropdown-menu dropdown-menu-left",onclick:function(e){return e.stopPropagation()}},!frappe._.is_empty(t.actions)&&t.actions.map(function(e){return h("li",null,h("a",{onclick:e.onclick},h(frappe.components.FontAwesome,{type:e.icon,fixed:!0})," "+e.label))}))),h("textarea",{class:"form-control",name:"content",value:r.content,placeholder:"Type a message",autofocus:!0,onkeypress:function(t){t.which!==frappe.ui.keycode.RETURN||t.shiftKey||e.onsubmit(t)}}),h("div",{class:"input-group-btn"},h(frappe.components.Button,{onclick:this.onsubmit},h(frappe.components.FontAwesome,{class:frappe._.is_empty(r.content)?"text-muted":"text-primary",type:"send",fixed:!0}))))))}},frappe.chat.component.ChatForm.defaultState={content:null,hints:[]},frappe.chat.component.EmojiPicker=class extends Component{render(){var e=this.props;return h("div",{class:"frappe-chat-emoji dropup "+e.class},h(frappe.components.Button,{type:"primary",class:"dropdown-toggle","data-toggle":"dropdown"},h(frappe.components.FontAwesome,{type:"smile-o",fixed:!0})),h("div",{class:"dropdown-menu dropdown-menu-right",onclick:function(e){return e.stopPropagation()}},h("div",{class:"panel panel-default"},h(frappe.chat.component.EmojiPicker.List))))}},frappe.chat.component.EmojiPicker.List=class extends Component{render(){this.props;return h("div",{class:"list-group"})}},frappe.provide("frappe._"),frappe._.platform=function(){var e=navigator.appVersion;return e.includes("Win")?"Windows":e.includes("Mac")?"Darwin":e.includes("X11")?"UNIX":e.includes("Linux")?"Linux":void 0},frappe.provide("frappe.assets"),frappe.assets.image=function(e,t){return void 0===t&&(t="frappe"),"/assets/"+t+"/images/"+e},frappe.provide("frappe.boot"),frappe.provide("frappe.browser"),frappe.browser.Notification="Notification"in window,frappe.notify=function(e,t){frappe.log=frappe.Logger.get("frappe.notify");var r={icon:frappe.assets.image("favicon.png","frappe"),lang:frappe.boot.lang||"en"};t=Object.assign({},r,t),frappe.browser.Notification||frappe.log.error("ERROR: This browser does not support desktop notifications."),Notification.requestPermission(function(r){if("granted"===r)new Notification(e,t)})},frappe.chat.render=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!1),frappe.log.info((e?"Enable":"Disable")+" Chat for User.");var r="desk"in frappe;if(r){var n=$(".navbar .frappe-chat-dropdown");if(frappe.utils.is_empty(n.has(".frappe-chat-toggle"))){var a=$('\n\t\t\t\t<a class="dropdown-toggle frappe-chat-toggle" data-toggle="dropdown">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<i class="octicon octicon-comment-discussion"/>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t');n.addClass("dropdown hidden"),n.html(a)}e?n.removeClass("hidden"):n.addClass("hidden")}if((!frappe.chatter||t)&&(frappe.chatter=new frappe.Chat({target:r?".frappe-chat-toggle":null}),e))if("Guest"!==frappe.session.user||r)frappe.chatter.render();else{frappe.store=frappe.Store.get("frappe.chat");var i=frappe.store.get("guest_token");frappe.log.info("Local Guest Token - "+i);var o=function(e){return new Promise(function(t){frappe.chat.room.create("Visitor",e).then(function(e){frappe.log.info("Visitor Room Created: "+e.name),frappe.chat.room.subscribe(e.name);var r=e;frappe.chat.room.history(e.name).then(function(e){return Object.assign({},r,{messages:e})}).then(function(e){t(e)})})})};i?o(i).then(function(e){frappe.chatter.render({room:e})}):frappe.chat.website.token().then(function(e){frappe.log.info("Generated Guest Token - "+e),frappe.store.set("guest_token",e),o(e).then(function(e){frappe.chatter.render({room:e})})})}},frappe.chat.setup=function(){frappe.log=frappe.Logger.get("frappe.chat"),frappe.log.info("Setting up frappe.chat"),frappe.log.warn("TODO: frappe.chat.<object> requires a storage."),"Guest"!==frappe.session.user?(frappe.log.info("Creating a Chat Profile."),frappe.chat.profile.create("enable_chat").then(function(e){var t=e.enable_chat;if(frappe.log.info("Chat Profile created for User "+frappe.session.user+"."),"desk"in frappe&&frappe.sys_defaults){var r=Boolean(parseInt(frappe.sys_defaults.enable_chat))&&t;frappe.chat.render(r)}}),frappe.chat.profile.on.update(function(e,t){if(e===frappe.session.user&&"enable_chat"in t){frappe.log.warn("Chat Profile update (Enable Chat - "+Boolean(t.enable_chat)+")");var r=Boolean(parseInt(frappe.sys_defaults.enable_chat))&&t.enable_chat;frappe.chat.render(r)}})):(frappe.log.info("Retrieving Chat Website Settings."),frappe.chat.website.settings(["socketio","enable","enable_from","enable_to"]).then(function(e){frappe.log.info("Chat Website Setting - "+JSON.stringify(e)),frappe.log.info("Chat Website Setting - "+(e.enable?"Enable":"Disable"));var t=e.enable;e.enable_from&&e.enable_to&&(frappe.log.info("Enabling Chat Schedule - "+e.enable_from.format()+" : "+e.enable_to.format()),t=new frappe.datetime.range(e.enable_from,e.enable_to).contains(frappe.datetime.now()));t&&(frappe.log.info("Initializing Socket.IO"),frappe.socketio.init(e.socketio.port)),frappe.chat.render(t)}))},$(document).on("ready toolbar_setup",function(){frappe.chat.setup()}),frappe.views.SocialFactory=class extends frappe.views.Factory{show(){frappe.pages.social?frappe.container.change_to("social"):this.make("social")}make(e){var t=this;frappe.require(["/assets/js/social.min.js"],function(){frappe.social.home=new frappe.social.Home({parent:t.make_page(!0,e)})})}},frappe.provide("frappe.energy_points"),Object.assign(frappe.energy_points,{get_points:function(e){return'<span class="bold" style="color: '+(e>=0?"#45A163":"#e42121")+'">\n\t\t\t'+(e>0?"+":"")+e+"\n\t\t</span>"},format_form_log:function(e){return"<span>\n\t\t\t"+this.get_points(e.points)+'&nbsp;\n\t\t\t<a href="#Form/Energy Point Log/'+e.name+'">'+this.get_form_log_message(e)+"</a>\n\t\t\t"+(e.reason?"<span>&nbsp;-&nbsp;</span>"+e.reason:"")+"\n\t\t</span>"},format_history_log:function(e){var t=frappe.utils.get_form_link(e.reference_doctype,e.reference_name);return"<span>\n\t\t\t"+this.get_points(e.points)+'&nbsp;\n\t\t\t<a href="'+t+'" class="text-muted">'+this.get_history_log_message(e)+"</a>\n\t\t\t"+(e.reason?"<span>&nbsp;-&nbsp;</span>"+e.reason:"")+"\n\t\t\t<span>&nbsp;-&nbsp;</span>"+frappe.datetime.comment_when(e.creation)+"\n\t\t</span>"},get_history_log_message:function(e){var t=frappe.user.full_name(e.owner).bold(),r=e.reference_name;return"Appreciation"===e.type?__("{0} appreciated on {1}",[t,r]):"Criticism"===e.type?__("{0} criticized on {1}",[t,r]):"Revert"===e.type?__("{0} reverted {1}",[t,e.revert_of]):__("via automatic rule {0} on {1}",[e.rule.bold(),r])},get_form_log_message:function(e){var t=frappe.user.full_name(e.owner).bold(),r=frappe.user.full_name(e.user).bold();return"Appreciation"===e.type?__("{0} appreciated {1}",[t,r]):"Criticism"===e.type?__("{0} criticized {1}",[t,r]):"Revert"===e.type?__("{0} reverted {1}",[t,e.revert_of]):__("gained by {0} via automatic rule {1}",[r,e.rule.bold()])}}),frappe.dashboard_utils={render_chart_filters:function(e,t,r,n){e.forEach(function(e){var a,i='<div class="'+t+' btn-group dropdown pull-right">\n\t\t\t\t\t<a class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n\t\t\t\t\t\t<button class="btn btn-default btn-xs">\n\t\t\t\t\t\t\t<span class="filter-label">'+e.label+'</span>\n\t\t\t\t\t\t\t<span class="caret"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t</a>';a=e.fieldnames?e.options.map(function(t,r){return'<li><a data-fieldname = "'+e.fieldnames[r]+'">'+t+"</a></li>"}).join(""):e.options.map(function(e){return"<li><a>"+e+"</a></li>"}).join("");var o=$(i+'<ul class="dropdown-menu">'+a+"</ul></div>");n?o.prependTo(r):o.appendTo(r),o.find(".dropdown-menu").on("click","li a",function(r){var n,a=$(r.currentTarget);a.attr("data-fieldname")&&(n=a.attr("data-fieldname"));var i=a.text();a.parents("."+t).find(".filter-label").text(i),e.action(i,n)})})},get_filters_for_chart_type:function(e){if("Custom"===e.chart_type&&e.source){return frappe.xcall("frappe.desk.doctype.dashboard_chart_source.dashboard_chart_source.get_config",{name:e.source}).then(function(t){return frappe.dom.eval(t),frappe.dashboards.chart_sources[e.source].filters})}return"Report"===e.chart_type&&e.report_name?frappe.report_utils.get_report_filters(e.report_name).then(function(e){return e}):Promise.resolve()},get_dashboard_settings:function(){var e=this;return frappe.db.get_list("Dashboard Settings",{filters:{name:frappe.session.user},fields:["*"]}).then(function(t){return t.length?t[0]:e.create_dashboard_settings().then(function(e){return e})})},create_dashboard_settings:function(){return frappe.xcall("frappe.desk.doctype.dashboard_settings.dashboard_settings.create_dashboard_settings",{user:frappe.session.user}).then(function(e){return e})},get_years_since_creation:function(e){for(var t=this.get_year(e),r=[],n=this.get_year(frappe.datetime.now_date());n>=t;n--)r.push(n);return r},get_year:function(e){return e.substring(0,e.indexOf("-"))},remove_common_static_filter_values:function(e,t){if(t)if($.isArray(e))e=e.filter(function(e){for(var r=0,n=t;r<n.length;r+=1){var a=n[r];if(e[0]==a[0]&&e[1]==a[1])return!1}return!0});else for(var r=0,n=Object.keys(t);r<n.length;r+=1){delete e[n[r]]}return e},get_fields_for_dynamic_filter_dialog:function(e,t,r){var n=[{fieldtype:"HTML",fieldname:"description",options:'<div>\n\t\t\t\t\t\t<p>Set dynamic filter values in JavaScript for the required fields here.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p>Ex:\n\t\t\t\t\t\t\t<code>frappe.defaults.get_user_default("Company")</code>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>'}];if(e)r&&(t=t.concat(r)),t.forEach(function(e){for(var t=0,r=n;t<r.length;t+=1){if(r[t].fieldname==e[0]+":"+e[1])return}"="==e[2]&&n.push({label:e[1]+" ("+e[0]+")",fieldname:e[0]+":"+e[1],fieldtype:"Data"})});else{t=Object.assign({},r,t);for(var a=0,i=Object.keys(t);a<i.length;a+=1){var o=i[a];n.push({label:o,fieldname:o,fieldtype:"Data"})}}return n},get_all_filters:function get_all_filters(doc){var filters=JSON.parse(doc.filters_json||"null"),dynamic_filters=JSON.parse(doc.dynamic_filters_json||"null");if(!dynamic_filters)return filters;if($.isArray(dynamic_filters))dynamic_filters.forEach(function(f){try{f[3]=eval(f[3])}catch(e){frappe.throw(__("Invalid expression set in filter "+f[1]+" ("+f[0]+")"))}}),filters=filters.concat(dynamic_filters);else{for(var i=0,list=Object.keys(dynamic_filters);i<list.length;i+=1){var key=list[i];try{var val=eval(dynamic_filters[key]);dynamic_filters[key]=val}catch(e){frappe.throw(__("Invalid expression set in filter "+key))}}Object.assign(filters,dynamic_filters)}return filters},get_dashboard_link_field:function(){var e={label:__("Select Dashboard"),fieldtype:"Link",fieldname:"dashboard",options:"Dashboard"};return frappe.boot.developer_mode||(e.get_query=function(){return{filters:{is_standard:0}}}),e},get_add_to_dashboard_dialog:function(e,t,r){var n=this.get_dashboard_link_field(),a=new frappe.ui.Dialog({title:__("Add to Dashboard"),fields:[n],primary_action:function(n){n.name=e,n.set_standard=frappe.boot.developer_mode,frappe.xcall(r,{args:n}).then(function(){var e='<a href = "#dashboard/'+n.dashboard+'">'+n.dashboard+"</a>",r=__(t+" "+n.name+" added to Dashboard "+e);frappe.msgprint(r)}),a.hide()}});return a}};var css_248z='.chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#555b51}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#6c7680;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ol,.graph-svg-tip ul{padding-left:0;display:-webkit-box;display:-ms-flexbox;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;-webkit-box-flex:1;-ms-flex:1;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:" ";border:5px solid transparent;border-top-color:rgba(0,0,0,.8)}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}';styleInject(css_248z);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};$$1.create=function(e,t){var r=document.createElement(e);for(var n in t){var a=t[n];if("inside"===n)$$1(a).appendChild(r);else if("around"===n){var i=$$1(a);i.parentNode.insertBefore(r,i),r.appendChild(i)}else"styles"===n?"object"===(void 0===a?"undefined":_typeof(a))&&Object.keys(a).map(function(e){r.style[e]=a[e]}):n in r?r[n]=a:r.setAttribute(n,a)}return r};var BASE_MEASURES={margins:{top:10,bottom:10,left:20,right:20},paddings:{top:20,bottom:40,left:30,right:10},baseHeight:240,titleHeight:20,legendHeight:30,titleFontSize:12},INIT_CHART_UPDATE_TIMEOUT=700,CHART_POST_ANIMATE_TIMEOUT=400,AXIS_LEGEND_BAR_SIZE=100,BAR_CHART_SPACE_RATIO=.5,MIN_BAR_PERCENT_HEIGHT=0,LINE_CHART_DOT_SIZE=4,DOT_OVERLAY_SIZE_INCR=4,PERCENTAGE_BAR_DEFAULT_HEIGHT=20,PERCENTAGE_BAR_DEFAULT_DEPTH=2,HEATMAP_DISTRIBUTION_SIZE=5,HEATMAP_SQUARE_SIZE=10,HEATMAP_GUTTER_SIZE=2,DEFAULT_CHAR_WIDTH=7,TOOLTIP_POINTER_TRIANGLE_HEIGHT=5,DEFAULT_CHART_COLORS=["light-blue","blue","violet","red","orange","yellow","green","light-green","purple","magenta","light-grey","dark-grey"],HEATMAP_COLORS_GREEN=["#ebedf0","#c6e48b","#7bc96f","#239a3b","#196127"],DEFAULT_COLORS={bar:DEFAULT_CHART_COLORS,line:DEFAULT_CHART_COLORS,pie:DEFAULT_CHART_COLORS,percentage:DEFAULT_CHART_COLORS,heatmap:HEATMAP_COLORS_GREEN,donut:DEFAULT_CHART_COLORS},ANGLE_RATIO=Math.PI/180,FULL_ANGLE=360,_createClass$3=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),SvgTip=function(){function e(t){var r=t.parent,n=void 0===r?null:r,a=t.colors,i=void 0===a?[]:a;_classCallCheck$4(this,e),this.parent=n,this.colors=i,this.titleName="",this.titleValue="",this.listValues=[],this.titleValueFirst=0,this.x=0,this.y=0,this.top=0,this.left=0,this.setup()}return _createClass$3(e,[{key:"setup",value:function(){this.makeTooltip()}},{key:"refresh",value:function(){this.fill(),this.calcPosition()}},{key:"makeTooltip",value:function(){var e=this;this.container=$$1.create("div",{inside:this.parent,className:"graph-svg-tip comparison",innerHTML:'<span class="title"></span>\n\t\t\t\t<ul class="data-point-list"></ul>\n\t\t\t\t<div class="svg-pointer"></div>'}),this.hideTip(),this.title=this.container.querySelector(".title"),this.dataPointList=this.container.querySelector(".data-point-list"),this.parent.addEventListener("mouseleave",function(){e.hideTip()})}},{key:"fill",value:function(){var e,t=this;this.index&&this.container.setAttribute("data-point-index",this.index),e=this.titleValueFirst?"<strong>"+this.titleValue+"</strong>"+this.titleName:this.titleName+"<strong>"+this.titleValue+"</strong>",this.title.innerHTML=e,this.dataPointList.innerHTML="",this.listValues.map(function(e,r){var n=t.colors[r]||"black",a=0===e.formatted||e.formatted?e.formatted:e.value,i=$$1.create("li",{styles:{"border-top":"3px solid "+n},innerHTML:'<strong style="display: block;">'+(0===a||a?a:"")+"</strong>\n\t\t\t\t\t"+(e.title?e.title:"")});t.dataPointList.appendChild(i)})}},{key:"calcPosition",value:function(){var e=this.container.offsetWidth;this.top=this.y-this.container.offsetHeight-TOOLTIP_POINTER_TRIANGLE_HEIGHT,this.left=this.x-e/2;var t=this.parent.offsetWidth-e,r=this.container.querySelector(".svg-pointer");if(this.left<0)r.style.left="calc(50% - "+-1*this.left+"px)",this.left=0;else if(this.left>t){var n="calc(50% + "+(this.left-t)+"px)";r.style.left=n,this.left=t}else r.style.left="50%"}},{key:"setValues",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;this.titleName=r.name,this.titleValue=r.value,this.listValues=n,this.x=e,this.y=t,this.titleValueFirst=r.valueFirst||0,this.index=a,this.refresh()}},{key:"hideTip",value:function(){this.container.style.top="0px",this.container.style.left="0px",this.container.style.opacity="0"}},{key:"showTip",value:function(){this.container.style.top=this.top+"px",this.container.style.left=this.left+"px",this.container.style.opacity="1"}}]),e}(),PRESET_COLOR_MAP={"light-blue":"#7cd6fd",blue:"#5e64ff",violet:"#743ee2",red:"#ff5858",orange:"#ffa00a",yellow:"#feef72",green:"#28a745","light-green":"#98d85b",purple:"#b554ff",magenta:"#ffa3ef",black:"#36114C",grey:"#bdd3e6","light-grey":"#f0f4f7","dark-grey":"#b8c2cc"},getColor=function(e){return PRESET_COLOR_MAP[e]||e},_slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},AXIS_TICK_LENGTH=6,LABEL_MARGIN=4,LABEL_MAX_CHARS=15,FONT_SIZE=10,BASE_LINE_COLOR="#dadada",FONT_FILL="#555b51",makeOverlay={bar:function(e){var t=void 0;"rect"!==e.nodeName&&(t=e.getAttribute("transform"),e=e.childNodes[0]);var r=e.cloneNode();return r.style.fill="#000000",r.style.opacity="0.4",t&&r.setAttribute("transform",t),r},dot:function(e){var t=void 0;"circle"!==e.nodeName&&(t=e.getAttribute("transform"),e=e.childNodes[0]);var r=e.cloneNode(),n=e.getAttribute("r"),a=e.getAttribute("fill");return r.setAttribute("r",parseInt(n)+DOT_OVERLAY_SIZE_INCR),r.setAttribute("fill",a),r.style.opacity="0.6",t&&r.setAttribute("transform",t),r},heat_square:function(e){var t=void 0;"circle"!==e.nodeName&&(t=e.getAttribute("transform"),e=e.childNodes[0]);var r=e.cloneNode(),n=e.getAttribute("r"),a=e.getAttribute("fill");return r.setAttribute("r",parseInt(n)+DOT_OVERLAY_SIZE_INCR),r.setAttribute("fill",a),r.style.opacity="0.6",t&&r.setAttribute("transform",t),r}},updateOverlay={bar:function(e,t){var r=void 0;"rect"!==e.nodeName&&(r=e.getAttribute("transform"),e=e.childNodes[0]);var n=["x","y","width","height"];Object.values(e.attributes).filter(function(e){return n.includes(e.name)&&e.specified}).map(function(e){t.setAttribute(e.name,e.nodeValue)}),r&&t.setAttribute("transform",r)},dot:function(e,t){var r=void 0;"circle"!==e.nodeName&&(r=e.getAttribute("transform"),e=e.childNodes[0]);var n=["cx","cy"];Object.values(e.attributes).filter(function(e){return n.includes(e.name)&&e.specified}).map(function(e){t.setAttribute(e.name,e.nodeValue)}),r&&t.setAttribute("transform",r)},heat_square:function(e,t){var r=void 0;"circle"!==e.nodeName&&(r=e.getAttribute("transform"),e=e.childNodes[0]);var n=["cx","cy"];Object.values(e.attributes).filter(function(e){return n.includes(e.name)&&e.specified}).map(function(e){t.setAttribute(e.name,e.nodeValue)}),r&&t.setAttribute("transform",r)}},_slicedToArray$2=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),UNIT_ANIM_DUR=350,PATH_ANIM_DUR=350,MARKER_LINE_ANIM_DUR=UNIT_ANIM_DUR,REPLACE_ALL_NEW_DUR=250,STD_EASING="easein",_slicedToArray$1=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),EASING={ease:"0.25 0.1 0.25 1",linear:"0 0 1 1",easein:"0.1 0.8 0.2 1",easeout:"0 0 0.58 1",easeinout:"0.42 0 0.58 1"},CSSTEXT=".chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#555b51}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#6c7680;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ul{padding-left:0;display:flex}.graph-svg-tip ol{padding-left:0;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:' ';border:5px solid transparent;border-top-color:rgba(0,0,0,.8)}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}",_createClass$2=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),BaseChart=function(){function e(t,r){if(_classCallCheck$3(this,e),this.parent="string"==typeof t?document.querySelector(t):t,!(this.parent instanceof HTMLElement))throw new Error("No `parent` element to render on was provided.");this.rawChartArgs=r,this.title=r.title||"",this.type=r.type||"",this.realData=this.prepareData(r.data),this.data=this.prepareFirstData(this.realData),this.colors=this.validateColors(r.colors,this.type),this.config={showTooltip:1,showLegend:1,isNavigable:r.isNavigable||0,animate:void 0!==r.animate?r.animate:1,truncateLegends:r.truncateLegends||1},this.measures=JSON.parse(JSON.stringify(BASE_MEASURES));var n=this.measures;this.setMeasures(r),this.title.length||(n.titleHeight=0),this.config.showLegend||(n.legendHeight=0),this.argHeight=r.height||n.baseHeight,this.state={},this.options={},this.initTimeout=INIT_CHART_UPDATE_TIMEOUT,this.config.isNavigable&&(this.overlays=[]),this.configure(r)}return _createClass$2(e,[{key:"prepareData",value:function(e){return e}},{key:"prepareFirstData",value:function(e){return e}},{key:"validateColors",value:function(e,t){var r=[];return(e=(e||[]).concat(DEFAULT_COLORS[t])).forEach(function(e){var t=getColor(e);isValidColor(t)?r.push(t):console.warn('"'+e+'" is not a valid color.')}),r}},{key:"setMeasures",value:function(){}},{key:"configure",value:function(){var e=this,t=this.argHeight;this.baseHeight=t,this.height=t-getExtraHeight(this.measures),this.boundDrawFn=function(){return e.draw(!0)},window.addEventListener("resize",this.boundDrawFn),window.addEventListener("orientationchange",this.boundDrawFn)}},{key:"destroy",value:function(){window.removeEventListener("resize",this.boundDrawFn),window.removeEventListener("orientationchange",this.boundDrawFn)}},{key:"setup",value:function(){this.makeContainer(),this.updateWidth(),this.makeTooltip(),this.draw(!1,!0)}},{key:"makeContainer",value:function(){this.parent.innerHTML="";var e={inside:this.parent,className:"chart-container"};this.independentWidth&&(e.styles={width:this.independentWidth+"px"}),this.container=$$1.create("div",e)}},{key:"makeTooltip",value:function(){this.tip=new SvgTip({parent:this.container,colors:this.colors}),this.bindTooltip()}},{key:"bindTooltip",value:function(){}},{key:"draw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&isHidden(this.parent)||(this.updateWidth(),this.calc(t),this.makeChartArea(),this.setupComponents(),this.components.forEach(function(t){return t.setup(e.drawArea)}),this.render(this.components,!1),r&&(this.data=this.realData,setTimeout(function(){e.update(e.data)},this.initTimeout)),this.renderLegend(),this.setupNavigation(r))}},{key:"calc",value:function(){}},{key:"updateWidth",value:function(){this.baseWidth=getElementContentWidth(this.parent),this.width=this.baseWidth-getExtraWidth(this.measures)}},{key:"makeChartArea",value:function(){this.svg&&this.container.removeChild(this.svg);var e=this.measures;this.svg=makeSVGContainer(this.container,"frappe-chart chart",this.baseWidth,this.baseHeight),this.svgDefs=makeSVGDefs(this.svg),this.title.length&&(this.titleEL=makeText("title",e.margins.left,e.margins.top,this.title,{fontSize:e.titleFontSize,fill:"#666666",dy:e.titleFontSize}));var t=getTopOffset(e);this.drawArea=makeSVGGroup(this.type+"-chart chart-draw-area","translate("+getLeftOffset(e)+", "+t+")"),this.config.showLegend&&(t+=this.height+e.paddings.bottom,this.legendArea=makeSVGGroup("chart-legend","translate("+getLeftOffset(e)+", "+t+")")),this.title.length&&this.svg.appendChild(this.titleEL),this.svg.appendChild(this.drawArea),this.config.showLegend&&this.svg.appendChild(this.legendArea),this.updateTipOffset(getLeftOffset(e),getTopOffset(e))}},{key:"updateTipOffset",value:function(e,t){this.tip.offset={x:e,y:t}}},{key:"setupComponents",value:function(){this.components=new Map}},{key:"update",value:function(e){e||console.error("No data to update."),this.data=this.prepareData(e),this.calc(),this.render(this.components,this.config.animate)}},{key:"render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.components,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.config.isNavigable&&this.overlays.map(function(e){return e.parentNode.removeChild(e)});var n=[];t.forEach(function(e){n=n.concat(e.update(r))}),n.length>0?(runSMILAnimation(this.container,this.svg,n),setTimeout(function(){t.forEach(function(e){return e.make()}),e.updateNav()},CHART_POST_ANIMATE_TIMEOUT)):(t.forEach(function(e){return e.make()}),this.updateNav())}},{key:"updateNav",value:function(){this.config.isNavigable&&(this.makeOverlay(),this.bindUnits())}},{key:"renderLegend",value:function(){}},{key:"setupNavigation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.config.isNavigable&&t&&(this.bindOverlay(),this.keyActions={13:this.onEnterKey.bind(this),37:this.onLeftArrow.bind(this),38:this.onUpArrow.bind(this),39:this.onRightArrow.bind(this),40:this.onDownArrow.bind(this)},document.addEventListener("keydown",function(t){isElementInViewport(e.container)&&(t=t||window.event,e.keyActions[t.keyCode]&&e.keyActions[t.keyCode]())}))}},{key:"makeOverlay",value:function(){}},{key:"updateOverlay",value:function(){}},{key:"bindOverlay",value:function(){}},{key:"bindUnits",value:function(){}},{key:"onLeftArrow",value:function(){}},{key:"onRightArrow",value:function(){}},{key:"onUpArrow",value:function(){}},{key:"onDownArrow",value:function(){}},{key:"onEnterKey",value:function(){}},{key:"addDataPoint",value:function(){}},{key:"removeDataPoint",value:function(){}},{key:"getDataPoint",value:function(){}},{key:"setCurrentDataPoint",value:function(){}},{key:"updateDataset",value:function(){}},{key:"export",value:function(){var e=prepareForExport(this.svg);downloadFile(this.title||"Chart",[e])}}]),e}(),_createClass$1=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get$1=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(n):void 0},AggregationChart=function(e){function t(e,r){return _classCallCheck$2(this,t),_possibleConstructorReturn$1(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return _inherits$1(t,BaseChart),_createClass$1(t,[{key:"configure",value:function(e){_get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"configure",this).call(this,e),this.config.maxSlices=e.maxSlices||20,this.config.maxLegendPoints=e.maxLegendPoints||20}},{key:"calc",value:function(){var e=this,t=this.state,r=this.config.maxSlices;t.sliceTotals=[];var n=this.data.labels.map(function(t,r){var n=0;return e.data.datasets.map(function(e){n+=e.values[r]}),[n,t]}).filter(function(e){return e[0]>=0}),a=n;if(n.length>r){n.sort(function(e,t){return t[0]-e[0]}),a=n.slice(0,r-1);var i=0;n.slice(r-1).map(function(e){i+=e[0]}),a.push([i,"Rest"]),this.colors[r-1]="grey"}t.labels=[],a.map(function(e){t.sliceTotals.push(e[0]),t.labels.push(e[1])}),t.grandTotal=t.sliceTotals.reduce(function(e,t){return e+t},0),this.center={x:this.width/2,y:this.height/2}}},{key:"renderLegend",value:function(){var e=this,t=this.state;this.legendArea.textContent="",this.legendTotals=t.sliceTotals.slice(0,this.config.maxLegendPoints);var r=0,n=0;this.legendTotals.map(function(a,i){var o=150,s=Math.floor((e.width-getExtraWidth(e.measures))/o);e.legendTotals.length<s&&(o=e.width/e.legendTotals.length),r>s&&(r=0,n+=20);var l=o*r+5,p=e.config.truncateLegends?truncateString(t.labels[i],o/10):t.labels[i],c=legendDot(l,n,5,e.colors[i],p+": "+a,!1);e.legendArea.appendChild(c),r++})}}]),t}(),NO_OF_YEAR_MONTHS=12,NO_OF_DAYS_IN_WEEK=7,NO_OF_MILLIS=1e3,SEC_IN_DAY=86400,MONTH_NAMES=["January","February","March","April","May","June","July","August","September","October","November","December"],DAY_NAMES_SHORT=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],_slicedToArray$3=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass$4=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),ChartComponent=function(){function e(t){var r=t.layerClass,n=void 0===r?"":r,a=t.layerTransform,i=void 0===a?"":a,o=t.constants,s=t.getData,l=t.makeElements,p=t.animateElements;_classCallCheck$5(this,e),this.layerTransform=i,this.constants=o,this.makeElements=l,this.getData=s,this.animateElements=p,this.store=[],this.labels=[],this.layerClass=n,this.layerClass="function"==typeof this.layerClass?this.layerClass():this.layerClass,this.refresh()}return _createClass$4(e,[{key:"refresh",value:function(e){this.data=e||this.getData()}},{key:"setup",value:function(e){this.layer=makeSVGGroup(this.layerClass,this.layerTransform,e)}},{key:"make",value:function(){this.render(this.data),this.oldData=this.data}},{key:"render",value:function(e){var t=this;this.store=this.makeElements(e),this.layer.textContent="",this.store.forEach(function(e){t.layer.appendChild(e)}),this.labels.forEach(function(e){t.layer.appendChild(e)})}},{key:"update",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.refresh();var t=[];return e&&(t=this.animateElements(this.data)||[]),t}}]),e}(),componentConfigs={donutSlices:{layerClass:"donut-slices",makeElements:function(e){return e.sliceStrings.map(function(t,r){var n=makePath(t,"donut-path",e.colors[r],"none",e.strokeWidth);return n.style.transition="transform .3s;",n})},animateElements:function(e){return this.store.map(function(t,r){return animatePathStr(t,e.sliceStrings[r])})}},pieSlices:{layerClass:"pie-slices",makeElements:function(e){return e.sliceStrings.map(function(t,r){var n=makePath(t,"pie-path","none",e.colors[r]);return n.style.transition="transform .3s;",n})},animateElements:function(e){return this.store.map(function(t,r){return animatePathStr(t,e.sliceStrings[r])})}},percentageBars:{layerClass:"percentage-bars",makeElements:function(e){var t=this;return e.xPositions.map(function(r,n){return percentageBar(r,0,e.widths[n],t.constants.barHeight,t.constants.barDepth,e.colors[n])})},animateElements:function(e){if(e)return[]}},yAxis:{layerClass:"y axis",makeElements:function(e){var t=this;return e.positions.map(function(r,n){return yLine(r,e.labels[n],t.constants.width,{mode:t.constants.mode,pos:t.constants.pos,shortenNumbers:t.constants.shortenNumbers})})},animateElements:function(e){var t=e.positions,r=e.labels,n=this.oldData.positions,a=this.oldData.labels,i=equilizeNoOfElements(n,t),o=_slicedToArray$3(i,2);n=o[0],t=o[1];var s=equilizeNoOfElements(a,r),l=_slicedToArray$3(s,2);return a=l[0],r=l[1],this.render({positions:n,labels:r}),this.store.map(function(e,r){return translateHoriLine(e,t[r],n[r])})}},xAxis:{layerClass:"x axis",makeElements:function(e){var t=this;return e.positions.map(function(r,n){return xLine(r,e.calcLabels[n],t.constants.height,{mode:t.constants.mode,pos:t.constants.pos})})},animateElements:function(e){var t=e.positions,r=e.calcLabels,n=this.oldData.positions,a=this.oldData.calcLabels,i=equilizeNoOfElements(n,t),o=_slicedToArray$3(i,2);n=o[0],t=o[1];var s=equilizeNoOfElements(a,r),l=_slicedToArray$3(s,2);return a=l[0],r=l[1],this.render({positions:n,calcLabels:r}),this.store.map(function(e,r){return translateVertLine(e,t[r],n[r])})}},yMarkers:{layerClass:"y-markers",makeElements:function(e){var t=this;return e.map(function(e){return yMarker(e.position,e.label,t.constants.width,{labelPos:e.options.labelPos,mode:"span",lineType:"dashed"})})},animateElements:function(e){var t=equilizeNoOfElements(this.oldData,e),r=_slicedToArray$3(t,2);this.oldData=r[0];var n=(e=r[1]).map(function(e){return e.position}),a=e.map(function(e){return e.label}),i=e.map(function(e){return e.options}),o=this.oldData.map(function(e){return e.position});return this.render(o.map(function(e,t){return{position:o[t],label:a[t],options:i[t]}})),this.store.map(function(e,t){return translateHoriLine(e,n[t],o[t])})}},yRegions:{layerClass:"y-regions",makeElements:function(e){var t=this;return e.map(function(e){return yRegion(e.startPos,e.endPos,t.constants.width,e.label,{labelPos:e.options.labelPos})})},animateElements:function(e){var t=equilizeNoOfElements(this.oldData,e),r=_slicedToArray$3(t,2);this.oldData=r[0];var n=(e=r[1]).map(function(e){return e.endPos}),a=e.map(function(e){return e.label}),i=e.map(function(e){return e.startPos}),o=e.map(function(e){return e.options}),s=this.oldData.map(function(e){return e.endPos}),l=this.oldData.map(function(e){return e.startPos});this.render(s.map(function(e,t){return{startPos:l[t],endPos:s[t],label:a[t],options:o[t]}}));var p=[];return this.store.map(function(e,t){p=p.concat(animateRegion(e,i[t],n[t],s[t]))}),p}},heatDomain:{layerClass:function(){return"heat-domain domain-"+this.constants.index},makeElements:function(e){var t=this,r=this.constants,n=r.index,a=r.colWidth,i=r.rowHeight,o=r.squareSize,s=r.radius,l=r.xTranslate,p=0;return this.serializedSubDomains=[],e.cols.map(function(e,r){1===r&&t.labels.push(makeText("domain-name",l,-12,getMonthName(n,!0).toUpperCase(),{fontSize:9})),e.map(function(e,r){if(e.fill){var n={"data-date":e.yyyyMmDd,"data-value":e.dataValue,"data-day":r},a=heatSquare("day",l,p,o,s,e.fill,n);t.serializedSubDomains.push(a)}p+=i}),p=0,l+=a}),this.serializedSubDomains},animateElements:function(e){if(e)return[]}},barGraph:{layerClass:function(){return"dataset-units dataset-bars dataset-"+this.constants.index},makeElements:function(e){var t=this.constants;return this.unitType="bar",this.units=e.yPositions.map(function(r,n){return datasetBar(e.xPositions[n],r,e.barWidth,t.color,e.labels[n],n,e.offsets[n],{zeroLine:e.zeroLine,barsWidth:e.barsWidth,minHeight:t.minHeight})}),this.units},animateElements:function(e){var t=e.xPositions,r=e.yPositions,n=e.offsets,a=e.labels,i=this.oldData.xPositions,o=this.oldData.yPositions,s=this.oldData.offsets,l=this.oldData.labels,p=equilizeNoOfElements(i,t),c=_slicedToArray$3(p,2);i=c[0],t=c[1];var d=equilizeNoOfElements(o,r),u=_slicedToArray$3(d,2);o=u[0],r=u[1];var f=equilizeNoOfElements(s,n),_=_slicedToArray$3(f,2);s=_[0],n=_[1];var h=equilizeNoOfElements(l,a),m=_slicedToArray$3(h,2);l=m[0],a=m[1],this.render({xPositions:i,yPositions:o,offsets:s,labels:a,zeroLine:this.oldData.zeroLine,barsWidth:this.oldData.barsWidth,barWidth:this.oldData.barWidth});var g=[];return this.store.map(function(a,i){g=g.concat(animateBar(a,t[i],r[i],e.barWidth,n[i],{zeroLine:e.zeroLine}))}),g}},lineGraph:{layerClass:function(){return"dataset-units dataset-line dataset-"+this.constants.index},makeElements:function(e){var t=this.constants;return this.unitType="dot",this.paths={},t.hideLine||(this.paths=getPaths(e.xPositions,e.yPositions,t.color,{heatline:t.heatline,regionFill:t.regionFill,spline:t.spline},{svgDefs:t.svgDefs,zeroLine:e.zeroLine})),this.units=[],t.hideDots||(this.units=e.yPositions.map(function(r,n){return datasetDot(e.xPositions[n],r,e.radius,t.color,t.valuesOverPoints?e.values[n]:"",n)})),Object.values(this.paths).concat(this.units)},animateElements:function(e){var t=e.xPositions,r=e.yPositions,n=e.values,a=this.oldData.xPositions,i=this.oldData.yPositions,o=this.oldData.values,s=equilizeNoOfElements(a,t),l=_slicedToArray$3(s,2);a=l[0],t=l[1];var p=equilizeNoOfElements(i,r),c=_slicedToArray$3(p,2);i=c[0],r=c[1];var d=equilizeNoOfElements(o,n),u=_slicedToArray$3(d,2);o=u[0],n=u[1],this.render({xPositions:a,yPositions:i,values:n,zeroLine:this.oldData.zeroLine,radius:this.oldData.radius});var f=[];return Object.keys(this.paths).length&&(f=f.concat(animatePath(this.paths,t,r,e.zeroLine,this.constants.spline))),this.units.length&&this.units.map(function(e,n){f=f.concat(animateDot(e,t[n],r[n]))}),f}}},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(n):void 0},PercentageChart=function(e){function t(e,r){_classCallCheck$1(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.type="percentage",n.setup(),n}return _inherits(t,AggregationChart),_createClass(t,[{key:"setMeasures",value:function(e){var t=this.measures;this.barOptions=e.barOptions||{};var r=this.barOptions;r.height=r.height||PERCENTAGE_BAR_DEFAULT_HEIGHT,r.depth=r.depth||PERCENTAGE_BAR_DEFAULT_DEPTH,t.paddings.right=30,t.legendHeight=60,t.baseHeight=8*(r.height+.5*r.depth)}},{key:"setupComponents",value:function(){var e=this.state,t=[["percentageBars",{barHeight:this.barOptions.height,barDepth:this.barOptions.depth},function(){return{xPositions:e.xPositions,widths:e.widths,colors:this.colors}}.bind(this)]];this.components=new Map(t.map(function(e){var t=getComponent.apply(void 0,_toConsumableArray(e));return[e[0],t]}))}},{key:"calc",value:function(){var e=this;_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"calc",this).call(this);var r=this.state;r.xPositions=[],r.widths=[];var n=0;r.sliceTotals.map(function(t){var a=e.width*t/r.grandTotal;r.widths.push(a),r.xPositions.push(n),n+=a})}},{key:"makeDataByIndex",value:function(){}},{key:"bindTooltip",value:function(){var e=this,t=this.state;this.container.addEventListener("mousemove",function(r){var n=e.components.get("percentageBars").store,a=r.target;if(n.includes(a)){var i=n.indexOf(a),o=getOffset(e.container),s=getOffset(a),l=s.left-o.left+parseInt(a.getAttribute("width"))/2,p=s.top-o.top,c=(e.formattedLabels&&e.formattedLabels.length>0?e.formattedLabels[i]:e.state.labels[i])+": ",d=t.sliceTotals[i]/t.grandTotal;e.tip.setValues(l,p,{name:c,value:(100*d).toFixed(1)+"%"}),e.tip.showTip()}})}}]),t}(),_createClass$5=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get$2=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(n):void 0},PieChart=function(e){function t(e,r){_classCallCheck$6(this,t);var n=_possibleConstructorReturn$2(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.type="pie",n.initTimeout=0,n.init=1,n.setup(),n}return _inherits$2(t,AggregationChart),_createClass$5(t,[{key:"configure",value:function(e){_get$2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"configure",this).call(this,e),this.mouseMove=this.mouseMove.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.hoverRadio=e.hoverRadio||.1,this.config.startAngle=e.startAngle||0,this.clockWise=e.clockWise||!1}},{key:"calc",value:function(){var e=this;_get$2(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"calc",this).call(this);var r=this.state;this.radius=this.height>this.width?this.center.x:this.center.y;var n=this.radius,a=this.clockWise,i=r.slicesProperties||[];r.sliceStrings=[],r.slicesProperties=[];var o=180-this.config.startAngle;r.sliceTotals.map(function(t,s){var l=o,p=t/r.grandTotal*FULL_ANGLE,c=p>180?1:0,d=a?-p:p,u=o+=d,f=getPositionByAngle(l,n),_=getPositionByAngle(u,n),h=e.init&&i[s],m=void 0,g=void 0;e.init?(m=h?h.startPosition:f,g=h?h.endPosition:f):(m=f,g=_);var v=360===p?makeCircleStr(m,g,e.center,e.radius,a,c):makeArcPathStr(m,g,e.center,e.radius,a,c);r.sliceStrings.push(v),r.slicesProperties.push({startPosition:f,endPosition:_,value:t,total:r.grandTotal,startAngle:l,endAngle:u,angle:d})}),this.init=0}},{key:"setupComponents",value:function(){var e=this.state,t=[["pieSlices",{},function(){return{sliceStrings:e.sliceStrings,colors:this.colors}}.bind(this)]];this.components=new Map(t.map(function(e){var t=getComponent.apply(void 0,_toConsumableArray$2(e));return[e[0],t]}))}},{key:"calTranslateByAngle",value:function(e){var t=this.radius,r=this.hoverRadio,n=getPositionByAngle(e.startAngle+e.angle/2,t);return"translate3d("+n.x*r+"px,"+n.y*r+"px,0)"}},{key:"hoverSlice",value:function(e,t,r,n){if(e){var a=this.colors[t];if(r){transform(e,this.calTranslateByAngle(this.state.slicesProperties[t])),e.style.fill=lightenDarkenColor(a,50);var i=getOffset(this.svg),o=n.pageX-i.left+10,s=n.pageY-i.top-10,l=(this.formatted_labels&&this.formatted_labels.length>0?this.formatted_labels[t]:this.state.labels[t])+": ",p=(100*this.state.sliceTotals[t]/this.state.grandTotal).toFixed(1);this.tip.setValues(o,s,{name:l,value:p+"%"}),this.tip.showTip()}else transform(e,"translate3d(0,0,0)"),this.tip.hideTip(),e.style.fill=a}}},{key:"bindTooltip",value:function(){this.container.addEventListener("mousemove",this.mouseMove),this.container.addEventListener("mouseleave",this.mouseLeave)}},{key:"mouseMove",value:function(e){var t=e.target,r=this.components.get("pieSlices").store,n=this.curActiveSliceIndex,a=this.curActiveSlice;if(r.includes(t)){var i=r.indexOf(t);this.hoverSlice(a,n,!1),this.curActiveSlice=t,this.curActiveSliceIndex=i,this.hoverSlice(t,i,!0,e)}else this.mouseLeave()}},{key:"mouseLeave",value:function(){this.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,!1)}}]),t}(),_slicedToArray$4=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass$6=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),COL_WIDTH=HEATMAP_SQUARE_SIZE+HEATMAP_GUTTER_SIZE,ROW_HEIGHT=COL_WIDTH,Heatmap=function(e){function t(e,r){_classCallCheck$7(this,t);var n=_possibleConstructorReturn$3(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));n.type="heatmap",n.countLabel=r.countLabel||"";var a=["Sunday","Monday"],i=a.includes(r.startSubDomain)?r.startSubDomain:"Sunday";return n.startSubDomainIndex=a.indexOf(i),n.setup(),n}return _inherits$3(t,BaseChart),_createClass$6(t,[{key:"setMeasures",value:function(e){var t=this.measures;this.discreteDomains=0===e.discreteDomains?0:1,t.paddings.top=3*ROW_HEIGHT,t.paddings.bottom=0,t.legendHeight=2*ROW_HEIGHT,t.baseHeight=ROW_HEIGHT*NO_OF_DAYS_IN_WEEK+getExtraHeight(t);var r=this.data,n=this.discreteDomains?NO_OF_YEAR_MONTHS:0;this.independentWidth=(getWeeksBetween(r.start,r.end)+n)*COL_WIDTH+getExtraWidth(t)}},{key:"updateWidth",value:function(){var e=this.discreteDomains?NO_OF_YEAR_MONTHS:0,t=this.state.noOfWeeks?this.state.noOfWeeks:52;this.baseWidth=(t+e)*COL_WIDTH+getExtraWidth(this.measures)}},{key:"prepareData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data;if(e.start&&e.end&&e.start>e.end)throw new Error("Start date cannot be greater than end date.");if(e.start||(e.start=new Date,e.start.setFullYear(e.start.getFullYear()-1)),e.end||(e.end=new Date),e.dataPoints=e.dataPoints||{},parseInt(Object.keys(e.dataPoints)[0])>1e5){var t={};Object.keys(e.dataPoints).forEach(function(r){var n=new Date(r*NO_OF_MILLIS);t[getYyyyMmDd(n)]=e.dataPoints[r]}),e.dataPoints=t}return e}},{key:"calc",value:function(){var e=this.state;e.start=clone(this.data.start),e.end=clone(this.data.end),e.firstWeekStart=clone(e.start),e.noOfWeeks=getWeeksBetween(e.start,e.end),e.distribution=calcDistribution(Object.values(this.data.dataPoints),HEATMAP_DISTRIBUTION_SIZE),e.domainConfigs=this.getDomains()}},{key:"setupComponents",value:function(){var e=this,t=this.state,r=this.discreteDomains?0:1,n=t.domainConfigs.map(function(n,a){return["heatDomain",{index:n.index,colWidth:COL_WIDTH,rowHeight:ROW_HEIGHT,squareSize:HEATMAP_SQUARE_SIZE,radius:e.rawChartArgs.radius||0,xTranslate:t.domainConfigs.filter(function(e,t){return t<a}).map(function(e){return e.cols.length-r}).reduce(function(e,t){return e+t},0)*COL_WIDTH},function(){return t.domainConfigs[a]}.bind(e)]});this.components=new Map(n.map(function(e,t){var r=getComponent.apply(void 0,_toConsumableArray$3(e));return[e[0]+"-"+t,r]}));var a=0;DAY_NAMES_SHORT.forEach(function(t,r){if([1,3,5].includes(r)){var n=makeText("subdomain-name",-COL_WIDTH/2,a,t,{fontSize:HEATMAP_SQUARE_SIZE,dy:8,textAnchor:"end"});e.drawArea.appendChild(n)}a+=ROW_HEIGHT})}},{key:"update",value:function(e){e||console.error("No data to update."),this.data=this.prepareData(e),this.draw(),this.bindTooltip()}},{key:"bindTooltip",value:function(){var e=this;this.container.addEventListener("mousemove",function(t){e.components.forEach(function(r){var n=r.store,a=t.target;if(n.includes(a)){var i=a.getAttribute("data-value"),o=a.getAttribute("data-date").split("-"),s=getMonthName(parseInt(o[1])-1,!0),l=e.container.getBoundingClientRect(),p=a.getBoundingClientRect(),c=parseInt(t.target.getAttribute("width")),d=p.left-l.left+c/2,u=p.top-l.top,f=i+" "+e.countLabel,_=" on "+s+" "+o[0]+", "+o[2];e.tip.setValues(d,u,{name:_,value:f,valueFirst:1},[]),e.tip.showTip()}})})}},{key:"renderLegend",value:function(){var e=this;this.legendArea.textContent="";var t=0,r=ROW_HEIGHT,n=this.rawChartArgs.radius||0,a=makeText("subdomain-name",t,r,"Less",{fontSize:HEATMAP_SQUARE_SIZE+1,dy:9});t=2*COL_WIDTH+COL_WIDTH/2,this.legendArea.appendChild(a),this.colors.slice(0,HEATMAP_DISTRIBUTION_SIZE).map(function(a,i){var o=heatSquare("heatmap-legend-unit",t+(COL_WIDTH+3)*i,r,HEATMAP_SQUARE_SIZE,n,a);e.legendArea.appendChild(o)});var i=makeText("subdomain-name",t+HEATMAP_DISTRIBUTION_SIZE*(COL_WIDTH+3)+COL_WIDTH/4,r,"More",{fontSize:HEATMAP_SQUARE_SIZE+1,dy:9});this.legendArea.appendChild(i)}},{key:"getDomains",value:function(){for(var e=this.state,t=[e.start.getMonth(),e.start.getFullYear()],r=t[0],n=t[1],a=[e.end.getMonth(),e.end.getFullYear()],i=a[0]-r+1+12*(a[1]-n),o=[],s=clone(e.start),l=0;l<i;l++){var p=e.end;if(!areInSameMonth(s,e.end)){var c=[s.getMonth(),s.getFullYear()];p=getLastDateInMonth(c[0],c[1])}o.push(this.getDomainConfig(s,p)),addDays(p,1),s=p}return o}},{key:"getDomainConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=[e.getMonth(),e.getFullYear()],n=r[0],a=r[1],i=setDayToSunday(e),o={index:n,cols:[]};addDays(t=clone(t)||getLastDateInMonth(n,a),1);for(var s=getWeeksBetween(i,t),l=[],p=void 0,c=0;c<s;c++)p=this.getCol(i,n),l.push(p),addDays(i=new Date(p[NO_OF_DAYS_IN_WEEK-1].yyyyMmDd),1);return void 0!==p[NO_OF_DAYS_IN_WEEK-1].dataValue&&(addDays(i,1),l.push(this.getCol(i,n,!0))),o.cols=l,o}},{key:"getCol",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.state,a=clone(e),i=[],o=0;o<NO_OF_DAYS_IN_WEEK;o++,addDays(a,1)){var s={},l=a>=n.start&&a<=n.end;r||a.getMonth()!==t||!l?s.yyyyMmDd=getYyyyMmDd(a):s=this.getSubDomainConfig(a),i.push(s)}return i}},{key:"getSubDomainConfig",value:function(e){var t=getYyyyMmDd(e),r=this.data.dataPoints[t];return{yyyyMmDd:t,dataValue:r||0,fill:this.colors[getMaxCheckpoint(r,this.state.distribution)]}}}]),t}(),_createClass$7=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get$3=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(n):void 0},AxisChart=function(e){function t(e,r){_classCallCheck$8(this,t);var n=_possibleConstructorReturn$4(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.barOptions=r.barOptions||{},n.lineOptions=r.lineOptions||{},n.type=r.type||"line",n.init=1,n.setup(),n}return _inherits$4(t,BaseChart),_createClass$7(t,[{key:"setMeasures",value:function(){this.data.datasets.length<=1&&(this.config.showLegend=0,this.measures.paddings.bottom=30)}},{key:"configure",value:function(e){_get$3(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"configure",this).call(this,e),e.axisOptions=e.axisOptions||{},e.tooltipOptions=e.tooltipOptions||{},this.config.xAxisMode=e.axisOptions.xAxisMode||"span",this.config.yAxisMode=e.axisOptions.yAxisMode||"span",this.config.xIsSeries=e.axisOptions.xIsSeries||0,this.config.shortenYAxisNumbers=e.axisOptions.shortenYAxisNumbers||0,this.config.formatTooltipX=e.tooltipOptions.formatTooltipX,this.config.formatTooltipY=e.tooltipOptions.formatTooltipY,this.config.valuesOverPoints=e.valuesOverPoints}},{key:"prepareData",value:function(){return dataPrep(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data,this.type)}},{key:"prepareFirstData",value:function(){return zeroDataPrep(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data)}},{key:"calc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.calcXPositions(),e||this.calcYAxisParameters(this.getAllYValues(),"line"===this.type),this.makeDataByIndex()}},{key:"calcXPositions",value:function(){var e=this.state,t=this.data.labels;e.datasetLength=t.length,e.unitWidth=this.width/e.datasetLength,e.xOffset=e.unitWidth/2,e.xAxis={labels:t,positions:t.map(function(t,r){return floatTwo(e.xOffset+r*e.unitWidth)})}}},{key:"calcYAxisParameters",value:function(e){var t=calcChartIntervals(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"false"),r=this.height/getValueRange(t),n=getIntervalSize(t)*r,a=this.height-getZeroIndex(t)*n;this.state.yAxis={labels:t,positions:t.map(function(e){return a-e*r}),scaleMultiplier:r,zeroLine:a},this.calcDatasetPoints(),this.calcYExtremes(),this.calcYRegions()}},{key:"calcDatasetPoints",value:function(){var e=this.state,t=function(t){return t.map(function(t){return scale(t,e.yAxis)})};e.datasets=this.data.datasets.map(function(e,r){var n=e.values,a=e.cumulativeYs||[];return{name:e.name,index:r,chartType:e.chartType,values:n,yPositions:t(n),cumulativeYs:a,cumulativeYPos:t(a)}})}},{key:"calcYExtremes",value:function(){var e=this.state;this.barOptions.stacked?e.yExtremes=e.datasets[e.datasets.length-1].cumulativeYPos:(e.yExtremes=new Array(e.datasetLength).fill(9999),e.datasets.map(function(t){t.yPositions.map(function(t,r){t<e.yExtremes[r]&&(e.yExtremes[r]=t)})}))}},{key:"calcYRegions",value:function(){var e=this.state;this.data.yMarkers&&(this.state.yMarkers=this.data.yMarkers.map(function(t){return t.position=scale(t.value,e.yAxis),t.options||(t.options={}),t})),this.data.yRegions&&(this.state.yRegions=this.data.yRegions.map(function(t){return t.startPos=scale(t.start,e.yAxis),t.endPos=scale(t.end,e.yAxis),t.options||(t.options={}),t}))}},{key:"getAllYValues",value:function(){var e,t=this,r="values";if(this.barOptions.stacked){r="cumulativeYs";var n=new Array(this.state.datasetLength).fill(0);this.data.datasets.map(function(e,a){var i=t.data.datasets[a].values;e[r]=n=n.map(function(e,t){return e+i[t]})})}var a=this.data.datasets.map(function(e){return e[r]});return this.data.yMarkers&&a.push(this.data.yMarkers.map(function(e){return e.value})),this.data.yRegions&&this.data.yRegions.map(function(e){a.push([e.end,e.start])}),(e=[]).concat.apply(e,_toConsumableArray$5(a))}},{key:"setupComponents",value:function(){var e=this,t=[["yAxis",{mode:this.config.yAxisMode,width:this.width,shortenNumbers:this.config.shortenYAxisNumbers},function(){return this.state.yAxis}.bind(this)],["xAxis",{mode:this.config.xAxisMode,height:this.height},function(){var e=this.state;return e.xAxis.calcLabels=getShortenedLabels(this.width,e.xAxis.labels,this.config.xIsSeries),e.xAxis}.bind(this)],["yRegions",{width:this.width,pos:"right"},function(){return this.state.yRegions}.bind(this)]],r=this.state.datasets.filter(function(e){return"bar"===e.chartType}),n=this.state.datasets.filter(function(e){return"line"===e.chartType}),a=r.map(function(t){var n=t.index;return["barGraph-"+t.index,{index:n,color:e.colors[n],stacked:e.barOptions.stacked,valuesOverPoints:e.config.valuesOverPoints,minHeight:e.height*MIN_BAR_PERCENT_HEIGHT},function(){var e=this.state,t=e.datasets[n],a=this.barOptions.stacked,i=this.barOptions.spaceRatio||BAR_CHART_SPACE_RATIO,o=e.unitWidth*(1-i),s=o/(a?1:r.length),l=e.xAxis.positions.map(function(e){return e-o/2});a||(l=l.map(function(e){return e+s*n}));var p=new Array(e.datasetLength).fill("");this.config.valuesOverPoints&&(p=a&&t.index===e.datasets.length-1?t.cumulativeYs:t.values);var c=new Array(e.datasetLength).fill(0);return a&&(c=t.yPositions.map(function(e,r){return e-t.cumulativeYPos[r]})),{xPositions:l,yPositions:t.yPositions,offsets:c,labels:p,zeroLine:e.yAxis.zeroLine,barsWidth:o,barWidth:s}}.bind(e)]}),i=n.map(function(t){var r=t.index;return["lineGraph-"+t.index,{index:r,color:e.colors[r],svgDefs:e.svgDefs,heatline:e.lineOptions.heatline,regionFill:e.lineOptions.regionFill,spline:e.lineOptions.spline,hideDots:e.lineOptions.hideDots,hideLine:e.lineOptions.hideLine,valuesOverPoints:e.config.valuesOverPoints},function(){var e=this.state,t=e.datasets[r],n=e.yAxis.positions[0]<e.yAxis.zeroLine?e.yAxis.positions[0]:e.yAxis.zeroLine;return{xPositions:e.xAxis.positions,yPositions:t.yPositions,values:t.values,zeroLine:n,radius:this.lineOptions.dotSize||LINE_CHART_DOT_SIZE}}.bind(e)]}),o=[["yMarkers",{width:this.width,pos:"right"},function(){return this.state.yMarkers}.bind(this)]];t=t.concat(a,i,o);var s=["yMarkers","yRegions"];this.dataUnitComponents=[],this.components=new Map(t.filter(function(t){return!s.includes(t[0])||e.state[t[0]]}).map(function(t){var r=getComponent.apply(void 0,_toConsumableArray$5(t));return(t[0].includes("lineGraph")||t[0].includes("barGraph"))&&e.dataUnitComponents.push(r),[t[0],r]}))}},{key:"makeDataByIndex",value:function(){var e=this;this.dataByIndex={};var t=this.state,r=this.config.formatTooltipX,n=this.config.formatTooltipY;t.xAxis.labels.map(function(a,i){var o=e.state.datasets.map(function(t,r){var a=t.values[i];return{title:t.name,value:a,yPos:t.yPositions[i],color:e.colors[r],formatted:n?n(a):a}});e.dataByIndex[i]={label:a,formattedLabel:r?r(a):a,xPos:t.xAxis.positions[i],values:o,yExtreme:t.yExtremes[i]}})}},{key:"bindTooltip",value:function(){var e=this;this.container.addEventListener("mousemove",function(t){var r=e.measures,n=getOffset(e.container),a=t.pageX-n.left-getLeftOffset(r),i=t.pageY-n.top;i<e.height+getTopOffset(r)&&i>getTopOffset(r)?e.mapTooltipXPosition(a):e.tip.hideTip()})}},{key:"mapTooltipXPosition",value:function(e){var t=this.state;if(t.yExtremes){var r=getClosestInArray(e,t.xAxis.positions,!0);if(r>=0){var n=this.dataByIndex[r];this.tip.setValues(n.xPos+this.tip.offset.x,n.yExtreme+this.tip.offset.y,{name:n.formattedLabel,value:""},n.values,r),this.tip.showTip()}}}},{key:"renderLegend",value:function(){var e=this,t=this.data;t.datasets.length>1&&(this.legendArea.textContent="",t.datasets.map(function(t,r){var n=legendBar(AXIS_LEGEND_BAR_SIZE*r,"0",AXIS_LEGEND_BAR_SIZE,e.colors[r],t.name,e.config.truncateLegends);e.legendArea.appendChild(n)}))}},{key:"makeOverlay",value:function(){var e=this;this.init?this.init=0:(this.overlayGuides&&this.overlayGuides.forEach(function(e){var t=e.overlay;t.parentNode.removeChild(t)}),this.overlayGuides=this.dataUnitComponents.map(function(e){return{type:e.unitType,overlay:void 0,units:e.units}}),void 0===this.state.currentIndex&&(this.state.currentIndex=this.state.datasetLength-1),this.overlayGuides.map(function(t){var r=t.units[e.state.currentIndex];t.overlay=makeOverlay[t.type](r),e.drawArea.appendChild(t.overlay)}))}},{key:"updateOverlayGuides",value:function(){this.overlayGuides&&this.overlayGuides.forEach(function(e){var t=e.overlay;t.parentNode.removeChild(t)})}},{key:"bindOverlay",value:function(){var e=this;this.parent.addEventListener("data-select",function(){e.updateOverlay()})}},{key:"bindUnits",value:function(){var e=this;this.dataUnitComponents.map(function(t){t.units.map(function(t){t.addEventListener("click",function(){var r=t.getAttribute("data-point-index");e.setCurrentDataPoint(r)})})}),this.tip.container.addEventListener("click",function(){var t=e.tip.container.getAttribute("data-point-index");e.setCurrentDataPoint(t)})}},{key:"updateOverlay",value:function(){var e=this;this.overlayGuides.map(function(t){var r=t.units[e.state.currentIndex];updateOverlay[t.type](r,t.overlay)})}},{key:"onLeftArrow",value:function(){this.setCurrentDataPoint(this.state.currentIndex-1)}},{key:"onRightArrow",value:function(){this.setCurrentDataPoint(this.state.currentIndex+1)}},{key:"getDataPoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.currentIndex,t=this.state;return{index:e,label:t.xAxis.labels[e],values:t.datasets.map(function(t){return t.values[e]})}}},{key:"setCurrentDataPoint",value:function(e){var t=this.state;(e=parseInt(e))<0&&(e=0),e>=t.xAxis.labels.length&&(e=t.xAxis.labels.length-1),e!==t.currentIndex&&(t.currentIndex=e,fire(this.parent,"data-select",this.getDataPoint()))}},{key:"addDataPoint",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.state.datasetLength;_get$3(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addDataPoint",this).call(this,e,r,n),this.data.labels.splice(n,0,e),this.data.datasets.map(function(e,t){e.values.splice(n,0,r[t])}),this.update(this.data)}},{key:"removeDataPoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.datasetLength-1;this.data.labels.length<=1||(_get$3(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeDataPoint",this).call(this,e),this.data.labels.splice(e,1),this.data.datasets.map(function(t){t.values.splice(e,1)}),this.update(this.data))}},{key:"updateDataset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.data.datasets[t].values=e,this.update(this.data)}},{key:"updateDatasets",value:function(e){this.data.datasets.map(function(t,r){e[r]&&(t.values=e[r])}),this.update(this.data)}}]),t}(),_createClass$8=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get$4=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(n):void 0},DonutChart=function(e){function t(e,r){_classCallCheck$9(this,t);var n=_possibleConstructorReturn$5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.type="donut",n.initTimeout=0,n.init=1,n.setup(),n}return _inherits$5(t,AggregationChart),_createClass$8(t,[{key:"configure",value:function(e){_get$4(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"configure",this).call(this,e),this.mouseMove=this.mouseMove.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.hoverRadio=e.hoverRadio||.1,this.config.startAngle=e.startAngle||0,this.clockWise=e.clockWise||!1,this.strokeWidth=e.strokeWidth||30}},{key:"calc",value:function(){var e=this;_get$4(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"calc",this).call(this);var r=this.state;this.radius=this.height>this.width?this.center.x-this.strokeWidth/2:this.center.y-this.strokeWidth/2;var n=this.radius,a=this.clockWise,i=r.slicesProperties||[];r.sliceStrings=[],r.slicesProperties=[];var o=180-this.config.startAngle;r.sliceTotals.map(function(t,s){var l=o,p=t/r.grandTotal*FULL_ANGLE,c=p>180?1:0,d=a?-p:p,u=o+=d,f=getPositionByAngle(l,n),_=getPositionByAngle(u,n),h=e.init&&i[s],m=void 0,g=void 0;e.init?(m=h?h.startPosition:f,g=h?h.endPosition:f):(m=f,g=_);var v=360===p?makeStrokeCircleStr(m,g,e.center,e.radius,e.clockWise,c):makeArcStrokePathStr(m,g,e.center,e.radius,e.clockWise,c);r.sliceStrings.push(v),r.slicesProperties.push({startPosition:f,endPosition:_,value:t,total:r.grandTotal,startAngle:l,endAngle:u,angle:d})}),this.init=0}},{key:"setupComponents",value:function(){var e=this.state,t=[["donutSlices",{},function(){return{sliceStrings:e.sliceStrings,colors:this.colors,strokeWidth:this.strokeWidth}}.bind(this)]];this.components=new Map(t.map(function(e){var t=getComponent.apply(void 0,_toConsumableArray$7(e));return[e[0],t]}))}},{key:"calTranslateByAngle",value:function(e){var t=this.radius,r=this.hoverRadio,n=getPositionByAngle(e.startAngle+e.angle/2,t);return"translate3d("+n.x*r+"px,"+n.y*r+"px,0)"}},{key:"hoverSlice",value:function(e,t,r,n){if(e){var a=this.colors[t];if(r){transform(e,this.calTranslateByAngle(this.state.slicesProperties[t])),e.style.stroke=lightenDarkenColor(a,50);var i=getOffset(this.svg),o=n.pageX-i.left+10,s=n.pageY-i.top-10,l=(this.formatted_labels&&this.formatted_labels.length>0?this.formatted_labels[t]:this.state.labels[t])+": ",p=(100*this.state.sliceTotals[t]/this.state.grandTotal).toFixed(1);this.tip.setValues(o,s,{name:l,value:p+"%"}),this.tip.showTip()}else transform(e,"translate3d(0,0,0)"),this.tip.hideTip(),e.style.stroke=a}}},{key:"bindTooltip",value:function(){this.container.addEventListener("mousemove",this.mouseMove),this.container.addEventListener("mouseleave",this.mouseLeave)}},{key:"mouseMove",value:function(e){var t=e.target,r=this.components.get("donutSlices").store,n=this.curActiveSliceIndex,a=this.curActiveSlice;if(r.includes(t)){var i=r.indexOf(t);this.hoverSlice(a,n,!1),this.curActiveSlice=t,this.curActiveSliceIndex=i,this.hoverSlice(t,i,!0,e)}else this.mouseLeave()}},{key:"mouseLeave",value:function(){this.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,!1)}}]),t}(),chartTypes={bar:AxisChart,line:AxisChart,percentage:PercentageChart,heatmap:Heatmap,pie:PieChart,donut:DonutChart},Chart=function e(t,r){return _classCallCheck(this,e),getChartByType(r.type,t,r)};frappe.Chart=Chart;var driver_min=createCommonjsModule(function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=57)}([function(e,t,r){var n=r(2),a=r(11),i=r(4),o=r(13),s=r(22),l=function(e,t,r){var p,c,d,u,f=e&l.F,_=e&l.G,h=e&l.S,m=e&l.P,g=e&l.B,v=_?n:h?n[t]||(n[t]={}):(n[t]||{}).prototype,b=_?a:a[t]||(a[t]={}),y=b.prototype||(b.prototype={});for(p in _&&(r=t),r)d=((c=!f&&v&&void 0!==v[p])?v:r)[p],u=g&&c?s(d,n):m&&"function"==typeof d?s(Function.call,d):d,v&&o(v,p,d,e&l.U),b[p]!=d&&i(b,p,u),m&&y[p]!=d&&(y[p]=d)};n.core=a,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,r){var n=r(17)("wks"),a=r(14),i=r(2).Symbol,o="function"==typeof i;(e.exports=function(e){return n[e]||(n[e]=o&&i[e]||(o?i:a)("Symbol."+e))}).store=n},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(5),a=r(16);e.exports=r(6)?function(e,t,r){return n.f(e,t,a(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(12),a=r(35),i=r(21),o=Object.defineProperty;t.f=r(6)?Object.defineProperty:function(e,t,r){if(n(e),t=i(t,!0),n(r),a)try{return o(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!r(7)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(39),a=r(24);e.exports=function(e){return n(a(e))}},function(e,t,r){var n=r(0);n(n.S+n.F*!r(6),"Object",{defineProperty:r(5).f})},function(e,t){var r=e.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(e,t,r){var n=r(3);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var n=r(2),a=r(4),i=r(8),o=r(14)("src"),s=r(59),l=(""+s).split("toString");r(11).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,r,s){var p="function"==typeof r;p&&(i(r,"name")||a(r,"name",t)),e[t]!==r&&(p&&(i(r,o)||a(r,o,e[t]?""+e[t]:l.join(String(t)))),e===n?e[t]=r:s?e[t]?e[t]=r:a(e,t,r):(delete e[t],a(e,t,r)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||s.call(this)})},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(45),a=r(28);e.exports=Object.keys||function(e){return n(e,a)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(11),a=r(2),i=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(18)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports=!1},function(e,t,r){var n=r(24);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n=r(2),a=r(8),i=r(6),o=r(0),s=r(13),l=r(62).KEY,p=r(7),c=r(17),d=r(26),u=r(14),f=r(1),_=r(43),h=r(44),m=r(63),g=r(42),v=r(12),b=r(3),y=r(19),w=r(9),k=r(21),x=r(16),C=r(30),$=r(67),S=r(49),A=r(47),T=r(5),E=r(15),O=S.f,P=T.f,L=$.f,j=n.Symbol,N=n.JSON,D=N&&N.stringify,F=f("_hidden"),M=f("toPrimitive"),z={}.propertyIsEnumerable,I=c("symbol-registry"),R=c("symbols"),B=c("op-symbols"),H=Object.prototype,q="function"==typeof j&&!!A.f,U=n.QObject,W=!U||!U.prototype||!U.prototype.findChild,G=i&&p(function(){return 7!=C(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=O(H,t);n&&delete H[t],P(e,t,r),n&&e!==H&&P(H,t,n)}:P,V=function(e){var t=R[e]=C(j.prototype);return t._k=e,t},Y=q&&"symbol"==typeof j.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof j},J=function(e,t,r){return e===H&&J(B,t,r),v(e),t=k(t,!0),v(r),a(R,t)?(r.enumerable?(a(e,F)&&e[F][t]&&(e[F][t]=!1),r=C(r,{enumerable:x(0,!1)})):(a(e,F)||P(e,F,x(1,{})),e[F][t]=!0),G(e,t,r)):P(e,t,r)},Z=function(e,t){v(e);for(var r,n=m(t=w(t)),a=0,i=n.length;i>a;)J(e,r=n[a++],t[r]);return e},K=function(e){var t=z.call(this,e=k(e,!0));return!(this===H&&a(R,e)&&!a(B,e))&&(!(t||!a(this,e)||!a(R,e)||a(this,F)&&this[F][e])||t)},X=function(e,t){if(e=w(e),t=k(t,!0),e!==H||!a(R,t)||a(B,t)){var r=O(e,t);return!r||!a(R,t)||a(e,F)&&e[F][t]||(r.enumerable=!0),r}},Q=function(e){for(var t,r=L(w(e)),n=[],i=0;r.length>i;)a(R,t=r[i++])||t==F||t==l||n.push(t);return n},ee=function(e){for(var t,r=e===H,n=L(r?B:w(e)),i=[],o=0;n.length>o;)!a(R,t=n[o++])||r&&!a(H,t)||i.push(R[t]);return i};q||(s((j=function(){if(this instanceof j)throw TypeError("Symbol is not a constructor!");var e=u(arguments.length>0?arguments[0]:void 0),t=function(r){this===H&&t.call(B,r),a(this,F)&&a(this[F],e)&&(this[F][e]=!1),G(this,e,x(1,r))};return i&&W&&G(H,e,{configurable:!0,set:t}),V(e)}).prototype,"toString",function(){return this._k}),S.f=X,T.f=J,r(48).f=$.f=Q,r(29).f=K,A.f=ee,i&&!r(18)&&s(H,"propertyIsEnumerable",K,!0),_.f=function(e){return V(f(e))}),o(o.G+o.W+o.F*!q,{Symbol:j});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)f(te[re++]);for(var ne=E(f.store),ae=0;ne.length>ae;)h(ne[ae++]);o(o.S+o.F*!q,"Symbol",{for:function(e){return a(I,e+="")?I[e]:I[e]=j(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in I)if(I[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),o(o.S+o.F*!q,"Object",{create:function(e,t){return void 0===t?C(e):Z(C(e),t)},defineProperty:J,defineProperties:Z,getOwnPropertyDescriptor:X,getOwnPropertyNames:Q,getOwnPropertySymbols:ee});var ie=p(function(){A.f(1)});o(o.S+o.F*ie,"Object",{getOwnPropertySymbols:function(e){return A.f(y(e))}}),N&&o(o.S+o.F*(!q||p(function(){var e=j();return"[null]"!=D([e])||"{}"!=D({a:e})||"{}"!=D(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=arguments,a=[e],i=1;arguments.length>i;)a.push(n[i++]);if(r=t=a[1],(b(t)||void 0!==e)&&!Y(e))return g(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Y(t))return t}),a[1]=t,D.apply(N,a)}}),j.prototype[M]||r(4)(j.prototype,M,j.prototype.valueOf),d(j,"Symbol"),d(Math,"Math",!0),d(n.JSON,"JSON",!0)},function(e,t,r){var n=r(3);e.exports=function(e,t){if(!n(e))return e;var r,a;if(t&&"function"==typeof(r=e.toString)&&!n(a=r.call(e)))return a;if("function"==typeof(r=e.valueOf)&&!n(a=r.call(e)))return a;if(!t&&"function"==typeof(r=e.toString)&&!n(a=r.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(37);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,a){return e.call(t,r,n,a)}}return function(){return e.apply(t,arguments)}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(7);e.exports=function(e,t){return!!e&&n(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,r){var n=r(5).f,a=r(8),i=r(1)("toStringTag");e.exports=function(e,t,r){e&&!a(e=r?e:e.prototype,i)&&n(e,i,{configurable:!0,value:t})}},function(e,t,r){var n=r(17)("keys"),a=r(14);e.exports=function(e){return n[e]||(n[e]=a(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var n=r(12),a=r(65),i=r(28),o=r(27)("IE_PROTO"),s=function(){},l=function(){var e,t=r(36)("iframe"),n=i.length;for(t.style.display="none",r(66).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;n--;)delete l.prototype[i[n]];return l()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[o]=e):r=l(),void 0===t?r:a(r,t)}},function(e,t,r){var n=r(68),a=r(69),i=r(32),o=r(9);e.exports=r(70)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,a(1)):a(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),i.Arguments=i.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports={}},function(e,t,r){r(44)("asyncIterator")},function(e,t,r){var n=r(0),a=r(38)(0),i=r(25)([].forEach,!0);n(n.P+n.F*!i,"Array",{forEach:function(e){return a(this,e,arguments[1])}})},function(e,t,r){e.exports=!r(6)&&!r(7)(function(){return 7!=Object.defineProperty(r(36)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(3),a=r(2).document,i=n(a)&&n(a.createElement);e.exports=function(e){return i?a.createElement(e):{}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var n=r(22),a=r(39),i=r(19),o=r(40),s=r(60);e.exports=function(e,t){var r=1==e,l=2==e,p=3==e,c=4==e,d=6==e,u=5==e||d,f=t||s;return function(t,s,_){for(var h,m,g=i(t),v=a(g),b=n(s,_,3),y=o(v.length),w=0,k=r?f(t,y):l?f(t,0):void 0;y>w;w++)if((u||w in v)&&(m=b(h=v[w],w,g),e))if(r)k[w]=m;else if(m)switch(e){case 3:return!0;case 5:return h;case 6:return w;case 2:k.push(h)}else if(c)return!1;return d?-1:p||c?c:k}}},function(e,t,r){var n=r(23);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(41),a=Math.min;e.exports=function(e){return e>0?a(n(e),9007199254740991):0}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(23);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){t.f=r(1)},function(e,t,r){var n=r(2),a=r(11),i=r(18),o=r(43),s=r(5).f;e.exports=function(e){var t=a.Symbol||(a.Symbol=i?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,r){var n=r(8),a=r(9),i=r(46)(!1),o=r(27)("IE_PROTO");e.exports=function(e,t){var r,s=a(e),l=0,p=[];for(r in s)r!=o&&n(s,r)&&p.push(r);for(;t.length>l;)n(s,r=t[l++])&&(~i(p,r)||p.push(r));return p}},function(e,t,r){var n=r(9),a=r(40),i=r(64);e.exports=function(e){return function(t,r,o){var s,l=n(t),p=a(l.length),c=i(o,p);if(e&&r!=r){for(;p>c;)if((s=l[c++])!=s)return!0}else for(;p>c;c++)if((e||c in l)&&l[c]===r)return e||c||0;return!e&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(45),a=r(28).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,a)}},function(e,t,r){var n=r(29),a=r(16),i=r(9),o=r(21),s=r(8),l=r(35),p=Object.getOwnPropertyDescriptor;t.f=r(6)?p:function(e,t){if(e=i(e),t=o(t,!0),l)try{return p(e,t)}catch(e){}if(s(e,t))return a(!n.f.call(e,t),e[t])}},function(e,t,r){for(var n=r(31),a=r(15),i=r(13),o=r(2),s=r(4),l=r(32),p=r(1),c=p("iterator"),d=p("toStringTag"),u=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},_=a(f),h=0;h<_.length;h++){var m,g=_[h],v=f[g],b=o[g],y=b&&b.prototype;if(y&&(y[c]||s(y,c,u),y[d]||s(y,d,g),l[g]=u,v))for(m in n)y[m]||i(y,m,n[m],!0)}},function(e,t,r){var n=r(73),a={};a[r(1)("toStringTag")]="z",a+""!="[object z]"&&r(13)(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},function(e,t,r){var n=r(19),a=r(15);r(74)("keys",function(){return function(e){return a(n(e))}})},function(e,t,r){var n=r(0),a=r(38)(2);n(n.P+n.F*!r(25)([].filter,!0),"Array",{filter:function(e){return a(this,e,arguments[1])}})},function(e,t,r){var n=r(0);n(n.P,"Function",{bind:r(75)})},function(e,t,r){var n=r(0);n(n.S,"Object",{create:r(30)})},function(e,t,r){var n=r(0);n(n.S,"Object",{setPrototypeOf:r(81).set})},function(e,t,r){r(58),e.exports=r(82)},function(e,t){},function(e,t,r){e.exports=r(17)("native-function-to-string",Function.toString)},function(e,t,r){var n=r(61);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(3),a=r(42),i=r(1)("species");e.exports=function(e){var t;return a(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(14)("meta"),a=r(3),i=r(8),o=r(5).f,s=0,l=Object.isExtensible||function(){return!0},p=!r(7)(function(){return l(Object.preventExtensions({}))}),c=function(e){o(e,n,{value:{i:"O"+ ++s,w:{}}})},d=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,n)){if(!l(e))return"F";if(!t)return"E";c(e)}return e[n].i},getWeak:function(e,t){if(!i(e,n)){if(!l(e))return!0;if(!t)return!1;c(e)}return e[n].w},onFreeze:function(e){return p&&d.NEED&&l(e)&&!i(e,n)&&c(e),e}}},function(e,t,r){var n=r(15),a=r(47),i=r(29);e.exports=function(e){var t=n(e),r=a.f;if(r)for(var o,s=r(e),l=i.f,p=0;s.length>p;)l.call(e,o=s[p++])&&t.push(o);return t}},function(e,t,r){var n=r(41),a=Math.max,i=Math.min;e.exports=function(e,t){return(e=n(e))<0?a(e+t,0):i(e,t)}},function(e,t,r){var n=r(5),a=r(12),i=r(15);e.exports=r(6)?Object.defineProperties:function(e,t){a(e);for(var r,o=i(t),s=o.length,l=0;s>l;)n.f(e,r=o[l++],t[r]);return e}},function(e,t,r){var n=r(2).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(9),a=r(48).f,i={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==i.call(e)?function(e){try{return a(e)}catch(e){return o.slice()}}(e):a(n(e))}},function(e,t,r){var n=r(1)("unscopables"),a=Array.prototype;null==a[n]&&r(4)(a,n,{}),e.exports=function(e){a[n][e]=!0}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(18),a=r(0),i=r(13),o=r(4),s=r(32),l=r(71),p=r(26),c=r(72),d=r(1)("iterator"),u=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,r,_,h,m,g){l(r,t,_);var v,b,y,w=function(e){if(!u&&e in $)return $[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},k=t+" Iterator",x="values"==h,C=!1,$=e.prototype,S=$[d]||$["@@iterator"]||h&&$[h],A=S||w(h),T=h?x?w("entries"):A:void 0,E="Array"==t&&$.entries||S;if(E&&(y=c(E.call(new e)))!==Object.prototype&&y.next&&(p(y,k,!0),n||"function"==typeof y[d]||o(y,d,f)),x&&S&&"values"!==S.name&&(C=!0,A=function(){return S.call(this)}),n&&!g||!u&&!C&&$[d]||o($,d,A),s[t]=A,s[k]=f,h)if(v={values:x?A:w("values"),keys:m?A:w("keys"),entries:T},g)for(b in v)b in $||i($,b,v[b]);else a(a.P+a.F*(u||C),t,v);return v}},function(e,t,r){var n=r(30),a=r(16),i=r(26),o={};r(4)(o,r(1)("iterator"),function(){return this}),e.exports=function(e,t,r){e.prototype=n(o,{next:a(1,r)}),i(e,t+" Iterator")}},function(e,t,r){var n=r(8),a=r(19),i=r(27)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),n(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,r){var n=r(23),a=r(1)("toStringTag"),i="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?r:i?n(t):"Object"==(o=n(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,r){var n=r(0),a=r(11),i=r(7);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e],o={};o[e]=t(r),n(n.S+n.F*i(function(){r(1)}),"Object",o)}},function(e,t,r){var n=r(37),a=r(3),i=r(76),o=[].slice,s={};e.exports=Function.bind||function(e){var t=n(this),r=o.call(arguments,1),l=function(){var n=r.concat(o.call(arguments));return this instanceof l?function(e,t,r){if(!(t in s)){for(var n=[],a=0;a<t;a++)n[a]="a["+a+"]";s[t]=Function("F,a","return new F("+n.join(",")+")")}return s[t](e,r)}(t,n.length,n):i(t,n,e)};return a(t.prototype)&&(l.prototype=t.prototype),l}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){r(78)("trim",function(e){return function(){return e(this,3)}})},function(e,t,r){var n=r(0),a=r(24),i=r(7),o=r(79),s="["+o+"]",l=RegExp("^"+s+s+"*"),p=RegExp(s+s+"*$"),c=function(e,t,r){var a={},s=i(function(){return!!o[e]()||"​"!="​"[e]()}),l=a[e]=s?t(d):o[e];r&&(a[r]=l),n(n.P+n.F*s,"String",a)},d=c.trim=function(e,t){return e=String(a(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(p,"")),e};e.exports=c},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,r){var n=r(0),a=r(46)(!1),i=[].indexOf,o=!!i&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(o||!r(25)(i)),"Array",{indexOf:function(e){return o?i.apply(this,arguments)||0:a(this,e,arguments[1])}})},function(e,t,r){var n=r(3),a=r(12),i=function(e,t){if(a(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{(n=r(22)(Function.call,r(49).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return i(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:i}},function(e,t,r){r.r(t),r(34),r(20),r(50),r(31),r(51),r(52),r(10),r(53),r(54);var n=.75,a=10,i=!0,o=!0,s=!0,l=!1,p="driver-highlighted-element-stage",c='<div id="'.concat("driver-page-overlay",'"></div>'),d='<div id="'.concat(p,'"></div>');function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r(33),r(77);var f=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},_=function e(t,r){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){for(var n=["","-webkit-","-ms-","moz-","-o-"],a=0;a<n.length;a++){var i=e(t,n[a]+r);if(i)return i}return""}var o="";return t.currentStyle?o=t.currentStyle[r]:document.defaultView&&document.defaultView.getComputedStyle&&(o=document.defaultView.getComputedStyle(t,null).getPropertyValue(r)),o&&o.toLowerCase?o.toLowerCase():o},h=function(e){return e&&"object"===u(e)&&"nodeType"in e},m=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.highlightedElement=null,this.lastHighlightedElement=null,this.hideTimer=null,this.window=r,this.document=n,this.removeNode=this.removeNode.bind(this)}var t,r;return t=e,(r=[{key:"attachNode",value:function(){var e=this.document.getElementById("driver-page-overlay");e||(e=f(c),document.body.appendChild(e)),this.node=e,this.node.style.opacity="0",this.options.animate||this.node.parentElement&&this.node.parentElement.removeChild(this.node)}},{key:"highlight",value:function(e){e&&e.node?e.isSame(this.highlightedElement)||(this.window.clearTimeout(this.hideTimer),e.onHighlightStarted(),this.highlightedElement&&!this.highlightedElement.isSame(this.lastHighlightedElement)&&this.highlightedElement.onDeselected(),e.getCalculatedPosition().canHighlight()&&(this.lastHighlightedElement=this.highlightedElement,this.highlightedElement=e,this.show(),this.highlightedElement.onHighlighted())):console.warn("Invalid element to highlight. Must be an instance of `Element`")}},{key:"show",value:function(){var e=this;this.node&&this.node.parentElement||(this.attachNode(),window.setTimeout(function(){e.node.style.opacity="".concat(e.options.opacity),e.node.style.position="fixed",e.node.style.left="0",e.node.style.top="0",e.node.style.bottom="0",e.node.style.right="0"}))}},{key:"getHighlightedElement",value:function(){return this.highlightedElement}},{key:"getLastHighlightedElement",value:function(){return this.lastHighlightedElement}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.onReset&&this.options.onReset(this.highlightedElement),this.highlightedElement&&this.highlightedElement.onDeselected(!0),this.highlightedElement=null,this.lastHighlightedElement=null,this.node&&(this.window.clearTimeout(this.hideTimer),this.options.animate&&!e?(this.node.style.opacity="0",this.hideTimer=this.window.setTimeout(this.removeNode,300)):this.removeNode())}},{key:"removeNode",value:function(){this.node&&this.node.parentElement&&this.node.parentElement.removeChild(this.node)}},{key:"refresh",value:function(){this.highlightedElement&&(this.highlightedElement.showPopover(),this.highlightedElement.showStage())}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),e}();r(80);var g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.left,n=void 0===r?0:r,a=t.top,i=void 0===a?0:a,o=t.right,s=void 0===o?0:o,l=t.bottom,p=void 0===l?0:l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.left=n,this.right=s,this.top=i,this.bottom=p}var t,r;return t=e,(r=[{key:"canHighlight",value:function(){return this.left<this.right&&this.top<this.bottom}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),e}(),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.node,n=t.options,a=t.popover,i=t.stage,o=t.overlay,s=t.window,l=t.document;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.node=r,this.document=l,this.window=s,this.options=n,this.overlay=o,this.popover=a,this.stage=i,this.animationTimeout=null}var t,r;return t=e,(r=[{key:"isInView",value:function(){for(var e=this.node.offsetTop,t=this.node.offsetLeft,r=this.node.offsetWidth,n=this.node.offsetHeight,a=this.node;a.offsetParent;)e+=(a=a.offsetParent).offsetTop,t+=a.offsetLeft;return e>=this.window.pageYOffset&&t>=this.window.pageXOffset&&e+n<=this.window.pageYOffset+this.window.innerHeight&&t+r<=this.window.pageXOffset+this.window.innerWidth}},{key:"scrollManually",value:function(){var e=this.node.getBoundingClientRect().top+this.window.pageYOffset-this.window.innerHeight/2;this.window.scrollTo(0,e)}},{key:"bringInView",value:function(){if(this.node&&!this.isInView())if(this.node.scrollIntoView)try{this.node.scrollIntoView(this.options.scrollIntoViewOptions||{behavior:"instant",block:"center"})}catch(e){this.scrollManually()}else this.scrollManually()}},{key:"getCalculatedPosition",value:function(){var e=this.document.body,t=this.document.documentElement,r=this.window,n=this.window.pageYOffset||t.scrollTop||e.scrollTop,a=r.pageXOffset||t.scrollLeft||e.scrollLeft,i=this.node.getBoundingClientRect();return new g({top:i.top+n,left:i.left+a,right:i.left+a+i.width,bottom:i.top+n+i.height})}},{key:"getPopover",value:function(){return this.popover}},{key:"onDeselected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.hidePopover(),e&&this.hideStage(),this.removeHighlightClasses(),this.window.clearTimeout(this.animationTimeout),this.options.onDeselected&&this.options.onDeselected(this)}},{key:"isSame",value:function(e){return!(!e||!e.node)&&e.node===this.node}},{key:"onHighlightStarted",value:function(){this.options.onHighlightStarted&&this.options.onHighlightStarted(this)}},{key:"onHighlighted",value:function(){this.isInView()||this.bringInView(),this.showPopover(),this.showStage(),this.addHighlightClasses(),this.options.onHighlighted&&this.options.onHighlighted(this)}},{key:"removeHighlightClasses",value:function(){this.node.classList.remove("driver-highlighted-element"),this.node.classList.remove("driver-position-relative");for(var e=this.document.querySelectorAll(".".concat("driver-fix-stacking")),t=0;t<e.length;t++)e[t].classList.remove("driver-fix-stacking")}},{key:"addHighlightClasses",value:function(){this.node.classList.add("driver-highlighted-element"),this.canMakeRelative()&&this.node.classList.add("driver-position-relative"),this.fixStackingContext()}},{key:"fixStackingContext",value:function(){for(var e=this.node.parentNode;e&&e.tagName&&"body"!==e.tagName.toLowerCase();){var t=_(e,"z-index"),r=parseFloat(_(e,"opacity")),n=_(e,"transform",!0),a=_(e,"transform-style",!0),i=_(e,"transform-box",!0),o=_(e,"filter",!0),s=_(e,"perspective",!0);(/[0-9]+/.test(t)||r<1||n&&"none"!==n||a&&"flat"!==a||i&&"border-box"!==i||o&&"none"!==o||s&&"none"!==s)&&e.classList.add("driver-fix-stacking"),e=e.parentNode}}},{key:"canMakeRelative",value:function(){var e=this.getStyleProperty("position");return-1===["absolute","fixed","relative"].indexOf(e)}},{key:"getStyleProperty",value:function(e){return _(this.node,e)}},{key:"showStage",value:function(){this.stage.show(this.getCalculatedPosition())}},{key:"getNode",value:function(){return this.node}},{key:"hideStage",value:function(){this.stage.hide()}},{key:"hidePopover",value:function(){this.popover&&this.popover.hide()}},{key:"showPopover",value:function(){var e=this;if(this.popover){var t=this.getCalculatedPosition(),r=300;this.options.animate&&this.overlay.lastHighlightedElement||(r=0),this.animationTimeout=this.window.setTimeout(function(){e.popover.show(t)},r)}}},{key:"getFullPageSize",value:function(){var e=this.document.body,t=this.document.documentElement;return{height:Math.max(e.scrollHeight,e.offsetHeight,t.scrollHeight,t.offsetHeight),width:Math.max(e.scrollWidth,e.offsetWidth,t.scrollWidth,t.offsetWidth)}}},{key:"getSize",value:function(){return{height:Math.max(this.node.scrollHeight,this.node.offsetHeight),width:Math.max(this.node.scrollWidth,this.node.offsetWidth)}}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),e}();function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r(55),r(56);var x=function(e){function t(e,r,n){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,w(t).call(this))).options=function(e){for(var t=arguments,r=1;r<arguments.length;r++){var n=null!=t[r]?t[r]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){y(e,t,n[t])})}return e}({isFirst:!0,isLast:!0,totalCount:1,currentIndex:0,offset:0,showButtons:!0,closeBtnText:"Close",doneBtnText:"Done",startBtnText:"Next &rarr;",nextBtnText:"Next &rarr;",prevBtnText:"&larr; Previous"},e),a.window=r,a.document=n,a}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,v),r=t,(n=[{key:"attachNode",value:function(){var e=this.document.getElementById("driver-popover-item");e&&e.parentElement.removeChild(e),e=f(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return'\n  <div id="'.concat("driver-popover-item",'" class="').concat(e,'">\n    <div class="').concat("driver-popover-tip",'"></div>\n    <div class="').concat("driver-popover-title",'">Popover Title</div>\n    <div class="').concat("driver-popover-description",'">Popover Description</div>\n    <div class="driver-clearfix ').concat("driver-popover-footer",'">\n      <button class="').concat("driver-close-btn",'">Close</button>\n      <span class="driver-btn-group ').concat("driver-navigation-btns",'">\n        <button class="').concat("driver-prev-btn",'">&larr; Previous</button>\n        <button class="').concat("driver-next-btn",'">Next &rarr;</button>\n      </span>\n    </div>\n  </div>')}(this.options.className)),document.body.appendChild(e),this.node=e,this.tipNode=e.querySelector(".".concat("driver-popover-tip")),this.titleNode=e.querySelector(".".concat("driver-popover-title")),this.descriptionNode=e.querySelector(".".concat("driver-popover-description")),this.footerNode=e.querySelector(".".concat("driver-popover-footer")),this.nextBtnNode=e.querySelector(".".concat("driver-next-btn")),this.prevBtnNode=e.querySelector(".".concat("driver-prev-btn")),this.closeBtnNode=e.querySelector(".".concat("driver-close-btn"))}},{key:"getTitleNode",value:function(){return this.titleNode}},{key:"getDescriptionNode",value:function(){return this.descriptionNode}},{key:"hide",value:function(){this.node&&(this.node.style.display="none")}},{key:"setInitialState",value:function(){this.node.style.display="block",this.node.style.left="0",this.node.style.top="0",this.node.style.bottom="",this.node.style.right="",this.node.querySelector(".".concat("driver-popover-tip")).className="driver-popover-tip"}},{key:"show",value:function(e){switch(this.attachNode(),this.setInitialState(),this.titleNode.innerHTML=this.options.title,this.descriptionNode.innerHTML=this.options.description||"",this.renderFooter(),this.options.position){case"left":case"left-top":this.positionOnLeft(e);break;case"left-center":this.positionOnLeftCenter(e);break;case"left-bottom":this.positionOnLeftBottom(e);break;case"right":case"right-top":this.positionOnRight(e);break;case"right-center":this.positionOnRightCenter(e);break;case"right-bottom":this.positionOnRightBottom(e);break;case"top":case"top-left":this.positionOnTop(e);break;case"top-center":this.positionOnTopCenter(e);break;case"top-right":this.positionOnTopRight(e);break;case"bottom":case"bottom-left":this.positionOnBottom(e);break;case"bottom-center":this.positionOnBottomCenter(e);break;case"bottom-right":this.positionOnBottomRight(e);break;case"mid-center":this.positionOnMidCenter(e);break;case"auto":default:this.autoPosition(e)}this.bringInView()}},{key:"renderFooter",value:function(){this.nextBtnNode.innerHTML=this.options.nextBtnText,this.prevBtnNode.innerHTML=this.options.prevBtnText,this.closeBtnNode.innerHTML=this.options.closeBtnText;var e=this.options.totalCount&&1!==this.options.totalCount;this.options.showButtons?(e?(this.nextBtnNode.style.display="inline-block",this.prevBtnNode.style.display="inline-block",this.closeBtnNode.classList.remove("driver-close-only-btn")):(this.nextBtnNode.style.display="none",this.prevBtnNode.style.display="none",this.closeBtnNode.classList.add("driver-close-only-btn")),this.footerNode.style.display="block",this.options.isFirst?(this.prevBtnNode.classList.add("driver-disabled"),this.nextBtnNode.innerHTML=this.options.startBtnText):this.prevBtnNode.classList.remove("driver-disabled"),this.options.isLast?this.nextBtnNode.innerHTML=this.options.doneBtnText:this.nextBtnNode.innerHTML=this.options.nextBtnText):this.footerNode.style.display="none"}},{key:"positionOnLeft",value:function(e){var t=this.getSize().width,r=this.options.padding+10;this.node.style.left="".concat(e.left-t-r,"px"),this.node.style.top="".concat(e.top+this.options.offset-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("right")}},{key:"positionOnLeftBottom",value:function(e){var t=this.getSize(),r=t.width,n=this.options.padding+10;this.node.style.left="".concat(e.left-r-n,"px"),this.node.style.top="".concat(e.bottom+this.options.padding+this.options.offset-t.height,"px"),this.node.style.bottom="",this.node.style.right="",this.tipNode.classList.add("right","position-bottom")}},{key:"positionOnLeftCenter",value:function(e){var t=this.getSize(),r=t.width,n=t.height/2,a=this.options.padding+10,i=(e.bottom-e.top)/2,o=e.top-n+i+this.options.offset;this.node.style.left="".concat(e.left-r-a,"px"),this.node.style.top="".concat(o,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("right","position-center")}},{key:"positionOnRight",value:function(e){var t=this.options.padding+10;this.node.style.left="".concat(e.right+t,"px"),this.node.style.top="".concat(e.top+this.options.offset-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("left")}},{key:"positionOnRightCenter",value:function(e){var t=this.getSize(),r=this.options.padding+10,n=t.height/2,a=(e.bottom-e.top)/2,i=e.top-n+a+this.options.offset;this.node.style.left="".concat(e.right+r,"px"),this.node.style.top="".concat(i,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("left","position-center")}},{key:"positionOnRightBottom",value:function(e){var t=this.options.padding+10,r=this.getSize();this.node.style.left="".concat(e.right+t,"px"),this.node.style.top="".concat(e.bottom+this.options.padding+this.options.offset-r.height,"px"),this.node.style.bottom="",this.node.style.right="",this.tipNode.classList.add("left","position-bottom")}},{key:"positionOnTop",value:function(e){var t=this.getSize().height,r=this.options.padding+10;this.node.style.top="".concat(e.top-t-r,"px"),this.node.style.left="".concat(e.left-this.options.padding+this.options.offset,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("bottom")}},{key:"positionOnTopCenter",value:function(e){var t=this.getSize(),r=t.height,n=t.width/2,a=this.options.padding+10,i=this.options.offset+e.left+(e.right-e.left)/2;this.node.style.top="".concat(e.top-r-a,"px"),this.node.style.left="".concat(i-n-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("bottom","position-center")}},{key:"positionOnTopRight",value:function(e){var t=this.getSize(),r=t.height,n=this.options.padding+10;this.node.style.top="".concat(e.top-r-n,"px"),this.node.style.left="".concat(e.right+this.options.padding+this.options.offset-t.width,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("bottom","position-right")}},{key:"positionOnBottom",value:function(e){var t=this.options.padding+10;this.node.style.top="".concat(e.bottom+t,"px"),this.node.style.left="".concat(e.left-this.options.padding+this.options.offset,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("top")}},{key:"positionOnBottomCenter",value:function(e){var t=this.getSize().width/2,r=this.options.padding+10,n=this.options.offset+e.left+(e.right-e.left)/2;this.node.style.top="".concat(e.bottom+r,"px"),this.node.style.left="".concat(n-t-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("top","position-center")}},{key:"positionOnBottomRight",value:function(e){var t=this.getSize(),r=this.options.padding+10;this.node.style.top="".concat(e.bottom+r,"px"),this.node.style.left="".concat(e.right+this.options.padding+this.options.offset-t.width,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("top","position-right")}},{key:"positionOnMidCenter",value:function(e){var t=this.getSize(),r=t.height,n=t.width/2,a=r/2,i=(e.bottom-e.top)/2,o=e.top-a+i+this.options.offset,s=this.options.offset+e.left+(e.right-e.left)/2;this.node.style.top="".concat(o,"px"),this.node.style.left="".concat(s-n-this.options.padding,"px"),this.node.style.right="",this.node.style.bottom="",this.tipNode.classList.add("mid-center")}},{key:"autoPosition",value:function(e){var t=this.getFullPageSize(),r=this.getSize(),n=t.height,a=r.height,i=this.options.padding+10;e.bottom+a+i>=n?this.positionOnTop(e):this.positionOnBottom(e)}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),t}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var A=function(e){function t(e,r,n){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,$(t).call(this))).options=e,a.window=r,a.document=n,a}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,v),r=t,(n=[{key:"attachNode",value:function(){var e=this.document.getElementById(p);e||(e=f(d),document.body.appendChild(e)),this.node=e,this.options.animate?this.node.classList.remove("driver-stage-no-animation"):this.node.classList.add("driver-stage-no-animation")}},{key:"hide",value:function(){this.node&&this.node.parentElement&&this.node.parentElement.removeChild(this.node)}},{key:"setInitialStyle",value:function(){this.node.style.display="block",this.node.style.left="0",this.node.style.top="0",this.node.style.bottom="",this.node.style.right=""}},{key:"show",value:function(e){this.attachNode(),this.setInitialStyle();var t=2*this.options.padding,r=e.right-e.left+t,n=e.bottom-e.top+t;this.node.style.display="block",this.node.style.position="absolute",this.node.style.width="".concat(r,"px"),this.node.style.height="".concat(n,"px"),this.node.style.top="".concat(e.top-t/2,"px"),this.node.style.left="".concat(e.left-t/2,"px"),this.node.style.backgroundColor=this.options.stageBackground}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(r.prototype,n),t}();function T(e){for(var t=arguments,r=1;r<arguments.length;r++){var n=null!=t[r]?t[r]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){E(e,t,n[t])})}return e}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"default",function(){return O});var O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=T({animate:i,opacity:n,padding:a,scrollIntoViewOptions:null,allowClose:o,keyboardControl:s,overlayClickNext:l,stageBackground:"#ffffff",onHighlightStarted:function(){return null},onHighlighted:function(){return null},onDeselected:function(){return null},onReset:function(){return null},onNext:function(){return null},onPrevious:function(){return null}},t),this.document=document,this.window=window,this.isActivated=!1,this.steps=[],this.currentStep=0,this.currentMovePrevented=!1,this.overlay=new m(this.options,window,document),this.onResize=this.onResize.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onClick=this.onClick.bind(this),this.moveNext=this.moveNext.bind(this),this.movePrevious=this.movePrevious.bind(this),this.preventMove=this.preventMove.bind(this),this.bind()}var t,r;return t=e,(r=[{key:"getSteps",value:function(){return this.steps}},{key:"setSteps",value:function(e){this.steps=e}},{key:"bind",value:function(){this.window.addEventListener("resize",this.onResize,!1),this.window.addEventListener("keyup",this.onKeyUp,!1),"ontouchstart"in document.documentElement?this.window.addEventListener("touchstart",this.onClick,!1):this.window.addEventListener("click",this.onClick,!1)}},{key:"onClick",value:function(e){if(this.isActivated&&this.hasHighlightedElement()){e.stopPropagation();var t=this.overlay.getHighlightedElement(),r=this.document.getElementById("driver-popover-item"),n=t.node.contains(e.target),a=r&&r.contains(e.target);if(n||a||!this.options.overlayClickNext)if(n||a||!this.options.allowClose){var i=e.target.classList.contains("driver-next-btn"),o=e.target.classList.contains("driver-prev-btn");e.target.classList.contains("driver-close-btn")?this.reset():i?this.handleNext():o&&this.handlePrevious()}else this.reset();else this.handleNext()}}},{key:"onResize",value:function(){this.isActivated&&this.refresh()}},{key:"refresh",value:function(){this.overlay.refresh()}},{key:"onKeyUp",value:function(e){if(this.isActivated&&this.options.keyboardControl)if(27!==e.keyCode){var t=this.getHighlightedElement();t&&t.popover&&(39===e.keyCode?this.handleNext():37===e.keyCode&&this.handlePrevious())}else this.reset()}},{key:"movePrevious",value:function(){var e=this.steps[this.currentStep-1];e?(this.overlay.highlight(e),this.currentStep-=1):this.reset()}},{key:"preventMove",value:function(){this.currentMovePrevented=!0}},{key:"handleNext",value:function(){this.currentMovePrevented=!1;var e=this.steps[this.currentStep];e&&e.options&&e.options.onNext&&e.options.onNext(this.overlay.highlightedElement),this.currentMovePrevented||this.moveNext()}},{key:"handlePrevious",value:function(){this.currentMovePrevented=!1;var e=this.steps[this.currentStep];e&&e.options&&e.options.onPrevious&&e.options.onPrevious(this.overlay.highlightedElement),this.currentMovePrevented||this.movePrevious()}},{key:"moveNext",value:function(){var e=this.steps[this.currentStep+1];e?(this.overlay.highlight(e),this.currentStep+=1):this.reset()}},{key:"hasNextStep",value:function(){return!!this.steps[this.currentStep+1]}},{key:"hasPreviousStep",value:function(){return!!this.steps[this.currentStep-1]}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.currentStep=0,this.isActivated=!1,this.overlay.clear(e)}},{key:"hasHighlightedElement",value:function(){var e=this.overlay.getHighlightedElement();return e&&e.node}},{key:"getHighlightedElement",value:function(){return this.overlay.getHighlightedElement()}},{key:"getLastHighlightedElement",value:function(){return this.overlay.getLastHighlightedElement()}},{key:"defineSteps",value:function(e){this.steps=[];for(var t=0;t<e.length;t++){var r=this.prepareElementFromStep(e[t],e,t);r&&this.steps.push(r)}}},{key:"prepareElementFromStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=T({},this.options),a=e,i="string"!=typeof e&&!h(e);if(!e||i&&!e.element)throw new Error("Element is required in step ".concat(r));i&&(a=e.element,n=T({},this.options,e));var o=h(a)?a:this.document.querySelector(a);if(!o)return console.warn("Element to highlight ".concat(a," not found")),null;var s=null;if(n.popover&&n.popover.title){var l=[this.options.className,n.popover.className].filter(function(e){return e}).join(" "),p=T({},n,n.popover,{className:l,totalCount:t.length,currentIndex:r,isFirst:0===r,isLast:0===t.length||r===t.length-1});s=new x(p,this.window,this.document)}var c=T({},n),d=new A(c,this.window,this.document);return new v({node:o,options:n,popover:s,stage:d,overlay:this.overlay,window:this.window,document:this.document})}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.steps||0===this.steps.length)throw new Error("There are no steps defined to iterate");this.isActivated=!0,this.currentStep=e,this.overlay.highlight(this.steps[e])}},{key:"highlight",value:function(e){this.isActivated=!0;var t=this.prepareElementFromStep(e);t&&this.overlay.highlight(t)}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,r),e}()}]).default}),Driver=unwrapExports(driver_min),driver_min_1=driver_min.Driver;return frappe.Driver=Driver,frappe.provide("frappe.barcode"),frappe.barcode.scan_barcode=function(){return new Promise(function(e,t){window.cordova&&window.cordova.plugins&&window.cordova.plugins.barcodeScanner?window.cordova.plugins.barcodeScanner.scan(function(t){t.cancelled||e(t.text)},t):frappe.require("/assets/js/barcode_scanner.min.js",function(){frappe.barcode.get_barcode().then(function(t){e(t)})})})},exports.__moduleExports=_class,exports}({});
//# sourceMappingURL=desk.min.js.map
